[
  {
    "objectID": "modelGrowthFlowByRiver.html#growth-models",
    "href": "modelGrowthFlowByRiver.html#growth-models",
    "title": "10Â  Growth in mass byRiver/byArea",
    "section": "10.1 Growth models",
    "text": "10.1 Growth models\n\n10.1.0.1 Environment/growth raw data graphs\n\n\n\n\n\nCode\nplotFlowGR_byRiver <- function(d, r){\n  fig1 <- ggplot(d |> filter(riverGG == r), aes(meanFlowByRiver, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    #geom_smooth(se = FALSE) +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2)) +\n    labs(x = \"Mean flow by river\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    #ggtitle(r) +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n  \n  fig2 <- ggplot(d |> filter(riverGG == r), aes(meanFlowByArea_flowExt, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    #geom_smooth(se = FALSE) +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2)) +\n    labs(x = \"Mean flow by area\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    #ggtitle(r) +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n  \n  grid.arrange(fig1, fig2, ncol = 2)\n}\n\nplotFlowGR_byRiverOverlay <- function(d, r){\n  ggplot(d |> filter(riverGG == r), aes(meanFlowByRiver, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2), color = \"grey3\") +\n    \n    geom_point(alpha = 0.05, color = \"green4\", aes(meanFlowByArea_flowExt, grWeight))  +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2), color = \"green4\", aes(meanFlowByArea_flowExt, grWeight)) +\n    \n    labs(x = \"Mean flow by river\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    #ggtitle(r) +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n}\n\n\n\nWest BrookOpen LargeOpen SmallIsolated small\n\n\n\n\nCode\nplotFlowGR_byRiver(dGAM, \"West Brook\")\n\n\n\n\n\nCode\nplotFlowGR_byRiverOverlay(dGAM, \"West Brook\")\n\n\n\n\n\n\n\n\n\nCode\nplotFlowGR_byRiver(dGAM, \"Open Large\")\n\n\n\n\n\nCode\nplotFlowGR_byRiverOverlay(dGAM, \"Open Large\")\n\n\n\n\n\n\n\n\n\nCode\nplotFlowGR_byRiver(dGAM, \"Open Small\")\n\n\n\n\n\nCode\nplotFlowGR_byRiverOverlay(dGAM, \"Open Small\")\n\n\n\n\n\n\n\n\n\nCode\nplotFlowGR_byRiver(dGAM, \"Isolated Small\")\n\n\n\n\n\nCode\nplotFlowGR_byRiverOverlay(dGAM, \"Isolated Small\")\n\n\n\n\n\n\n\n\n\n\n10.1.1 Flow duration curve data\n\n\nCode\nplotFDC_GR_byRiver <- function(d, r){\n  fig1 <- ggplot(d |> filter(riverGG == r), aes(propBelowLoFlowThreshByRiverRiver, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    #geom_smooth(se = FALSE) +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2)) +\n    labs(x = \"Proportion of high flow days\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    ggtitle(\"Flow by river\") +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n  \n  fig2 <- ggplot(d |> filter(riverGG == r), aes(propAboveHiFlowThreshByRiverRiver, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    #geom_smooth(se = FALSE) +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2)) +\n    labs(x = \"Proportion of low flow days\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    ggtitle(\"Flow by river\") +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n  \n  grid.arrange(fig1, fig2, ncol = 2)\n}\n\nplotFDC_GR_byArea <- function(d, r){\n  fig1 <- ggplot(d |> filter(riverGG == r), aes(propBelowLoFlowThreshByRiverArea_flowExt, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    #geom_smooth(se = FALSE) +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2)) +\n    labs(x = \"Proportion of high flow days\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    ggtitle(\"Flow by area\") +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n  \n  fig2 <- ggplot(d |> filter(riverGG == r), aes(propAboveHiFlowThreshByRiverArea_flowExt, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    #geom_smooth(se = FALSE) +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2)) +\n    labs(x = \"Proportion of low flow days\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    ggtitle(\"Flow by area\") +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n  \n  grid.arrange(fig1, fig2, ncol = 2)\n}\n\n\nplotFlowGR_byRiverOverlay <- function(d, r){\n  ggplot(d |> filter(riverGG == r), aes(meanFlowByRiver, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2), color = \"grey3\") +\n    \n    geom_point(alpha = 0.05, color = \"green4\", aes(meanFlowByArea_flowExt, grWeight))  +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2), color = \"green4\", aes(meanFlowByArea_flowExt, grWeight)) +\n    \n    labs(x = \"Mean flow by river (black = byRiver, green = byArea)\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    #ggtitle(r) +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n}\n\n\n\nWest BrookOpen LargeOpen SmallIsolated small\n\n\n\n\nCode\nplotFDC_GR_byRiver(dGAM, \"West Brook\")\n\n\n\n\n\nCode\nplotFDC_GR_byArea(dGAM, \"West Brook\")\n\n\n\n\n\n\n\n\n\nCode\nplotFDC_GR_byRiver(dGAM, \"Open Large\")\n\n\n\n\n\nCode\nplotFDC_GR_byArea(dGAM, \"Open Large\")\n\n\n\n\n\n\n\n\n\nCode\nplotFDC_GR_byRiver(dGAM, \"Open Small\")\n\n\n\n\n\nCode\nplotFDC_GR_byArea(dGAM, \"Open Small\")\n\n\n\n\n\n\n\n\n\nCode\nplotFDC_GR_byRiver(dGAM, \"Isolated Small\")\n\n\n\n\n\nCode\nplotFDC_GR_byArea(dGAM, \"Isolated Small\")\n\n\n\n\n\n\n\n\n\n10.1.1.1 Flow compared with flow duration curve metrics\n\n\nCode\n ggplot(dGAM, aes(flowByRiverS, propBelowLoFlowThreshByRiver)) +\n   geom_point() +\n   geom_point(aes(flowByRiverS, propBelowLoFlowThreshByArea_flowExt), color  = \"green4\") +\n   facet_grid(seasonGG ~ riverGG, scales = \"free\")\n\n\n\n\n\nBy river in black and by area in green\n\n\n\n\n\n\nCode\n ggplot(dGAM, aes(flowByRiverS, propAboveHiFlowThreshByRiver)) +\n   geom_point() +\n   geom_point(aes(flowByRiverS, propAboveHiFlowThreshByArea_flowExt), color  = \"green4\") +\n   facet_grid(seasonGG ~ riverGG, scales = \"free\")\n\n\n\n\n\nBy river in black and by area in green\n\n\n\n\n\n\n\n10.1.2 Flow models\n\n10.1.2.1 Flow standardized by season\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n10.1.2.2 Brook trout - flow by area\nredo models\n\n\nCode\nlmS1ByArea <- lm(\n  grWeight ~\n    (riverGG + seasonGG + observedWeight + tempS + flowByAreaS + \n     propBelowLoFlowThreshByArea_flowExt + propAboveHiFlowThreshByArea_flowExt)^2,\n  data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013))\n\nlmS2ByArea <- lm(\n  grWeight ~\n    (riverGG + seasonGG + observedWeight)^2 +\n    (riverGG + seasonGG + poly(tempS, 2) + poly(flowByAreaS, 2))^2 + \n    (riverGG + seasonGG + propBelowLoFlowThreshByArea_flowExt + propAboveHiFlowThreshByArea_flowExt)^2,\n  data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013))\n\nAIC(lmS1ByArea, lmS2ByArea) |> arrange(AIC)\n\n\n           df       AIC\nlmS2ByArea 71 -86683.73\nlmS1ByArea 62 -86486.14\n\n\n\n\n10.1.2.3 Brook trout - flow by river\nredo models\n\n\nCode\nlmS1ByRiver <- lm(\n  grWeight ~\n    (riverGG + seasonGG + observedWeight + tempS + flowByRiverS + \n     propBelowLoFlowThreshByRiver + propAboveHiFlowThreshByRiver)^2,\n  data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013))\n\nlmS2ByRiver <- lm(\n  grWeight ~\n    (riverGG + seasonGG + observedWeight)^2 +\n    (riverGG + seasonGG + poly(tempS, 2) + poly(flowByRiverS, 2))^2 + \n    (riverGG + seasonGG + propBelowLoFlowThreshByRiver + propAboveHiFlowThreshByRiver)^2,\n  data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013))\n\nlmS3ByRiver <- lm(\n  grWeight ~\n    (riverGG + seasonGG + observedWeight)^2 +\n    (riverGG + seasonGG + poly(tempS, 2) + poly(flowByRiverS, 2))^2, \n    #(riverGG + seasonGG + propBelowLoFlowThreshByRiver + propAboveHiFlowThreshByRiver)^2,\n  data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013))\n\nlmS4ByRiver <- lm(\n  grWeight ~\n    (riverGG + seasonGG + observedWeight)^2 +\n    (riverGG + seasonGG + poly(tempS, 2) + poly(flowByRiverS, 2))^2 + \n    (propBelowLoFlowThreshByRiver + propAboveHiFlowThreshByRiver)^2,\n  data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013))\n\n\nAIC(lmS1ByRiver, lmS2ByRiver, lmS3ByRiver, lmS4ByRiver) |> arrange(AIC)\n\n\n            df       AIC\nlmS2ByRiver 71 -86808.62\nlmS4ByRiver 59 -86667.15\nlmS1ByRiver 62 -86534.56\nlmS3ByRiver 56 -86412.23\n\n\n\n\n10.1.2.4 Brook trout - compare flow byArea and flow byRiver gams\n\n\nCode\npredictBKTlmS <- function(dIn, modInFlowByArea, modInFlowByRiver){\n    \n  predMatByArea0 <- \n    expand.grid(\n      flowByAreaS = seq(-1.5, 1.5, 0.5),\n      propBelowLoFlowThreshByArea_flowExt = seq(0, 0.8, 0.2),\n      propAboveHiFlowThreshByArea_flowExt = seq(0, 0.6, 0.2),\n      tempS = seq(-1.5, 1.5, 0.5), \n      #meanFlowByArea_flowExt = seq(0, 0.8, 0.2), \n      #meanTemperature = seq(0, 20, 5), \n      riverGG = unique(dIn$riverGG), \n      seasonGG= unique(dIn$seasonGG),\n      observedWeight = c(2, 10, 30, 60), #seq(2, max(dIn$observedWeight, na.rm = TRUE)/2, 20),\n      #cohortF = 2000:2013,#unique(dIn$cohortF),\n      byRiver = FALSE\n    ) \n  predMatByArea <- \n    add_column(\n      pred = predict.lm(modInFlowByArea, predMatByArea0),\n      predMatByArea0\n    ) |> \n    rename(flow = flowByAreaS, temp = tempS,\n           #meanFlow = meanFlowByArea_flowExt, meanTemperature = meanTemperature,\n           loFlowThresh = propBelowLoFlowThreshByArea_flowExt, \n           hiFlowThresh = propAboveHiFlowThreshByArea_flowExt)\n  \n########\n  predMatByRiver0 <- \n    expand.grid(\n      flowByRiverS = seq(-1.5, 1.5, 0.5), \n      propBelowLoFlowThreshByRiver = seq(0, 0.8, 0.2),\n      propAboveHiFlowThreshByRiver = seq(0, 0.6, 0.2),\n      tempS = seq(-1.5, 1.5, 0.5), \n      #meanFlowByRiver = seq(0, 0.8, 0.2), \n      #meanTemperature = seq(0, 20, 5),\n      riverGG = unique(dIn$riverGG), \n      seasonGG= unique(dIn$seasonGG),\n      observedWeight = c(2, 10, 30, 60), #seq(2, max(dIn$observedWeight, na.rm = TRUE)/2, 20),\n      #cohortF = 2000:2013,#uunique(dIn$cohortF),\n      byRiver = TRUE\n  )\n  \n  predMatByRiver <- \n    add_column(\n      pred = predict.lm(modInFlowByRiver, predMatByRiver0),\n      predMatByRiver0\n    ) |> \n    rename(flow = flowByRiverS, temp = tempS,\n           #meanFlow = meanFlowByRiver, meanTemperature = meanTemperature,\n           loFlowThresh = propBelowLoFlowThreshByRiver, hiFlowThresh = propAboveHiFlowThreshByRiver)\n\n  return(add_row(predMatByArea, predMatByRiver))\n}\n\nlmSBKTPredictions <- predictBKTlmS(dGAM, lmS2ByArea, lmS2ByRiver) |> \n  mutate(byLoFlowThresh = paste(byRiver, loFlowThresh, sep=\"_\"),\n         byHiFlowThresh = paste(byRiver, hiFlowThresh, sep=\"_\"))\n\n\n\n\n10.1.2.5 For talk\nWest brook\n\n\nCode\nggplot(\n  lmSBKTPredictions |> \n    filter(\n      observedWeight == 10,\n      loFlowThresh == 0,\n      hiFlowThresh == 0,\n      temp == 0,#c(-1.5,0,1.5)\n      riverGG == \"West Brook\"\n    ), \n  aes(flow, pred, color = (byRiver), group = (byRiver))) +\n  geom_line(size = 1.5) +\n  geom_point(size = 5) +\n  labs(x = \"Standardized stream flow\", y = \"Predicted growth rate\") +\n  #ylim(-0.02, 0.06) +\n  #geom_smooth(se = FALSE) +\n  geom_hline(yintercept = 0) +\n  theme_publication(24) +\n  ggtitle(\"West Brook\") +\n  scale_color_manual(values = colorsTalk) +\n  facet_wrap(~seasonGG)#, scales = 'free')\n\n\n\n\n\nCode\nggplot(\n  lmSBKTPredictions |> \n    filter(\n      observedWeight %in% c(10),\n      loFlowThresh == 0,\n      hiFlowThresh == 0,\n      #flow %in% c(-1.5,0,1.5),\n      temp %in% 1,#c(-1.5,0,1.5)\n      riverGG == \"West Brook\"\n    ), \n  aes(flow, pred, color = (byRiver), group = (byRiver))) +\n  geom_line(size = 1.5) +\n  geom_point(size = 5) +\n  labs(x = \"Standardized stream flow\", y = \"Predicted growth rate\") +\n  #ylim(-0.02, 0.06) +\n  #geom_smooth(se = FALSE) +\n  geom_hline(yintercept = 0) +\n  theme_publication(24) +\n  ggtitle(\"West Brook\") +\n  scale_color_manual(values = colorsTalk) +\n  facet_wrap(~seasonGG)#, scales = 'free')\n\n\n\n\n\n\n\nCode\nggplot(\n  lmSBKTPredictions |> \n    filter(\n      observedWeight == 10,\n      #loFlowThresh == 0,\n      hiFlowThresh == 0,\n      temp == 0,#c(-1.5,0,1.5)\n      riverGG == \"West Brook\"\n    ), \n  aes(flow, pred, color = (byRiver), group = (byLoFlowThresh), alpha = loFlowThresh)) +\n  scale_alpha(range = c(1, 0.1)) +\n  geom_line(size = 1.5) +\n  geom_point(size = 5) +\n  labs(x = \"Standardized stream flow\", y = \"Predicted growth rate\") +\n  #ylim(-0.02, 0.06) +\n  #geom_smooth(se = FALSE) +\n  geom_hline(yintercept = 0) +\n  theme_publication(24) +\n  ggtitle(\"West Brook\") +\n  scale_color_manual(values = colorsTalk) +\n  facet_wrap(~seasonGG)#, scales = 'free')\n\n\n\n\n\nCode\nggplot(\n  lmSBKTPredictions |> \n    filter(\n      observedWeight == 10,\n      loFlowThresh == 0,\n      #hiFlowThresh == 0,\n      temp == 0,#c(-1.5,0,1.5)\n      riverGG == \"West Brook\"\n    ), \n  aes(flow, pred, color = (byRiver), group = (byHiFlowThresh), alpha = hiFlowThresh)) +\n  scale_alpha(range = c(1, 0.1)) +\n  geom_line(size = 1.5) +\n  geom_point(size = 5) +\n  labs(x = \"Standardized stream flow\", y = \"Predicted growth rate\") +\n  #ylim(-0.02, 0.06) +\n  #geom_smooth(se = FALSE) +\n  geom_hline(yintercept = 0) +\n  theme_publication(24) +\n  ggtitle(\"West Brook\") +\n  scale_color_manual(values = colorsTalk) +\n  facet_wrap(~seasonGG)#, scales = 'free')\n\n\n\n\n\nOpen Large\n\n\nCode\nggplot(\n  lmSBKTPredictions |> \n    filter(\n      observedWeight %in% c(10),\n      loFlowThresh == 0,\n      hiFlowThresh == 0,\n      #cohortF == 2012, \n      #flow %in% c(-1.5,0,1.5),\n      #meanFlow == 0.4,\n      #meanTemperature == 10,\n      temp %in% 0,#c(-1.5,0,1.5)\n      riverGG == \"Open Large\"\n    ), \n  aes(flow, pred, color = (byRiver), group = (byRiver))) +\n  geom_line(size = 1.5) +\n  geom_point(size = 5) +\n  labs(x = \"Standardized stream flow\", y = \"Predicted growth rate\") +\n  #ylim(-0.02, 0.06) +\n  #geom_smooth(se = FALSE) +\n  geom_hline(yintercept = 0) +\n  theme_publication(24) +\n  ggtitle(\"Open Large\") +\n  scale_color_manual(values = colorsTalk) +\n  facet_wrap(~seasonGG)#, scales = 'free')\n\n\n\n\n\nCode\nggplot(\n  lmSBKTPredictions |> \n    filter(\n      observedWeight %in% c(10),\n      loFlowThresh == 0,\n      hiFlowThresh == 0,\n      #flow %in% c(-1.5,0,1.5),\n      temp %in% 1,#c(-1.5,0,1.5)\n      riverGG == \"Open Large\"\n    ), \n  aes(flow, pred, color = (byRiver), group = (byRiver))) +\n  geom_line(size = 1.5) +\n  geom_point(size = 5) +\n  labs(x = \"Standardized stream flow\", y = \"Predicted growth rate\") +\n  #ylim(-0.02, 0.06) +\n  #geom_smooth(se = FALSE) +\n  geom_hline(yintercept = 0) +\n  theme_publication(24) +\n  ggtitle(\"Open Large\") +\n  scale_color_manual(values = colorsTalk) +\n  facet_wrap(~seasonGG)#, scales = 'free')\n\n\n\n\n\n\n\n\n10.1.3 Flow std by season/river (not used)\n\n\nCode\nplotFlowGR_SR_byRiver <- function(d, r){\n  fig1 <- ggplot(d |> filter(riverGG == r), aes(flowByRiverSR, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    geom_smooth(se = FALSE) +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2)) +\n    labs(x = \"Mean flow by river\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    #ggtitle(r) +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n  \n  fig2 <- ggplot(d |> filter(riverGG == r), aes(flowByAreaSR, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se = FALSE) +\n    geom_smooth(se = FALSE) +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2)) +\n    labs(x = \"Mean flow by area\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    #ggtitle(r) +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n  \n  grid.arrange(fig1, fig2, ncol = 2)\n}\n\nplotFlowGR_SR_byRiverOverlay <- function(d, r){\n  ggplot(d |> filter(riverGG == r), aes(flowByRiverSR, grWeight)) +\n    geom_point(alpha = 0.05)  +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2), color = \"grey3\") +\n    \n    geom_point(alpha = 0.05, color = \"green4\", aes(flowByAreaSR, grWeight))  +\n    geom_smooth(method = \"lm\", se =FALSE, formula = y~poly(x,2), color = \"green4\", aes(flowByAreaSR, grWeight)) +\n    \n    labs(x = \"Mean flow by river\", y = \"Growth in mass\") +\n    scale_color_discrete() +\n    #ggtitle(r) +\n    facet_grid(seasonGG~speciesGG)#, scales = 'free')\n}\n\n\n\nWest BrookOpen LargeOpen SmallIsolated small\n\n\n\n\nCode\nplotFlowGR_SR_byRiver(dGAM, \"West Brook\")\n\n\n\n\n\nCode\nplotFlowGR_SR_byRiverOverlay(dGAM, \"West Brook\")\n\n\n\n\n\n\n\n\n\nCode\nplotFlowGR_SR_byRiver(dGAM, \"Open Large\")\n\n\n\n\n\nCode\nplotFlowGR_SR_byRiverOverlay(dGAM, \"Open Large\")\n\n\n\n\n\n\n\n\n\nCode\nplotFlowGR_SR_byRiver(dGAM, \"Open Small\")\n\n\n\n\n\nCode\nplotFlowGR_SR_byRiverOverlay(dGAM, \"Open Small\")\n\n\n\n\n\n\n\n\n\nCode\nplotFlowGR_SR_byRiver(dGAM, \"Isolated Small\")\n\n\n\n\n\nCode\nplotFlowGR_SR_byRiverOverlay(dGAM, \"Isolated Small\")\n\n\n\n\n\n\n\n\n\n10.1.3.1 Brook trout - flow\nuse scale(temperature) instead of tempSR?\n\n\nCode\nkIn = 4\nspeciesIn <- \"Brook trout\"\n\ngamSR0 <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowSR)^2 + cohortF * ageF +             \n               s(flowSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\ngamSR1 <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowSR)^2 + cohortF +             \n               s(flowSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\n# age matters, what about taking out length?\ngamSR2 <- bam(grWeight ~ (riverGG + seasonGG  + tempSR + flowSR)^2 + cohortF * ageF +             \n               s(flowSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\n#nope, need to keep length\n#How about without the interactions?\ngamSR3 <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowSR) + cohortF * ageF +             \n               s(flowSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n#nope, need the interactions\n\nAIC(gamSR0, gamSR1, gamSR2, gamSR3) |> arrange(AIC)\n\n\n              df       AIC\ngamSR0 118.69693 -87324.21\ngamSR1  68.72459 -86378.09\ngamSR2 109.59850 -85805.33\ngamSR3 102.43371 -85526.74\n\n\n\n\n10.1.3.2 Brook trout - flow by river\n\n\nCode\ngamSR0ByRiver <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowByRiverSR)^2 + cohortF * ageF +             \n               s(flowByRiverSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowByRiverSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\ngamSR1ByRiver <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowByRiverSR)^2 + cohortF +             \n               s(flowByRiverSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowByRiverSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\n# age matters, what about taking out length?\ngamSR2ByRiver <- bam(grWeight ~ (riverGG + seasonGG  + tempSR + flowByRiverSR)^2 + cohortF * ageF +             \n               s(flowByRiverSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowByRiverSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\n#nope, need to keep length\n#How about without the interactions?\ngamSR3ByRiver <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowByRiverSR) + cohortF * ageF +             \n               s(flowByRiverSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowByRiverSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n#nope, need the interactions\n\nAIC(gamSR0ByRiver, gamSR1ByRiver, gamSR2ByRiver, gamSR3ByRiver) |> arrange(AIC)\n\n\n                     df       AIC\ngamSR0ByRiver 120.02873 -87218.68\ngamSR1ByRiver  71.79121 -86264.17\ngamSR2ByRiver 110.84119 -85736.95\ngamSR3ByRiver 102.51579 -85461.99\n\n\n\n\n10.1.3.3 Brook trout - flow by area\n\n\nCode\ngamSR0ByArea <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowByAreaSR)^2 + cohortF * ageF +             \n               s(flowByAreaSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowByAreaSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\ngamSR1ByArea <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowByAreaSR)^2 + cohortF +             \n               s(flowByAreaSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowByAreaSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\n# age matters, what about taking out length?\ngamSR2ByArea <- bam(grWeight ~ (riverGG + seasonGG  + tempSR + flowByAreaSR)^2 + cohortF * ageF +             \n               s(flowByAreaSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowByAreaSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n\n#nope, need to keep length\n#How about without the interactions?\ngamSR3ByArea <- bam(grWeight ~ (riverGG + seasonGG + observedWeight + tempSR + flowByAreaSR) + cohortF * ageF +             \n               s(flowByAreaSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(flowByAreaSR, bs = \"cr\", k = kIn, by = seasonGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = riverGG) +\n               s(tempSR, bs = \"cr\", k = kIn, by = seasonGG),\n             data = dGAM |> filter(speciesGG == speciesIn, cohort %in% 2000:2013), method = \"REML\")\n#nope, need the interactions\n\nAIC(gamSR0ByArea, gamSR1ByArea, gamSR2ByArea, gamSR3ByArea) |> arrange(AIC)\n\n\n                    df       AIC\ngamSR0ByArea 118.69694 -87324.21\ngamSR1ByArea  68.72378 -86378.10\ngamSR2ByArea 109.59850 -85805.33\ngamSR3ByArea 102.43371 -85526.74\n\n\n\n\nCode\npredictBKTgamSR <- function(dIn, modInFlowByRiver, modInFlowByArea){\n\n  predMatByRiver0 <- \n    expand.grid(\n      flowByRiverSR = seq(-1.5,1.5,0.25), \n      tempSR = seq(-1.5,1.5,0.25), \n      riverGG = unique(dIn$riverGG), \n      seasonGG= unique(dIn$seasonGG),\n      observedWeight = seq(2, max(dIn$observedWeight, na.rm = TRUE)/2, 20),\n      cohortF = 2000:2013,#uunique(dIn$cohortF),\n      ageF = 0:4,#unique(dIn$ageF),\n      byRiver = TRUE\n  )\n  predMatByRiver <- \n    add_column(\n      pred = predict.bam(modInFlowByRiver, predMatByRiver0),\n      predMatByRiver0\n    ) |> \n    rename(flow = flowByRiverSR, temp = tempSR)\n  \n  predMatByArea0 <- \n    expand.grid(\n      flowByAreaSR = seq(-1.5,1.5,0.25), \n      tempSR = seq(-1.5,1.5,0.25), \n      riverGG = unique(dIn$riverGG), \n      seasonGG= unique(dIn$seasonGG),\n      observedWeight = seq(2, max(dIn$observedWeight, na.rm = TRUE)/2, 20),\n      cohortF = 2000:2013,#unique(dIn$cohortF),\n      ageF = 0:4,#unique(dIn$ageF),\n      byRiver = FALSE\n    ) \n  predMatByArea <- \n    add_column(\n      pred = predict.bam(modInFlowByArea, predMatByArea0),\n      predMatByArea0\n    ) |> \n    rename(flow = flowByAreaSR, temp = tempSR)\n\n  return(add_row(predMatByRiver, predMatByArea))\n}\ngamSR_BKTPredictions <- predictBKTgamSR(dGAM, gamSR0ByRiver, gamSR0ByArea)\n\n\n\n\n10.1.3.4 Graph predictions\nAcross cohorts, small fish\n\n\nCode\nggplot(\n  gamSR_BKTPredictions |> \n    filter(\n      observedWeight %in% c(22), \n      #cohortF == 2012, \n      ageF == 0\n    ), \n  aes(temp, pred, color = (flow), group = (flow))) +\n  geom_point(alpha = 0.2) +\n  labs(x = \"Stream temperature\", y = \"Predicted growth rate\") +\n  ylim(-0.005, 0.02) +\n  #geom_smooth(se = FALSE) +\n  geom_hline(yintercept = 0) +\n  facet_grid(seasonGG ~ riverGG + byRiver, scales = 'free')\n\n\n\n\n\nAcross cohorts, large fish\n\n\nCode\nggplot(\n  gamSR_BKTPredictions |> \n    filter(\n      observedWeight %in% c(122), \n      #cohortF == 2012, \n      ageF == 0\n    ), \n  aes(temp, pred, color = (flow), group = (flow))) +\n  geom_point(alpha = 0.2) +\n  labs(x = \"Stream temperature\", y = \"Predicted growth rate\") +\n  ylim(-0.02, 0.02) +\n  #geom_smooth(se = FALSE) +\n  geom_hline(yintercept = 0) +\n  facet_grid(seasonGG ~ riverGG + byRiver, scales = 'free')"
  }
]
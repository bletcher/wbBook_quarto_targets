[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "The West Brook story",
    "section": "",
    "text": "Introduction"
  },
  {
    "objectID": "index.html#the-west-brook-stream-network",
    "href": "index.html#the-west-brook-stream-network",
    "title": "The West Brook story",
    "section": "The West Brook stream network",
    "text": "The West Brook stream network\nThe Ecology Section at the USGS Conte Laboratory has studied fish in the West Brook (MA, USA) since 1997. The goal is to understand the strength and direction of drivers on fish growth, movement, reproduction and survival in a small stream network. We hope to provide a comprehensive understanding of fish population dynamics and ultimately individual fitness (natural selection and evolution) in the study area.\nSee below or here for interactive applications to explore the raw data.\n\n\n\n\nData extraction and manipulation and models are run using targets from the R package targets. Run the following code to rebuild all the targets.\nlibrary(targets) library(quarto)\ntar_make()\nRun this code to rebuild the book.\nquarto::quarto_render(output_format = \"html\")"
  },
  {
    "objectID": "index.html#mainstem-and-tributary-names",
    "href": "index.html#mainstem-and-tributary-names",
    "title": "The West Brook story",
    "section": "Mainstem and tributary names",
    "text": "Mainstem and tributary names\nThere are four locations within the study area. Here are the primary names and aliases:\n\n\nTable 1: River names and aliases\n\n\nPrimary name\nAlias\nAlias-long\nRiver #\n\n\n\n\nWest Brook\nWB\nWest Brook\n1\n\n\nJimmy Brook\nOL\nOpen Large\n2\n\n\nMitchell Brook\nOS\nOpen Small\n3\n\n\nOBear Brook\nIL\nIsolated Large\n4\n\n\n\n\n\n\nCode\n#if/when .qmd's are in quarto subdir\n#tar_config_set(store = \"../_targets\")"
  },
  {
    "objectID": "vizTargets.html",
    "href": "vizTargets.html",
    "title": "1  Visualize targets",
    "section": "",
    "text": "Run code in buildBook.R to update targets and run quarto_render()\nData processing and model running is controlled by targets. Targets are only re-run if the upstream data source changes\n\n\nCode\nlibrary(targets)\nlibrary(tarchetypes)\nlibrary(visNetwork)\n\n\nVisualize the targets network\n\n\nCode\n#tar_visnetwork()"
  },
  {
    "objectID": "getData.html#databases",
    "href": "getData.html#databases",
    "title": "2  Get data info",
    "section": "2.1 Databases",
    "text": "2.1 Databases\nWe have two types of databases: Environmental and fish\nThe environmental database contains daily mean temperature and flow data. Flow data are from a flow extension model and are not tributary-specific. Temperature data are from tributary-specific loggers.\nThere are four main fish databases we want to create:\n1. cdWB_electro West Brook electrofishing data, 3 species (brook trout, brown trout and Atlantic salmon), tagged and untagged fish\n2. cdWB_CMR West Brook electrofishing data formatted for Capture-Mark-Recapture (CMR) analysis for tagged individuals\n3. cdWB_wanding West Brook wanding (portable antenna) data, all tagged salmonids\n4. cdWB_antenna West Brook stationary antenna data, all tagged salmonids\n“cd” stands for “core data”."
  },
  {
    "objectID": "getDataEnv.html#get-environmental-data-target-and-show-data-frame-structure",
    "href": "getDataEnv.html#get-environmental-data-target-and-show-data-frame-structure",
    "title": "3  Get environmental data",
    "section": "3.1 Get environmental data target and show data frame structure",
    "text": "3.1 Get environmental data target and show data frame structure\n\n\nCode\nenvDataWB <- tar_read(envDataWB_Target)\nstr(envDataWB)\n\n\ntibble [32,189 × 22] (S3: tbl_df/tbl/data.frame)\n $ river         : chr [1:32189] \"wb jimmy\" \"wb jimmy\" \"wb jimmy\" \"wb jimmy\" ...\n $ date          : POSIXct[1:32189], format: \"1997-05-14 04:00:00\" \"1997-05-15 04:00:00\" ...\n $ temperature   : num [1:32189] 11.57 10.4 10.55 8.84 9.09 ...\n $ daily_max_temp: num [1:32189] 11.6 12.3 11.9 10.2 11.6 ...\n $ daily_min_temp: num [1:32189] 11.57 8.96 9.73 7.74 7.45 ...\n $ flow          : num [1:32189] NA NA NA NA NA NA NA NA NA NA ...\n $ dateDate      : Date[1:32189], format: \"1997-05-14\" \"1997-05-15\" ...\n $ yday          : num [1:32189] 134 135 136 137 138 139 140 141 142 143 ...\n $ year          : num [1:32189] 1997 1997 1997 1997 1997 ...\n $ riverOrdered  : Ord.factor w/ 4 levels \"West Brook\"<\"WB Jimmy\"<..: 2 2 2 2 2 2 2 2 2 2 ...\n $ dayLength     : num [1:32189] 51770 51896 52019 52140 52258 ...\n $ precip        : num [1:32189] 0 1.15 0 0 2.34 ...\n $ solarRadiation: num [1:32189] 587 562 259 434 446 ...\n $ swe           : num [1:32189] 78.7 73.6 67.9 63 59.5 ...\n $ airTempMax    : num [1:32189] 20.1 21.2 12.7 15.1 18.9 ...\n $ airTempMin    : num [1:32189] 4.03 6.28 7.47 5.64 2.38 6.59 7.91 3.28 4.98 3.99 ...\n $ vaporPressure : num [1:32189] 815 953 1034 911 725 ...\n $ airTempMedian : num [1:32189] 12.1 13.7 10.1 10.4 10.6 ...\n $ ETmm          : num [1:32189] NA NA NA NA NA NA NA NA NA NA ...\n $ Pmm           : num [1:32189] NA NA NA NA NA NA NA NA NA NA ...\n $ flowByRiver   : num [1:32189] NA NA NA NA NA NA NA NA NA NA ...\n $ flowByRiverm3s: num [1:32189] NA NA NA NA NA NA NA NA NA NA ...\n\n\nCode\nojs_define(envDataWB_OJS = transpose(envDataWB))"
  },
  {
    "objectID": "getDataEnv.html#plot-flow-over-time-for-the-west-brook-by-year",
    "href": "getDataEnv.html#plot-flow-over-time-for-the-west-brook-by-year",
    "title": "3  Get environmental data",
    "section": "3.2 Plot flow over time for the West Brook by year",
    "text": "3.2 Plot flow over time for the West Brook by year\n\n\nCode\nggplot(envDataWB %>% filter(riverOrdered == \"West Brook\"), aes(yday, flow)) +\n  geom_point(size = 0.1) +\n  geom_point(size = 0.1, color = \"blue\", aes(yday, flowByRiverm3s)) +\n  #geom_line() +\n  scale_x_continuous(\"Day of year\") +\n  scale_y_continuous(\"Stream flow (m^3/s)\") +\n  facet_wrap(~year(date))\n\n\n\n\n\nFigure 3.1: Stream flow (m3/s) for the West Brook\n\n\n\n\n\n\nCode\n#| label: fig-envFlowByRiver\n#| fig-cap: \"Stream flow (m3/s) for the West Brook with Jenn's model predictions\"\nggplot(envDataWB %>% filter(riverOrdered == \"West Brook\", year %in% (1998:2021)), aes(flow, flowByRiverm3s, color = yday)) +\n  geom_point(size = 0.1) +\n  geom_abline(slope = 1) +\n  scale_y_continuous(\"Stream flow (m^3/s) from Jenn's model\") +\n  scale_x_continuous(\"Stream flow (m^3/s) from flow extension\") +\n  facet_wrap(~year(date))\n\n\n\n\n\n\n\nCode\nviewof rangeYear = Inputs.range([1997, 2022], {\n  label: \"Which year?\",\n  value: 2002,\n  step: 1\n})\n\nenvDataWB_OJSplot = envDataWB_OJS.filter(d => d.year === rangeYear)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nPlot.plot({\n    width: width,\n    height: 350,\n    inset: 10,\n    color: {\n      scheme: \"greys\"\n    },\n    x: { label: \"Stream flow (m3/s)\" },\n    y: { label: \"Stream flow (m3/s) from Jenn's model\" },\n    marks: [\n      Plot.frame(),\n      Plot.dot(envDataWB_OJSplot, {\n        x: \"flow\",\n        y: \"flowByRiverm3s\"\n      })\n    ],\n    facet: {\n      data: envDataWB_OJSplot,\n      x: \"riverOrdered\"\n    }\n  });\n\n\n\n\n\n\n\n\n\nCode\nPlot.plot({\n    width: width,\n    height: 350,\n    inset: 10,\n    color: {\n      type: \"categorical\"\n    },\n    x: { label: \"Day of year\" },\n    y: { label: \"Stream flow (m3/s)\" },\n    marks: [\n      Plot.frame(),\n      Plot.dot(envDataWB_OJSplot, {\n        x: \"dateDate\",\n        y: \"flowByRiverm3s\"\n      })\n    ],\n    marks: [\n      Plot.frame(),\n      Plot.dot(envDataWB_OJSplot, {\n        x: \"dateDate\",\n        y: \"flow\"\n      })\n    ],\n    facet: {\n      data: envDataWB_OJSplot,\n      x: \"riverOrdered\"\n    }\n  });\n\n\n\n\n\n\n\nTest: referring to Figure 3.1."
  },
  {
    "objectID": "getDataEnv.html#plot-temperature-over-time-for-each-tributary",
    "href": "getDataEnv.html#plot-temperature-over-time-for-each-tributary",
    "title": "3  Get environmental data",
    "section": "3.3 Plot temperature over time for each tributary",
    "text": "3.3 Plot temperature over time for each tributary\n\n\nCode\nggplot(envDataWB, aes(date, temperature)) +\n  geom_point(size = 0.2) +\n  scale_x_continuous(\"Date\") +\n  scale_y_continuous(\"Stream temperature (C)\") +\n  facet_wrap(~river)\n\n\n\n\n\nFigure 3.2: Stream temperature (C) by river"
  },
  {
    "objectID": "getDataEnv.html#plot-air-and-water-temperature-over-time-for-each-tributary",
    "href": "getDataEnv.html#plot-air-and-water-temperature-over-time-for-each-tributary",
    "title": "3  Get environmental data",
    "section": "3.4 Plot air and water temperature over time for each tributary",
    "text": "3.4 Plot air and water temperature over time for each tributary\n\n\nCode\ngetTempYear <- function(d, yearIn){\n  d %>% filter(year == yearIn)\n}\n\ntempYear <- getTempYear(envDataWB, 2002)\n#write.csv(tempYear, \"./data/tempYear.csv\")\nojs_define(tempYearOJS0 = tempYear)\n\nggplot(tempYear, aes(date, temperature)) +\n  geom_point(size = 0.2) +\n  geom_point(aes(date, airTempMedian), color = \"blue\", size = 0.2) +\n  scale_x_continuous(\"Date\") +\n  scale_y_continuous(\"Stream temperature (C)\") +\n  facet_wrap(~river)\n\nggplot(tempYear, aes(airTempMedian, temperature, color = yday)) +\n  geom_point(size = 0.2) +\n  scale_x_continuous(\"Air Temperature\") +\n  scale_y_continuous(\"Stream temperature (C)\") +\n  facet_wrap(~river)\n\n\n\n\n\nFigure 3.3: Stream and air temperature (C) by river\n\n\n\n\n\n\n\nFigure 3.4: Stream and air temperature (C) by river\n\n\n\n\nWill move this to its own chapter\n\n\nCode\ntempYearOJS = transpose(tempYearOJS0)\n\n//tempYearOJS0\n//tempYearOJS\ndateChunks\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndateChunks = {\n  let daysCount = rangeWindowWidth;\n  let days = [\n    {\n      daysCount0: 0,\n      start: tempYearOJS[0].dateDate,\n      end: tempYearOJS[rangeWindowWidth].dateDate,\n      daysCount: rangeWindowWidth,\n      data: tempYearOJS.filter(\n        (d) => d.yday >= 0 && d.yday <= 0 + rangeWindowWidth\n      )\n    }\n  ];\n\n  do {\n    if (daysCount < 365) {\n      // dont push if the whole year is seleceted, array will be empty\n      days.push({\n        daysCount0: daysCount,\n        start: tempYearOJS[daysCount].dateDate,\n        end: tempYearOJS[daysCount + rangeWindowWidth].dateDate,\n        daysCount: daysCount,\n        data: tempYearOJS.filter(\n          (d) =>\n            d.yday >= daysCount + 1 && d.yday <= daysCount + rangeWindowWidth\n        )\n      });\n    }\n    daysCount = daysCount + rangeWindowWidth;\n  } while (daysCount <= 365);\n  return days;\n}\n\n\n\n\n\n\n\nUse the slider below to set the length (# of days) of each data chunk.\nNumber of data chunks: \nStart date = \nend date = \n\n\nCode\nviewof rangeWindowWidth = Inputs.range([1, 365 - 0], {\n  label: \"Data chunk length\",\n  value: 14,\n  step: 1\n})\n\n\n\n\n\n\n\nOf the data chunks defined above which one should we graph. 0 is the first one and you won’t be able to go past the last one (range updates automatically) but you might get as few as one observation in the last chunk.\n\n\nCode\nviewof rangeWhichWindow = Inputs.range([0, dateChunks.length - 1], {\n  label: \"Which data chunk?\",\n  step: 1,\n  value: 0\n})\n\n\n\n\n\n\n\n\n\nCode\nPlot.plot({\n  width: width,\n  height: 350,\n  inset: 10,\n  color: {\n    scheme: \"greys\"\n  },\n  x: { label: \"Air temperature (C)\" },\n  y: { label: \"Water temperature (C)\" },\n  marks: [\n    Plot.frame(),\n    Plot.dot(dateChunks[rangeWhichWindow].data, {\n      x: \"airTempMedian\",\n      y: \"temperature\",\n      stroke: \"yday\"\n    })//,\n //   Plot.linearRegressionY(dateChunks[rangeWhichWindow].data, {\n//      x: \"airTempMedian\",\n //     y: \"temperature\"\n //   })\n  ],\n  facet: {\n    data: dateChunks[rangeWhichWindow].data,\n    x: \"river\"\n  }\n})\n\n\n\n\n\n\n\n=======================================================\nsome integration alternatives - most are not so slick and are independent from the ojs code blocks above\nSeems like it is best to devleop in observable and copy/paste code blocks in here.\nimport chunk from ‘Playground’\n\n\nCode\nimport { plotChunk } from \"@bletcher/Playground\"\nplotChunk\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\niframe in html block\n\nruntime with javascript in html block\n\n\n\nCredit: Playground by Ben Letcher"
  },
  {
    "objectID": "getDataElectro.html#get-electrofishing-data-target",
    "href": "getDataElectro.html#get-electrofishing-data-target",
    "title": "4  Get electrofishing data",
    "section": "4.1 Get electrofishing data target",
    "text": "4.1 Get electrofishing data target\n\n\nCode\ncdWB_electro <- tar_read(cdWB_electro_target)\nstr(cdWB_electro)\n\n\ntibble [91,103 × 57] (S3: tbl_df/tbl/data.frame)\n $ tag                   : chr [1:91103] \"00088cbed0\" \"00088cbed3\" \"00088cbed4\" \"00088cbed4\" ...\n $ detectionDate         : POSIXct[1:91103], format: \"2013-03-25 04:00:00\" \"2012-06-07 13:03:00\" ...\n $ sampleName            : chr [1:91103] \"84\" \"81\" \"84\" \"85\" ...\n $ sampleNumber          : num [1:91103] 73 70 73 74 70 71 73 79 80 71 ...\n $ river                 : chr [1:91103] \"wb obear\" \"west brook\" \"west brook\" \"west brook\" ...\n $ section               : num [1:91103] 7 1 40 44 25 32 32 3 3 23 ...\n $ area                  : chr [1:91103] \"trib\" \"inside\" \"inside\" \"inside\" ...\n $ observedLength        : num [1:91103] 62 62 109 154 113 120 147 70 74 86 ...\n $ survey                : chr [1:91103] \"shock\" \"shock\" \"shock\" \"shock\" ...\n $ pass                  : num [1:91103] 1 1 1 1 1 1 1 1 1 1 ...\n $ observedWeight        : num [1:91103] 1.9 2.7 12.6 41.3 15.5 18.3 30.4 3.5 4.8 6.7 ...\n $ comments              : chr [1:91103] \"additional genetic sample\" NA NA NA ...\n $ cohort                : num [1:91103] 2012 2012 2012 2012 2011 ...\n $ species               : chr [1:91103] \"bkt\" \"bkt\" \"bkt\" \"bkt\" ...\n $ dateEmigrated         : Date[1:91103], format: NA NA ...\n $ sex                   : chr [1:91103] NA NA NA NA ...\n $ year                  : num [1:91103] 2013 2012 2013 2013 2012 ...\n $ season                : num [1:91103] 1 2 1 2 2 3 1 3 4 3 ...\n $ proportionSampled     : num [1:91103] 1 1 1 1 1 1 1 1 1 1 ...\n $ lagDetectionDate      : POSIXct[1:91103], format: NA NA ...\n $ meanTemperature       : num [1:91103] NaN NaN 10.7 NaN 16.5 ...\n $ meanFlow              : num [1:91103] NaN NaN 0.5247 NaN 0.0338 ...\n $ riverOrdered          : Ord.factor w/ 4 levels \"west brook\"<\"wb jimmy\"<..: 4 1 1 1 1 1 1 4 4 1 ...\n $ readerId              : logi [1:91103] NA NA NA NA NA NA ...\n $ sectionN              : num [1:91103] 7 1 40 44 25 32 32 3 3 23 ...\n $ aliveOrDead           : chr [1:91103] \"alive\" \"alive\" \"alive\" \"alive\" ...\n $ instance              : logi [1:91103] NA NA NA NA NA NA ...\n $ quarter               : logi [1:91103] NA NA NA NA NA NA ...\n $ leftOrRight           : logi [1:91103] NA NA NA NA NA NA ...\n $ habitat               : logi [1:91103] NA NA NA NA NA NA ...\n $ cover                 : logi [1:91103] NA NA NA NA NA NA ...\n $ justification         : logi [1:91103] NA NA NA NA NA NA ...\n $ sectionWQuarter       : logi [1:91103] NA NA NA NA NA NA ...\n $ j                     : logi [1:91103] NA NA NA NA NA NA ...\n $ date                  : Date[1:91103], format: \"2013-03-25\" \"2012-06-07\" ...\n $ sectionOriginal       : chr [1:91103] \"7\" \"1\" \"40\" \"44\" ...\n $ inside                : logi [1:91103] TRUE TRUE TRUE TRUE TRUE TRUE ...\n $ yday                  : num [1:91103] 84 159 88 176 160 271 87 260 335 270 ...\n $ ageInSamples          : num [1:91103] 3 0 3 4 4 5 7 1 2 1 ...\n $ isYOY                 : logi [1:91103] TRUE TRUE TRUE FALSE FALSE FALSE ...\n $ lagSection            : num [1:91103] NA NA 44 NA 32 32 NA 3 NA 24 ...\n $ distMoved             : num [1:91103] NA NA -4 NA -7 0 NA 0 NA -1 ...\n $ lagObservedWeight     : num [1:91103] NA NA 41.3 NA 18.3 30.4 NA 4.8 NA 12.7 ...\n $ lagObservedLength     : num [1:91103] NA NA 154 NA 120 147 NA 74 NA 108 ...\n $ grWeight              : num [1:91103] NA NA 3.30e+10 NA 1.48e-01 ...\n $ grLength              : num [1:91103] NA NA 0.5102 NA 0.0631 ...\n $ minSample             : num [1:91103] 73 70 73 73 70 70 70 79 79 71 ...\n $ maxSample             : num [1:91103] 73 70 74 74 73 73 73 80 80 74 ...\n $ minYear               : num [1:91103] 1997 1997 1997 1997 1997 ...\n $ moveDir               : num [1:91103] NA NA -1 NA -1 0 NA 0 NA -1 ...\n $ sampleInterval        : num [1:91103] NA NA 88.2 NA 110.9 ...\n $ drainage              : chr [1:91103] \"west\" \"west\" \"west\" \"west\" ...\n $ quarter_length        : num [1:91103] 5 5.2 5.03 4.83 4.75 ...\n $ river_meter           : num [1:91103] 5252 4394 5208 5292 4903 ...\n $ confluence_river_meter: num [1:91103] 5114 0 0 0 0 ...\n $ riverMeter            : num [1:91103] 5252 4394 5208 5292 4903 ...\n $ nPasses               : num [1:91103] 1 2 1 2 2 2 1 1 1 2 ..."
  },
  {
    "objectID": "getDataElectro.html#counts-by-species",
    "href": "getDataElectro.html#counts-by-species",
    "title": "4  Get electrofishing data",
    "section": "4.2 Counts by species",
    "text": "4.2 Counts by species\n\n\nCode\n# # off tagged individuals/species\ntagged <- cdWB_electro %>%\n  group_by(tag, species)\n \ntagged %>%\n  summarize(n = n()) %>%\n  group_by(species) %>%\n  summarize(n = n())\n\n\n# A tibble: 3 × 2\n  species     n\n  <chr>   <int>\n1 ats      7875\n2 bkt     14611\n3 bnt      7204\n\n\nCode\n#####\nuntagged <- cdWB_electro %>%\n  filter(is.na(tag))\n\nuntagged %>%\n  group_by(species) %>%\n  summarize(n = n())\n\n\n# A tibble: 3 × 2\n  species     n\n  <chr>   <int>\n1 ats      3419\n2 bkt     16013\n3 bnt      6732\n\n\nCode\n######\ncdWB_electro %>%\n  ggplot(aes(observedLength, color = is.na(tag))) +\n  geom_freqpoly() \n\n\n\n\n\nCode\ncdWB_electro %>%\n  group_by(comments) %>%\n  summarize(n = n()) %>%\n  arrange(desc(n)) %>%\n  filter(str_detect(comments, \"mort\")) %>%\n  print(n = 50)\n\n\n# A tibble: 96 × 2\n   comments                                                                    n\n   <chr>                                                                   <int>\n 1 shock scars/mort                                                          264\n 2 shock mort                                                                136\n 3 tagging mort                                                               52\n 4 shocking mortality                                                         42\n 5 shocking mortality; no picture                                             14\n 6 shocking mort                                                               9\n 7 mort                                                                        8\n 8 shock scars/mort/too small to tag                                           7\n 9 shocking mortality; kept for guts                                           7\n10 tag mort                                                                    5\n11 shock scars/mort/time is estimated based on effort                          3\n12 shocking mort; no video                                                     3\n13 tagging mortality                                                           3\n14 mortality due to lack of oxygen; kept for otoliths                          2\n15 mortality due to ms222 or warm weather                                      2\n16 mortality due to shocking                                                   2\n17 mortality due to shocking; no picture                                       2\n18 mortality due to tagging or warm weather                                    2\n19 ms222 mortality; kept for otoliths                                          2\n20 shocking mortality; kept                                                    2\n21 shocking mortality; kept for guts; no picture                               2\n22 shocking mortality; no tag; no picture                                      2\n23 smolt, shock scars/mort                                                     2\n24 tagging or ms222 mortality? kept for otoliths                               2\n25 walking mortality                                                           2\n26 additional genetic sample / tagging mort                                    1\n27 additional genetic sample/shock scars/mort                                  1\n28 braid sec 29&30/shock scars/mort                                            1\n29 bucket mortality; no picture                                                1\n30 dope mort-with wrong picture label (as 7-1)                                 1\n31 electrofishing mortality (tim did it)                                       1\n32 ethanol mortality courtesy of melissa                                       1\n33 fin clip but no tag and shock mort                                          1\n34 four was a stepped on mort                                                  1\n35 isolated pool/shock scars/mort                                              1\n36 mort (222, tag?)                                                            1\n37 mort (looks like a bnt)                                                     1\n38 mort found                                                                  1\n39 mort stepped on                                                             1\n40 mort; chunk out of side (bird)                                              1\n41 mort; no tag or scales                                                      1\n42 mortality ; found the fish dead; looks like bites on the head and scra…     1\n43 mortality ; no picture                                                      1\n44 mortality due to eating; tag found in bnt (249 mm, 173.4 g)                 1\n45 mortality due to lack of oxygen (stuck on side of bucket)                   1\n46 mortality due to lavage                                                     1\n47 mortality; cause unknown                                                    1\n48 mortality; stepped on                                                       1\n49 mortality; stepped on; no picture                                           1\n50 mortality; tag/ms222?                                                       1\n# … with 46 more rows"
  },
  {
    "objectID": "getDataElectro.html#length-weight-graph",
    "href": "getDataElectro.html#length-weight-graph",
    "title": "4  Get electrofishing data",
    "section": "4.3 Length-weight graph",
    "text": "4.3 Length-weight graph\n\n\nCode\nggplot(cdWB_electro, aes(observedLength, observedWeight, color = species)) +\n  geom_point(size = 0.75, alpha = 0.1) +\n  scale_x_log10(\"Length (mm)\") +\n  scale_y_log10(\"Mass (mg)\") +\n#  theme_publication() +\n  facet_wrap(~ species)\n\n\n\n\n\nFigure 4.1: Length - mass graph"
  },
  {
    "objectID": "getDataElectro.html#length-weight-regression",
    "href": "getDataElectro.html#length-weight-regression",
    "title": "4  Get electrofishing data",
    "section": "4.4 Length-weight regression",
    "text": "4.4 Length-weight regression\n\n\nCode\nlwReg <- cdWB_electro %>%\n  nest_by(species) %>%\n  mutate(reg = list(lm(log(observedWeight) ~ log(observedLength), data = data)))\n\nlwReg %>% summarise(broom::tidy(reg))  \n\n\n# A tibble: 6 × 6\n# Groups:   species [3]\n  species term                estimate std.error statistic p.value\n  <chr>   <chr>                  <dbl>     <dbl>     <dbl>   <dbl>\n1 ats     (Intercept)           -11.4    0.00942    -1210.       0\n2 ats     log(observedLength)     3.00   0.00208     1442.       0\n3 bkt     (Intercept)           -11.5    0.00621    -1859.       0\n4 bkt     log(observedLength)     3.02   0.00140     2155.       0\n5 bnt     (Intercept)           -11.5    0.00686    -1670.       0\n6 bnt     log(observedLength)     3.01   0.00149     2023.       0\n\n\nCode\nlwReg %>% summarise(broom::glance(reg))\n\n\n# A tibble: 3 × 13\n# Groups:   species [3]\n  species r.squared adj.r.…¹  sigma stati…² p.value    df logLik     AIC     BIC\n  <chr>       <dbl>    <dbl>  <dbl>   <dbl>   <dbl> <dbl>  <dbl>   <dbl>   <dbl>\n1 ats         0.989    0.989 0.0945  2.08e6       0     1 22663. -45319. -45295.\n2 bkt         0.991    0.991 0.112   4.64e6       0     1 32555. -65105. -65079.\n3 bnt         0.996    0.996 0.0858  4.09e6       0     1 18345. -36683. -36660.\n# … with 3 more variables: deviance <dbl>, df.residual <int>, nobs <int>, and\n#   abbreviated variable names ¹​adj.r.squared, ²​statistic"
  },
  {
    "objectID": "getDataElectro.html#cmr-metadata",
    "href": "getDataElectro.html#cmr-metadata",
    "title": "4  Get electrofishing data",
    "section": "4.5 CMR metadata",
    "text": "4.5 CMR metadata\n\n4.5.1 adapted from https://github.com/Conte-Ecology/westBrookData/blob/master/getWBData/vignettes/westBrookDataIntro.Rmd\n\n4.5.1.1 Column explanations\ntag PIT tag number, unique identifier, character\ncohort year the fish was born, assigned based on size at initial capture and size distributions of fish of known age\ndetectionDate mostly self explanatory, but filled in for unobserved fish as the median capture date for all observed fish.\nsampleName An ordered identifier for sampling mostly for recognition by people who did the sampling. This is not very clean because early in the study samples were not taken at strictly seasonal intervals. sampleNumber is probably more useful and intuitive.\nsampleNumber A tidier identifier for samples that strictly increases by one for each season (4/yr)\nriver River the fish was observed in. NA if the fish was not observed.\nwest brook The mainstem\nwb jimmy Larger tributary that fish can move back and forth into from WB section 31 (Open Large from Letcher et al 2015)\nwb mitchell Smaller tributary that fish can move back and forth into from WB section 35 (Open Small from Letcher et al 2015)\nwb obear Smaller tributary that has a waterfall at its mouth, so fish can only move downstream into WB section 20 (Isolated Small from Letcher et al 2015)\nsection Identifier for the 20m section that the fish was captured in. This is ordered from downstream to upstream starting at 1 within each river.\narea inside = section 1:47 in the west brook, trib = tributary (not west brook), below = sections below inside sections, above = sections above the inside sections\nobservedLength in mm\nsurvey shock = electroshocking survey\npass electrofishing pass. 1 or 2 in the west brook (inside), 1 in tribs\nobservedWeight in g wet weight\nspecies\nbkt = brook trout (native, self-sustained population)\nbnt = brown trout (non-native, self-sustained population)\nats = atlantic salmon (stocked through 2005, no reproduction)\ndateEmigrated date of emigration from inside/tribs if observed to emigrate. Coded as emigrated if last observation was on PIT antenna or captured below or above\nsex NA = unknown, f = female, m = male, p = precocious male (salmon only)\nenc\nLogical, was the fish observed? (1 = yes, 0 = no)\nageInSamples number of seasons since summer of the year of birth (1st summer = 0)\nsampleIndex sampleNumber rescaled to start at 1 and end at length(unique(sampleNumber)) for ease of looping in JAGS\ntagIndex ordered, unique individual identifier 1:N\nyear of sample\nseason 1 = spring, 2 = summer, 3 = fall, 4 = winter\nproportionSampled Occasionally the sample was not complete (e.g., skipped west brook but did the tributaries). This is the proportion of sections in the river of capture that were sampled.\nlagDetectionDate detection date lagged back one observation\nmeanTemperature mean temperature between observation dates. If individual was not observed, median observation date for the sampling occasion was used.\nmeanFlow mean flow between observation dates. If individual was not observed, median observation date for the sampling occasion was used.\nknownZ z is alive state, so this is ‘1’ between first and last capture, and NA otherwise, unless the fish was known to be dead (e.g. tagging mortality or observed dead) in which case the value is set to ‘2’. There is also an option in the addKnownZ() function to useAntenna. This is useAntenna = FALSE by default, but could be set to TRUE to set knownZ to 1 up to the last antenna observation."
  },
  {
    "objectID": "getDataCMR.html#get-electrofishing-data-target-wb",
    "href": "getDataCMR.html#get-electrofishing-data-target-wb",
    "title": "5  Create Capture-Recapture data",
    "section": "5.1 Get electrofishing data target WB",
    "text": "5.1 Get electrofishing data target WB\nWest brook and 3 tributaries\n\n\nCode\ncdWB_CMR0_WB <- tar_read(eh_WB_2002_2014_target)\nstr(cdWB_CMR0_WB)\n\n\nList of 16\n $ eh         : num [1:19981, 1:12] 1 1 1 1 1 1 1 1 1 1 ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ flow       : num [1:19981, 1:12] -0.707 -0.679 -0.556 -0.767 -0.531 ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ flowByRiver: num [1:19981, 1:12] -0.949 0.323 0.615 -0.951 0.652 ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ temperature: num [1:19981, 1:12] 0.0892 -0.324 0.3839 -0.3903 0.298 ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ river      : chr [1:19981, 1:12] \"wb obear\" \"west brook\" \"west brook\" \"wb obear\" ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ section    : num [1:19981, 1:12] 82 23 30 87 42 20 84 90 27 51 ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ riverN     : num [1:19981, 1:12] 4 1 1 4 1 1 4 4 1 2 ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ isYOY      : num [1:19981, 1:12] 1 1 1 1 1 1 1 1 1 1 ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ length     : num [1:19981, 1:12] 70 86 89 61 60 64 70 62 87 73 ...\n  ..- attr(*, \"dimnames\")=List of 2\n  .. ..$ : NULL\n  .. ..$ : chr [1:12] \"ais_1\" \"ais_2\" \"ais_3\" \"ais_4\" ...\n $ tags       : tibble [19,981 × 1] (S3: tbl_df/tbl/data.frame)\n  ..$ tag: chr [1:19981] \"00088cbed7\" \"00088cbed8\" \"00088cbedb\" \"00088cbedd\" ...\n $ cohorts    : tibble [19,981 × 1] (S3: tbl_df/tbl/data.frame)\n  ..$ cohort: num [1:19981] 2014 2012 2014 2012 2014 ...\n $ seasons    : tibble [79,133 × 1] (S3: tbl_df/tbl/data.frame)\n  ..$ season: num [1:79133] 3 4 1 2 3 4 1 2 3 4 ...\n $ species    : tibble [19,981 × 1] (S3: tbl_df/tbl/data.frame)\n  ..$ species: chr [1:19981] \"bkt\" \"bnt\" \"bkt\" \"bkt\" ...\n $ first      : int [1:19981] 1 1 1 1 1 1 1 1 1 1 ...\n $ last       : num [1:19981] 4 12 4 12 4 12 12 4 12 4 ...\n $ data       : tibble [199,614 × 47] (S3: tbl_df/tbl/data.frame)\n  ..$ cohort               : num [1:199614] 2012 2012 2012 2012 2012 ...\n  ..$ tag                  : chr [1:199614] \"00088cbed0\" \"00088cbed0\" \"00088cbed0\" \"00088cbed0\" ...\n  ..$ detectionDate        : POSIXct[1:199614], format: \"2013-03-25 04:00:00\" \"2013-06-05 04:00:00\" ...\n  ..$ sampleName           : chr [1:199614] \"84\" \"85\" \"86\" \"87\" ...\n  ..$ sampleNumber         : num [1:199614] 73 74 75 76 77 78 79 80 81 82 ...\n  ..$ river                : chr [1:199614] \"wb obear\" \"wb obear\" \"wb obear\" \"wb obear\" ...\n  ..$ section              : chr [1:199614] \"7\" NA NA NA ...\n  ..$ area                 : chr [1:199614] \"trib\" NA NA NA ...\n  ..$ observedLength       : num [1:199614] 62 NA NA NA NA NA NA NA NA NA ...\n  ..$ survey               : chr [1:199614] \"shock\" NA NA NA ...\n  ..$ pass                 : num [1:199614] 1 NA NA NA NA NA NA NA NA NA ...\n  ..$ observedWeight       : num [1:199614] 1.9 NA NA NA NA NA NA NA NA NA ...\n  ..$ species              : chr [1:199614] \"bkt\" \"bkt\" \"bkt\" \"bkt\" ...\n  ..$ dateEmigrated        : Date[1:199614], format: NA NA ...\n  ..$ sex                  : chr [1:199614] NA NA NA NA ...\n  ..$ enc                  : num [1:199614] 1 0 0 0 0 0 0 0 0 0 ...\n  ..$ ageInSamples         : num [1:199614] 3 4 5 6 7 8 9 10 11 12 ...\n  ..$ sampleIndex          : num [1:199614] 63 64 65 66 67 68 69 70 71 72 ...\n  ..$ tagIndex             : num [1:199614] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ year                 : num [1:199614] 2013 2013 2013 2013 2014 ...\n  ..$ season               : num [1:199614] 1 2 3 4 1 2 3 4 1 2 ...\n  ..$ proportionSampled    : num [1:199614] 1 NA NA NA NA NA NA NA NA NA ...\n  ..$ lagDetectionDate     : POSIXct[1:199614], format: \"2013-06-05 04:00:00\" \"2013-09-18 04:00:00\" ...\n  ..$ meanTemperature      : num [1:199614] 8.62 16.51 9.44 0.94 10.52 ...\n  ..$ meanFlow             : num [1:199614] 0.38874 0.30331 0.00882 0.31319 0.58363 ...\n  ..$ meanFlowByRiver      : num [1:199614] 0.0217 0.1632 0.0432 0.0732 0.2446 ...\n  ..$ knownZ               : num [1:199614] 1 NA NA NA NA NA NA NA NA NA ...\n  ..$ firstObserved        : num [1:199614] 73 73 73 73 73 73 73 73 73 73 ...\n  ..$ lastObserved         : num [1:199614] 73 73 73 73 73 73 73 73 73 73 ...\n  ..$ isFirstObserved      : logi [1:199614] TRUE FALSE FALSE FALSE FALSE FALSE ...\n  ..$ isLastObserved       : logi [1:199614] TRUE FALSE FALSE FALSE FALSE FALSE ...\n  ..$ riverTagged          : chr [1:199614] \"wb obear\" \"wb obear\" \"wb obear\" \"wb obear\" ...\n  ..$ meanMeanFlow         : num [1:199614] 0.409 0.137 0.307 0.464 0.409 ...\n  ..$ sdMeanFlow           : num [1:199614] 0.155 0.126 0.246 0.113 0.155 ...\n  ..$ meanMeanFlowByRiver  : num [1:199614] 0.1368 0.0612 0.0891 0.1094 0.1368 ...\n  ..$ sdMeanFlowByRiver    : num [1:199614] 0.0837 0.0468 0.0819 0.0639 0.0837 ...\n  ..$ meanMeanTemperature  : num [1:199614] 10.39 16.23 8.42 1.65 10.39 ...\n  ..$ sdMeanTemperature    : num [1:199614] 1.202 0.711 1.455 0.616 1.202 ...\n  ..$ meanFlowScaled       : num [1:199614] -0.129 1.313 -1.215 -1.33 1.124 ...\n  ..$ meanFlowByRiverScaled: num [1:199614] -1.375 2.182 -0.56 -0.566 1.287 ...\n  ..$ meanTemperatureScaled: num [1:199614] -1.472 0.402 0.7 -1.149 0.105 ...\n  ..$ isYOY                : num [1:199614] 1 2 2 2 2 2 2 2 2 2 ...\n  ..$ riverN               : num [1:199614] 4 4 4 4 4 4 4 4 4 4 ...\n  ..$ riverOrdered         : Ord.factor w/ 4 levels \"West Brook\"<\"WB Jimmy\"<..: 4 4 4 4 4 4 4 4 4 4 ...\n  ..$ indexByCohort        : int [1:199614] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ sectionTMP           : chr [1:199614] \"7\" NA NA NA ...\n  ..$ sectionRiverN        : num [1:199614] 86 NA NA NA NA NA NA NA NA NA ...\n\n\n\n\nCode\ncdWB_CMR0_WB$data %>% \n  group_by(riverOrdered, cohort) %>% \n  summarize(n = n()) %>%\n  pivot_wider(values_from = \"n\", names_from = \"riverOrdered\") %>%\n  kable() %>%\n  kable_styling(full_width = T)\n\n\n\n\nTable 5.1:  Count of CMR data (including 0’s) by river \n \n  \n    cohort \n    West Brook \n    WB Jimmy \n    WB Mitchell \n    WB OBear \n  \n \n\n  \n    2002 \n    13023 \n    1440 \n    626 \n    2139 \n  \n  \n    2003 \n    24489 \n    2396 \n    444 \n    2747 \n  \n  \n    2004 \n    24963 \n    3637 \n    2707 \n    1666 \n  \n  \n    2005 \n    5471 \n    943 \n    1003 \n    723 \n  \n  \n    2006 \n    6797 \n    1973 \n    533 \n    1322 \n  \n  \n    2007 \n    3958 \n    1530 \n    1068 \n    968 \n  \n  \n    2008 \n    8668 \n    1424 \n    131 \n    886 \n  \n  \n    2009 \n    18696 \n    3497 \n    1889 \n    5081 \n  \n  \n    2010 \n    7693 \n    689 \n    281 \n    453 \n  \n  \n    2011 \n    2202 \n    1792 \n    395 \n    394 \n  \n  \n    2012 \n    16663 \n    2377 \n    1721 \n    5305 \n  \n  \n    2013 \n    4999 \n    1246 \n    304 \n    729 \n  \n  \n    2014 \n    3853 \n    528 \n    427 \n    725 \n  \n\n\n\n\n\n\n\n\nCode\ncdWB_CMR0_WB$data %>% \n  filter(enc == 1) %>% \n  group_by(riverOrdered, cohort) %>% \n  summarize(n = n()) %>%\n  pivot_wider(values_from = \"n\", names_from = \"riverOrdered\") %>%\n  kable() %>%\n  kable_styling(full_width = T)\n\n\n\n\nTable 5.2:  Count of CMR data (encounters only) by river \n \n  \n    cohort \n    West Brook \n    WB Jimmy \n    WB Mitchell \n    WB OBear \n  \n \n\n  \n    2002 \n    2974 \n    379 \n    209 \n    564 \n  \n  \n    2003 \n    4932 \n    491 \n    142 \n    709 \n  \n  \n    2004 \n    5140 \n    734 \n    638 \n    426 \n  \n  \n    2005 \n    939 \n    216 \n    204 \n    163 \n  \n  \n    2006 \n    1350 \n    379 \n    77 \n    278 \n  \n  \n    2007 \n    882 \n    318 \n    273 \n    228 \n  \n  \n    2008 \n    1606 \n    273 \n    33 \n    193 \n  \n  \n    2009 \n    3375 \n    569 \n    403 \n    1075 \n  \n  \n    2010 \n    1294 \n    164 \n    73 \n    99 \n  \n  \n    2011 \n    470 \n    426 \n    71 \n    104 \n  \n  \n    2012 \n    2731 \n    490 \n    282 \n    1196 \n  \n  \n    2013 \n    1184 \n    433 \n    99 \n    216 \n  \n  \n    2014 \n    1431 \n    248 \n    236 \n    395"
  },
  {
    "objectID": "getDataCMR.html#get-electrofishing-data-target-ob",
    "href": "getDataCMR.html#get-electrofishing-data-target-ob",
    "title": "5  Create Capture-Recapture data",
    "section": "5.2 Get electrofishing data target OB",
    "text": "5.2 Get electrofishing data target OB\nO’Bear also known as Isolated Large\n\n\nCode\ncdWB_CMR0_OB <- tar_read(eh_OB_2002_2014_target)\n\n\n\n\nCode\ncdWB_CMR0_OB$data %>% \n  group_by(riverOrdered, cohort) %>% \n  summarize(n = n()) %>%\n  pivot_wider(values_from = \"n\", names_from = \"riverOrdered\") %>%\n  kable() %>%\n  kable_styling(full_width = T)\n\n\n\n\nTable 5.3:  Count of CMR data (including 0’s) by river \n \n  \n    cohort \n    West Brook \n    WB Jimmy \n    WB OBear \n  \n \n\n  \n    2002 \n    11 \n    NA \n    2139 \n  \n  \n    2003 \n    23 \n    NA \n    2747 \n  \n  \n    2004 \n    61 \n    9 \n    1666 \n  \n  \n    2006 \n    34 \n    NA \n    1322 \n  \n  \n    2007 \n    35 \n    NA \n    968 \n  \n  \n    2009 \n    170 \n    8 \n    5081 \n  \n  \n    2010 \n    10 \n    8 \n    453 \n  \n  \n    2011 \n    17 \n    NA \n    394 \n  \n  \n    2012 \n    116 \n    8 \n    5305 \n  \n  \n    2013 \n    12 \n    NA \n    729 \n  \n  \n    2014 \n    2 \n    NA \n    725 \n  \n  \n    2005 \n    NA \n    NA \n    723 \n  \n  \n    2008 \n    NA \n    NA \n    886 \n  \n\n\n\n\n\n\n\n\nCode\ncdWB_CMR0_OB$data %>% \n  filter(enc == 1) %>% \n  group_by(riverOrdered, cohort) %>% \n  summarize(n = n()) %>%\n  pivot_wider(values_from = \"n\", names_from = \"riverOrdered\") %>%\n  kable() %>%\n  kable_styling(full_width = T)\n\n\n\n\nTable 5.4:  Count of CMR data (encounters only) by river \n \n  \n    cohort \n    West Brook \n    WB Jimmy \n    WB OBear \n  \n \n\n  \n    2002 \n    2 \n    NA \n    564 \n  \n  \n    2003 \n    5 \n    NA \n    709 \n  \n  \n    2004 \n    15 \n    2 \n    426 \n  \n  \n    2006 \n    7 \n    NA \n    278 \n  \n  \n    2007 \n    8 \n    NA \n    228 \n  \n  \n    2009 \n    27 \n    1 \n    1075 \n  \n  \n    2010 \n    1 \n    1 \n    99 \n  \n  \n    2011 \n    2 \n    NA \n    104 \n  \n  \n    2012 \n    13 \n    1 \n    1196 \n  \n  \n    2013 \n    4 \n    NA \n    216 \n  \n  \n    2014 \n    1 \n    NA \n    395 \n  \n  \n    2005 \n    NA \n    NA \n    163 \n  \n  \n    2008 \n    NA \n    NA \n    193"
  },
  {
    "objectID": "getDataWanding.html#get-wanding-data-targets",
    "href": "getDataWanding.html#get-wanding-data-targets",
    "title": "6  Get wanding data",
    "section": "6.1 Get wanding data targets",
    "text": "6.1 Get wanding data targets\n\n\nCode\ncdWB_wanding0 <- tar_read(cdWB_wanding0_target)\nstr(cdWB_wanding0)\n\n\ntibble [14,880 × 25] (S3: tbl_df/tbl/data.frame)\n $ tag            : chr [1:14880] \"00088cf41b\" \"00088cf41b\" \"00088cf41b\" \"00088cf435\" ...\n $ detectionDate  : POSIXct[1:14880], format: \"2010-09-27 15:08:45\" \"2010-10-18 18:16:22\" ...\n $ sampleName     : chr [1:14880] \"92710.00\" \"101810.00\" \"102510.00\" \"12610.00\" ...\n $ river          : chr [1:14880] \"wb jimmy\" \"wb jimmy\" \"wb jimmy\" \"wb jimmy\" ...\n $ section        : num [1:14880] 13 14 14 2 6 8 8 11 12 10 ...\n $ area           : chr [1:14880] \"trib\" \"trib\" \"trib\" \"trib\" ...\n $ survey         : chr [1:14880] \"portableAntenna\" \"portableAntenna\" \"portableAntenna\" \"portableAntenna\" ...\n $ readerId       : chr [1:14880] \"iso\" \"iso\" \"iso\" \"iso\" ...\n $ aliveOrDead    : chr [1:14880] \"alive\" \"alive\" NA \"alive\" ...\n $ instance       : num [1:14880] 1 2 3 1 1 1 2 1 1 1 ...\n $ pass           : num [1:14880] NA NA NA NA NA NA NA NA NA NA ...\n $ quarter        : num [1:14880] 2 1 1 4 2 4 4 3 4 2 ...\n $ leftOrRight    : chr [1:14880] \"l\" \"m\" NA \"r\" ...\n $ habitat        : chr [1:14880] \"pool\" \"run\" NA \"pool\" ...\n $ cover          : chr [1:14880] NA NA NA NA ...\n $ justification  : chr [1:14880] NA NA NA NA ...\n $ cohort         : num [1:14880] 2010 2010 2010 2010 2009 ...\n $ species        : chr [1:14880] \"bkt\" \"bkt\" \"bkt\" \"bkt\" ...\n $ dateEmigrated  : Date[1:14880], format: NA NA ...\n $ sex            : chr [1:14880] NA NA NA NA ...\n $ riverOrdered   : Ord.factor w/ 4 levels \"West Brook\"<\"WB Jimmy\"<..: 2 2 2 2 2 2 2 2 2 3 ...\n $ sectionN       : num [1:14880] 13 14 14 2 6 8 8 11 12 10 ...\n $ year           : num [1:14880] 2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...\n $ j              : num [1:14880] 270 291 298 340 333 305 313 270 270 236 ...\n $ sectionWQuarter: num [1:14880] 13.25 14 14 2.75 6.25 ...\n\n\nCode\ncdWB_wandingTribs3 <- tar_read(cdWB_wandingTribs3_target)\n\ncdWB_wandingWB2 <- tar_read(cdWB_wandingWB2_target)\ncdWB_wandingWB3 <- tar_read(cdWB_wandingWB3_target)\n\n\n\n\nCode\ncdWB_wanding0 %>% \n  group_by(riverOrdered, cohort) %>% \n  summarize(n = n()) %>%\n  pivot_wider(values_from = \"n\", names_from = \"riverOrdered\") %>%\n  arrange(cohort) %>%\n  kable() %>%\n  kable_styling(full_width = T)\n\n\n\n\nTable 6.1:  Count of wanding data by river \n \n  \n    cohort \n    West Brook \n    WB Jimmy \n    WB Mitchell \n    WB OBear \n  \n \n\n  \n    1996 \n    4 \n    NA \n    NA \n    NA \n  \n  \n    1997 \n    9 \n    NA \n    NA \n    NA \n  \n  \n    1998 \n    33 \n    41 \n    4 \n    NA \n  \n  \n    1999 \n    141 \n    44 \n    2 \n    2 \n  \n  \n    2000 \n    352 \n    211 \n    116 \n    66 \n  \n  \n    2001 \n    1966 \n    1022 \n    414 \n    639 \n  \n  \n    2002 \n    2169 \n    615 \n    467 \n    894 \n  \n  \n    2003 \n    80 \n    650 \n    277 \n    1004 \n  \n  \n    2004 \n    195 \n    118 \n    298 \n    3 \n  \n  \n    2005 \n    61 \n    51 \n    90 \n    NA \n  \n  \n    2006 \n    NA \n    95 \n    126 \n    NA \n  \n  \n    2007 \n    NA \n    125 \n    256 \n    NA \n  \n  \n    2008 \n    NA \n    186 \n    41 \n    NA \n  \n  \n    2009 \n    NA \n    1089 \n    840 \n    NA \n  \n  \n    2010 \n    NA \n    50 \n    28 \n    NA \n  \n  \n    NA \n    6 \n    NA \n    NA \n    NA"
  },
  {
    "objectID": "getDataWanding.html#all-wanding-data",
    "href": "getDataWanding.html#all-wanding-data",
    "title": "6  Get wanding data",
    "section": "6.2 All wanding data",
    "text": "6.2 All wanding data\nBased on the following, looks like best data for analysis are trout in the tribs in 2009 2010. Need to decide what to do for salmon\n\n\nCode\n#everything\nggplot(cdWB_wanding0, aes(j, sectionWQuarter, color = tag) )+\n  geom_point()+\n  geom_line() +\n  scale_y_continuous(limits = c(0,50))+\n  theme(legend.position = \"none\")+\n  ggtitle(\"Everything\") +\n  facet_grid(riverOrdered ~ year)\n\n\n\n\n\nCode\n#everything\nggplot(filter(cdWB_wanding0, aliveOrDead != 'dead'), aes(j, sectionWQuarter, color = tag) )+\n  geom_point()+\n  geom_line() +\n  scale_y_continuous(limits = c(0, 50))+\n  theme(legend.position = \"none\")+\n  ggtitle(\"Not dead\") +\n  facet_grid(river~year)"
  },
  {
    "objectID": "getDataWanding.html#tributaries",
    "href": "getDataWanding.html#tributaries",
    "title": "6  Get wanding data",
    "section": "6.3 Tributaries",
    "text": "6.3 Tributaries\n\n\nCode\n# Tribs\n# Loop over species\nfor (s in c(\"bkt\",\"bnt\") ) {\n  tmp2 <-\n    ggplot(filter(cdWB_wanding0, river!=\"west brook\" & species == s & aliveOrDead != 'dead'), \n           aes(detectionDate,sectionWQuarter, group = tag))+\n    geom_point(aes(shape = aliveOrDead), size = 2)+\n    geom_line() +\n    scale_y_continuous(limits = c(-2, 15))+\n    #  theme(legend.position=\"none\")+\n    ggtitle(paste(\"Tribs\", s, \"not dead\")) +\n    facet_grid(river ~ year, scales = 'free')\n  print(tmp2)\n}\n\n\n\n\n\n\n\n\n\n6.3.1 Which species_year_tributary?\nRaw data graphs for the 4 sets of data to focus on\n\n\nCode\n# Tribs - focus on a year\nfor (s in c(\"bkt\", \"bnt\") ) {\n  for (y in c(2009, 2010) ) {\n    for (r in c(\"wb mitchell\", \"wb jimmy\", \"wb obear\")) {\n\n      tmp <-\n        ggplot(filter(cdWB_wanding0, river == r & species == s & year == y & aliveOrDead != 'dead'), \n               aes(detectionDate,sectionWQuarter, color = tag))+\n        geom_point(aes(shape=aliveOrDead),size=2)+\n        geom_line() +\n        #  scale_y_continuous(limits=c(0,15))+\n        theme(legend.position=\"none\")+\n        ggtitle(paste(\"Tribs\", s, y, r, \"not dead\"))\n      #  facet_grid(species~year,scales='free')\n\n      print(tmp)\n    }\n  }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n6.3.2 Movement\nCounts of observations by month, river, year\n\n\nCode\ntable(cdWB_wandingTribs3$month, cdWB_wandingTribs3$river, cdWB_wandingTribs3$year)\n\n\n, ,  = 2009\n\n    \n     wb jimmy wb mitchell\n  9        42          66\n  10      185         161\n  11      170         117\n\n, ,  = 2010\n\n    \n     wb jimmy wb mitchell\n  9        20          14\n  10       46          17\n  11       21          12\n\n\nCode\n ggplot(cdWB_wandingTribs3, aes(moveRate, color = species)) +\n   geom_freqpoly() +\n   facet_grid(river ~ year)\n\n\n\n\n\nFrequency distribution of movement rates\n\n\nCode\nggplot(cdWB_wandingTribs3, aes(moveRate, linetype = species)) +\n  geom_freqpoly(binwidth=5, boundary = min(cdWB_wandingTribs3$moveRate)) +\n  scale_x_continuous(\"Movement rate (m/week)\") +\n  scale_y_continuous(\"Frequency\") +\n  theme_bw(base_size=25)+\n  theme( strip.background = element_blank()\n         #strip.text = element_blank()\n         #legend.position = \"none\"\n         ) +\n  facet_grid(~ river)\n\n\n\n\n\n\n\n6.3.3 Intervals\n\n\nCode\n# #Cut moveTime into intervals to make sure patterns look same for recaptures of different intervals\n\n# ggplot(cdWB_wandingTribs4_target, aes( moveRate, color=interval ) ) +\n#   geom_freqpoly() +\n#   facet_grid(river~year+species)\n\n #Try a boxplot\n ggplot( cdWB_wandingTribs3 %>% filter(month %in% 9:11), \n         aes( factor(month),moveRate, color = species ) ) +\n   geom_boxplot() +\n   facet_grid(river~year)\n\n\n\n\n\n\n\n6.3.4 Random effect models\n\n\nCode\n# RE model for individual movement variation\n# \n mod0 <- lmer(abs(moveRate) ~ (1|tag), data = cdWB_wandingTribs3)\n# ####\n mod1 <- lmer(abs(moveRate) ~ factor(species) + (1|tag), data = cdWB_wandingTribs3)\n# ####\n mod2 <- lmer(abs(moveRate) ~ factor(species) * factor(month) + (1|tag), data = cdWB_wandingTribs3)\n# ####\n mod3 <- lmer(abs(moveRate) ~ factor(species) + factor(month) + factor(year) + (1|tag), data = cdWB_wandingTribs3)\n# ####\n mod4 <- lmer(abs(moveRate) ~ factor(species) * factor(month) * factor(year) + (1|tag), data = cdWB_wandingTribs3)\n# \n AIC(mod0,mod1,mod2,mod3,mod4) %>% arrange(AIC)\n\n\n     df      AIC\nmod4 14 7388.654\nmod2  8 7429.937\nmod3  7 7434.280\nmod1  4 7460.786\nmod0  3 7466.674\n\n\nCode\n# \n summary(mod4)\n\n\nLinear mixed model fit by REML ['lmerMod']\nFormula: abs(moveRate) ~ factor(species) * factor(month) * factor(year) +  \n    (1 | tag)\n   Data: cdWB_wandingTribs3\n\nREML criterion at convergence: 7360.7\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-2.4602 -0.2715 -0.1552 -0.0014  9.1656 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n tag      (Intercept)  31.14    5.581  \n Residual             266.81   16.334  \nNumber of obs: 871, groups:  tag, 326\n\nFixed effects:\n                                                    Estimate Std. Error t value\n(Intercept)                                           15.462      1.774   8.714\nfactor(species)bnt                                    -9.948      4.965  -2.004\nfactor(month)10                                      -10.510      1.989  -5.283\nfactor(month)11                                      -11.744      2.049  -5.733\nfactor(year)2010                                      -8.289      3.486  -2.378\nfactor(species)bnt:factor(month)10                     6.680      5.466   1.222\nfactor(species)bnt:factor(month)11                     8.700      5.652   1.539\nfactor(species)bnt:factor(year)2010                    2.813     18.086   0.156\nfactor(month)10:factor(year)2010                       9.706      4.219   2.300\nfactor(month)11:factor(year)2010                      21.045      4.745   4.435\nfactor(species)bnt:factor(month)10:factor(year)2010   -3.630     19.402  -0.187\nfactor(species)bnt:factor(month)11:factor(year)2010  -17.396     20.572  -0.846\n\nCorrelation of Fixed Effects:\n            (Intr) fctr() fc()10 fc()11 f()201 fc():()10 fc():()11 f():()2\nfctr(spcs)b -0.357                                                        \nfctr(mnt)10 -0.850  0.304                                                 \nfctr(mnt)11 -0.831  0.297  0.739                                          \nfctr(y)2010 -0.500  0.179  0.432  0.423                                   \nfctr():()10  0.309 -0.879 -0.364 -0.269 -0.157                            \nfctr():()11  0.301 -0.856 -0.268 -0.362 -0.153  0.779                     \nfc():()2010  0.096 -0.274 -0.083 -0.082 -0.193  0.241     0.235           \nf()10:()201  0.397 -0.142 -0.470 -0.346 -0.799  0.171     0.125     0.154 \nf()11:()201  0.361 -0.129 -0.319 -0.431 -0.706  0.116     0.156     0.136 \nf():()10:() -0.086  0.247  0.102  0.075  0.174 -0.281    -0.218    -0.915 \nf():()11:() -0.083  0.235  0.074  0.099  0.163 -0.214    -0.275    -0.851 \n            f()10: f()11: f():()10:\nfctr(spcs)b                        \nfctr(mnt)10                        \nfctr(mnt)11                        \nfctr(y)2010                        \nfctr():()10                        \nfctr():()11                        \nfc():()2010                        \nf()10:()201                        \nf()11:()201  0.582                 \nf():()10:() -0.217 -0.127          \nf():()11:() -0.134 -0.231  0.789   \n\n\nCode\n# \n randoms <- REsim( mod4, n.sims = 1000 )\n plotREsim(randoms)\n\n\n\n\n\nCode\n# \n\n ggplot(randoms, aes(mean)) + \n   geom_histogram(binwidth = 0.75, boundary = min(randoms$mean)) +\n   scale_x_continuous(\"Indivdual random effect for movement rate (m/week)\") +\n   scale_y_continuous(\"Frequency\") +\n   theme_bw(base_size = 25)\n\n\n\n\n\nCode\n# # % of fish with CI that don't overlap 0\n randoms$lCI <- randoms$mean - randoms$sd * 1.96\n randoms$uCI <- randoms$mean + randoms$sd * 1.96\n randoms$sig <- (randoms$uCI < 0 | randoms$lCI > 0)\n# \n count(randoms, sig)$n/nrow(randoms)\n\n\n[1] 0.98466258 0.01533742\n\n\n\n\n6.3.5 Young-of-year fish\n\n\nCode\nggplot(cdWB_wandingTribs3, aes(moveRate, linetype = species)) +\n  geom_freqpoly() +\n  scale_x_continuous(\"Movement rate (m/week)\") +\n  scale_y_continuous(\"Frequency\") +\n  #theme_bw(base_size=25)+\n  facet_grid(month ~ yoy + river)"
  },
  {
    "objectID": "getDataWanding.html#west-brook",
    "href": "getDataWanding.html#west-brook",
    "title": "6  Get wanding data",
    "section": "6.4 West Brook",
    "text": "6.4 West Brook\nDid not filter by moveTime > 1 because there were within-day samples in the WB (in contrast to the tribs)\n\n6.4.1 West brook wanding data\nCalculate and plot movement\n\n\nCode\n# Loop over species\nfor (s in unique(cdWB_wanding0$species)) {\n  tmp <-\n    ggplot(filter(cdWB_wanding0, river == \"west brook\" & species==s & aliveOrDead != 'dead'), \n           aes(detectionDate,sectionWQuarter, color = tag))+\n    geom_point(size=2)+\n    geom_line() +\n    scale_y_continuous(limits = c(30,35))+\n    theme(legend.position = \"none\")+\n    ggtitle(paste(\"WB\", s, \"not dead\")) +\n    facet_wrap(~ year, scales = 'free')\n  print(tmp)\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n6.4.2 Movement\n\n\nCode\ntable(cdWB_wandingWB3$species, cdWB_wandingWB3$month, cdWB_wandingWB3$river, cdWB_wandingWB3$year)\n\n\n, ,  = west brook,  = 2002\n\n     \n        4   5   6   8   9  10  11  12\n  ats   0   0   0  28  11  14 149   8\n  bkt   0   0   0  18   3  12 101   5\n\n, ,  = west brook,  = 2003\n\n     \n        4   5   6   8   9  10  11  12\n  ats 186 281 147   0   0   0   0   0\n  bkt  90 180  93   0   0   0   0   0\n\n\nCode\n# \n# # raw\n ggplot(cdWB_wandingWB3, aes(j, sectionWQuarter, color = tag)) +\n   geom_point()+\n   geom_line() +\n   #  scale_y_continuous(limits=c(0,50))+\n   theme(legend.position=\"none\")+\n   ggtitle(\"Not dead\") +\n   facet_grid(river~year)\n\n\n\n\n\nCode\n ggplot(cdWB_wandingWB3, aes(moveRate, color = species)) +\n   geom_freqpoly() +\n   facet_grid(river ~ year)\n\n\n\n\n\nCode\n ggplot(cdWB_wandingWB3, aes(moveRate, linetype=species)) +\n   geom_freqpoly(binwidth = 5, boundary = min(cdWB_wandingWB3$moveRate, na.rm=T)) +\n   scale_x_continuous(\"Movement rate (m/week)\") +\n   scale_y_continuous(\"Frequency\") +\n   theme_bw(base_size=25)+\n   theme( strip.background = element_blank()\n          #strip.text = element_blank(),\n          #legend.position = \"none\"\n          ) \n\n\n\n\n\nCode\n# #ats is solid line\n\n# \n\n\n\n\n6.4.3 Random effects models\n\n\nCode\n  mod0WB <- lmer( abs(moveRate) ~ (1|tag), data=cdWB_wandingWB3 )\n  ####\n  mod1WB <- lmer( abs(moveRate) ~ factor(species) + (1|tag), data=cdWB_wandingWB3 )\n  ####\n  mod2WB <- lmer( abs(moveRate) ~ factor(species) * factor(month) + (1|tag), data=cdWB_wandingWB3 )\n  ####\n  mod3WB <- lmer( abs(moveRate) ~ factor(species) + factor(month) + factor(year) + (1|tag), data=cdWB_wandingWB3 )\n \n \n  AIC(mod0WB,mod1WB,mod2WB,mod3WB) %>% arrange(AIC)\n\n\n       df      AIC\nmod2WB 18 12944.76\nmod3WB 11 13001.44\nmod1WB  4 13052.68\nmod0WB  3 13060.72\n\n\nCode\n  summary(mod2WB)\n\n\nLinear mixed model fit by REML ['lmerMod']\nFormula: abs(moveRate) ~ factor(species) * factor(month) + (1 | tag)\n   Data: cdWB_wandingWB3\n\nREML criterion at convergence: 12908.8\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-2.5703 -0.4130 -0.1898  0.0996 10.7899 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n tag      (Intercept)  531.2   23.05   \n Residual             2369.0   48.67   \nNumber of obs: 1216, groups:  tag, 124\n\nFixed effects:\n                                   Estimate Std. Error t value\n(Intercept)                          15.257      4.977   3.066\nfactor(species)bkt                    7.872      8.440   0.933\nfactor(month)5                        7.095      4.977   1.426\nfactor(month)6                        2.478      6.373   0.389\nfactor(month)8                        8.650     10.720   0.807\nfactor(month)9                      -12.233     15.934  -0.768\nfactor(month)10                     -10.745     18.187  -0.591\nfactor(month)11                      -2.775      5.712  -0.486\nfactor(month)12                     -18.671     18.086  -1.032\nfactor(species)bkt:factor(month)5     7.775      8.643   0.900\nfactor(species)bkt:factor(month)6    23.543     10.572   2.227\nfactor(species)bkt:factor(month)8   -31.321     18.194  -1.722\nfactor(species)bkt:factor(month)9   -10.230     33.752  -0.303\nfactor(species)bkt:factor(month)10   59.008     25.208   2.341\nfactor(species)bkt:factor(month)11   -8.667      9.734  -0.890\nfactor(species)bkt:factor(month)12    4.149     31.494   0.132\n\n\nCode\n  randomsWB <- REsim(mod2WB, n.sims = 1000)\n  plotREsim(randomsWB)\n\n\n\n\n\nCode\n  ggplot(randomsWB, aes(mean)) +\n    geom_histogram(binwidth = 4.75, boundary = min(randomsWB$mean)) +\n    scale_x_continuous(\"Indivdual random effect for movement rate (m/week)\") +\n    scale_y_continuous(\"Frequency\") +\n    theme_bw(base_size = 25)\n\n\n\n\n\nCode\n  # % of fish with CI that don't overlap 0\n  randomsWB$lCI <- randomsWB$mean - randomsWB$sd * 1.96\n  randomsWB$uCI <- randomsWB$mean + randomsWB$sd * 1.96\n  randomsWB$sig <- (randomsWB$uCI < 0 | randomsWB$lCI > 0)\n  \n  count(randomsWB,sig)$n/nrow(randomsWB)\n\n\n[1] 0.90322581 0.09677419"
  },
  {
    "objectID": "getDataAntenna.html#get-antenna-data-target",
    "href": "getDataAntenna.html#get-antenna-data-target",
    "title": "7  Get antenna data",
    "section": "7.1 Get antenna data target",
    "text": "7.1 Get antenna data target\n\n\nCode\ncdWB_antenna0 <- tar_read(cdWB_antenna0_target)\nstr(cdWB_antenna0)\n\n\ntibble [410,915 × 23] (S3: tbl_df/tbl/data.frame)\n $ tag                   : chr [1:410915] \"00088cbed9\" \"00088cbed9\" \"00088cbed9\" \"00088cbed9\" ...\n $ detectionDate         : POSIXct[1:410915], format: \"2014-10-18 00:22:33\" \"2014-10-24 19:34:31\" ...\n $ river                 : chr [1:410915] \"wb mitchell\" \"wb mitchell\" \"wb mitchell\" \"wb mitchell\" ...\n $ riverMeter            : num [1:410915] 4797 4797 4830 4830 5524 ...\n $ survey                : chr [1:410915] \"stationaryAntenna\" \"stationaryAntenna\" \"stationaryAntenna\" \"stationaryAntenna\" ...\n $ cohort                : num [1:410915] 2013 2013 2013 2013 2013 ...\n $ species               : chr [1:410915] \"bkt\" \"bkt\" \"bkt\" \"bkt\" ...\n $ dateEmigrated         : Date[1:410915], format: \"2014-10-25\" \"2014-10-25\" ...\n $ sex                   : chr [1:410915] NA NA NA NA ...\n $ riverOrdered          : Ord.factor w/ 4 levels \"West Brook\"<\"WB Jimmy\"<..: 3 3 3 3 1 2 2 2 2 2 ...\n $ drainage              : chr [1:410915] \"west\" \"west\" \"west\" \"west\" ...\n $ area                  : chr [1:410915] NA NA NA NA ...\n $ section               : num [1:410915] NA NA NA NA NA NA NA NA NA NA ...\n $ quarter_length        : num [1:410915] NA NA NA NA NA NA NA NA NA NA ...\n $ confluence_river_meter: num [1:410915] NA NA NA NA NA NA NA NA NA NA ...\n $ sectionOriginal       : chr [1:410915] NA NA NA NA ...\n $ inside                : logi [1:410915] TRUE TRUE TRUE TRUE TRUE TRUE ...\n $ year                  : num [1:410915] 2014 2014 2014 2014 2014 ...\n $ yday                  : num [1:410915] 291 297 297 297 298 258 260 260 289 289 ...\n $ date                  : Date[1:410915], format: \"2014-10-18\" \"2014-10-24\" ...\n $ lagSection            : num [1:410915] NA NA NA NA NA NA NA NA NA NA ...\n $ distMoved             : num [1:410915] NA NA NA NA NA NA NA NA NA NA ...\n $ moveDir               : logi [1:410915] NA NA NA NA NA NA ...\n\n\nNeed to find previous antanna analysis - lower left drawer in office desk."
  },
  {
    "objectID": "dataAll.html#merge-all-data",
    "href": "dataAll.html#merge-all-data",
    "title": "8  All data",
    "section": "8.1 Merge All data",
    "text": "8.1 Merge All data\n\n\n\n\n8.1.1 Read merged data target\n\n\ntibble [516,898 × 57] (S3: tbl_df/tbl/data.frame)\n $ tag                   : chr [1:516898] \"00088cbed0\" \"00088cbed3\" \"00088cbed4\" \"00088cbed4\" ...\n $ detectionDate         : POSIXct[1:516898], format: \"2013-03-25 04:00:00\" \"2012-06-07 13:03:00\" ...\n $ sampleName            : chr [1:516898] \"84\" \"81\" \"84\" \"85\" ...\n $ sampleNumber          : num [1:516898] 73 70 73 74 70 71 73 79 80 71 ...\n $ river                 : chr [1:516898] \"wb obear\" \"west brook\" \"west brook\" \"west brook\" ...\n $ section               : num [1:516898] 7 1 40 44 25 32 32 3 3 23 ...\n $ area                  : chr [1:516898] \"trib\" \"inside\" \"inside\" \"inside\" ...\n $ observedLength        : num [1:516898] 62 62 109 154 113 120 147 70 74 86 ...\n $ survey                : chr [1:516898] \"shock\" \"shock\" \"shock\" \"shock\" ...\n $ pass                  : num [1:516898] 1 1 1 1 1 1 1 1 1 1 ...\n $ observedWeight        : num [1:516898] 1.9 2.7 12.6 41.3 15.5 18.3 30.4 3.5 4.8 6.7 ...\n $ comments              : chr [1:516898] \"additional genetic sample\" NA NA NA ...\n $ cohort                : num [1:516898] 2012 2012 2012 2012 2011 ...\n $ species               : chr [1:516898] \"bkt\" \"bkt\" \"bkt\" \"bkt\" ...\n $ dateEmigrated         : Date[1:516898], format: NA NA ...\n $ sex                   : chr [1:516898] NA NA NA NA ...\n $ year                  : num [1:516898] 2013 2012 2013 2013 2012 ...\n $ season                : num [1:516898] 1 2 1 2 2 3 1 3 4 3 ...\n $ proportionSampled     : num [1:516898] 1 1 1 1 1 1 1 1 1 1 ...\n $ lagDetectionDate      : POSIXct[1:516898], format: NA NA ...\n $ meanTemperature       : num [1:516898] NaN NaN 10.7 NaN 16.5 ...\n $ meanFlow              : num [1:516898] NaN NaN 0.5247 NaN 0.0338 ...\n $ riverOrdered          : Ord.factor w/ 4 levels \"West Brook\"<\"WB Jimmy\"<..: 4 1 1 1 1 1 1 4 4 1 ...\n $ readerId              : chr [1:516898] NA NA NA NA ...\n $ sectionN              : num [1:516898] 7 1 40 44 25 32 32 3 3 23 ...\n $ aliveOrDead           : chr [1:516898] \"alive\" \"alive\" \"alive\" \"alive\" ...\n $ instance              : num [1:516898] NA NA NA NA NA NA NA NA NA NA ...\n $ quarter               : num [1:516898] NA NA NA NA NA NA NA NA NA NA ...\n $ leftOrRight           : chr [1:516898] NA NA NA NA ...\n $ habitat               : chr [1:516898] NA NA NA NA ...\n $ cover                 : chr [1:516898] NA NA NA NA ...\n $ justification         : chr [1:516898] NA NA NA NA ...\n $ sectionWQuarter       : num [1:516898] NA NA NA NA NA NA NA NA NA NA ...\n $ j                     : num [1:516898] NA NA NA NA NA NA NA NA NA NA ...\n $ date                  : Date[1:516898], format: \"2013-03-25\" \"2012-06-07\" ...\n $ sectionOriginal       : chr [1:516898] \"7\" \"1\" \"40\" \"44\" ...\n $ inside                : logi [1:516898] TRUE TRUE TRUE TRUE TRUE TRUE ...\n $ yday                  : num [1:516898] 84 159 88 176 160 271 87 260 335 270 ...\n $ ageInSamples          : num [1:516898] 3 0 3 4 4 5 7 1 2 1 ...\n $ isYOY                 : logi [1:516898] TRUE TRUE TRUE FALSE FALSE FALSE ...\n $ lagSection            : num [1:516898] NA NA 44 NA 32 32 NA 3 NA 24 ...\n $ distMoved             : num [1:516898] NA NA -4 NA -7 0 NA 0 NA -1 ...\n $ lagObservedWeight     : num [1:516898] NA NA 41.3 NA 18.3 30.4 NA 4.8 NA 12.7 ...\n $ lagObservedLength     : num [1:516898] NA NA 154 NA 120 147 NA 74 NA 108 ...\n $ grWeight              : num [1:516898] NA NA 3.30e+10 NA 1.48e-01 ...\n $ grLength              : num [1:516898] NA NA 0.5102 NA 0.0631 ...\n $ minSample             : num [1:516898] 73 70 73 73 70 70 70 79 79 71 ...\n $ maxSample             : num [1:516898] 73 70 74 74 73 73 73 80 80 74 ...\n $ minYear               : num [1:516898] 1997 1997 1997 1997 1997 ...\n $ moveDir               : num [1:516898] NA NA -1 NA -1 0 NA 0 NA -1 ...\n $ sampleInterval        : num [1:516898] NA NA 88.2 NA 110.9 ...\n $ drainage              : chr [1:516898] \"west\" \"west\" \"west\" \"west\" ...\n $ quarter_length        : num [1:516898] 5 5.2 5.03 4.83 4.75 ...\n $ river_meter           : num [1:516898] 5252 4394 5208 5292 4903 ...\n $ confluence_river_meter: num [1:516898] 5114 0 0 0 0 ...\n $ riverMeter            : num [1:516898] 5252 4394 5208 5292 4903 ...\n $ nPasses               : num [1:516898] 1 2 1 2 2 2 1 1 1 2 ...\n\n\n\n\n\n\n\n\n\n\nCode\nviewof selectTag = Inputs.select(\n  tagsOJS,\n  {\n    //value: \"1bf20ebcae\",\n    label: \"Tags:\",\n    multiple: true\n  }\n)\n\n\n\n\n\n\n\n\n\nCode\nselectTag\n\n\n\n\n\n\n\n\n\nCode\ntagsToPlot\n\n\n\n\n\n\n\n\n\nCode\ntranspose(allOJS)\n\n\n\n\n\n\n\n\n\n\n\nCode\nallOJS_T = transpose(allOJS)\n\ntagsToPlot = allOJS_T.filter((d) => selectTag.includes(d.tag))\n\ntagsOverTime = Plot.plot({\n  marks: [\n    Plot.dot(tagsToPlot, { x: \"detectionDate\", y: \"section\", stroke: \"tag\" }),\n    Plot.line(tagsToPlot, { x: \"detectionDate\", y: \"section\", stroke: \"tag\" })\n  ]\n})"
  },
  {
    "objectID": "modelYOY.html#raw-data-for-yoy-model",
    "href": "modelYOY.html#raw-data-for-yoy-model",
    "title": "9  Young-of-year size model",
    "section": "9.1 Raw data for YOY model",
    "text": "9.1 Raw data for YOY model\n\nEnvironmental data (flow, temperature) are from 1, 3, or 5 months prior to date of individual capture. Also can used fixed dates: assumed spawning dates, assumed emergence dates and actual observation (sample) dates.\nAll fish data are from age-0 in autumn.\nAbundance data."
  },
  {
    "objectID": "modelYOY.html#get-data-from-targets",
    "href": "modelYOY.html#get-data-from-targets",
    "title": "9  Young-of-year size model",
    "section": "9.2 Get data from targets",
    "text": "9.2 Get data from targets\nWest Brook environmental data (flow and temperature) and electrofishing data\n\n\nCode\nenvDataWB <- tar_read(envDataWB_target)\ncdWB_electro <- tar_read(cdWB_electro_target)"
  },
  {
    "objectID": "modelYOY.html#get-first-observations",
    "href": "modelYOY.html#get-first-observations",
    "title": "9  Young-of-year size model",
    "section": "9.3 Get first observations",
    "text": "9.3 Get first observations\n\nFilter cdWB_electro for first observations in the autumn for age-0 fish (ageInsamples == 1). Including both tagged and untagged fish.\n\n\n\nCode\nfirstObs_noTag <- tar_read(firstObs_noTag_target)\nfirstObs_tag <- tar_read(firstObs_tag_target)\nfirstObs0 <- tar_read(firstObs0_target)\n\n\nFor each date in firstObs0 that at least one fish was captured, calculate summary stats for flow and temperature for different time periods:\n1. Assumed spawning to capture\n2. Assumed spawning to assumed emergence\n3. Assumed emergence to capture\n4. One month preceding capture\n5. Three months preceding capture\n5. Five months preceding capture\nThen merge results with firstObs0 to create firstObs.\n\n\nCode\nfirstObsDates <- tar_read(firstObsDates_target) \n    \nfirstObs_Env <- tar_read(firstObs_Env_target)\n# merge env data into firstObs0\nfirstObs <- tar_read(firstObs_target)\n\n\nUnnest firstObs so environmental summary stats are available as data frame with the name of the time interval as the prefix to the statisticVariable name\n\n\nCode\nfirstObsUnnested <- tar_read(firstObsUnnested_target)\n\nggplot(firstObsUnnested, aes(oneMonth_sumTScaled, fiveMonth_sumTScaled)) +\n geom_point() +\n facet_wrap(~river)\n\n\n\n\n\n\n9.3.1 Counts of captured fish\nMin and max years (inclusive) for standardizing counts This is in targets, not sure if needed here\n\n\nCode\nminYear <- 2000\nmaxYear <- 2015\n\n\nCounts by river and species\n\n\nCode\ncountsRSY <- tar_read(countsRSY_target)\n\nggplot(countsRSY, aes(year, countRS_Scaled, color = species)) +\n  geom_point() +\n  geom_line() +\n  facet_wrap(~ river)\n\n\n\n\n\nCounts by river\n\n\nCode\ncountsRY <- tar_read(countsRY_target)\n\nggplot(countsRY, aes(year, countR_Scaled, color = river)) +\n  geom_point() +\n  geom_line()\n\n\n\n\n\nCounts for the metaPopulation (WB, Jimmy, Mitchell)\nUse these for modelling.\n\n\nCode\ncountsMetaY <- tar_read(countsMetaY_target)\n\nggplot(countsMetaY, aes(year, count_Scaled)) +\n  geom_point() +\n  geom_line()\n\n\n\n\n\nMerge metapopulation scaled counts into firstObsUnnested\n\n\nCode\nfirstObsUnnested <- tar_read(firstObsUnnested_target)\nfirstObsUnnestedWB <- tar_read(firstObsUnnestedWB_target)"
  },
  {
    "objectID": "modelYOY.html#raw-data-plots",
    "href": "modelYOY.html#raw-data-plots",
    "title": "9  Young-of-year size model",
    "section": "9.4 Raw data plots",
    "text": "9.4 Raw data plots\n\n9.4.1 Frequency plots by species and river\n\n\n9.4.2 Brook Trout, West brook\n\n\nCode\n  #cd1 <- cdWB_electro %>% filter(ageInSamples == 1, species != 'ats')\n\n  plotSppRiv = function(s, r) { \n    ggplot(firstObs %>% filter(species == s, river == r), aes(observedLength, color = is.na(tag))) +\n      geom_freqpoly() +\n      geom_vline(xintercept = 60) +\n      ggtitle(paste(s, r, sep = ', ')) +\n      xlim(c(30,125)) +\n      facet_wrap(~ year, scales = \"free_y\")\n  }\n  \n  species = 'bkt'\n  riverOrdered = \"west brook\"\n\n  plotSppRiv(species, riverOrdered)\n\n\n\n\n\n\n\n9.4.3 Brook Trout, wb jimmy\n\n\n\n\n\n\n\n9.4.4 Brook Trout, wb mitchell\n\n\n\n\n\n\n\n9.4.5 Brook Trout, wb obear\n\n\n\n\n\n\n\n9.4.6 Brown Trout, West brook\n\n\n\n\n\n\n\n9.4.7 Brown Trout, wb jimmy\n\n\n\n\n\n\n\n9.4.8 Brown Trout, wb mitchell\n\n\n\n\n\n\n\n9.4.9 Brown Trout, wb obear - there are no Brown trout in O’Bear\n\n\n9.4.10 Trout, in the WB mainstem only\n\n\nCode\n  ggplot(firstObs %>% filter(species != \"ats\"), aes(observedLength)) +\n    geom_freqpoly() +\n    geom_vline(xintercept = 60, color = 'orange') +\n    facet_grid(species ~ year)\n\n\n\n\n\nCode\n  ggplot(firstObs %>% filter(species != \"ats\"), aes(observedLength, color = is.na(tag))) +\n    geom_freqpoly() +\n    geom_vline(xintercept = 60, color = 'orange') +\n    facet_grid(species ~ year)\n\n\n\n\n\n\n\n9.4.11 Why are there untagged fish bigger than 60mm?\nCheck 2002/bkt/WB, as an example Answer: because they are outside the study area (area = ‘above’ or ‘below’) or were tagging mortalities\n\n\nCode\n  firstObs2002BKT <- firstObs %>% filter(year == 2002, species == \"bkt\")\n  table(is.na(firstObs2002BKT$tag))\n\n\n\nFALSE  TRUE \n  295   253 \n\n\nCode\n  ggplot(firstObs2002BKT, aes(observedLength, color = is.na(tag))) +\n    geom_freqpoly() +\n    geom_vline(xintercept = 60)\n\n\n\n\n\nCode\n  # looks like untagged area=inside fish wee morts, the rest were above or below\n  ggplot(firstObs2002BKT, aes(observedLength, color = is.na(tag))) +\n    geom_freqpoly() +\n    geom_vline(xintercept = 60) +\n    facet_grid(~area)\n\n\n\n\n\nCode\n  # check 2003\n  ggplot(firstObs %>% filter(year == 2003, species == \"bkt\"), aes(observedLength, color = is.na(tag))) +\n    geom_freqpoly() +\n    geom_vline(xintercept = 60) +\n    facet_grid(~area)\n\n\n\n\n\nCode\n  # same story as 2002"
  },
  {
    "objectID": "modelYOY.html#models-based-on-yearly-means",
    "href": "modelYOY.html#models-based-on-yearly-means",
    "title": "9  Young-of-year size model",
    "section": "9.5 Models based on yearly means",
    "text": "9.5 Models based on yearly means\nFilter firstObsUnnestedWB for bkt, bnt and min/maxYear\n\n\nCode\nd_WB_BKT_BNT <- firstObsUnnestedWB %>% filter(species != \"ats\", year %in% minYear:maxYear) %>%\n  mutate(species01 = ifelse(species == \"bkt\", 1, 0))\n\nhist(d_WB_BKT_BNT$detectionDate, breaks = 250)\n\n\n\n\n\nCode\nd_BKT_BNT <- firstObsUnnested %>% filter(species != \"ats\", year %in% minYear:maxYear) %>%\n  mutate(species01 = ifelse(species == \"bkt\", 1, 0))\n\n\nMean model functions\n\n\nCode\ngetMeansData <- function(d, t, f) {\n  means <- d %>% \n    group_by(species, year) %>% \n    summarize(meanLength = mean(observedLength, na.rm = TRUE), \n              meanEmerge_detect_sumTScaled = mean(emerge_detect_sumTScaled, na.rm = TRUE),\n              meanEmerge_detect_sumFScaled = mean(emerge_detect_sumTScaled, na.rm = TRUE),\n              meanTTime_sumTScaled = mean(get(t), na.rm = TRUE),\n              meanFTime_sumFScaled = mean(get(f), na.rm = TRUE),\n              meanYdayScaled = mean(ydayScaled, na.rm = TRUE),\n              meanCount_Scaled = mean(count_Scaled, na.rm = TRUE)\n              )\n  return(means)\n}\n\ngetMeansDataByRiver <- function(d, t, f) {\n  means <- d %>% \n    group_by(species, year, river) %>% \n    summarize(meanLength = mean(observedLength, na.rm = TRUE), \n              meanEmerge_detect_sumTScaled = mean(emerge_detect_sumTScaled, na.rm = TRUE),\n              meanEmerge_detect_sumFScaled = mean(emerge_detect_sumTScaled, na.rm = TRUE),\n              meanTTime_sumTScaled = mean(get(t), na.rm = TRUE),\n              meanFTime_sumFScaled = mean(get(f), na.rm = TRUE),\n              meanYdayScaled = mean(ydayScaled, na.rm = TRUE),\n              meanCount_Scaled = mean(count_Scaled, na.rm = TRUE)\n              )\n  return(means)\n}\n\nplotMeans <- function(means){\n  out <- list()\n  out[[1]] <- ggplot(means, aes(meanTTime_sumTScaled, meanLength, color = species)) +\n    geom_point() + \n    geom_smooth(method = \"lm\", se = FALSE)\n  \n  out[[2]] <- ggplot(means, aes(meanFTime_sumFScaled, meanLength, color = species)) +\n    geom_point() + \n    geom_smooth(method = \"lm\", se = FALSE)\n  \n  out[[3]] <- ggplot(means, aes(meanTTime_sumTScaled, meanFTime_sumFScaled, color = species)) +\n    geom_point() + \n    geom_smooth(method = \"lm\", se = FALSE)\n  return(out)\n}\n\nrunMeanModels <- function(means) {\n  modLMMeans1 <- lm(meanLength ~ (factor(species) + meanFTime_sumFScaled + meanTTime_sumTScaled + meanYdayScaled + meanCount_Scaled), data = means)\n  modLMMeans2 <- lm(meanLength ~ (factor(species) + meanFTime_sumFScaled + meanTTime_sumTScaled + meanYdayScaled + meanCount_Scaled)^2, data = means)\n  modLMMeans3 <- lm(meanLength ~ (factor(species) + meanFTime_sumFScaled + meanTTime_sumTScaled + meanYdayScaled + meanCount_Scaled)^3, data = means)\n  return(list(modLMMeans1, modLMMeans2, modLMMeans3))\n}\n\n\nMean lengths by river. This is information only. Using the WB data only shown here and in the next graph for the models.\n\n\n\n\n\nMean lengths for the mean length model.\n\n\n\n\n\nGraphs for variables that do not depend on number of months\n\n\n\n\n\n\n\n\n\n9.5.0.1 Models with flow and temperature from previous one month\n\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n          df      AIC\nmod1[[2]] 17 176.2075\nmod1[[3]] 27 181.7035\nmod1[[1]]  7 181.8187\n\n\n\nCall:\nlm(formula = meanLength ~ (factor(species) + meanFTime_sumFScaled + \n    meanTTime_sumTScaled + meanYdayScaled + meanCount_Scaled), \n    data = means)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-6.2779 -1.9839 -0.8754  1.0981 10.5908 \n\nCoefficients:\n                     Estimate Std. Error t value Pr(>|t|)    \n(Intercept)           72.4359     1.0722  67.558  < 2e-16 ***\nfactor(species)bnt     0.6550     1.3128   0.499 0.622039    \nmeanFTime_sumFScaled   1.6769     0.3849   4.356 0.000184 ***\nmeanTTime_sumTScaled -10.3842     2.3734  -4.375 0.000175 ***\nmeanYdayScaled        -3.4856     1.7314  -2.013 0.054554 .  \nmeanCount_Scaled      -2.5187     0.7068  -3.564 0.001443 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.695 on 26 degrees of freedom\nMultiple R-squared:  0.6966,    Adjusted R-squared:  0.6383 \nF-statistic: 11.94 on 5 and 26 DF,  p-value: 4.544e-06\n\n\nRelative importance for main effects model\n\n\n     factor(species) meanFTime_sumFScaled meanTTime_sumTScaled \n          0.00395522           0.24940595           0.19990058 \n      meanYdayScaled     meanCount_Scaled \n          0.06280977           0.18053989 \n\n\n\n\n9.5.0.2 Models with flow and temperature from previous three months\n\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n          df      AIC\nmod3[[3]] 27 177.0683\nmod3[[2]] 17 181.7547\nmod3[[1]]  7 187.3979\n\n\n\nCall:\nlm(formula = meanLength ~ (factor(species) + meanFTime_sumFScaled + \n    meanTTime_sumTScaled + meanYdayScaled + meanCount_Scaled), \n    data = means)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-6.3569 -2.8523  0.3445  1.8018  9.2951 \n\nCoefficients:\n                     Estimate Std. Error t value Pr(>|t|)    \n(Intercept)           73.4882     1.8809  39.070  < 2e-16 ***\nfactor(species)bnt     0.8334     1.4312   0.582 0.565351    \nmeanFTime_sumFScaled   2.2450     0.5866   3.827 0.000732 ***\nmeanTTime_sumTScaled  -8.8499     3.6769  -2.407 0.023489 *  \nmeanYdayScaled         0.7120     1.4287   0.498 0.622411    \nmeanCount_Scaled      -3.1604     0.7937  -3.982 0.000490 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 4.032 on 26 degrees of freedom\nMultiple R-squared:  0.6388,    Adjusted R-squared:  0.5694 \nF-statistic: 9.197 on 5 and 26 DF,  p-value: 3.902e-05\n\n\nRelative importance for main effects model\n\n\n     factor(species) meanFTime_sumFScaled meanTTime_sumTScaled \n         0.004325792          0.281631981          0.060776249 \n      meanYdayScaled     meanCount_Scaled \n         0.066333713          0.225756051 \n\n\n\n\n9.5.0.3 Models with flow and temperature from previous five months\n\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n          df      AIC\nmod5[[3]] 27 167.4034\nmod5[[1]]  7 193.2144\nmod5[[2]] 17 208.3847\n\n\n\nCall:\nlm(formula = meanLength ~ (factor(species) + meanFTime_sumFScaled + \n    meanTTime_sumTScaled + meanYdayScaled + meanCount_Scaled), \n    data = means)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-5.9186 -3.3732  0.3856  2.4470 11.8564 \n\nCoefficients:\n                     Estimate Std. Error t value Pr(>|t|)    \n(Intercept)           71.1144     1.9342  36.767  < 2e-16 ***\nfactor(species)bnt     0.8911     1.5671   0.569  0.57450    \nmeanFTime_sumFScaled   2.6934     0.8705   3.094  0.00468 ** \nmeanTTime_sumTScaled  -3.5748     2.9746  -1.202  0.24029    \nmeanYdayScaled         3.2403     1.5506   2.090  0.04657 *  \nmeanCount_Scaled      -2.8957     0.8613  -3.362  0.00240 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 4.415 on 26 degrees of freedom\nMultiple R-squared:  0.5668,    Adjusted R-squared:  0.4835 \nF-statistic: 6.805 on 5 and 26 DF,  p-value: 0.0003537\n\n\nRelative importance for main effects model\n\n\n     factor(species) meanFTime_sumFScaled meanTTime_sumTScaled \n         0.004330339          0.226812955          0.017322018 \n      meanYdayScaled     meanCount_Scaled \n         0.107186866          0.211177826 \n\n\nr-squared values and AICs for 1st, 2nd (2-way interactions) and 3rd (3-way interactions) order models\n\n\n\n\n \n  \n    Order \n    r2 \n    numMonths \n  \n \n\n  \n    1 \n    0.697 \n    1 \n  \n  \n    2 \n    0.864 \n    1 \n  \n  \n    3 \n    0.913 \n    1 \n  \n\n\n\n\n\n\n\n \n  \n    Order \n    r2 \n    numMonths \n  \n \n\n  \n    1 \n    0.639 \n    3 \n  \n  \n    2 \n    0.838 \n    3 \n  \n  \n    3 \n    0.925 \n    3 \n  \n\n\n\n\n\n\n\n \n  \n    Order \n    r2 \n    numMonths \n  \n \n\n  \n    1 \n    0.567 \n    5 \n  \n  \n    2 \n    0.628 \n    5 \n  \n  \n    3 \n    0.945 \n    5 \n  \n\n\n\n\n\n\n\n \n  \n      \n    df \n    AIC \n    numMonths \n  \n \n\n  \n    mod1[[2]] \n    17 \n    176.207 \n    1 \n  \n  \n    mod1[[3]] \n    27 \n    181.703 \n    1 \n  \n  \n    mod1[[1]] \n    7 \n    181.819 \n    1 \n  \n\n\n\n\n\n\n\n \n  \n      \n    df \n    AIC \n    numMonths \n  \n \n\n  \n    mod3[[3]] \n    27 \n    177.068 \n    3 \n  \n  \n    mod3[[2]] \n    17 \n    181.755 \n    3 \n  \n  \n    mod3[[1]] \n    7 \n    187.398 \n    3 \n  \n\n\n\n\n\n\n\n \n  \n      \n    df \n    AIC \n    numMonths \n  \n \n\n  \n    mod5[[3]] \n    27 \n    167.403 \n    5 \n  \n  \n    mod5[[1]] \n    7 \n    193.214 \n    5 \n  \n  \n    mod5[[2]] \n    17 \n    208.385 \n    5 \n  \n\n\n\n\n\nRelative importance of main effects models (repeat of above, but all in one place here)\n\n\n\n\n \n  \n    var \n    relImp \n    numMonths \n  \n \n\n  \n    factor(species) \n    0.004 \n    1 \n  \n  \n    meanFTime_sumFScaled \n    0.249 \n    1 \n  \n  \n    meanTTime_sumTScaled \n    0.200 \n    1 \n  \n  \n    meanYdayScaled \n    0.063 \n    1 \n  \n  \n    meanCount_Scaled \n    0.181 \n    1 \n  \n\n\n\n\n\n\n\n \n  \n    var \n    relImp \n    numMonths \n  \n \n\n  \n    factor(species) \n    0.004 \n    3 \n  \n  \n    meanFTime_sumFScaled \n    0.282 \n    3 \n  \n  \n    meanTTime_sumTScaled \n    0.061 \n    3 \n  \n  \n    meanYdayScaled \n    0.066 \n    3 \n  \n  \n    meanCount_Scaled \n    0.226 \n    3 \n  \n\n\n\n\n\n\n\n \n  \n    var \n    relImp \n    numMonths \n  \n \n\n  \n    factor(species) \n    0.004 \n    5 \n  \n  \n    meanFTime_sumFScaled \n    0.227 \n    5 \n  \n  \n    meanTTime_sumTScaled \n    0.017 \n    5 \n  \n  \n    meanYdayScaled \n    0.107 \n    5 \n  \n  \n    meanCount_Scaled \n    0.211 \n    5 \n  \n\n\n\n\n\n\n\n9.5.1 Models with extreme flow events (droughts)\nWe get negative cumulFlows because we have some negative flows from the flow extension model\n\n\nCode\n# put some of these calculations into envDataWB\nenvDataWBFlow = tar_read(envDataWBFlow_target)\n\nfirstObsYears <- firstObs %>%\n    filter(year %in% minYear:maxYear, \n           yday > 100, yday < 300)\n\nggplot(envDataWBFlow, aes(yday, flow)) +\n  geom_point(aes(yday, observedLength/20), size = 0.75, alpha = 0.2, color = 'lightblue', data = firstObsYears) +\n  geom_point(size = 0.5) +\n  scale_x_continuous(breaks = seq(0,300, 30)) +\n  facet_wrap(~year)\n\n\n\n\n\nCode\nggplot(envDataWBFlow, aes(yday, cumulFlow / 10)) +\n  geom_point(aes(yday, observedLength / 20), size = 0.75, alpha = 0.2, color = 'lightblue', data = firstObsYears) +\n  geom_point(size = 0.5, color = 'darkgrey') +\n  geom_point(aes(yday, cumulTemp / 800), size = 0.5, color = \"orange\", data = envDataWBFlow) +\n  geom_point(aes(yday, flow), size = 0.5, data = envDataWBFlow) +\n  scale_x_continuous(breaks = seq(0, 300, 30)) +\n  #theme_publication() +\n  facet_wrap(~year)\n\n\n\n\n\nCode\nggplot(envDataWBFlow, aes(yday, cumulFlow, color = (year))) +\n  geom_point() +\n  scale_x_continuous(breaks = seq(0, 300, 30)) \n\n\n\n\n\nCode\nggplot(envDataWBFlow, aes(yday, cumulTemp, color = (year))) +\n  geom_point() +\n  #geom_point(aes(yday, cumulTemp / 800, color = factor(year)), data = tmp) +\n  scale_x_continuous(breaks = seq(0, 300, 30))\n\n\n\n\n\nIs there a sampling section effect?\nNote: there are fish in sections > 50 for years 2002 and 2003, need to filter out early\n\n\nCode\nggplot(d_WB_BKT_BNT %>% filter( section <= 47), aes(factor(section), observedLength)) +\n  geom_boxplot() +\n  geom_smooth() +\n  facet_wrap(~year)\n\n\n\n\n\nCode\nggplot(d_WB_BKT_BNT %>% filter( section <= 47), aes(factor(year), observedLength)) +\n  geom_boxplot() +\n  geom_smooth() +\n  facet_wrap(~section)"
  },
  {
    "objectID": "modelFlow.html",
    "href": "modelFlow.html",
    "title": "10  Flow model",
    "section": "",
    "text": "Code\ndataFlow <- tar_read(dataFlow_target)\ndFlow <- tar_read(dFlow_target)\ndFlowWide <- tar_read(dFlowWide_target)\n\n\n\n\nCode\ntibble(dataFlow)\n\n\n# A tibble: 582,388 × 9\n   Station_No Site_Name   DateTi…¹ GageH…² Disch…³ Water…⁴ AirPr…⁵ AirTe…⁶ X    \n        <int> <chr>       <chr>      <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <lgl>\n 1    1171000 Avery Brook 2/20/20…    4.17    5.37    32.0      NA      NA NA   \n 2    1171000 Avery Brook 2/20/20…    4.17    5.3     32.0      NA      NA NA   \n 3    1171000 Avery Brook 2/20/20…    4.16    5.17    32.0      NA      NA NA   \n 4    1171000 Avery Brook 2/20/20…    4.17    5.27    32.0      NA      NA NA   \n 5    1171000 Avery Brook 2/20/20…    4.17    5.3     32.0      NA      NA NA   \n 6    1171000 Avery Brook 2/20/20…    4.15    4.94    31.9      NA      NA NA   \n 7    1171000 Avery Brook 2/20/20…    4.13    4.56    31.9      NA      NA NA   \n 8    1171000 Avery Brook 2/20/20…    4.1     4.14    31.9      NA      NA NA   \n 9    1171000 Avery Brook 2/20/20…    4.08    3.84    31.9      NA      NA NA   \n10    1171000 Avery Brook 2/20/20…    4.09    4.02    31.9      NA      NA NA   \n# … with 582,378 more rows, and abbreviated variable names ¹​DateTime_EST,\n#   ²​GageHeight_Hobo_ft, ³​Discharge_Hobo_cfs, ⁴​WaterTemperature_HOBO_DegF,\n#   ⁵​AirPressure_PSI, ⁶​AirTemperature_HOBO_degF\n\n\nCode\ntable(dataFlow$Site_Name)\n\n\n\n         Avery Brook          Jimmy Brook       Mitchell Brook \n               56536                57849                56978 \n   Obear Brook Lower      Sanderson Brook         West Brook 0 \n               60392                55336                58548 \n    West Brook Lower West Brook Reservoir     West Brook Upper \n               61279                61059                57301 \n  West Whately Brook \n               57110 \n\n\nCode\n#check for real entries\ndFlow %>% filter(is.infinite(dischargeLog))\n\n\n [1] Station_No                 Site_Name                 \n [3] DateTime_EST               GageHeight_Hobo_ft        \n [5] Discharge_Hobo_cfs         WaterTemperature_HOBO_DegF\n [7] AirPressure_PSI            AirTemperature_HOBO_degF  \n [9] X                          date                      \n[11] site                       dischargeLog              \n<0 rows> (or 0-length row.names)\n\n\n\n\nCode\nggplot(dFlow, aes(date, dischargeLog, color = Site_Name)) +\n  geom_point(size = 0.02) +\n  facet_wrap(~Site_Name)\n\n\n\n\n\nCode\nggpairs(dFlowWide,\n          columns = 6:9,\n          mapping = ggplot2::aes(color = as.factor(year), alpha = 0.7),\n          #diag = list(continuous = myDens),\n          lower = list(continuous = wrap(\"points\", alpha = 0.3, size=0.1), \n                       combo = wrap(\"dot\", alpha = 0.4, size=0.2))\n        )\n\n\n\n\n\nCode\nggpairs(dFlowWide %>% filter(yday > 90, yday < 300),\n          columns = 6:9,\n          mapping = ggplot2::aes(color = as.factor(year)),\n          lower = list(continuous = wrap(\"points\", alpha = 0.3, size=0.1), \n                       combo = wrap(\"dot\", alpha = 0.4, size=0.2))\n        )\n\n\n\n\n\nCode\nggpairs(dFlowWide %>% filter(yday == 110),\n          columns = 8:11,\n          mapping = ggplot2::aes(color = as.factor(year)),\n          lower = list(continuous = wrap(\"points\", alpha = 0.3, size=0.2), \n                       combo = wrap(\"dot\", alpha = 0.4, size=0.2))\n        )"
  },
  {
    "objectID": "modelsCMR_ft_Flow_OB.html",
    "href": "modelsCMR_ft_Flow_OB.html",
    "title": "11  Flow effects on survival (phi) models - O’Bear only",
    "section": "",
    "text": "logit(phi[t,i]) <- betaInt[ isYOY[i,t],season[t]] + betaFlow[1,isYOY[i,t],season[t]] * flow[i,t] + betaFlow[2,isYOY[i,t],season[t]] * temp[i,t] + betaFlow[3,isYOY[i,t],season[t]] * temp[i,t] * flow[i,t]\nThe goal of this modelling exercise is to evaluate the effect of new tributary-specific stream flow estimates on survival of brook trout and brown trout. We will compare survival across the WB and tributaries with flow input data as 1) single flow estimate for all locations (historical approach) and 2) hindcasted flows for each tributary based on new tributary-specific flows which are available since 2000.\nThe goal is to find the best structure for the survival model, then compare survival estimates with tributary-specific flow to estimates with common flow across locations.\nStructure options include [species, cohort, season, isYOY, flow, flow^2]\n\n\n\n\n11.0.1 Model phiT_pT (tt)\nSingle estimates of phi and p (across, cohorts, flow)\n\n11.0.1.1 Retrieve model results\nModel is run using targets in R/modelCMR_tt_OB.R\n\n\nCode\n# Following https://oliviergimenez.github.io/bayesian-cr-workshop/worksheets/4_demo.html\n# \n  out <- tar_read(tt_modelOut_OB)\n\n  MCMCplot(object = out$mcmc)\n\n\n\n\n\nCode\n  MCMCsummary(object = out$mcmc, round = 3)\n\n\n         mean    sd  2.5%   50% 97.5% Rhat n.eff\np[1]    0.293 0.006 0.281 0.293 0.305 1.00   275\np[2]    0.421 0.007 0.407 0.421 0.434 1.01   575\np[3]    0.667 0.007 0.652 0.667 0.683 1.00   382\np[4]    0.713 0.009 0.696 0.713 0.730 1.00   313\np[5]    0.364 0.010 0.347 0.364 0.384 1.09   259\np[6]    0.519 0.012 0.496 0.519 0.542 1.01   427\np[7]    0.687 0.014 0.658 0.687 0.716 1.00   334\np[8]    0.740 0.021 0.698 0.741 0.778 1.02   201\np[9]    0.454 0.027 0.400 0.455 0.508 1.01   236\np[10]   0.573 0.038 0.489 0.573 0.646 1.00   244\np[11]   0.681 0.141 0.469 0.668 0.969 1.92    18\nphi[1]  0.789 0.010 0.771 0.789 0.812 1.00   141\nphi[2]  0.713 0.010 0.693 0.713 0.732 1.00   194\nphi[3]  0.764 0.009 0.747 0.764 0.781 1.02   238\nphi[4]  0.642 0.008 0.626 0.642 0.659 1.00   260\nphi[5]  0.670 0.015 0.640 0.670 0.700 1.11   130\nphi[6]  0.562 0.015 0.533 0.562 0.592 1.14   142\nphi[7]  0.683 0.015 0.652 0.683 0.712 1.03   233\nphi[8]  0.623 0.019 0.586 0.623 0.663 1.04   210\nphi[9]  0.466 0.027 0.415 0.466 0.520 1.03   149\nphi[10] 0.563 0.043 0.483 0.563 0.645 1.02   122\nphi[11] 0.684 0.146 0.442 0.668 0.945 1.93    15\n\n\nCode\n  priors <- runif(out$runData$nIter * out$runData$nChains, 0, 1)\n  MCMCtrace(object = out$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c(\"phi\", \"p\"),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n11.0.2 Model phiT_pT flow (tt_OB_flow)\nCohort-dependent estimates of phi and p with flow and temperature hierarchical effects\n\n11.0.2.1 Retrieve model results\nModel is run using targets in R/modelCMR_tt_OB.R\n\n\nCode\n# Following https://oliviergimenez.github.io/bayesian-cr-workshop/worksheets/4_demo.html\n# \n  out_flow <- tar_read(tt_modelOut_ft_OB_flow )\n\n  MCMCplot(object = out_flow$mcmc)\n\n\n\n\n\nCode\n  summary_flow <- MCMCsummary(object = out_flow$mcmc, round = 3) %>%\n    mutate(flowData = \"flow\") %>%\n    rownames_to_column(var = \"var\")\n  \n  priors <- runif(out_flow$runData$nIter * out_flow$runData$nChains, 0, 1)\n  MCMCtrace(object = out_flow$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c(\n              \"betaIntTop\",\"betaFlowTop\",\"betaPTop\"  \n            #  \"betaInt\", \"betaPhi\",\"betaFlow\",\"betaP\",\n            #  \"betaIntOut\", \"betaPhiOut\",\"betaFlowOut\",\"betaPOut\"\n            ),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\nCode\n    MCMCtrace(object = out_flow$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c(\n              \"betaIntYOY\",\"betaFlowYOY\",\"betaPYOY\"  \n            #  \"betaInt\", \"betaPhi\",\"betaFlow\",\"betaP\",\n            #  \"betaIntOut\", \"betaPhiOut\",\"betaFlowOut\",\"betaPOut\"\n            ),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n11.0.3 Model phiT_pT flow ByRiver (tt_OB_flowByRiver)\nCohort-dependent estimates of phi and p with flowByRiver and flowByRiver^2 hierarchical effects\n\n11.0.3.1 Retrieve model results\nModel is run using targets in R/modelCMR_tt_OB.R\n\n\nCode\n# Following https://oliviergimenez.github.io/bayesian-cr-workshop/worksheets/4_demo.html\n# \n  out_flowByRiver <- tar_read(tt_modelOut_ft_OB_flowByRiver)\n\n  MCMCplot(object = out_flowByRiver$mcmc)\n\n\n\n\n\nCode\n  summary_flowByRiver <- MCMCsummary(object = out_flowByRiver$mcmc, round = 3) %>%\n    mutate(flowData = \"flowByRiver\") %>%\n    rownames_to_column(var = \"var\")\n  \n  priors <- runif(out_flowByRiver$runData$nIter * out_flowByRiver$runData$nChains, 0, 1)\n  MCMCtrace(object = out_flowByRiver$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c(  \"betaIntYOY\", \"betaFlowYOY\",\"betaPYOY\"    ),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n11.0.3.2 Compare parameter estimates of models with flow and flowByRiver\n\n\nCode\nboth <- bind_rows(summary_flow, summary_flowByRiver) %>%\n  rename(lo = '2.5%', hi = '97.5%')\n\nggplot(both %>% filter(grepl(\"betaFlowTop\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) \n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaIntTop\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaFlowYOY\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaIntYOY\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaPYOY\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\n# ggplot(both %>% filter(grepl(\"betaPOut\", var)), aes(color = flowData)) +\n#   geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n#   geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n#   theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\nCode\ngetPredictions_FlowYOYSeason <- function(toSave, everyNIters = 10, flowStep = 0.5){\n  \n  mcmc <- toSave$mcmc\n  ## betaInt\n  predictorsBetaInt <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n    season = 1:toSave$myConstants$nSeasons\n #   cohort = 1:toSave$myConstants$nCohorts\n  )\n  \n  for(i in 1:nrow(predictorsBetaInt)){\n    predictorsBetaInt$betaInt[i] <- mcmc$chain1[[predictorsBetaInt[i, \"iter\"], \n                                                 paste0(\"betaInt[\", predictorsBetaInt[i, \"isYOY\"],\n                                                        \", \",       predictorsBetaInt[i, \"season\"],\n                                                    #    \", \",       predictorsBetaInt[i, \"cohort\"],\n                                                        \"]\")\n    ]]\n  }\n  \n  # # betaPhi\n  #   ## betaPhi\n  # predictorsBetaPhi <- expand.grid(\n  #   iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n  #   isYOY = 1:2,\n  #   season = 1:toSave$myConstants$nSeasons\n  # #  cohort = 1:toSave$myConstants$nCohorts\n  # )\n  \n  # for(i in 1:nrow(predictorsBetaPhi)){\n  #   predictorsBetaPhi$betaPhi[i] <- mcmc$chain1[[predictorsBetaPhi[i, \"iter\"], \n  #                                                paste0(\"betaPhi[\", predictorsBetaPhi[i, \"isYOY\"],\n  #                                                       \", \",       predictorsBetaPhi[i, \"season\"],\n  #                                                    #   \", \",       predictorsBetaPhi[i, \"cohort\"],\n  #                                                       \"]\")\n  #   ]]\n  # }\n  \n  ## betaFlow\n  predictorsBetaFlow <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n    season = 1:toSave$myConstants$nSeasons\n  #  cohort = 1:toSave$myConstants$nCohorts\n  )\n  \n  for(i in 1:nrow(predictorsBetaFlow)){\n    predictorsBetaFlow$betaFlow1[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[1, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                      #     \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n    predictorsBetaFlow$betaFlow2[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[2, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                  #         \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n    \n    predictorsBetaFlow$betaFlow3[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[3, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                  #         \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n  }\n  \n\n  predictorsAll <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n  #  cohort = 1:toSave$myConstants$nCohorts,\n    season = 1:toSave$myConstants$nSeasons,\n    flow = seq(-1.5, 1.5, flowStep),\n    temp = seq(-1.5, 1.5, flowStep)\n  )\n  \n  preds <- predictorsAll %>%\n    left_join(predictorsBetaInt) %>%\n    left_join(predictorsBetaFlow) %>%\n   # left_join(predictorsBetaPhi) %>%\n    mutate(predPhi = plogis(betaInt + betaFlow1 * flow + betaFlow2 * temp + betaFlow3 * flow * temp))\n  \n  return(preds)\n}\n\n\nFlow_YOYSeason predictions\n\n\nCode\npredFlowCohort <- getPredictions_FlowYOYSeason(out_flow, everyNIters = 5) %>%\n    mutate(flowData = \"flow\") \n\npredFlowByRiverCohort <- getPredictions_FlowYOYSeason(out_flowByRiver, everyNIters = 5) %>%\n    mutate(flowData = \"flowByRiver\")\n\npredBoth <- bind_rows(predFlowCohort, predFlowByRiverCohort)\n\n\n\n\n11.0.3.3 Graph flow predictions\nPredictions based on flow from the flow extension curve - original approach\n\n\nCode\ncolors <- c(\"blue\", \"green\", \"red\")\n\nggplot(predFlowCohort %>% filter(temp %in% c(-1,0,1)), aes(flow, predPhi, group = ((paste0(iter,temp, sep = \"_\"))))) +\n  geom_line(aes(color = factor(temp)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  facet_grid(season ~ isYOY)\n\n\n\n\n\nPredictions based on flow from flowByRiver\n\n\nCode\nggplot(predFlowByRiverCohort %>% filter(temp %in% c(-1,0,1)), aes(flow, predPhi, group = ((paste0(iter,temp, sep = \"_\"))))) +\n  geom_line(aes(color = factor(temp)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  facet_grid(season ~ isYOY)\n\n\n\n\n\nSimilar format to to the 2015 paper\n\n\nCode\nggplot(predFlowCohort %>% filter(flow %in% c(-1,0,1)), aes(temp, predPhi, group = ((paste0(iter,flow, sep = \"_\"))))) +\n  geom_line(aes(color = factor(flow)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  facet_grid(season ~ isYOY)\n\n\n\n\n\nFlowTop predictions\n\n\nCode\n# predFlowTop <- getPredictionsFlowTop(out_flow, everyNIters = 5) %>%\n#     mutate(flowData = \"flow\") \n# \n# predFlowByRiverTop <- getPredictionsFlowTop(out_flowByRiver, everyNIters = 5) %>%\n#     mutate(flowData = \"flowByRiver\")\n# \n# predTopBoth <- bind_rows(predFlowTop, predFlowByRiverTop)\n\n\n\n\nCode\n# ggplot(predTopBoth, aes(flow, predPhi, group = iter)) +\n#   geom_line() +\n#   facet_wrap(~flowData)\n# \n# ggplot(predTopBoth %>% filter(iter < 100), aes(flow, predPhi, group = iter)) +\n#   geom_line() +\n#   facet_grid(flowData ~ iter)\n\n\n\n\nCode\ngetPredictionsFlowTop <- function(toSave, everyNIters = 10, flowStep = 0.5){\n\n  mcmc <- toSave$mcmc\n  \n  ## betaFlow\n  predictorsBetaFlowTop <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    var = 1:2,\n    flow = seq(-1.5, 1.5, flowStep),\n    temp = seq(-1.5, 1.5, flowStep)\n  )\n  \n  for(i in 1:nrow(predictorsBetaFlowTop)){\n    predictorsBetaFlowTop$betaFlowTop1[i] <- mcmc$chain1[[predictorsBetaFlowTop[i, \"iter\"], \n                                                         1\n                                                        ]]\n    predictorsBetaFlowTop$betaFlowTop2[i] <- mcmc$chain1[[predictorsBetaFlowTop[i, \"iter\"], \n                                                         2\n                                                        ]]\n    predictorsBetaFlowTop$betaFlowTop3[i] <- mcmc$chain1[[predictorsBetaFlowTop[i, \"iter\"], \n                                                         3\n                                                        ]]\n  }\n\n  preds <- predictorsBetaFlowTop %>%\n    mutate(predPhi = plogis(betaFlow1 * flow + betaFlow2 * temp + betaFlow3 * flow * temp))\n  \n  return(preds)\n}"
  },
  {
    "objectID": "modelsCMR_ft_cohort_Flow_OB.html",
    "href": "modelsCMR_ft_cohort_Flow_OB.html",
    "title": "12  Flow effects on survival (phi) models with cohort structure - O’Bear only",
    "section": "",
    "text": "Phi model structure:\nlogit(phi[t,i]) <-\nbetaInt[ isYOY[i,t],season[t],cohort[i]] +\nbetaFlow[1,isYOY[i,t],season[t]] * flow[i,t] +\nbetaFlow[2,isYOY[i,t],season[t]] * temp[i,t] +\nbetaFlow[3,isYOY[i,t],season[t]] * temp[i,t] * flow[i,t]\nlogit(p[t,i]) <- betaP[isYOY[i,t],season[t-1],cohort[i]]\nThe goal of this modelling exercise is to evaluate the effect of new tributary-specific stream flow estimates on survival of brook trout and brown trout. We will compare survival across the WB and tributaries with flow input data as 1) single flow estimate for all locations (historical approach) and 2) hindcasted flows for each tributary based on new tributary-specific flows which are available since 2000.\nThe goal is to find the best structure for the survival model, then compare survival estimates with tributary-specific flow to estimates with common flow across locations.\nStructure options include [species, cohort, season, isYOY, flow, flow^2]\n\n\n\n\n12.0.1 Model phiT_pT flow (tt_OB_flow)\nCohort-dependent estimates of phi and p with flow and temperature hierarchical effects\n\n12.0.1.1 Retrieve model results\nModel is run using targets in R/modelCMR_tt_ft_cohort_OB.R\n\n\nCode\n# Following https://oliviergimenez.github.io/bayesian-cr-workshop/worksheets/4_demo.html\n# \n  out_flow <- tar_read(tt_modelOut_ft_cohort_OB_flow )\n\n  MCMCplot(object = out_flow$mcmc)\n\n\n\n\n\nCode\n  summary_flow <- MCMCsummary(object = out_flow$mcmc, round = 3) %>%\n    mutate(flowData = \"flow\") %>%\n    rownames_to_column(var = \"var\")\n  \n  summary_flow %>% filter(grepl(\"betaIntYOYSeason\", var))\n\n\n                         var   mean    sd   2.5%    50% 97.5% Rhat n.eff\n1     betaIntYOYSeason[1, 1]  0.804 0.394  0.065  0.798 1.619 1.00   900\n2     betaIntYOYSeason[2, 1] -0.381 0.447 -1.257 -0.399 0.521 1.02   661\n3     betaIntYOYSeason[1, 2]  1.413 1.139 -0.867  1.405 3.646 1.00  4000\n4     betaIntYOYSeason[2, 2] -0.031 0.307 -0.638 -0.037 0.566 1.00  2559\n5     betaIntYOYSeason[1, 3]  1.789 0.426  1.036  1.761 2.694 1.01   471\n6     betaIntYOYSeason[2, 3]  1.014 0.343  0.338  1.010 1.693 1.00  1323\n7     betaIntYOYSeason[1, 4]  2.442 0.529  1.531  2.398 3.615 1.01   329\n8     betaIntYOYSeason[2, 4]  1.561 0.500  0.717  1.516 2.690 1.04   400\n9  betaIntYOYSeasonOut[1, 1]  0.685 0.082  0.516  0.690 0.835 1.00   932\n10 betaIntYOYSeasonOut[2, 1]  0.410 0.104  0.221  0.402 0.627 1.01   704\n11 betaIntYOYSeasonOut[1, 2]  0.757 0.181  0.296  0.803 0.975 1.00  3699\n12 betaIntYOYSeasonOut[2, 2]  0.492 0.075  0.346  0.491 0.638 1.00  2559\n13 betaIntYOYSeasonOut[1, 3]  0.849 0.052  0.738  0.853 0.937 1.01   522\n14 betaIntYOYSeasonOut[2, 3]  0.729 0.066  0.584  0.733 0.845 1.00  1319\n15 betaIntYOYSeasonOut[1, 4]  0.912 0.039  0.822  0.917 0.974 1.02   421\n16 betaIntYOYSeasonOut[2, 4]  0.816 0.068  0.672  0.820 0.936 1.02   497\n   flowData\n1      flow\n2      flow\n3      flow\n4      flow\n5      flow\n6      flow\n7      flow\n8      flow\n9      flow\n10     flow\n11     flow\n12     flow\n13     flow\n14     flow\n15     flow\n16     flow\n\n\nCode\n  summary_flow %>% filter(grepl(\"betaPhiYOYSeason\", var))\n\n\n[1] var      mean     sd       2.5%     50%      97.5%    Rhat     n.eff   \n[9] flowData\n<0 rows> (or 0-length row.names)\n\n\nCode\n  summary_flow %>% filter(grepl(\"betaFlow\", var))\n\n\n                 var   mean    sd   2.5%    50%  97.5% Rhat n.eff flowData\n1  betaFlow[1, 1, 1]  0.234 0.506 -0.806  0.249  1.189 1.00   422     flow\n2  betaFlow[2, 1, 1] -1.321 0.381 -2.033 -1.332 -0.559 1.00   173     flow\n3  betaFlow[3, 1, 1] -5.163 0.784 -6.710 -5.155 -3.633 1.01   268     flow\n4  betaFlow[1, 2, 1] -1.031 0.284 -1.587 -1.025 -0.470 1.00   601     flow\n5  betaFlow[2, 2, 1] -2.129 0.372 -2.859 -2.132 -1.402 1.00   422     flow\n6  betaFlow[3, 2, 1] -2.803 0.495 -3.784 -2.782 -1.899 1.01   411     flow\n7  betaFlow[1, 1, 2]  0.177 1.138 -2.061  0.179  2.440 1.00  2572     flow\n8  betaFlow[2, 1, 2] -0.527 1.164 -2.789 -0.534  1.789 1.00  3347     flow\n9  betaFlow[3, 1, 2] -2.028 1.155 -4.230 -2.006  0.249 1.00  2042     flow\n10 betaFlow[1, 2, 2] -0.318 0.103 -0.517 -0.318 -0.115 1.00   805     flow\n11 betaFlow[2, 2, 2] -0.857 0.150 -1.146 -0.856 -0.562 1.01   535     flow\n12 betaFlow[3, 2, 2] -0.153 0.165 -0.493 -0.151  0.157 1.01   719     flow\n13 betaFlow[1, 1, 3]  0.647 0.458 -0.156  0.605  1.646 1.10   220     flow\n14 betaFlow[2, 1, 3] -0.305 0.425 -1.299 -0.276  0.415 1.00   387     flow\n15 betaFlow[3, 1, 3] -0.956 0.519 -2.129 -0.886 -0.104 1.04   327     flow\n16 betaFlow[1, 2, 3]  1.701 0.320  1.046  1.709  2.312 1.04   176     flow\n17 betaFlow[2, 2, 3] -0.348 0.181 -0.693 -0.346  0.010 1.01   579     flow\n18 betaFlow[3, 2, 3] -2.124 0.380 -2.817 -2.135 -1.317 1.02   244     flow\n19 betaFlow[1, 1, 4] -0.289 0.421 -1.088 -0.305  0.592 1.04   283     flow\n20 betaFlow[2, 1, 4] -0.167 0.484 -1.113 -0.178  0.818 1.02   277     flow\n21 betaFlow[3, 1, 4] -0.811 0.400 -1.661 -0.798 -0.059 1.00   291     flow\n22 betaFlow[1, 2, 4] -0.373 0.322 -1.018 -0.372  0.254 1.02   487     flow\n23 betaFlow[2, 2, 4]  0.390 0.471 -0.590  0.410  1.318 1.04   185     flow\n24 betaFlow[3, 2, 4] -1.248 0.384 -2.005 -1.245 -0.483 1.02   208     flow\n25    betaFlowTop[1]  0.076 0.633 -1.144  0.076  1.317 1.00  3304     flow\n26    betaFlowTop[2] -0.408 0.634 -1.676 -0.406  0.819 1.00  3722     flow\n27    betaFlowTop[3] -1.186 0.639 -2.449 -1.189  0.046 1.00  3403     flow\n28 betaFlowYOY[1, 1]  0.168 0.570 -0.939  0.148  1.298 1.01  1328     flow\n29 betaFlowYOY[2, 1] -0.530 0.566 -1.637 -0.532  0.584 1.00  1402     flow\n30 betaFlowYOY[3, 1] -2.020 0.607 -3.193 -2.016 -0.846 1.01   684     flow\n31 betaFlowYOY[1, 2]  0.011 0.485 -0.916  0.009  0.953 1.00  3179     flow\n32 betaFlowYOY[2, 2] -0.678 0.490 -1.643 -0.669  0.262 1.00  2204     flow\n33 betaFlowYOY[3, 2] -1.498 0.497 -2.446 -1.505 -0.524 1.00  2381     flow\n\n\nCode\n  summary_flow %>% filter(grepl(\"betaInt\", var))\n\n\n                          var   mean    sd   2.5%    50%  97.5% Rhat n.eff\n1            betaInt[1, 1, 1]  1.233 0.503  0.331  1.201  2.313 1.00   520\n2            betaInt[2, 1, 1] -0.608 0.521 -1.601 -0.626  0.438 1.01   538\n3            betaInt[1, 2, 1]  1.396 1.525 -1.520  1.381  4.399 1.00  4139\n4            betaInt[2, 2, 1] -0.534 0.342 -1.156 -0.550  0.225 1.00   563\n5            betaInt[1, 3, 1]  1.899 0.977  0.082  1.866  3.916 1.00   930\n6            betaInt[2, 3, 1] -1.420 0.651 -2.561 -1.459 -0.062 1.01  1118\n7            betaInt[1, 4, 1]  2.705 0.963  1.085  2.629  4.761 1.01  1231\n8            betaInt[2, 4, 1]  1.309 0.648  0.422  1.155  2.989 1.04   267\n9            betaInt[1, 1, 2] -1.485 0.538 -2.537 -1.493 -0.397 1.00   394\n10           betaInt[2, 1, 2]  0.207 0.425 -0.543  0.185  1.100 1.00  1119\n11           betaInt[1, 2, 2]  1.398 1.527 -1.621  1.422  4.448 1.00  4000\n12           betaInt[2, 2, 2]  0.101 0.418 -0.615  0.060  1.025 1.01   694\n13           betaInt[1, 3, 2]  0.992 1.445 -1.597  1.008  3.723 1.00   549\n14           betaInt[2, 3, 2] -0.140 0.391 -0.859 -0.155  0.659 1.02   582\n15           betaInt[1, 4, 2]  3.586 0.820  2.044  3.557  5.268 1.00   611\n16           betaInt[2, 4, 2]  2.544 0.534  1.556  2.527  3.634 1.03   458\n17           betaInt[1, 1, 3]  1.095 0.534  0.161  1.047  2.279 1.00  1062\n18           betaInt[2, 1, 3] -2.271 0.612 -3.429 -2.279 -1.059 1.00   585\n19           betaInt[1, 2, 3]  1.416 1.534 -1.576  1.396  4.421 1.00  4231\n20           betaInt[2, 2, 3]  0.002 0.238 -0.449 -0.005  0.480 1.00  1526\n21           betaInt[1, 3, 3]  1.419 1.008 -0.427  1.366  3.511 1.01  1117\n22           betaInt[2, 3, 3]  1.417 0.449  0.615  1.382  2.405 1.00  1411\n23           betaInt[1, 4, 3]  2.555 0.648  1.381  2.507  3.960 1.01   294\n24           betaInt[2, 4, 3]  3.565 0.781  2.080  3.564  5.129 1.02   546\n25           betaInt[1, 1, 4]  1.254 0.957 -0.496  1.228  3.186 1.00  1063\n26           betaInt[2, 1, 4] -1.394 1.337 -3.679 -1.517  1.396 1.01   755\n27           betaInt[1, 2, 4]  1.408 1.498 -1.545  1.406  4.363 1.00  4000\n28           betaInt[2, 2, 4]  0.312 0.602 -0.698  0.249  1.713 1.00  1621\n29           betaInt[1, 3, 4]  2.181 0.751  0.771  2.156  3.745 1.01  1222\n30           betaInt[2, 3, 4] -0.156 0.657 -1.154 -0.251  1.494 1.00  1288\n31           betaInt[1, 4, 4]  2.824 0.752  1.370  2.806  4.314 1.00   535\n32           betaInt[2, 4, 4]  0.006 1.240 -1.682 -0.299  3.071 1.02   502\n33           betaInt[1, 1, 5]  0.727 1.097 -1.377  0.708  2.878 1.00  2709\n34           betaInt[2, 1, 5] -0.531 1.130 -2.723 -0.546  1.684 1.00  1918\n35           betaInt[1, 2, 5]  1.442 1.512 -1.484  1.451  4.397 1.00  3439\n36           betaInt[2, 2, 5] -0.319 0.554 -1.222 -0.372  0.991 1.00  1149\n37           betaInt[1, 3, 5]  1.780 0.651  0.773  1.680  3.299 1.00  2080\n38           betaInt[2, 3, 5]  2.892 0.770  1.307  2.902  4.331 1.03   208\n39           betaInt[1, 4, 5]  1.363 0.865  0.098  1.207  3.555 1.01   420\n40           betaInt[2, 4, 5] -0.482 0.810 -1.858 -0.530  1.305 1.02   872\n41           betaInt[1, 1, 6]  1.117 0.984 -0.733  1.094  3.039 1.00  2880\n42           betaInt[2, 1, 6] -1.371 1.064 -3.242 -1.423  0.874 1.01   677\n43           betaInt[1, 2, 6]  1.410 1.510 -1.520  1.410  4.319 1.00  4000\n44           betaInt[2, 2, 6]  0.021 0.420 -0.691 -0.015  0.952 1.01  1311\n45           betaInt[1, 3, 6]  2.962 0.848  1.478  2.917  4.802 1.06   285\n46           betaInt[2, 3, 6]  0.891 0.542 -0.023  0.835  2.162 1.00  1347\n47           betaInt[1, 4, 6]  1.835 1.106 -0.008  1.719  4.269 1.00   769\n48           betaInt[2, 4, 6]  0.144 0.887 -1.177 -0.003  2.418 1.03   504\n49           betaInt[1, 1, 7] -1.406 0.693 -2.588 -1.465  0.153 1.00   270\n50           betaInt[2, 1, 7]  0.540 0.662 -0.624  0.504  1.975 1.01  1349\n51           betaInt[1, 2, 7]  1.418 1.518 -1.584  1.412  4.444 1.00  4023\n52           betaInt[2, 2, 7] -1.075 0.517 -2.058 -1.096 -0.018 1.00  1246\n53           betaInt[1, 3, 7]  1.915 0.671  0.812  1.831  3.491 1.00  1150\n54           betaInt[2, 3, 7]  2.422 0.663  1.208  2.407  3.806 1.00  1982\n55           betaInt[1, 4, 7]  2.326 1.096  0.427  2.257  4.647 1.00   777\n56           betaInt[2, 4, 7]  1.462 0.861  0.117  1.338  3.423 1.01  1180\n57           betaInt[1, 1, 8]  0.491 0.266  0.031  0.466  1.114 1.00   957\n58           betaInt[2, 1, 8] -1.012 0.557 -1.954 -1.050  0.194 1.00   864\n59           betaInt[1, 2, 8]  1.429 1.517 -1.538  1.427  4.372 1.00  3761\n60           betaInt[2, 2, 8] -0.131 0.209 -0.531 -0.134  0.285 1.00   832\n61           betaInt[1, 3, 8]  1.884 0.447  1.111  1.852  2.886 1.02   460\n62           betaInt[2, 3, 8]  1.161 0.293  0.641  1.146  1.807 1.00  1108\n63           betaInt[1, 4, 8]  2.994 0.877  1.526  2.899  4.890 1.01   571\n64           betaInt[2, 4, 8]  2.039 0.802  0.748  1.955  3.859 1.01   884\n65           betaInt[1, 1, 9]  0.754 1.120 -1.533  0.771  2.880 1.00  2576\n66           betaInt[2, 1, 9] -0.313 0.820 -1.823 -0.354  1.432 1.00  1688\n67           betaInt[1, 2, 9]  1.396 1.527 -1.575  1.380  4.436 1.00  4000\n68           betaInt[2, 2, 9]  0.177 0.522 -0.695  0.134  1.300 1.00  1621\n69           betaInt[1, 3, 9]  0.884 0.880 -0.633  0.808  2.903 1.00  1441\n70           betaInt[2, 3, 9]  0.928 0.543 -0.085  0.911  2.076 1.00  1653\n71           betaInt[1, 4, 9]  2.311 1.110  0.362  2.240  4.616 1.00  1163\n72           betaInt[2, 4, 9]  1.255 1.096 -0.656  1.156  3.617 1.01   936\n73          betaInt[1, 1, 10]  3.224 0.784  1.656  3.237  4.719 1.00   769\n74          betaInt[2, 1, 10] -0.503 1.031 -2.425 -0.544  1.568 1.01  1707\n75          betaInt[1, 2, 10]  1.412 1.517 -1.543  1.407  4.330 1.00  4139\n76          betaInt[2, 2, 10] -0.026 0.446 -0.842 -0.057  0.927 1.00  2296\n77          betaInt[1, 3, 10]  2.608 0.830  1.044  2.581  4.296 1.00  1219\n78          betaInt[2, 3, 10]  2.426 0.681  1.121  2.414  3.794 1.00   868\n79          betaInt[1, 4, 10]  2.634 0.945  0.937  2.594  4.609 1.02  1223\n80          betaInt[2, 4, 10]  1.944 0.873  0.357  1.903  3.810 1.01   956\n81          betaInt[1, 1, 11]  0.086 0.595 -0.938  0.036  1.431 1.00   190\n82          betaInt[2, 1, 11]  1.447 0.513  0.493  1.442  2.457 1.00  1229\n83          betaInt[1, 2, 11]  1.386 1.515 -1.683  1.390  4.379 1.00  4000\n84          betaInt[2, 2, 11]  0.140 0.228 -0.276  0.129  0.639 1.00  1008\n85          betaInt[1, 3, 11]  2.055 0.462  1.239  2.028  3.040 1.11   228\n86          betaInt[2, 3, 11]  0.515 0.310 -0.089  0.511  1.112 1.05   408\n87          betaInt[1, 4, 11]  2.809 0.855  1.352  2.731  4.713 1.00   391\n88          betaInt[2, 4, 11]  3.596 1.000  1.615  3.600  5.579 1.02   323\n89          betaInt[1, 1, 12]  0.823 0.737 -0.490  0.776  2.397 1.00   832\n90          betaInt[2, 1, 12]  0.313 0.801 -1.094  0.272  2.073 1.00  2116\n91          betaInt[1, 2, 12]  1.437 1.518 -1.564  1.476  4.337 1.00  4000\n92          betaInt[2, 2, 12]  0.251 0.458 -0.529  0.205  1.293 1.00  1811\n93          betaInt[1, 3, 12]  1.691 0.696  0.433  1.641  3.157 1.01   534\n94          betaInt[2, 3, 12]  1.761 0.596  0.706  1.729  3.054 1.00  1280\n95          betaInt[1, 4, 12]  3.068 1.014  1.186  3.013  5.240 1.00   388\n96          betaInt[2, 4, 12]  2.308 0.840  0.821  2.277  4.052 1.00  1120\n97          betaInt[1, 1, 13]  1.925 0.748  0.579  1.882  3.494 1.00  1421\n98          betaInt[2, 1, 13] -0.364 1.097 -2.449 -0.374  1.797 1.01  2692\n99          betaInt[1, 2, 13]  1.419 1.511 -1.555  1.429  4.440 1.00  3812\n100         betaInt[2, 2, 13] -0.026 1.033 -2.032 -0.008  1.922 1.00  3033\n101         betaInt[1, 3, 13]  1.300 0.422  0.545  1.280  2.227 1.04   336\n102         betaInt[2, 3, 13]  0.984 1.061 -1.072  0.990  3.090 1.00  3765\n103         betaInt[1, 4, 13]  1.656 0.760  0.354  1.590  3.317 1.00   508\n104         betaInt[2, 4, 13]  1.579 1.128 -0.612  1.557  3.835 1.00  1503\n105       betaIntOut[1, 1, 1]  0.763 0.084  0.582  0.769  0.910 1.00   496\n106       betaIntOut[2, 1, 1]  0.360 0.115  0.168  0.348  0.608 1.01   504\n107       betaIntOut[1, 2, 1]  0.729 0.232  0.179  0.799  0.988 1.00  4174\n108       betaIntOut[2, 2, 1]  0.373 0.079  0.239  0.366  0.556 1.00   562\n109       betaIntOut[1, 3, 1]  0.834 0.124  0.520  0.866  0.980 1.00  1106\n110       betaIntOut[2, 3, 1]  0.212 0.111  0.072  0.189  0.485 1.01  1178\n111       betaIntOut[1, 4, 1]  0.915 0.068  0.747  0.933  0.992 1.01  1294\n112       betaIntOut[2, 4, 1]  0.769 0.092  0.604  0.760  0.952 1.02   317\n113       betaIntOut[1, 1, 2]  0.197 0.084  0.073  0.184  0.402 1.01   384\n114       betaIntOut[2, 1, 2]  0.549 0.100  0.367  0.546  0.750 1.00  1072\n115       betaIntOut[1, 2, 2]  0.730 0.232  0.165  0.806  0.988 1.00  3857\n116       betaIntOut[2, 2, 2]  0.523 0.098  0.351  0.515  0.736 1.01   689\n117       betaIntOut[1, 3, 2]  0.668 0.249  0.168  0.733  0.976 1.00   540\n118       betaIntOut[2, 3, 2]  0.466 0.094  0.298  0.461  0.659 1.02   583\n119       betaIntOut[1, 4, 2]  0.964 0.029  0.885  0.972  0.995 1.01   769\n120       betaIntOut[2, 4, 2]  0.919 0.038  0.826  0.926  0.974 1.02   488\n121       betaIntOut[1, 1, 3]  0.737 0.094  0.540  0.740  0.907 1.00  1217\n122       betaIntOut[2, 1, 3]  0.106 0.061  0.031  0.093  0.257 1.00   625\n123       betaIntOut[1, 2, 3]  0.731 0.232  0.171  0.801  0.988 1.00  4000\n124       betaIntOut[2, 2, 3]  0.501 0.059  0.390  0.499  0.618 1.00  1525\n125       betaIntOut[1, 3, 3]  0.765 0.156  0.395  0.797  0.971 1.01  1029\n126       betaIntOut[2, 3, 3]  0.796 0.068  0.649  0.799  0.917 1.00  1326\n127       betaIntOut[1, 4, 3]  0.917 0.046  0.799  0.925  0.981 1.00   540\n128       betaIntOut[2, 4, 3]  0.964 0.028  0.889  0.972  0.994 1.01   562\n129       betaIntOut[1, 1, 4]  0.742 0.160  0.378  0.774  0.960 1.00  1092\n130       betaIntOut[2, 1, 4]  0.259 0.220  0.025  0.180  0.802 1.01   765\n131       betaIntOut[1, 2, 4]  0.734 0.227  0.176  0.803  0.987 1.00  3862\n132       betaIntOut[2, 2, 4]  0.569 0.132  0.332  0.562  0.847 1.00  1620\n133       betaIntOut[1, 3, 4]  0.879 0.076  0.684  0.896  0.977 1.00  1474\n134       betaIntOut[2, 3, 4]  0.460 0.146  0.240  0.438  0.817 1.00  1294\n135       betaIntOut[1, 4, 4]  0.930 0.049  0.797  0.943  0.987 1.01   657\n136       betaIntOut[2, 4, 4]  0.483 0.235  0.157  0.426  0.956 1.01   516\n137       betaIntOut[1, 1, 5]  0.642 0.209  0.202  0.670  0.947 1.00  2686\n138       betaIntOut[2, 1, 5]  0.396 0.220  0.062  0.367  0.843 1.00  1954\n139       betaIntOut[1, 2, 5]  0.737 0.228  0.185  0.810  0.988 1.00  3397\n140       betaIntOut[2, 2, 5]  0.424 0.127  0.228  0.408  0.729 1.00  1140\n141       betaIntOut[1, 3, 5]  0.839 0.074  0.684  0.843  0.964 1.00  1983\n142       betaIntOut[2, 3, 5]  0.933 0.054  0.787  0.948  0.987 1.09   230\n143       betaIntOut[1, 4, 5]  0.766 0.117  0.524  0.770  0.972 1.04   543\n144       betaIntOut[2, 4, 5]  0.391 0.168  0.135  0.370  0.787 1.01   884\n145       betaIntOut[1, 1, 6]  0.717 0.173  0.324  0.749  0.954 1.00  2956\n146       betaIntOut[2, 1, 6]  0.244 0.180  0.038  0.194  0.706 1.00   812\n147       betaIntOut[1, 2, 6]  0.732 0.229  0.179  0.804  0.987 1.00  4000\n148       betaIntOut[2, 2, 6]  0.504 0.100  0.334  0.496  0.722 1.01  1335\n149       betaIntOut[1, 3, 6]  0.936 0.048  0.814  0.949  0.992 1.07   391\n150       betaIntOut[2, 3, 6]  0.697 0.102  0.494  0.697  0.897 1.00  1353\n151       betaIntOut[1, 4, 6]  0.818 0.135  0.498  0.848  0.986 1.00  1042\n152       betaIntOut[2, 4, 6]  0.522 0.177  0.236  0.499  0.918 1.02   543\n153       betaIntOut[1, 1, 7]  0.216 0.120  0.070  0.188  0.538 1.00   299\n154       betaIntOut[2, 1, 7]  0.619 0.139  0.349  0.623  0.878 1.01  1355\n155       betaIntOut[1, 2, 7]  0.733 0.230  0.170  0.804  0.988 1.00  3843\n156       betaIntOut[2, 2, 7]  0.266 0.098  0.113  0.250  0.496 1.00  1335\n157       betaIntOut[1, 3, 7]  0.855 0.072  0.692  0.862  0.970 1.00  1179\n158       betaIntOut[2, 3, 7]  0.905 0.055  0.770  0.917  0.978 1.00  1813\n159       betaIntOut[1, 4, 7]  0.874 0.105  0.605  0.905  0.991 1.00   936\n160       betaIntOut[2, 4, 7]  0.781 0.121  0.529  0.792  0.968 1.01  1218\n161       betaIntOut[1, 1, 8]  0.618 0.060  0.508  0.615  0.753 1.00   971\n162       betaIntOut[2, 1, 8]  0.279 0.111  0.124  0.259  0.548 1.00   886\n163       betaIntOut[1, 2, 8]  0.734 0.231  0.177  0.806  0.988 1.00  3799\n164       betaIntOut[2, 2, 8]  0.468 0.051  0.370  0.467  0.571 1.00   832\n165       betaIntOut[1, 3, 8]  0.860 0.050  0.752  0.864  0.947 1.03   459\n166       betaIntOut[2, 3, 8]  0.758 0.052  0.655  0.759  0.859 1.00  1087\n167       betaIntOut[1, 4, 8]  0.937 0.045  0.821  0.948  0.993 1.01   530\n168       betaIntOut[2, 4, 8]  0.862 0.081  0.679  0.876  0.979 1.00   850\n169       betaIntOut[1, 1, 9]  0.647 0.212  0.178  0.684  0.947 1.00  2582\n170       betaIntOut[2, 1, 9]  0.430 0.177  0.139  0.412  0.807 1.00  1793\n171       betaIntOut[1, 2, 9]  0.729 0.232  0.172  0.799  0.988 1.00  3701\n172       betaIntOut[2, 2, 9]  0.540 0.119  0.333  0.533  0.786 1.00  1642\n173       betaIntOut[1, 3, 9]  0.680 0.158  0.347  0.692  0.948 1.01  1661\n174       betaIntOut[2, 3, 9]  0.705 0.106  0.479  0.713  0.889 1.00  1642\n175       betaIntOut[1, 4, 9]  0.872 0.108  0.590  0.904  0.990 1.01  1401\n176       betaIntOut[2, 4, 9]  0.733 0.173  0.342  0.761  0.974 1.01  1162\n177      betaIntOut[1, 1, 10]  0.950 0.040  0.840  0.962  0.991 1.00   767\n178      betaIntOut[2, 1, 10]  0.396 0.208  0.081  0.367  0.827 1.01  1757\n179      betaIntOut[1, 2, 10]  0.731 0.232  0.176  0.803  0.987 1.00  4026\n180      betaIntOut[2, 2, 10]  0.493 0.106  0.301  0.486  0.717 1.00  2294\n181      betaIntOut[1, 3, 10]  0.912 0.066  0.740  0.930  0.987 1.00  1312\n182      betaIntOut[2, 3, 10]  0.904 0.059  0.754  0.918  0.978 1.01   906\n183      betaIntOut[1, 4, 10]  0.910 0.073  0.718  0.931  0.990 1.05  1107\n184      betaIntOut[2, 4, 10]  0.846 0.104  0.588  0.870  0.978 1.00  1048\n185      betaIntOut[1, 1, 11]  0.518 0.135  0.281  0.509  0.807 1.00   196\n186      betaIntOut[2, 1, 11]  0.798 0.080  0.621  0.809  0.921 1.00  1366\n187      betaIntOut[1, 2, 11]  0.729 0.232  0.157  0.801  0.988 1.00  3794\n188      betaIntOut[2, 2, 11]  0.534 0.056  0.431  0.532  0.655 1.00  1008\n189      betaIntOut[1, 3, 11]  0.878 0.047  0.775  0.884  0.954 1.10   266\n190      betaIntOut[2, 3, 11]  0.623 0.071  0.478  0.625  0.753 1.05   408\n191      betaIntOut[1, 4, 11]  0.927 0.053  0.794  0.939  0.991 1.00   470\n192      betaIntOut[2, 4, 11]  0.959 0.044  0.834  0.973  0.996 1.07   335\n193      betaIntOut[1, 1, 12]  0.675 0.142  0.380  0.685  0.917 1.00   659\n194      betaIntOut[2, 1, 12]  0.566 0.170  0.251  0.568  0.888 1.01  2149\n195      betaIntOut[1, 2, 12]  0.736 0.231  0.173  0.814  0.987 1.00  4000\n196      betaIntOut[2, 2, 12]  0.559 0.105  0.371  0.551  0.785 1.00  1864\n197      betaIntOut[1, 3, 12]  0.824 0.093  0.607  0.838  0.959 1.01   514\n198      betaIntOut[2, 3, 12]  0.839 0.075  0.669  0.849  0.955 1.00  1362\n199      betaIntOut[1, 4, 12]  0.935 0.062  0.766  0.953  0.995 1.01   530\n200      betaIntOut[2, 4, 12]  0.887 0.079  0.694  0.907  0.983 1.00   897\n201      betaIntOut[1, 1, 13]  0.851 0.087  0.641  0.868  0.971 1.00  1333\n202      betaIntOut[2, 1, 13]  0.427 0.220  0.080  0.408  0.858 1.01  2681\n203      betaIntOut[1, 2, 13]  0.733 0.229  0.174  0.807  0.988 1.00  3911\n204      betaIntOut[2, 2, 13]  0.496 0.214  0.116  0.498  0.872 1.00  3086\n205      betaIntOut[1, 3, 13]  0.778 0.069  0.633  0.782  0.903 1.04   366\n206      betaIntOut[2, 3, 13]  0.691 0.192  0.255  0.729  0.956 1.00  3781\n207      betaIntOut[1, 4, 13]  0.816 0.100  0.588  0.831  0.965 1.00   459\n208      betaIntOut[2, 4, 13]  0.781 0.169  0.352  0.826  0.979 1.01  1752\n209                betaIntTop  0.658 0.624 -0.596  0.656  1.904 1.00  3833\n210             betaIntYOY[1]  1.427 0.557  0.334  1.417  2.544 1.00  2693\n211             betaIntYOY[2]  0.566 0.486 -0.381  0.572  1.530 1.00  3471\n212          betaIntYOYOut[1]  0.793 0.088  0.583  0.805  0.927 1.00  2686\n213          betaIntYOYOut[2]  0.631 0.108  0.406  0.639  0.822 1.00  3462\n214    betaIntYOYSeason[1, 1]  0.804 0.394  0.065  0.798  1.619 1.00   900\n215    betaIntYOYSeason[2, 1] -0.381 0.447 -1.257 -0.399  0.521 1.02   661\n216    betaIntYOYSeason[1, 2]  1.413 1.139 -0.867  1.405  3.646 1.00  4000\n217    betaIntYOYSeason[2, 2] -0.031 0.307 -0.638 -0.037  0.566 1.00  2559\n218    betaIntYOYSeason[1, 3]  1.789 0.426  1.036  1.761  2.694 1.01   471\n219    betaIntYOYSeason[2, 3]  1.014 0.343  0.338  1.010  1.693 1.00  1323\n220    betaIntYOYSeason[1, 4]  2.442 0.529  1.531  2.398  3.615 1.01   329\n221    betaIntYOYSeason[2, 4]  1.561 0.500  0.717  1.516  2.690 1.04   400\n222 betaIntYOYSeasonOut[1, 1]  0.685 0.082  0.516  0.690  0.835 1.00   932\n223 betaIntYOYSeasonOut[2, 1]  0.410 0.104  0.221  0.402  0.627 1.01   704\n224 betaIntYOYSeasonOut[1, 2]  0.757 0.181  0.296  0.803  0.975 1.00  3699\n225 betaIntYOYSeasonOut[2, 2]  0.492 0.075  0.346  0.491  0.638 1.00  2559\n226 betaIntYOYSeasonOut[1, 3]  0.849 0.052  0.738  0.853  0.937 1.01   522\n227 betaIntYOYSeasonOut[2, 3]  0.729 0.066  0.584  0.733  0.845 1.00  1319\n228 betaIntYOYSeasonOut[1, 4]  0.912 0.039  0.822  0.917  0.974 1.02   421\n229 betaIntYOYSeasonOut[2, 4]  0.816 0.068  0.672  0.820  0.936 1.02   497\n    flowData\n1       flow\n2       flow\n3       flow\n4       flow\n5       flow\n6       flow\n7       flow\n8       flow\n9       flow\n10      flow\n11      flow\n12      flow\n13      flow\n14      flow\n15      flow\n16      flow\n17      flow\n18      flow\n19      flow\n20      flow\n21      flow\n22      flow\n23      flow\n24      flow\n25      flow\n26      flow\n27      flow\n28      flow\n29      flow\n30      flow\n31      flow\n32      flow\n33      flow\n34      flow\n35      flow\n36      flow\n37      flow\n38      flow\n39      flow\n40      flow\n41      flow\n42      flow\n43      flow\n44      flow\n45      flow\n46      flow\n47      flow\n48      flow\n49      flow\n50      flow\n51      flow\n52      flow\n53      flow\n54      flow\n55      flow\n56      flow\n57      flow\n58      flow\n59      flow\n60      flow\n61      flow\n62      flow\n63      flow\n64      flow\n65      flow\n66      flow\n67      flow\n68      flow\n69      flow\n70      flow\n71      flow\n72      flow\n73      flow\n74      flow\n75      flow\n76      flow\n77      flow\n78      flow\n79      flow\n80      flow\n81      flow\n82      flow\n83      flow\n84      flow\n85      flow\n86      flow\n87      flow\n88      flow\n89      flow\n90      flow\n91      flow\n92      flow\n93      flow\n94      flow\n95      flow\n96      flow\n97      flow\n98      flow\n99      flow\n100     flow\n101     flow\n102     flow\n103     flow\n104     flow\n105     flow\n106     flow\n107     flow\n108     flow\n109     flow\n110     flow\n111     flow\n112     flow\n113     flow\n114     flow\n115     flow\n116     flow\n117     flow\n118     flow\n119     flow\n120     flow\n121     flow\n122     flow\n123     flow\n124     flow\n125     flow\n126     flow\n127     flow\n128     flow\n129     flow\n130     flow\n131     flow\n132     flow\n133     flow\n134     flow\n135     flow\n136     flow\n137     flow\n138     flow\n139     flow\n140     flow\n141     flow\n142     flow\n143     flow\n144     flow\n145     flow\n146     flow\n147     flow\n148     flow\n149     flow\n150     flow\n151     flow\n152     flow\n153     flow\n154     flow\n155     flow\n156     flow\n157     flow\n158     flow\n159     flow\n160     flow\n161     flow\n162     flow\n163     flow\n164     flow\n165     flow\n166     flow\n167     flow\n168     flow\n169     flow\n170     flow\n171     flow\n172     flow\n173     flow\n174     flow\n175     flow\n176     flow\n177     flow\n178     flow\n179     flow\n180     flow\n181     flow\n182     flow\n183     flow\n184     flow\n185     flow\n186     flow\n187     flow\n188     flow\n189     flow\n190     flow\n191     flow\n192     flow\n193     flow\n194     flow\n195     flow\n196     flow\n197     flow\n198     flow\n199     flow\n200     flow\n201     flow\n202     flow\n203     flow\n204     flow\n205     flow\n206     flow\n207     flow\n208     flow\n209     flow\n210     flow\n211     flow\n212     flow\n213     flow\n214     flow\n215     flow\n216     flow\n217     flow\n218     flow\n219     flow\n220     flow\n221     flow\n222     flow\n223     flow\n224     flow\n225     flow\n226     flow\n227     flow\n228     flow\n229     flow\n\n\nCode\n  priors <- runif(out_flow$runData$nIter * out_flow$runData$nChains, 0, 1)\n  MCMCtrace(object = out_flow$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c(\n              \"betaIntYOYSeason\", \"betaPhiYOYSeason\",\"betaPYOYSeason\"\n            #  \"betaIntTop\", \"betaPhiTop\",\"betaFlowTop\",\"betaPTop\"  \n            #  \"betaInt\", \"betaPhi\",\"betaFlow\",\"betaP\",\n            #  \"betaIntOut\", \"betaPhiOut\",\"betaFlowOut\",\"betaPOut\"\n            ),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\n    MCMCtrace(object = out_flow$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c(\n              \"betaIntYOY\", \"betaPhiYOY\",\"betaFlowYOY\",\"betaPYOY\"  \n            #  \"betaInt\", \"betaPhi\",\"betaFlow\",\"betaP\",\n            #  \"betaIntOut\", \"betaPhiOut\",\"betaFlowOut\",\"betaPOut\"\n            ),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n12.0.2 Model phiT_pT flow ByRiver (tt_OB_flowByRiver)\nCohort-dependent estimates of phi and p with flowByRiver and flowByRiver^2 hierarchical effects\n\n12.0.2.1 Retrieve model results\nModel is run using targets in R/modelCMR_tt_OB.R\n\n\nCode\n# Following https://oliviergimenez.github.io/bayesian-cr-workshop/worksheets/4_demo.html\n# \n  out_flowByRiver <- tar_read(tt_modelOut_ft_cohort_OB_flowByRiver)\n\n  MCMCplot(object = out_flowByRiver$mcmc)\n\n\n\n\n\nCode\n  summary_flowByRiver <- MCMCsummary(object = out_flowByRiver$mcmc, round = 3) %>%\n    mutate(flowData = \"flowByRiver\") %>%\n    rownames_to_column(var = \"var\")\n  \n  summary_flowByRiver %>% filter(grepl(\"betaIntYOYSeason\", var))\n\n\n                         var  mean    sd   2.5%   50% 97.5% Rhat n.eff\n1     betaIntYOYSeason[1, 1] 1.250 0.374  0.544 1.243 2.015 1.01   645\n2     betaIntYOYSeason[2, 1] 0.897 0.575 -0.169 0.868 2.065 1.10   215\n3     betaIntYOYSeason[1, 2] 1.506 1.184 -0.768 1.519 3.791 1.00  2005\n4     betaIntYOYSeason[2, 2] 0.448 0.368 -0.251 0.443 1.195 1.06   423\n5     betaIntYOYSeason[1, 3] 1.551 0.764  0.003 1.559 3.052 1.03    84\n6     betaIntYOYSeason[2, 3] 0.925 0.410  0.155 0.918 1.755 1.00   439\n7     betaIntYOYSeason[1, 4] 2.581 0.552  1.539 2.586 3.680 1.00   308\n8     betaIntYOYSeason[2, 4] 0.986 0.537  0.073 0.942 2.158 1.00   216\n9  betaIntYOYSeasonOut[1, 1] 0.771 0.064  0.633 0.776 0.882 1.01   719\n10 betaIntYOYSeasonOut[2, 1] 0.697 0.112  0.458 0.704 0.887 1.08   220\n11 betaIntYOYSeasonOut[1, 2] 0.767 0.182  0.317 0.820 0.978 1.00  2463\n12 betaIntYOYSeasonOut[2, 2] 0.607 0.085  0.438 0.609 0.768 1.06   435\n13 betaIntYOYSeasonOut[1, 3] 0.801 0.116  0.501 0.826 0.955 1.06   108\n14 betaIntYOYSeasonOut[2, 3] 0.709 0.081  0.539 0.715 0.853 1.00   493\n15 betaIntYOYSeasonOut[1, 4] 0.921 0.041  0.823 0.930 0.975 1.00   298\n16 betaIntYOYSeasonOut[2, 4] 0.716 0.099  0.518 0.719 0.896 1.00   278\n      flowData\n1  flowByRiver\n2  flowByRiver\n3  flowByRiver\n4  flowByRiver\n5  flowByRiver\n6  flowByRiver\n7  flowByRiver\n8  flowByRiver\n9  flowByRiver\n10 flowByRiver\n11 flowByRiver\n12 flowByRiver\n13 flowByRiver\n14 flowByRiver\n15 flowByRiver\n16 flowByRiver\n\n\nCode\n  summary_flowByRiver %>% filter(grepl(\"betaPhiYOYSeason\", var))\n\n\n[1] var      mean     sd       2.5%     50%      97.5%    Rhat     n.eff   \n[9] flowData\n<0 rows> (or 0-length row.names)\n\n\nCode\n  summary_flowByRiver %>% filter(grepl(\"betaFlow\", var))\n\n\n                 var   mean    sd   2.5%    50%  97.5% Rhat n.eff    flowData\n1  betaFlow[1, 1, 1]  0.015 0.203 -0.351  0.006  0.433 1.03   318 flowByRiver\n2  betaFlow[2, 1, 1] -0.387 0.229 -0.863 -0.383  0.050 1.01   337 flowByRiver\n3  betaFlow[3, 1, 1]  0.102 0.144 -0.171  0.106  0.390 1.00   592 flowByRiver\n4  betaFlow[1, 2, 1]  0.184 0.422 -0.600  0.157  1.122 1.14   130 flowByRiver\n5  betaFlow[2, 2, 1] -0.928 0.332 -1.576 -0.924 -0.302 1.01   414 flowByRiver\n6  betaFlow[3, 2, 1]  0.188 0.293 -0.395  0.192  0.745 1.09   360 flowByRiver\n7  betaFlow[1, 1, 2] -0.291 1.165 -2.550 -0.284  1.974 1.00  1394 flowByRiver\n8  betaFlow[2, 1, 2]  0.628 1.181 -1.727  0.639  2.916 1.00  2473 flowByRiver\n9  betaFlow[3, 1, 2]  0.433 1.160 -1.788  0.435  2.726 1.00  2197 flowByRiver\n10 betaFlow[1, 2, 2]  0.426 0.238  0.027  0.402  0.917 1.18   122 flowByRiver\n11 betaFlow[2, 2, 2] -1.237 0.227 -1.722 -1.223 -0.830 1.13   152 flowByRiver\n12 betaFlow[3, 2, 2] -0.285 0.170 -0.674 -0.274  0.018 1.11   183 flowByRiver\n13 betaFlow[1, 1, 3] -0.453 0.873 -2.204 -0.447  1.300 1.03    62 flowByRiver\n14 betaFlow[2, 1, 3]  0.240 0.757 -1.301  0.249  1.659 1.02   219 flowByRiver\n15 betaFlow[3, 1, 3]  1.227 0.877 -0.484  1.236  2.928 1.02   222 flowByRiver\n16 betaFlow[1, 2, 3] -0.123 0.270 -0.614 -0.138  0.464 1.03   179 flowByRiver\n17 betaFlow[2, 2, 3] -1.085 0.291 -1.715 -1.065 -0.576 1.01   206 flowByRiver\n18 betaFlow[3, 2, 3] -0.754 0.259 -1.321 -0.733 -0.294 1.01   207 flowByRiver\n19 betaFlow[1, 1, 4] -0.587 0.242 -1.068 -0.585 -0.116 1.03   526 flowByRiver\n20 betaFlow[2, 1, 4]  2.728 0.510  1.728  2.731  3.758 1.02   330 flowByRiver\n21 betaFlow[3, 1, 4]  0.238 0.390 -0.506  0.238  0.991 1.02   357 flowByRiver\n22 betaFlow[1, 2, 4] -0.281 0.229 -0.715 -0.285  0.203 1.06   437 flowByRiver\n23 betaFlow[2, 2, 4]  1.328 0.600 -0.116  1.363  2.344 1.01   183 flowByRiver\n24 betaFlow[3, 2, 4]  0.244 0.315 -0.379  0.248  0.865 1.00   369 flowByRiver\n25    betaFlowTop[1] -0.094 0.638 -1.389 -0.091  1.157 1.00  3445 flowByRiver\n26    betaFlowTop[2]  0.104 0.650 -1.169  0.115  1.356 1.00  3203 flowByRiver\n27    betaFlowTop[3]  0.114 0.646 -1.151  0.105  1.370 1.00  3669 flowByRiver\n28 betaFlowYOY[1, 1] -0.266 0.597 -1.439 -0.264  0.912 1.00   392 flowByRiver\n29 betaFlowYOY[2, 1]  0.665 0.592 -0.468  0.649  1.794 1.00  1038 flowByRiver\n30 betaFlowYOY[3, 1]  0.422 0.613 -0.767  0.426  1.606 1.00  1124 flowByRiver\n31 betaFlowYOY[1, 2]  0.023 0.487 -0.954  0.034  0.964 1.00  1662 flowByRiver\n32 betaFlowYOY[2, 2] -0.368 0.500 -1.348 -0.349  0.579 1.00  1180 flowByRiver\n33 betaFlowYOY[3, 2] -0.110 0.477 -1.045 -0.107  0.817 1.00  2843 flowByRiver\n\n\nCode\n  priors <- runif(out_flowByRiver$runData$nIter * out_flowByRiver$runData$nChains, 0, 1)\n  MCMCtrace(object = out_flowByRiver$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c( \"betaIntYOY\", \"betaPhiYOY\",\"betaFlowYOY\",\"betaPYOY\" ),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\n  # MCMCtrace(object = out_flowByRiver$mcmc,\n  #           #ISB = FALSE,\n  #           #exact = TRUE, \n  #           params = c(\"betaInt\"),\n  #           pdf = FALSE, \n  #           priors = priors)\n\n\n\n\n12.0.2.2 Compare parameter estimates of models with flow and flowByRiver\n\n\nCode\nboth <- bind_rows(summary_flow, summary_flowByRiver) %>%\n  rename(lo = '2.5%', hi = '97.5%')\n\nggplot(both %>% filter(grepl(\"betaFlowTop\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) \n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaPhiTop\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaFlowYOY\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaPhiYOY\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaIntYOYSeason\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaPhiYOYSeason\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaInt\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\nggplot(both %>% filter(grepl(\"betaPYOY\", var)), aes(color = flowData)) +\n  geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\nCode\n# ggplot(both %>% filter(grepl(\"betaPOut\", var)), aes(color = flowData)) +\n#   geom_point(aes(var, mean), size = 2, position = position_dodge(width = 0.5)) +\n#   geom_errorbar( aes(var, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n#   theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))\n\n\n\n\n\n\n\n\n12.0.3 Survival comparison\n\n\nCode\ngetBetas <- function(d) {\n  #betaFlow\n  betaFlow <- d %>% \n    filter(grepl(\"betaInt\\\\[\", var)) %>%\n    mutate(\n      flowData = \"flow\",\n      tmp = str_match(var, \"\\\\[([0-9]+), ([0-9]+), ([0-9]+)\\\\]\")[, 2:4] %>% as.data.frame(),\n      param = tmp$V1,\n      isYOY = tmp$V2,\n      season = tmp$V3\n    ) %>%\n    select(-tmp)\n  \n  betaFlowYOY <- d %>% \n    filter(grepl(\"betaFlowYOY\", var)) %>%\n    mutate(\n      flowData = \"flow\",\n      tmp = str_match(var, \"\\\\[([0-9]+), ([0-9]+)\\\\]\")[, 2:3] %>% as.data.frame(),\n      param = tmp$V1,\n      isYOY = tmp$V2,\n    ) %>%\n    select(-tmp)\n  \n  betaFlowTop <- d %>% \n    filter(grepl(\"betaFlowTop\", var)) %>%\n    mutate(\n      flowData = \"flow\",\n      tmp = str_match(var, \"\\\\[([0-9]+)\\\\]\") %>% as.data.frame(),\n      param = tmp$V2\n    ) %>%\n    select(-tmp)\n  \n  \n}\n\ngetBetaIntOuts <- function(d, dataType = \"flow\") {\n  #betaFlow\n  betaInt <- d %>% \n    filter(grepl(\"betaIntOut\\\\[\", var)) %>%\n    mutate(\n      flowData = dataType,\n      tmp = str_match(var, \"\\\\[([0-9]+), ([0-9]+), ([0-9]+)\\\\]\")[, 2:4] %>% as.data.frame(),\n      isYOY = tmp$V1,\n      season = tmp$V2,\n      cohort = tmp$V3,\n      varName = \"betaInt\"\n    ) %>%\n    select(-tmp) %>%\n    filter(!(season == 2 & isYOY == 1))\n    \n  betaIntYOY <- d %>% \n    filter(grepl(\"betaIntYOYOut\\\\[\", var)) %>%\n    mutate(\n      flowData = dataType,\n      tmp = str_match(var, \"\\\\[([0-9]+)\\\\]\") %>% as.data.frame(),\n      isYOY = tmp$V2,\n      varName = \"betaIntYOY\"\n    ) %>%\n    select(-tmp)\n  \n  betaIntYOYSeason <- d %>% \n    filter(grepl(\"betaIntYOYSeasonOut\\\\[\", var)) %>%\n    mutate(\n      flowData = dataType,\n      tmp = str_match(var, \"\\\\[([0-9]+), ([0-9]+)\\\\]\")[, 2:3] %>% as.data.frame(),\n      isYOY = tmp$V1,\n      season = tmp$V2,\n      varName = \"betaIntYOYSeason\"\n    ) %>%\n    select(-tmp) %>%\n    filter(!(season == 2 & isYOY == 1))\n\n  return(\n    bind_rows(betaInt, betaIntYOY, betaIntYOYSeason) %>%\n      mutate(cohort = as.numeric(cohort) + 2002 - 1)\n         )\n}\n\n\n\n12.0.3.1 Get betaIntOut estimates\n\n\nCode\nbetaIntFlow <- getBetaIntOuts(summary_flow, \"flow\")\nbetaIntFlowByRiver <- getBetaIntOuts(summary_flowByRiver, \"flowByRiver\")\n\nbetaInts <- bind_rows(betaIntFlow, betaIntFlowByRiver) %>%\n  rename(lo = '2.5%', hi = '97.5%')\n\n\n\n\nCode\n# Define the facet labeller function\nlabelsIntYOY <- c(\n  \"1\" = \"Growth year 1\",\n  \"2\" = \"Growth year 2\"\n)\n\nlabelsIntSeason <- c(\n  \"1\" = \"Spring\",\n  \"2\" = \"Summer\",\n  \"3\" = \"Autumn\",\n  \"4\" = \"Winter\"\n)\n\nglobal_labellerInt <- labeller(\n  isYOY = labelsIntYOY,\n  season = labelsIntSeason\n  #.default = label_both\n)\n\nggplot(betaInts %>% filter(varName == \"betaInt\"), aes(cohort, mean, color = flowData)) +\n  geom_point(size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar(aes(cohort, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  scale_x_continuous(\"Cohort\") +  \n  scale_y_continuous(\"Suvrival\") +\n  facet_grid(season~isYOY, labeller = global_labellerInt) +\n  guides(color = guide_legend(\n    title = \"Data source\"\n  ))\n\n\n\n\n\nCode\nglobal_labellerIntYOYSeason <- labeller(\n  isYOY = labelsIntYOY\n # season = labelsIntSeason\n  #.default = label_both\n)\n\nggplot(betaInts %>% filter(varName == \"betaIntYOYSeason\"), aes(season, mean, color = flowData)) +\n  geom_point(size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar(aes(season, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5)) +\n  scale_x_discrete(\"Season\") +  \n  scale_y_continuous(\"Suvrival\") +\n  facet_grid(~isYOY, labeller = global_labellerIntYOYSeason) +\n  guides(color = guide_legend(\n    title = \"Data source\"\n  ))\n\n\n\n\n\nCode\nggplot(betaInts %>% filter(varName == \"betaIntYOY\"), aes(isYOY, mean, color = flowData)) +\n  geom_point(size = 2, position = position_dodge(width = 0.5)) +\n  geom_errorbar(aes(isYOY, ymin = lo, ymax = hi), width = 0.4, position = position_dodge(width = 0.5))\n\n\n\n\n\n\n\n\n\n\n\n12.0.4 Flow_YOYSeason predictions\n\n\nCode\ngetPredictions_FlowYOYSeasonCohort <- function(toSave, everyNIters = 10, flowStep = 0.5){\n  \n  mcmc <- toSave$mcmc\n  ## betaInt\n  predictorsBetaInt <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n    season = 1:toSave$myConstants$nSeasons,\n    cohort = 1:toSave$myConstants$nCohorts\n  )\n  \n  for(i in 1:nrow(predictorsBetaInt)){\n    predictorsBetaInt$betaInt[i] <- mcmc$chain1[[predictorsBetaInt[i, \"iter\"], \n                                                 paste0(\"betaInt[\", predictorsBetaInt[i, \"isYOY\"],\n                                                        \", \",       predictorsBetaInt[i, \"season\"],\n                                                        \", \",       predictorsBetaInt[i, \"cohort\"],\n                                                        \"]\")\n    ]]\n  }\n\n  # ## betaPhi\n  # predictorsBetaPhi <- expand.grid(\n  #   iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n  #   isYOY = 1:2,\n  #   season = 1:toSave$myConstants$nSeasons,\n  #   cohort = 1:toSave$myConstants$nCohorts\n  # )\n  # \n  # for(i in 1:nrow(predictorsBetaPhi)){\n  #   predictorsBetaPhi$betaPhi[i] <- mcmc$chain1[[predictorsBetaPhi[i, \"iter\"], \n  #                                                paste0(\"betaPhi[\", predictorsBetaPhi[i, \"isYOY\"],\n  #                                                       \", \",       predictorsBetaPhi[i, \"season\"],\n  #                                                       \", \",       predictorsBetaPhi[i, \"cohort\"],\n  #                                                       \"]\")\n  #   ]]\n  # }\n  \n  ## betaFlow\n  predictorsBetaFlow <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n    season = 1:toSave$myConstants$nSeasons\n  #  cohort = 1:toSave$myConstants$nCohorts\n  )\n  \n  for(i in 1:nrow(predictorsBetaFlow)){\n    predictorsBetaFlow$betaFlow1[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[1, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                      #     \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n    predictorsBetaFlow$betaFlow2[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[2, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                  #         \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n    \n    predictorsBetaFlow$betaFlow3[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[3, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                  #         \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n  }\n  \n\n  predictorsAll <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n    cohort = 1:toSave$myConstants$nCohorts,\n    season = 1:toSave$myConstants$nSeasons,\n    flow = seq(-1.5, 1.5, flowStep),\n    temp = seq(-1.5, 1.5, flowStep)\n  )\n  \n  preds <- predictorsAll %>%\n    left_join(predictorsBetaInt) %>%\n    left_join(predictorsBetaFlow) %>%\n #   left_join(predictorsBetaPhi) %>%\n    mutate(predPhi = plogis(betaInt + betaFlow1 * flow + betaFlow2 * temp + betaFlow3 * flow * temp))\n  \n  return(preds)\n}\n\n\n\n\nCode\ngetPredictions_FlowYOYSeason <- function(toSave, everyNIters = 10, flowStep = 0.5){\n  \n  mcmc <- toSave$mcmc\n  ## betaInt\n  predictorsBetaInt <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n    season = 1:toSave$myConstants$nSeasons\n#    cohort = 1:toSave$myConstants$nCohorts\n  )\n  \n  for(i in 1:nrow(predictorsBetaInt)){\n    predictorsBetaInt$betaInt[i] <- mcmc$chain1[[predictorsBetaInt[i, \"iter\"], \n                                                 paste0(\"betaIntYOYSeason[\", predictorsBetaInt[i, \"isYOY\"],\n                                                        \", \",       predictorsBetaInt[i, \"season\"],\n                                                  #      \", \",       predictorsBetaInt[i, \"cohort\"],\n                                                        \"]\")\n    ]]\n  }\n\n#   ## betaPhi\n#   predictorsBetaPhi <- expand.grid(\n#     iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n#     isYOY = 1:2,\n#     season = 1:toSave$myConstants$nSeasons\n# #    cohort = 1:toSave$myConstants$nCohorts\n#   )\n#   \n#   for(i in 1:nrow(predictorsBetaPhi)){\n#     predictorsBetaPhi$betaPhi[i] <- mcmc$chain1[[predictorsBetaPhi[i, \"iter\"], \n#                                                  paste0(\"betaPhiYOYSeason[\", predictorsBetaPhi[i, \"isYOY\"],\n#                                                         \", \",       predictorsBetaPhi[i, \"season\"],\n#                                                   #      \", \",       predictorsBetaPhi[i, \"cohort\"],\n#                                                         \"]\")\n#     ]]\n#   }\n  \n  ## betaFlow\n  predictorsBetaFlow <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n    season = 1:toSave$myConstants$nSeasons\n  #  cohort = 1:toSave$myConstants$nCohorts\n  )\n  \n  for(i in 1:nrow(predictorsBetaFlow)){\n    predictorsBetaFlow$betaFlow1[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[1, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                      #     \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n    predictorsBetaFlow$betaFlow2[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[2, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                  #         \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n    \n    predictorsBetaFlow$betaFlow3[i] <- mcmc$chain1[[predictorsBetaFlow[i, \"iter\"], \n                                                    paste0(\"betaFlow[3, \", predictorsBetaFlow[i, \"isYOY\"],\n                                                           \", \",           predictorsBetaFlow[i, \"season\"],\n                                                  #         \", \",           predictorsBetaFlow[i, \"cohort\"],\n                                                           \"]\")\n    ]]\n  }\n  \n\n  predictorsAll <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    isYOY = 1:2,\n   # cohort = 1:toSave$myConstants$nCohorts,\n    season = 1:toSave$myConstants$nSeasons,\n    flow = seq(-1.5, 1.5, flowStep),\n    temp = seq(-1.5, 1.5, flowStep)\n  )\n  \n  preds <- predictorsAll %>%\n    left_join(predictorsBetaInt) %>%\n    left_join(predictorsBetaFlow) %>%\n  #  left_join(predictorsBetaPhi) %>%\n    mutate(predPhi = plogis(betaInt + betaFlow1 * flow + betaFlow2 * temp + betaFlow3 * flow * temp))\n  \n  return(preds)\n}\n\n\n\n\nCode\npredFlowYOYSeason <- getPredictions_FlowYOYSeason(out_flow, everyNIters = 5) %>%\n    mutate(flowData = \"flow\") \n\npredFlowByRiverYOYSeason <- getPredictions_FlowYOYSeason(out_flowByRiver, everyNIters = 5) %>%\n    mutate(flowData = \"flowByRiver\")\n\npredBoth <- bind_rows(predFlowYOYSeason, predFlowByRiverYOYSeason)\n\n\n\n12.0.4.1 Graph flow predictions\nPredictions based on flow from the flow extension curve - original approach\n\n\nCode\ncolors <- c(\"blue\", \"green\", \"red\")\n\nggplot(predFlowYOYSeason %>% filter(temp %in% c(-1,0,1)), aes(flow, predPhi, group = ((paste0(iter,temp, sep = \"_\"))))) +\n  geom_line(aes(color = factor(temp)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  guides(colour = guide_legend(override.aes = list(alpha = 1))) +\n  facet_grid(season ~ isYOY)\n\n\n\n\n\nPredictions based on flow from flowByRiver\n\n\nCode\nggplot(predFlowByRiverYOYSeason %>% filter(temp %in% c(-1,0,1)), aes(flow, predPhi, group = ((paste0(iter,temp, sep = \"_\"))))) +\n  geom_line(aes(color = factor(temp)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  guides(colour = guide_legend(override.aes = list(alpha = 1))) +\n  facet_grid(season ~ isYOY)\n\n\n\n\n\nSimilar format to to the 2015 paper\n\n\nCode\ncolors <- c(\"red\", \"green\", \"blue\")\n\nggplot(predFlowYOYSeason %>% filter(flow %in% c(-1,0,1)), aes(temp, predPhi, group = ((paste0(iter,flow, sep = \"_\"))))) +\n  geom_line(aes(color = factor(flow)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  guides(colour = guide_legend(override.aes = list(alpha = 1))) +\n  facet_grid(season ~ isYOY)\n\n\n\n\n\n\n\n\n\n\n\n12.0.5 Flow_YOYSeasonCohort predictions\n\n\nCode\npredFlowYOYSeasonCohort <- getPredictions_FlowYOYSeasonCohort(out_flow, everyNIters = 5) %>%\n    mutate(flowData = \"flow\") \n\npredFlowByRiverYOYSeasonCohort <- getPredictions_FlowYOYSeasonCohort(out_flowByRiver, everyNIters = 5) %>%\n    mutate(flowData = \"flowByRiver\")\n\npredBoth <- bind_rows(predFlowYOYSeasonCohort, predFlowByRiverYOYSeasonCohort)\n\n\n\n12.0.5.1 Graph flow predictions\nPredictions based on flow from the flow extension curve - original approach\n\n\nCode\ncolors <- c(\"blue\", \"green\", \"red\")\n\nggplot(predFlowYOYSeasonCohort %>% filter(temp %in% c(-1,0,1)), aes(flow, predPhi, group = ((paste0(iter,temp,cohort, sep = \"_\"))))) +\n  geom_line(aes(color = factor(temp)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  facet_grid(season ~ isYOY + cohort)\n\n\n\n\n\nPredictions based on flow from flowByRiver\n\n\nCode\nggplot(predFlowByRiverYOYSeasonCohort %>% filter(temp %in% c(-1,0,1)), aes(flow, predPhi, group = ((paste0(iter,temp,cohort, sep = \"_\"))))) +\n  geom_line(aes(color = factor(temp)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  facet_grid(season ~ isYOY + cohort)\n\n\n\n\n\nSimilar format to to the 2015 paper\n\n\nCode\nggplot(predFlowYOYSeasonCohort %>% filter(flow %in% c(-1,0,1)), aes(temp, predPhi, group = ((paste0(iter,flow,cohort, sep = \"_\"))))) +\n  geom_line(aes(color = factor(flow)), alpha = 0.05) +\n  scale_color_manual(values = colors) +\n  facet_grid(season ~ isYOY)\n\n\n\n\n\n\n\n\n\n\n12.0.5.2 FlowTop predictions\n\n\nCode\n# predFlowTop <- getPredictionsFlowTop(out_flow, everyNIters = 5) %>%\n#     mutate(flowData = \"flow\") \n# \n# predFlowByRiverTop <- getPredictionsFlowTop(out_flowByRiver, everyNIters = 5) %>%\n#     mutate(flowData = \"flowByRiver\")\n# \n# predTopBoth <- bind_rows(predFlowTop, predFlowByRiverTop)\n\n\n\n\nCode\n# ggplot(predTopBoth, aes(flow, predPhi, group = iter)) +\n#   geom_line() +\n#   facet_wrap(~flowData)\n# \n# ggplot(predTopBoth %>% filter(iter < 100), aes(flow, predPhi, group = iter)) +\n#   geom_line() +\n#   facet_grid(flowData ~ iter)\n\n\n\n\nCode\ngetPredictionsFlowTop <- function(toSave, everyNIters = 10, flowStep = 0.5){\n\n  mcmc <- toSave$mcmc\n  \n  ## betaFlow\n  predictorsBetaFlowTop <- expand.grid(\n    iter = seq(1, dim(mcmc$chain1)[1], everyNIters),\n    var = 1:2,\n    flow = seq(-1.5, 1.5, flowStep),\n    temp = seq(-1.5, 1.5, flowStep)\n  )\n  \n  for(i in 1:nrow(predictorsBetaFlowTop)){\n    predictorsBetaFlowTop$betaFlowTop1[i] <- mcmc$chain1[[predictorsBetaFlowTop[i, \"iter\"], \n                                                         1\n                                                        ]]\n    predictorsBetaFlowTop$betaFlowTop2[i] <- mcmc$chain1[[predictorsBetaFlowTop[i, \"iter\"], \n                                                         2\n                                                        ]]\n    predictorsBetaFlowTop$betaFlowTop3[i] <- mcmc$chain1[[predictorsBetaFlowTop[i, \"iter\"], \n                                                         3\n                                                        ]]\n  }\n\n  preds <- predictorsBetaFlowTop %>%\n    mutate(predPhi = plogis(betaFlow1 * flow + betaFlow2 * temp + betaFlow3 * flow * temp))\n  \n  return(preds)\n}"
  },
  {
    "objectID": "modelsCMR_Flow_4Rivers.html",
    "href": "modelsCMR_Flow_4Rivers.html",
    "title": "13  Flow effects on survival (phi) models - 4 rivers",
    "section": "",
    "text": "The goal of this modelling exercise is to evaluate the effect of new tributary-specific stream flow estimates on survival of brook trout and brown trout. We will compare survival across the WB and tributaries with flow input data as 1) single flow estimate for all locations (historical approach) and 2) hindcasted flows for each tributary based on new tributary-specific flows which are available since 2000.\nThe goal is to find the best structure for the survival model, then compare survival estimates with tributary-specific flow to estimates with common flow across locations.\nStructure options include [species, cohort, season, isYOY, flow, flow^2]\n\n\n\n\n13.0.0.1 Load pre-run model\nThis model is too big (88 Gb) and needs to be run on workbench\nOutput files are here: “C:- DOI-book4rivers”\n\n\nCode\n# Following https://oliviergimenez.github.io/bayesian-cr-workshop/worksheets/4_demo.html\n\n  toSave <-  tar_read(toSave_ttt_WB_target)\n\n  MCMCplot(object = toSave$mcmc, params = \"betaPhiOut\")\n\n\n\n\n\nCode\n  MCMCplot(object = toSave$mcmc, params = \"betaPhiRiverOut\")# \n\n\n\n\n\nCode\n  MCMCplot(object = toSave$mcmc, params = c(\"betaPhiRiverCohortOut\"))\n\n\n\n\n\nCode\n  MCMCplot(object = toSave$mcmc, params = \"betaPOut\")\n\n\n\n\n\nCode\n  MCMCplot(object = toSave$mcmc, params = \"betaPRiverOut\")# \n\n\n\n\n\nCode\n  MCMCplot(object = toSave$mcmc, params = c(\"betaPRiverCohortOut\"))\n\n\n\n\n\nCode\n  MCMCplot(object = toSave$mcmc, params = c(\"psi\"))\n\n\n\n\n\nCode\n   priors <- rnorm(toSave$nIter * toSave$nChains, 0, 1/sqrt(.1))\n  MCMCtrace(object = toSave$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c(\"betaPhiRiverOut\"),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\nCode\n  priors <- runif(toSave$nIter * toSave$nChains, 0, 1)\n  MCMCtrace(object = toSave$mcmc,\n            #ISB = FALSE,\n            #exact = TRUE, \n            params = c(\"betaPhiRiverCohortOut\"),\n            pdf = FALSE, \n            priors = priors)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\n   priors <- runif(toSave$nIter * toSave$nChains, 0, 1)\n   MCMCtrace(object = toSave$mcmc,\n             ISB = FALSE,\n             exact = TRUE,\n             params = c(\"psi[1, 1, 4, 4]\", \"psi[1, 2, 4, 4]\", \"psi[1, 3, 4, 4]\", \"psi[1, 4, 4, 4]\",\n                        \"psi[2, 1, 4, 4]\", \"psi[2, 2, 4, 4]\", \"psi[2, 3, 4, 4]\", \"psi[2, 4, 4, 4]\"),\n             pdf = FALSE,\n             priors = priors)\n\n\n\n\n\n\n\n\n\n\n\nCode from westBrook-book Needs to be run on workBench\n\n\nCode\n# copy code below into workbench for model runs\n# Put zipped output into ./models/cmrFlow4rivers/runsOut/fromWorkbench/rstudio-export.zip and then unzip\n\nif(!useWorkbenchRuns) {\n  \n  # Following https://oliviergimenez.github.io/bayesian-cr-workshop/worksheets/5_demo.html\n  if (rerunSurivalModels) {\n    \n    y <- eh$eh * eh$riverN\n    (nCohorts <- nrow(unique(eh$cohorts)))\n    (nSeasons <- nrow(unique(eh$seasons)))\n    (nRivers <- length(unique(eh$data$riverN)))# rivers 1:4\n    seasonArray <- c(3,4,1,2,3,4,1,2,3,4,1,2)\n               \n  \n    first <- eh$first #apply(y, 1, function(x) min(which(x !=0)))\n    last <- eh$last\n    cohort = ((eh$cohorts) - min(eh$cohorts) + 1)$cohort #can't be a data frame or tibble\n    \n    zinits <- y + 1 # non-detection -> alive\n    zinits[zinits == 2] <- 1 # dead -> alive\n    zInitsNA <- ifelse(is.na(eh$flow), NA, 1)\n    \n    # Proportion of fish in each river on the first observation\n    y1 <- y[,1]\n    deltaProps <- table(y1[y1>0]) / length(y1[y1>0])\n    \n    # alpha for the dirichlet prior\n    alpha <- c(1,1,1,1)\n    \n    # fill in entries for dirichlet priors where a[r,,t,c] sums to 1 for any r,t,c combo\n    getDirchPriors <- function(nRivers,myConstants, nCohorts, alpha){\n      a = array(rep(0, nRivers * nRivers * (myConstants$T - 1) * nCohorts) , c(nRivers, nRivers, (myConstants$T - 1), nCohorts ))\n      for(r in 1:nRivers){\n        for(t in 1:(myConstants$T - 1)){\n          for (c in 1:nCohorts){\n            dirch <- rdirch(1, alpha)\n            for (r2 in 1:nRivers){\n              a[r,r2,t,c] <- dirch[r2]\n            }\n          }\n        }\n      }\n      return(a)\n    }\n    \n    # Priors for psi where more likely to stay than move\n    alphaR <- list()\n    alphaR[[1]] <- alphaR1 <- c(0.7, 0.1, 0.1, 0.1)\n    alphaR[[2]] <- alphaR2 <- c(0.1, 0.7, 0.1, 0.1)\n    alphaR[[3]] <- alphaR3 <- c(0.1, 0.1, 0.7, 0.1)\n    alphaR[[4]] <- alphaR4 <- c(0.1, 0.1, 0.1, 0.7)\n    \n    getDirchPriorsR <- function(nRivers,myConstants, nCohorts, alpha){\n      a = array(rep(0, nRivers * nRivers * (myConstants$T - 1) * nCohorts) , c(nRivers, nRivers, (myConstants$T - 1), nCohorts ))\n      for(r in 1:nRivers){\n        for(t in 1:(myConstants$T - 1)){\n          for (c in 1:nCohorts){\n            dirch <- rdirch(1, alphaR[[r]])\n            for (r2 in 1:nRivers){\n              a[r,r2,t,c] <- dirch[r2]\n            }\n          }\n        }\n      }\n      return(a)\n    }\n      \n    #psi = getDirchPriorsR(nRivers, myConstants, nCohorts, alpha)\n    \n    #  For 3 states, we are using 4\n    # -------------------------------------------------\n    # Parameters for 3 sites (A, B, C):\n    # phiA: survival probability site A\n    # phiB: survival probability site B\n    # phiC: survival probability site B\n    # psiAA: movement probability from site A to site A (reference)\n    # psiAB = psiA[1]: movement probability from site A to site B\n    # psiAC = psiA[2]: movement probability from site A to site C \n    # psiBA = psiB[1]: movement probability from site B to site A\n    # psiBB: movement probability from site B to site B (reference)\n    # psiBC = psiB[2]: movement probability from site B to site C\n    # psiCA = psiC[1]: movement probability from site C to site A\n    # psiCB = psiC[2]: movement probability from site C to site B\n    # psiCC: movement probability from site C to site C (reference)\n    # pA: recapture probability site A\n    # pB: recapture probability site B\n    # pC: recapture probability site C\n    # -------------------------------------------------\n    # States (z):\n    # 1 alive at A\n    # 2 alive at B\n    # 3 alive at C\n    # 4 alive at D\n    # 5 dead\n    # Observations (y):  \n    # 1 not seen\n    # 2 seen at A \n    # 3 seen at B\n    # 4 seen at C\n    # 5 seen at D\n    # river names: c(\"west brook\" = 1, \"wb jimmy\" = 2, \"wb mitchell\" = 3, \"wb obear\" = 4)\n    # -------------------------------------------------\n    \n    ## model code using DHMMo distribution\n    hmm.phiT_pT_psiT_DHMM_dirch <- nimbleCode({\n        # Initial distribution among rivers\n        delta[1] <- deltaProps[1]                  # Pr(alive t = 1 and in river 1) = 0.4\n        delta[2] <- deltaProps[2]\n        delta[3] <- deltaProps[3]\n        delta[4] <- deltaProps[4]\n        delta[5] <- 0                    # Pr(dead t = 1) = 0\n    \n        for (r in 1:nRivers){\n            betaPhiRiver[r] ~ dnorm(0,sd = 1)\n            betaPRiver[r] ~ dnorm(0,sd = 1)\n            \n            betaPhiRiverOut[r] <- ilogit(betaPhiRiver[r])\n            betaPRiverOut[r] <- ilogit(betaPRiver[r])\n            \n            for (c in 1:nCohorts){\n                betaPhiRiverCohort[r,c] ~ dnorm(betaPhiRiver[r], sd = 1)\n                betaPRiverCohort[r,c] ~ dnorm(betaPRiver[r], sd = 1)\n   \n                betaPhiRiverCohortOut[r,c] <- ilogit(betaPhiRiverCohort[r,c])\n                betaPRiverCohortOut[r,c] <- ilogit(betaPRiverCohort[r,c])\n                for (t in 1:(T-1)){\n                    betaPhi[r,t,c] ~ dnorm(betaPhiRiverCohort[r,c], sd = 1)\n                    betaP[r,t,c] ~ dnorm(betaPRiverCohort[r,c], sd = 1)\n                    \n                    betaPhiOut[r,t,c] <- ilogit(betaPhi[r,t,c])\n                    betaPOut[r,t,c] <- ilogit(betaP[r,t,c])\n                    \n                    # move from river 'r' to one of river 1:nRivers\n                    # Nice description of effect of 'alpha' on probabilities:\n                    # https://stats.stackexchange.com/questions/244917/what-exactly-is-the-alpha-in-the-dirichlet-distribution\n                    #psi[r,1:nRivers,t,c] ~ ddirch(alpha[[r]][1:nRivers])\n                }\n            }\n        }\n        \n        for (t in 1:(T-1)){ # loop over time\n          for (c in 1:nCohorts){\n            psi[1,1:nRivers,t,c] ~ ddirch(alphaR1[1:nRivers])\n            psi[2,1:nRivers,t,c] ~ ddirch(alphaR2[1:nRivers])\n            psi[3,1:nRivers,t,c] ~ ddirch(alphaR3[1:nRivers])\n            psi[4,1:nRivers,t,c] ~ ddirch(alphaR4[1:nRivers])\n          }\n        }\n    \n        for (t in 1:(T-1)){ # loop over time\n          for (c in 1:nCohorts){\n  \n            gamma[1,1,t,c] <- ilogit(betaPhi[1,t,c]) * psi[1,1,t,c]\n            gamma[1,2,t,c] <- ilogit(betaPhi[1,t,c]) * psi[1,2,t,c]\n            gamma[1,3,t,c] <- ilogit(betaPhi[1,t,c]) * psi[1,3,t,c]\n            gamma[1,4,t,c] <- ilogit(betaPhi[1,t,c]) * psi[1,4,t,c]\n            gamma[1,5,t,c] <- 1 - ilogit(betaPhi[1,t,c])\n            gamma[2,1,t,c] <- ilogit(betaPhi[2,t,c]) * psi[2,1,t,c]\n            gamma[2,2,t,c] <- ilogit(betaPhi[2,t,c]) * psi[2,2,t,c]\n            gamma[2,3,t,c] <- ilogit(betaPhi[2,t,c]) * psi[2,3,t,c]\n            gamma[2,4,t,c] <- ilogit(betaPhi[2,t,c]) * psi[2,4,t,c]\n            gamma[2,5,t,c] <- 1 - ilogit(betaPhi[2,t,c])\n            gamma[3,1,t,c] <- ilogit(betaPhi[3,t,c]) * psi[3,1,t,c]\n            gamma[3,2,t,c] <- ilogit(betaPhi[3,t,c]) * psi[3,2,t,c]\n            gamma[3,3,t,c] <- ilogit(betaPhi[3,t,c]) * psi[3,3,t,c]\n            gamma[3,4,t,c] <- ilogit(betaPhi[3,t,c]) * psi[3,4,t,c]\n            gamma[3,5,t,c] <- 1 - ilogit(betaPhi[3,t,c])\n            gamma[4,1,t,c] <- ilogit(betaPhi[4,t,c]) * psi[4,1,t,c]\n            gamma[4,2,t,c] <- ilogit(betaPhi[4,t,c]) * psi[4,2,t,c]\n            gamma[4,3,t,c] <- ilogit(betaPhi[4,t,c]) * psi[4,3,t,c]\n            gamma[4,4,t,c] <- ilogit(betaPhi[4,t,c]) * psi[4,4,t,c]\n            gamma[4,5,t,c] <- 1 - ilogit(betaPhi[4,t,c])\n            gamma[5,1,t,c] <- 0\n            gamma[5,2,t,c] <- 0\n            gamma[5,3,t,c] <- 0\n            gamma[5,4,t,c] <- 0\n            gamma[5,5,t,c] <- 1\n          }\n        }\n         \n        # gamma for the last occasion  \n        for (c in 1:nCohorts){\n            for (a in 1:(nRivers+1)){\n                for (b in 1:nRivers){\n                    gamma[a,b,T,c] <- 0\n                }  \n                gamma[a,5,T,c] <- 1\n            }\n        }\n         \n         \n        for (i in 1:N){ # loop over individuals\n            # omega for first obs      \n            omega[1,1,first[i],i] <- 0          # Pr(alive A t -> non-detected t)\n            omega[1,2,first[i],i] <- 1          # Pr(alive A t -> detected A t)\n            omega[1,3,first[i],i] <- 0          # Pr(alive A t -> detected B t)\n            omega[1,4,first[i],i] <- 0          # Pr(alive A t -> detected C t)\n            omega[1,5,first[i],i] <- 0          # Pr(alive A t -> detected D t)\n            omega[2,1,first[i],i] <- 0          # Pr(alive B t -> non-detected t)\n            omega[2,2,first[i],i] <- 0          # Pr(alive B t -> detected A t)\n            omega[2,3,first[i],i] <- 1          # Pr(alive B t -> detected B t)\n            omega[2,4,first[i],i] <- 0          # Pr(alive B t -> detected C t)\n            omega[2,5,first[i],i] <- 0          # Pr(alive B t -> detected C t)\n            omega[3,1,first[i],i] <- 0          # Pr(alive C t -> non-detected t)\n            omega[3,2,first[i],i] <- 0          # Pr(alive C t -> detected A t)\n            omega[3,3,first[i],i] <- 0          # Pr(alive C t -> detected B t)\n            omega[3,4,first[i],i] <- 1          # Pr(alive C t -> detected C t)\n            omega[3,5,first[i],i] <- 0          # Pr(alive C t -> detected C t)\n            omega[4,1,first[i],i] <- 0          # Pr(dead t -> non-detected t)\n            omega[4,2,first[i],i] <- 0          # Pr(dead t -> detected A t)\n            omega[4,3,first[i],i] <- 0          # Pr(dead t -> detected B t)\n            omega[4,4,first[i],i] <- 0          # Pr(dead t -> detected C t)\n            omega[4,5,first[i],i] <- 1          # Pr(dead t -> detected C t)\n            omega[5,1,first[i],i] <- 1          # Pr(dead t -> non-detected t)\n            omega[5,2,first[i],i] <- 0          # Pr(dead t -> detected A t)\n            omega[5,3,first[i],i] <- 0          # Pr(dead t -> detected B t)\n            omega[5,4,first[i],i] <- 0          # Pr(dead t -> detected C t)\n            omega[5,5,first[i],i] <- 0          # Pr(dead t -> detected D t)\n         \n           \n            ## DT changes:\n            ## time t > first[i]:\n            for(t in (first[i]+1):last[i]) {\n                logit(pA[t,i]) <- betaP[1,t-1,cohort[i]]\n                logit(pB[t,i]) <- betaP[2,t-1,cohort[i]]\n                logit(pC[t,i]) <- betaP[3,t-1,cohort[i]]\n                logit(pD[t,i]) <- betaP[4,t-1,cohort[i]]\n               \n                # probabilities of y(t) given z(t)\n                # omega[z, y, t, i]\n                \n                # z=1 = alive in River 1, z=2 = alive in River 2...z=5 = dead\n                # y=1 = unobserved, y=2 = observed in River 1, y=3 = observed in River 2, etc\n                \n                omega[1,1,t,i] <- 1 - pA[t,i]     # Pr(alive A t -> non-detected t)\n                omega[1,2,t,i] <- pA[t,i]         # Pr(alive A t -> detected A t)\n                omega[1,3,t,i] <- 0               # Pr(alive A t -> detected B t)\n                omega[1,4,t,i] <- 0               # Pr(alive A t -> detected C t)\n                omega[1,5,t,i] <- 0               # Pr(alive A t -> detected D t)\n                omega[2,1,t,i] <- 1 - pB[t,i]     # Pr(alive B t -> non-detected t)\n                omega[2,2,t,i] <- 0               # Pr(alive B t -> detected A t)\n                omega[2,3,t,i] <- pB[t,i]         # Pr(alive B t -> detected B t)\n                omega[2,4,t,i] <- 0               # Pr(alive B t -> detected C t)\n                omega[2,5,t,i] <- 0               # Pr(alive B t -> detected C t)\n                omega[3,1,t,i] <- 1 - pC[t,i]     # Pr(alive C t -> non-detected t)\n                omega[3,2,t,i] <- 0               # Pr(alive C t -> detected A t)\n                omega[3,3,t,i] <- 0               # Pr(alive C t -> detected B t)\n                omega[3,4,t,i] <- pC[t,i]         # Pr(alive C t -> detected C t)\n                omega[3,5,t,i] <- 0               # Pr(alive C t -> detected C t)\n                omega[4,1,t,i] <- 1 - pD[t,i]     # Pr(alive D t -> non-detected t))\n                omega[4,2,t,i] <- 0               # Pr(dead D t -> detected A t)\n                omega[4,3,t,i] <- 0               # Pr(dead D t -> detected B t)\n                omega[4,4,t,i] <- 0               # Pr(dead D t -> detected C t)\n                omega[4,5,t,i] <- pD[t,i]         # Pr(alive D t -> detected D t)\n                omega[5,1,t,i] <- 1               # Pr(dead t -> non-detected t)\n                omega[5,2,t,i] <- 0               # Pr(dead t -> detected A t)\n                omega[5,3,t,i] <- 0               # Pr(dead t -> detected B t)\n                omega[5,4,t,i] <- 0               # Pr(dead t -> detected C t)\n                omega[5,5,t,i] <- 0               # Pr(dead t -> detected D t)\n            }\n           \n        } # i loop\n    \n        for (i in 1:N){\n            y[i,first[i]:last[i]] ~ dDHMMo(init = delta[1:5],\n                                           probTrans = gamma[1:5, 1:5, first[i]:last[i], cohort[i]],\n                                           probObs =   omega[1:5, 1:5, first[i]:last[i], i],\n                                           len = length[i],\n                                           checkRowSums = 1)\n        }\n    \n    })\n    \n    ##\n    myConstants0 <- list(N = nrow(y),\n                         T = ncol(y),\n                         first = first,\n                         last = last,\n                         cohort = cohort,\n                         nCohorts = nCohorts,\n                         nRivers = nRivers,\n                         season = seasonArray,\n                         #                     flow = eh$flow,\n                         length = last - first + 1,\n                         alpha = alpha,\n                         deltaProps = deltaProps\n                         )\n    \n    ## DT changes:\n    myData0 <- list(###yCJS = eh$eh, #y,    ## data for CJS distribution\n        y = y + 1\n    )   ## data for DHMM distribution\n    \n      ## if you change this FALSE to TRUE\n    ## this makes the dataset smaller - only 200 observations,\n    ## for quicker testing\n    if(FALSE) {\n        newN <- 20\n        oldN <- dim(y)[1]\n        set.seed(0)\n        indToKeep <- sample(1:oldN, size = newN, replace = FALSE)\n    }\n    \n    ## this removes fish that were only observed on the very last observation\n    if(TRUE) {\n        indToKeep <- which(first < ncol(y))\n        newN <- length(indToKeep)\n    }\n    \n    myConstants <- list(\n        N = newN,\n        T = myConstants0$T,\n        first = myConstants0$first[indToKeep],\n        last = myConstants0$last[indToKeep],\n        nRivers = myConstants0$nRivers,\n        cohort = myConstants0$cohort[indToKeep],\n        nCohorts = myConstants0$nCohorts,\n        #      season = myConstants$season,\n        #      flow = myConstants$flow[indToKeep,],\n        length = myConstants0$length[indToKeep],\n        alpha = myConstants0$alpha,\n        deltaProps = deltaProps\n    )\n    \n    myData <- list(\n        ##yCJS = myData0$yCJS[indToKeep,],\n        y = myData0$y[indToKeep,]\n    )\n    \n      initialValues <- function(){\n        list(\n            betaPhiRiver = array(runif(nRivers, 0, 1), c(nRivers)),\n            betaPhiRiverCohort = array(runif(nRivers * nCohorts, 0, 1), c(nRivers, nCohorts)),\n            betaPhi = array(rnorm(nRivers * (myConstants$T - 1) * nCohorts , 0, 1), c(nRivers, (myConstants$T - 1), nCohorts)),\n            \n            betaPRiver = array(runif(nRivers, 0, 1), c(nRivers)),\n            betaPRiverCohort = array(runif(nRivers * nCohorts, 0, 1), c(nRivers, nCohorts)),\n            betaP = array(rnorm(nRivers * (myConstants$T - 1) * nCohorts , 0, 1), c(nRivers, (myConstants$T - 1), nCohorts)),\n            \n            psi = getDirchPriorsR(nRivers, myConstants, nCohorts, alphaR)\n        )\n    }\n  \n    set.seed(0)\n    start = Sys.time()\n    \n    ## you'll get warnings that the data 'yCJS' is not used, and the 'z' initial\n    ## values are not in the model.  Those don't cause any problems,\n    ## and let us use the same myData and initialValue() for both models.\n    system.time(\n        Rmodel <- nimbleModel(\n            code = hmm.phiT_pT_psiT_DHMM_dirch,\n            constants = myConstants,\n            data = myData,              \n            inits = initialValues(),\n            calculate = FALSE\n        )\n    )\n    \n    #Rmodel$calculate()\n    \n    parametersToSave <- c(\"betaPhi\", \"betaPhiRiver\", \"betaPhiRiverCohort\", \n                          \"betaP\",   \"betaPRiver\",   \"betaPRiverCohort\",\n                          \"betaPhiOut\", \"betaPhiRiverOut\", \"betaPhiRiverCohortOut\", \n                          \"betaPOut\",   \"betaPRiverOut\",   \"betaPRiverCohortOut\",\n                          \n                          \"psi\"\n                          )\n    \n    nIter <- 15000 #30000\n    nBurnin <- 5000 #15000\n    nChains <- 2\n    thinRate <- 5\n    \n    rm(conf, Rmcmc, Cmodel, Cmcmc) # so old versions don't run if there is an error in an earlier step\n    system.time(\n        conf <- configureMCMC(\n            Rmodel,\n            monitors = parametersToSave\n        )\n    )\n    \n    Rmcmc <- buildMCMC(conf, useConjugacy = FALSE)\n    Cmodel <- compileNimble(Rmodel)\n    Cmcmc <- compileNimble(Rmcmc, project = Rmodel)\n    \n    mcmc.phiT_pT_psiT_DHMM_dirch <- runMCMC(\n        Cmcmc, \n        niter = nIter, \n        nburnin = nBurnin, \n        thin = thinRate, \n        nchains = nChains\n    )\n    \n    end <- Sys.time()\n    elapsed_phiT_pT_psiT_DHMM_dirch <- end - start\n    toSave <- list(\n        mcmc = mcmc.phiT_pT_psiT_DHMM_dirch, \n        elapsed = elapsed_phiT_pT_psiT_DHMM_dirch,\n        name = \"phiT_pT_psiT_DHMM_dirch\",\n        myConstants = myConstants, \n        nIter = nIter, \n        nBurnin = nBurnin,\n        thinRate = thinRate, \n        nSeasons = nSeasons, \n        nCohorts = nCohorts,\n        nChains = nChains\n    )\n    \n      save(toSave, file = paste0('./models/cmrFlow4rivers/runsOut/mcmc_phiT_pT_psiT_DHMM_dirch_', substr(end,1,13), '.RData'))\n      save(toSave, file = './models/cmrFlow4rivers/runsOut/mcmc_phiT_pT_psiT_DHMM_dirch_mostRecent.RData')\n  \n    # conduct more runs, will need to save into 'toSave'   \n    # Cmcmc$run(5000, reset = FALSE)  \n      \n  } else {\n    load('./models/cmrFlow4rivers/runsOut/mcmc_phiT_pT_psiT_DHMM_dirch_mostRecent.RData')\n  }\n    \n} else {\n  load('./models/cmrFlow4rivers/runsOut/fromWorkbench/rstudio-export/mcmc_phiT_pT_psiT_DHMM_dirch_mostRecent.RData')\n}"
  }
]
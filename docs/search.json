[
  {
    "objectID": "modelGrowthInMass.html#get-data",
    "href": "modelGrowthInMass.html#get-data",
    "title": "13  Growth in mass",
    "section": "13.1 Get data",
    "text": "13.1 Get data\n\n13.1.1 Get electrofishing data\n\n\nCode\ncd <- tar_read(cdWB_electro_target)\n\n\n\n\n13.1.2 Get environmental data\n\n\nCode\nenvIn <- tar_read(envDataWB_Target)"
  },
  {
    "objectID": "modelGrowthInMass.html#examine-raw-data",
    "href": "modelGrowthInMass.html#examine-raw-data",
    "title": "13  Growth in mass",
    "section": "13.2 Examine raw data",
    "text": "13.2 Examine raw data\n\n13.2.1 Limit data to consecutive sample captures (cd1)\nPrevious growth models with length used all possible observations for a fish and interpolated missing observations. Here, we are just looking at consecutive captures to estimate growth over just that interval.\n\n\nCode\n# table(as.numeric(cd$sampleNumber), as.numeric(cd$lagSampleNumber), cd$season, cd$year) |> \n#   data.frame() |> \n#   filter(Freq > 0) |> \n#   arrange(Var1, Var2) |> \n#   rename(firstCapt = Var1, secondCapt = Var2, season = Var3, year = Var4) |> \n#   filter(year == 2010)\n\n`%notin%` <- Negate(`%in%`)\n\ncd1 <- cd |> \n  filter(sampleNumberDiff == 1,\n         tag %notin% c('1bf20ff490', '1bf20ebe4e')) |> \n  mutate(negGrowth = grWeight < 0,\n         month = month(date))\n\n\n\n\n13.2.2 Find outlier growth rates\n\n13.2.2.1 Negative outlier growth\n1bf20ebe4e and 1bf20ff490 have incorrect weights leading to very negative growth rates.\nExclude these tags above. The rest of the quite negative growth fish seem plausible (remember we can’t account for stomach contents or egg loss).\n\n\nCode\ncd |> \n  arrange(grWeightS) |> \n  dplyr::select(tag, species, season, sampleNumber, lagSampleNumber, observedWeight, lagObservedWeight, grWeightS)\n\n\n# A tibble: 24,304 × 8\n   tag        species season sampleNumber lagSampleNu…¹ obser…² lagOb…³ grWeig…⁴\n   <chr>      <chr>    <dbl>        <dbl>         <dbl>   <dbl>   <dbl>    <dbl>\n 1 1bf20ebe4e bnt          3           55            56    46.5     4.3 -0.0320 \n 2 257c67e414 bkt          3           59            60     7.3     4.4 -0.00414\n 3 1bf0fec291 bkt          3           27            28     2.7     1.6 -0.00409\n 4 1bf20ff490 bnt          2           54            55   167.     41.8 -0.00378\n 5 257c67b532 bnt          3           63            64    34      25.5 -0.00371\n 6 00088d1ad4 bnt          3           63            64     4.5     3.6 -0.00330\n 7 257c67db60 bnt          3           63            64    24.2    19.5 -0.00317\n 8 00088d0b59 bnt          3           63            64     3.7     3   -0.00314\n 9 414b684955 ats          3           15            16     5.7     4.3 -0.00289\n10 0009f6ec56 bkt          3           75            76     3.5     2.7 -0.00288\n# … with 24,294 more rows, and abbreviated variable names ¹​lagSampleNumber,\n#   ²​observedWeight, ³​lagObservedWeight, ⁴​grWeightS\n\n\n\n\n13.2.2.2 Positive outlier growth\nLots of very fast growth mostly in the spring. No clear way to exclude fish.\n\n\nCode\ncd1 |> \n  arrange(desc(grWeightS)) |> \n  dplyr::select(tag, species, season, sampleNumber, lagSampleNumber, observedWeight, lagObservedWeight, grWeightS) |> \n  print(n = 20)\n\n\n# A tibble: 24,299 × 8\n   tag        species season sampleNumber lagSampleNum…¹ obser…² lagOb…³ grWei…⁴\n   <chr>      <chr>    <dbl>        <dbl>          <dbl>   <dbl>   <dbl>   <dbl>\n 1 1bf1020623 bkt          1           29             30     1.3    14.4  0.0199\n 2 0009f6eef4 bkt          1           77             78     2.3    10.3  0.0160\n 3 413f4b1845 ats          1           13             14     1.8     8.3  0.0152\n 4 1bf16366cf bnt          1           33             34     2      10.7  0.0142\n 5 410a015165 ats          1           13             14     2.1     9.3  0.0142\n 6 00088d2d2c bkt          1           73             74     1.8     9.2  0.0141\n 7 410a0f0653 ats          1           13             14     2.2    10.9  0.0138\n 8 1bf18b7637 bkt          1           33             34     2.5    13.2  0.0137\n 9 1bf20e4e30 bnt          1           53             54     2.3    12.1  0.0137\n10 1bf1930917 ats          1           37             38     1.9    11.7  0.0136\n11 411a356c36 ats          1           17             18     2       7.8  0.0136\n12 413d675356 ats          1           13             14     2.2    10.3  0.0134\n13 41096c506c ats          1           13             14     2.5    10.4  0.0133\n14 1bf18b7083 bkt          1           33             34     2.3    10.7  0.0133\n15 41097c2230 ats          1           13             14     2.4    11.6  0.0132\n16 1bf18b6cc8 ats          1           33             34     2.7    17    0.0132\n17 410a043a56 ats          1           13             14     2.6    13.2  0.0130\n18 4109740f1b ats          1           13             14     2.4    11.3  0.0130\n19 1bf17f0114 bkt          1           33             34     2.3    10.5  0.0130\n20 1bf18b8453 bkt          1           33             34     2.3    10.1  0.0129\n# … with 24,279 more rows, and abbreviated variable names ¹​lagSampleNumber,\n#   ²​observedWeight, ³​lagObservedWeight, ⁴​grWeightS\n\n\n\n\n\n13.2.3 Raw length, weight data graphs\n\n13.2.3.1 Distribution of growth rates\n\n\nCode\nggplot(cd1, aes(grWeight, color = factor(species))) +\n  geom_freqpoly(bins = 100) +\n  facet_wrap(~season)\n\n\n\n\n\n\n\n\n13.2.4 Length vs weight by species\nVery few outliers\n\n\nCode\nggplot(cd1 |> filter(species == \"bkt\"), aes(observedLength, observedWeight)) +\n  geom_point(alpha = 0.5, size = 1) +\n  scale_x_log10() +\n  scale_y_log10() +\n  ggtitle(\"Brook trout\") +\n  facet_grid(river~year, scales = 'free')\n\n\n\n\n\nCode\nggplot(cd1 |> filter(species == \"bnt\"), aes(observedLength, observedWeight)) +\n  geom_point(alpha = 0.5, size = 1) +\n  scale_x_log10() +\n  scale_y_log10() +\n  ggtitle(\"Brown trout\") +\n  facet_grid(river~year, scales = 'free')\n\n\n\n\n\nCode\nggplot(cd1 |> filter(species == \"ats\"), aes(observedLength, observedWeight)) +\n  geom_point(alpha = 0.5, size = 1) +\n  scale_x_log10() +\n  scale_y_log10() +\n  ggtitle(\"Atlantic salmon\") +\n  facet_grid(river~year, scales = 'free')\n\n\n\n\n\n\n\n13.2.5 Weight vs weight at next sample\n\n\nCode\nggplot(cd1 |> filter(species == \"bkt\"), aes(observedWeight, lagObservedWeight, color = factor(season))) +\n  geom_point(alpha = 0.15) +\n  guides(color = guide_legend(override.aes = list(alpha = 1))) +\n  ggtitle(\"Brook trout\") +\n  facet_wrap(~river, scales = 'free')\n\n\n\n\n\nCode\nggplot(cd1 |> filter(species == \"bnt\", river != \"wb mitchell\"), aes(observedWeight, lagObservedWeight, color = factor(season))) +\n  geom_point(alpha = 0.15) +\n  guides(color = guide_legend(override.aes = list(alpha = 1))) +\n  ggtitle(\"Brown trout\") +\n  facet_wrap(~river, scales = 'free')\n\n\n\n\n\nCode\nggplot(cd1 |> filter(species == \"ats\", river ==\"west brook\"), aes(observedWeight, lagObservedWeight, color = factor(season))) +\n  geom_point(alpha = 0.15) +\n  guides(color = guide_legend(override.aes = list(alpha = 1))) +\n  ggtitle(\"Atlantic salmon\") +\n  facet_wrap(~river, scales = 'free')"
  },
  {
    "objectID": "modelGrowthInMass.html#two-growth-models",
    "href": "modelGrowthInMass.html#two-growth-models",
    "title": "13  Growth in mass",
    "section": "13.3 Two growth models",
    "text": "13.3 Two growth models\n\n13.3.1 Size-adjusted growth model\n\n13.3.1.1 Get l-w relationships for size-adjusted growth model\nHere, we will explore size-independent growth in mass, see Sigourney, D. B., B H Letcher, M. Obedzinski, and R. A. Cunjak. “Size-Independent Growth in Fishes: Patterns, Models and Metrics.” Journal of Fish Biology 72, no. 10 (2008): 2435–55. https://doi.org/10.1111/j.1095-8649.2008.01830.x. Size-independent growth (grWeightS) is calculated in getDataElectro_targets.R file using addSizeIndGrowthWeight().\ngrWeightS uses the slope of log(observedWeight) ~ log(grWeight) for each river and season and species to adjust growth.\nA simple linear models shows we need to get separate slopes for each river and season and species.\n\n\nCode\nggplot(cd1 |> filter(grWeight > 0), \n       aes(log(observedWeight), log(grWeight), color = river)) +\n  geom_point(alpha = 0.05)  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  facet_grid(season~species)\n\n\n\n\n\nCode\nmod0 <- lm(log(grWeight) ~ log(observedWeight), data = cd1 |> filter(grWeight > 0))\nmod1 <- lm(log(grWeight) ~ log(observedWeight) * river, data = cd1 |> filter(grWeight > 0))\nmod2 <- lm(log(grWeight) ~ log(observedWeight) * river * factor(season), data = cd1 |> filter(grWeight > 0))\nmod3 <- lm(log(grWeight) ~ log(observedWeight) * factor(season), data = cd1 |> filter(grWeight > 0))\nmod4 <- lm(log(grWeight) ~ log(observedWeight) * river * factor(season) * species, data = cd1 |> filter(grWeight > 0))\n\nAIC(mod0,mod1,mod2,mod3,mod4) |> arrange(AIC)\n\n\n     df      AIC\nmod4 73 43939.97\nmod2 33 47554.54\nmod3  9 48050.71\nmod1  9 64666.62\nmod0  3 64751.39\n\n\n\n\n\n13.3.2 Compare size-adjusted and instantaneous growth\nDifferences don’t seem big enough to warrant the extra complexity from the s-adjusted growth metric\n\n\nCode\nggplot(cd1, aes(grWeight, grWeightS, color = river)) +\n  geom_point(alpha = 0.05)  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_abline(intercept = 0, slope = 1) +\n  facet_grid(season~species)\n\n\n\n\n\nCode\nggplot(cd1 |> \n         dplyr::select(observedWeight, grWeight, grWeightS, season, species) |> \n         pivot_longer(cols = c(grWeight, grWeightS)),\n       \n       aes(log(observedWeight), value, color = name)) +\n  geom_point(alpha = 0.05 )  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  scale_y_continuous(\"Growth rate\") +\n  facet_grid(season~species)"
  },
  {
    "objectID": "modelGrowthInMass.html#compare-growth-in-length-and-mass",
    "href": "modelGrowthInMass.html#compare-growth-in-length-and-mass",
    "title": "13  Growth in mass",
    "section": "13.4 Compare growth in length and mass",
    "text": "13.4 Compare growth in length and mass\n\n13.4.1 Growth rate in length vs size-independent growth rate in mass\n\n\nCode\nggplot(cd1, aes(grLength, grWeightS)) +\n  geom_point(aes(size = observedWeight), alpha = 0.02) +\n  guides(size = guide_legend(override.aes = list(alpha = 1))) +\n  facet_grid(season~species)\n\n\n\n\n\n\n\n13.4.2 Growth rate in length vs ‘instantaneous’ growth rate in mass\n\n\nCode\nggplot(cd1, aes(grLength, grWeight)) +\n  geom_point(aes(size = observedWeight), alpha = 0.02) +\n  guides(size = guide_legend(override.aes = list(alpha = 1))) +\n  facet_grid(season~species)\n\n\n\n\n\nCode\nggplot(cd1 |> filter(species==\"bnt\", season ==2), aes(grLength, grWeight, color = factor(year))) +\n  geom_point( alpha = 1) +\n  geom_smooth(method=\"lm\", se=FALSE) +\n  guides(size = guide_legend(override.aes = list(alpha = 1))) \n\n\n\n\n\nCode\n#  facet_wrap(~year)"
  },
  {
    "objectID": "modelGrowthInMass.html#flow-and-temperature-growth-models",
    "href": "modelGrowthInMass.html#flow-and-temperature-growth-models",
    "title": "13  Growth in mass",
    "section": "13.5 Flow and temperature growth models",
    "text": "13.5 Flow and temperature growth models\n\n13.5.1 Mean flow effect on growth?\nMaybe in Jimmy for bnt, or for ats\n\n\nCode\nggplot(cd1, aes(meanFlow, grWeight, color = river)) +\n  geom_point(alpha = 0.05)  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  facet_grid(season~species, scales = 'free')\n\n\n\n\n\nFall season only\n\n\nCode\nggplot(cd1 |> filter(season == 3), aes(meanFlow, grWeight, color = river)) +\n  geom_point(alpha = 0.1)  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  facet_grid(season~species, scales = 'free')\n\n\n\n\n\n\n\n13.5.2 Mean temperature effect on growth?\nMaybe in Jimmy for bnt, or for ats\n\n\nCode\nggplot(cd1, aes(meanTemperature, grWeight, color = river)) +\n  geom_point(alpha = 0.05)  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  facet_grid(season~species, scales = 'free')\n\n\n\n\n\nCode\nggplot(cd1 |> filter(species == 'bkt'), aes(meanTemperature, grWeight, color = river)) +\n  geom_point(alpha = 0.1)  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  ggtitle('Species = brook trout') +\n  facet_wrap(~season, scales = 'free')\n\n\n\n\n\nCode\nggplot(cd1 |> filter(species == 'bnt'), aes(meanTemperature, grWeight, color = river)) +\n  geom_point(alpha = 0.1)  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  ggtitle('Species = brown trout') +\n  facet_wrap(~season, scales = 'free')\n\n\n\n\n\nCode\nggplot(cd1 |> filter(species == 'ats'), aes(meanTemperature, grWeight, color = river)) +\n  geom_point(alpha = 0.1)  +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  ggtitle('Species = Atlantic salmon') +\n  facet_wrap(~season, scales = 'free')"
  },
  {
    "objectID": "modelGrowthInMass.html#negative-vs-positive-growth",
    "href": "modelGrowthInMass.html#negative-vs-positive-growth",
    "title": "13  Growth in mass",
    "section": "13.6 Negative vs positive growth",
    "text": "13.6 Negative vs positive growth\n\n13.6.1 Proportion of fish with negative growth by species/river/season\n\n\nCode\nggplot(cd1, aes(negGrowth)) +\n  geom_bar() +\n  facet_grid(season~species+river, scales = \"free\")\n\n\n\n\n\nCode\npropNegSRS <- cd1 |> \n  group_by(species, river, season) |> \n  summarize(numNeg = sum(negGrowth, na.rm = TRUE),\n            n = n()\n            ) |> \n  mutate(numPos = n - numNeg,\n         propPos = numPos/n,\n         propNeg = numNeg/n)\n\nggplot(propNegSRS |> filter(n > 50), aes(season, propNeg, color = river)) +\n  geom_point(aes(size = n)) +\n  geom_line() +\n  scale_y_continuous(\"Proportion of fish with negative growth in mass\") +\n  facet_wrap(~species)\n\n\n\n\n\n\n\n13.6.2 Proportion of fish with negative growth by species/river/sampleNumber\nBreak down season by year\n\n\nCode\npropNegSRsN <- cd1 |> \n  group_by(species, river, sampleNumber, season, year) |> \n  summarize(numNeg = sum(negGrowth, na.rm = TRUE),\n            n = n(),\n            mT = mean(meanTemperature, na.rm = TRUE),\n            mF = mean(meanFlow, na.rm = TRUE)\n            ) |> \n  mutate(numPos = n - numNeg,\n         propPos = numPos/n,\n         propNeg = numNeg/n) |> \n  ungroup()\n\nggplot(propNegSRsN |> filter(n > 10), aes(year, propNeg, color = river)) +\n  geom_point(aes(size = n)) +\n  geom_line() +\n  scale_y_continuous(\"Proportion of fish with negative growth in mass\") +\n  facet_grid(season~species)"
  },
  {
    "objectID": "modelGrowthInMass.html#environmental-effects-on-proportion-of-fish-with-negative-growth",
    "href": "modelGrowthInMass.html#environmental-effects-on-proportion-of-fish-with-negative-growth",
    "title": "13  Growth in mass",
    "section": "13.7 Environmental effects on proportion of fish with negative growth",
    "text": "13.7 Environmental effects on proportion of fish with negative growth\n\n13.7.1 Proportion of fish with negative growth by flow\n\n\nCode\nggplot(propNegSRsN |> filter(n > 10), aes(mF, propNeg, color = river)) +\n  geom_point(aes(size = n)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  scale_y_continuous(\"Proportion of fish with negative growth in mass\") +\n  scale_x_continuous(\"Mean Flow\") +\n  facet_grid(season~species)\n\n\n\n\n\n\n\n13.7.2 Proportion of fish with negative growth by temperature\n\n\nCode\nggplot(propNegSRsN |> filter(n > 10), aes(mT, propNeg, color = river)) +\n  geom_point(aes(size = n)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  scale_y_continuous(\"Proportion of fish with negative growth in mass\") +\n  scale_x_continuous(\"Mean Temperature\") +\n  facet_grid(season~species, scales = \"free\")\n\n\n\n\n\nRotate graph so we can have free scales for each season\n\n\nCode\nggplot(propNegSRsN |> filter(n > 10), aes(mT, propNeg, color = river)) +\n  geom_point(aes(size = n)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  scale_y_continuous(\"Proportion of fish with negative growth in mass\") +\n  scale_x_continuous(\"Mean Temperature\") +\n  facet_grid(species~season, scales = \"free\")\n\n\n\n\n\n\n\n13.7.3 F/T cycle graphs\n\n\nCode\nggplot(propNegSRsN |> filter(n > 10), aes(mT, mF, color = factor(season))) +\n  geom_point() +\n  facet_wrap(~river)\n\n\n\n\n\n\n\nCode\nggplot(propNegSRsN |> filter(n > 10, river == 'west brook') |> arrange(river, species, year, season), aes(mT, mF)) +\n  geom_line() +\n  geom_point(aes(color = factor(season))) +\n  facet_wrap(~year)\n\n\n\n\n\n\n\nCode\nenvIn_propNeg <- envIn |> \n  left_join(propNegSRsN |> dplyr::select(river, year, season, propNeg)) |> \n  mutate(yearSeason = paste(year, season, sep = \"_\"))\n\n\n\n\nCode\nggplot(envIn |> filter(river == \"west brook\", year %in% c(2000:2017)), \n       aes(temperature, log10(flowByRiverm3s), color = season, group = season)) +\n  geom_point() +\n  geom_smooth(se = FALSE) +\n  #geom_line() +\n  ggtitle(\"West Brook\") +\n  facet_wrap(~year, scales = 'free')\n\n\n\n\n\nCode\nggplot(envIn_propNeg |> filter(river == \"west brook\", year %in% c(2000:2017), !is.na(season)), \n       aes(temperature, log10(flowByRiverm3s), \n           color = factor(year), group = year\n           )\n       ) +\n  #geom_point() +\n  geom_smooth(se = FALSE) +\n  ggtitle(\"West Brook\") +\n  facet_wrap(~season, scales = 'free')\n\n\n\n\n\nCode\nggplot(envIn_propNeg |> filter(river == \"west brook\", year %in% c(2000:2017), !is.na(season)), \n       aes(temperature, log10(flowByRiverm3s) \n         #  color = factor(year), group = year\n           )\n       ) +\n  #geom_point() +\n  geom_smooth(aes(linewidth = (propNeg + 0.1), group = propNeg), se = FALSE) +\n  #geom_line() +\n  ggtitle(\"West Brook\") +\n  facet_wrap(~season, scales = 'free')\n\n\n\n\n\n\n\nCode\nggplot(propNegSRsN |> filter(n > 10, river==\"west brook\", species == \"bkt\"), \n       aes(year, propNeg, color = factor(season))) +\n  geom_point(aes(size = n)) +\n  geom_line() +\n  ggtitle(\"West brook\") +\n  scale_y_continuous(\"Proportion of fish with negative growth in mass\") \n\n\n\n\n\nCode\n  #facet_wrap(~season)\n\n\n\n\nCode\nggplot(propNegSRsN |> filter(n > 10, river==\"west brook\", species == \"bkt\"), aes(year, propNeg, color = factor(season))) +\n  geom_point(aes(size = n)) +\n  geom_line() +\n  ggtitle(\"West brook\") +\n  scale_y_continuous(\"Proportion of fish with negative growth in mass\") \n\n\n\n\n\nCode\nggplot(propNegSRsN |> filter(n > 10, river==\"wb obear\", species == \"bkt\"), aes(year, propNeg, color = factor(season))) +\n  geom_point(aes(size = n)) +\n  geom_line() +\n  ggtitle(\"O'Bear\") +\n  scale_y_continuous(\"Proportion of fish with negative growth in mass\")"
  },
  {
    "objectID": "modelGrowthInMass.html#logistic-models-for-environmental-effects-on-propneg",
    "href": "modelGrowthInMass.html#logistic-models-for-environmental-effects-on-propneg",
    "title": "13  Growth in mass",
    "section": "13.8 Logistic models for environmental effects on propNeg",
    "text": "13.8 Logistic models for environmental effects on propNeg\n\n13.8.1 Standardize flow and temperature\n\n\nCode\n# getZ <- function(d){\n#   list(\n#     mean = mean(d, na.rm = TRUE),\n#     sd = sd(d, na.rm = TRUE)\n#   )\n# }\n# fZ <- getZ(cd1$meanFlow)\n# fT <- getZ(cd1$meanTemperature)\n\nz <- cd1 |> \n  group_by(season) |> \n  summarize(fZMean = mean(meanFlow, na.rm = TRUE),\n            fZSd = sd(meanFlow, na.rm = TRUE),\n            fTMean = mean(meanTemperature, na.rm = TRUE),\n            fTSd = sd(meanTemperature, na.rm = TRUE)\n            )\n\ncd1 <- cd1 |> \n  left_join(z) |> \n  mutate(meanFlowZ = (meanFlow - fZMean)/fZSd,\n         meanTempZ = (meanTemperature - fTMean)/fTSd)\n\n\n\n\n13.8.2 Raw data with logistic fit for flow effect\n\n\nCode\nggplot(cd1 |> filter(!is.na(negGrowth)), aes(meanFlowZ, negGrowth * 1, color = river)) +\n  geom_point(alpha = 0.1) +\n  geom_smooth(method = \"glm\", \n              method.args = list(family = \"binomial\"),\n              se = FALSE) +\n  labs(y = \"Probability of negative growth in mass\", x = \"Mean flow\") +\n  facet_grid(season~species)\n\n\n\n\n\nCode\nggplot(cd1 |> filter(!is.na(negGrowth)), aes(meanFlowZ, negGrowth * 1, color = river)) +\n  geom_point(alpha = 0.1) +\n  geom_smooth(method = \"glm\", \n              method.args = list(family = \"binomial\"),\n              se = FALSE) +\n  labs(y = \"Probability of negative growth in mass\", x = \"Mean flow\") +\n  facet_grid(season~species+river)\n\n\n\n\n\n\n\n13.8.3 Raw data with logistic fit for temperature effect\n\n\nCode\nggplot(cd1 |> filter(!is.na(negGrowth), meanTempZ > -4), aes(meanTempZ, negGrowth * 1, color = river)) +\n  geom_point(alpha = 0.1) +\n  geom_smooth(method = \"glm\", \n              method.args = list(family = \"binomial\"),\n              se = FALSE) +\n  labs(y = \"Probability of negative growth in mass\", x = \"Mean temperature\") +\n  facet_grid(season~species)"
  },
  {
    "objectID": "modelGrowthInMass.html#logistic-model-for-flow-and-temperature-one-species-at-a-time",
    "href": "modelGrowthInMass.html#logistic-model-for-flow-and-temperature-one-species-at-a-time",
    "title": "13  Growth in mass",
    "section": "13.9 Logistic model for flow and temperature, one species at a time",
    "text": "13.9 Logistic model for flow and temperature, one species at a time\nSpecies occupy different rivers, so an all-species model will have unequal river representation across species and don’t need to predict where species are not.\nNeed to think through whether these models make sense…\n\n\nCode\nrunSppModels <- function(d, speciesIn) {\n  models =\n    tibble(model = \n      c(\n          'negGrowth ~ meanFlowZ * meanTempZ * river',\n          'negGrowth ~ meanFlowZ * meanTempZ + river',\n          'negGrowth ~ meanFlowZ + meanTempZ + river', \n          \n          'negGrowth ~ meanFlowZ * meanTempZ' , \n          \n          'negGrowth ~ meanFlowZ * meanTempZ * river * factor(season)',\n          \n          'negGrowth ~ meanFlowZ + meanTempZ * river * factor(season)', \n          \n          'negGrowth ~ meanFlowZ * meanTempZ * river * factor(season) * observedWeight' \n        )\n    ) |>\n    mutate(\n      fit = map(model, ~glm(.x, family = \"binomial\", data = d |> filter(species == speciesIn))),\n      glanced = map(fit, broom::glance),\n      tidied = map(fit, broom::tidy)\n    )\n  return(models)\n}\n\n\n\n13.9.1 Predict p(neg growth in mass)\n\n\nCode\npredictSpp <- function(dIn, modIn, speciesIn){\n  d <- dIn |> filter(species == speciesIn)\n  \n  byAIC = modIn |> \n    unnest(glanced) |>\n    arrange(AIC) |>\n    dplyr::select(model, AIC, df.residual, fit, tidied)\n  \n  predDSpp <- expand.grid(\n    meanFlowZ = seq(-1.5,1.5,0.25), \n    meanTempZ = seq(-1.5,1.5,0.25), \n    river = unique(d$river), \n    season = unique(d$season),\n    observedWeight = seq(min(d$observedWeight, na.rm = TRUE), max(d$observedWeight, na.rm = TRUE), 40)\n    )\n  \n  \n  pred <- add_column(predDSpp, \n                        pred = predict.glm(byAIC[1,]$fit[[1]], predDSpp, type = \"response\")) |> \n             mutate(groupT = paste(river, season, meanTempZ, sep = \"_\"),\n                    groupF = paste(river, season, meanFlowZ, sep = \"_\"))\n  return(\n    list(\n      pred = pred,\n      byAIC = byAIC\n      )\n  )\n}   \n\n\n\n\n13.9.2 Brook trout\n\n\nCode\nspeciesIn <- \"bkt\"\nmodBKT <- runSppModels(cd1, speciesIn)\npredBKT <- predictSpp(cd1, modBKT, speciesIn)\n\n\nggplot(predBKT$pred |> filter(meanTempZ %in% c(-1.5,0,1.5), meanFlowZ %in% c(-1.5,0,1.5)), aes(observedWeight, pred, group = groupF)) +\n  geom_line(aes(color = factor(meanFlowZ))) +\n  labs(y = \"Probability of negative growth in mass\", x = \"Body mass (mg)\") +\n  facet_grid(season~river+meanTempZ)\n\n\n\n\n\n\n\n13.9.3 Brown trout\n\n\nCode\nspeciesIn <- \"bnt\"\n\nmodBNT <- runSppModels(cd1, speciesIn)\npredBNT <- predictSpp(cd1, modBNT, speciesIn)\n\n\nggplot(predBNT$pred |> filter(meanTempZ %in% c(-1.5,0,1.5), meanFlowZ %in% c(-1.5,0,1.5)), aes(observedWeight, pred, group = groupF)) +\n  geom_line(aes(color = factor(meanFlowZ))) +\n  labs(y = \"Probability of negative growth in mass\", x = \"Body mass (mg)\") +\n  facet_grid(season~river+meanTempZ)\n\n\n\n\n\n\n\n13.9.4 Atlantic salmon\n\n\nCode\nspeciesIn <- \"ats\"\n\nmodATS <- runSppModels(cd1, speciesIn)\npredATS <- predictSpp(cd1, modATS, speciesIn)\n\n\nggplot(predATS$pred |> filter(meanTempZ %in% c(-1.5,0,1.5), meanFlowZ %in% c(-1.5,0,1.5)), aes(observedWeight, pred, group = groupF)) +\n  geom_line(aes(color = factor(meanFlowZ))) +\n  labs(y = \"Probability of negative growth in mass\", x = \"Body mass (mg)\") +\n  facet_grid(season~river+meanTempZ)\n\n\n\n\n\n\n\n13.9.5 Pairs plots"
  },
  {
    "objectID": "modelGrowthInMass.html#deprecated-logistic-models-below",
    "href": "modelGrowthInMass.html#deprecated-logistic-models-below",
    "title": "13  Growth in mass",
    "section": "13.10 Deprecated logistic models below",
    "text": "13.10 Deprecated logistic models below"
  },
  {
    "objectID": "modelGrowthInMass.html#logistic-model-for-flow-and-temperature-all-species",
    "href": "modelGrowthInMass.html#logistic-model-for-flow-and-temperature-all-species",
    "title": "13  Growth in mass",
    "section": "13.11 Logistic model for flow and temperature, all species",
    "text": "13.11 Logistic model for flow and temperature, all species\n\n13.11.1 Model selection\n\n\nCode\nmodSpecies <- c(\"bkt\", \"ats\", \"bnt\")\ncd1Mod <- cd1 |> filter(species == modSpecies)\n\nmodFT0 <- glm(negGrowth ~ meanFlowZ * meanTempZ * river * species, family = \"binomial\", data = cd1Mod)\nmodFT1 <- glm(negGrowth ~ meanFlowZ * meanTempZ * river + species, family = \"binomial\", data = cd1Mod)\nmodFT2 <- glm(negGrowth ~ meanFlowZ * meanTempZ + river + species, family = \"binomial\", data = cd1Mod)\nmodFT3 <- glm(negGrowth ~ meanFlowZ + meanTempZ + river + species, family = \"binomial\", data = cd1Mod)\nmodFT4 <- glm(negGrowth ~ meanFlowZ * meanTempZ + river , family = \"binomial\", data = cd1Mod)\nmodFT5 <- glm(negGrowth ~ meanFlowZ * meanTempZ + river , family = \"binomial\", data = cd1Mod)\nmodFT6 <- glm(negGrowth ~ meanFlowZ * meanTempZ + species , family = \"binomial\", data = cd1Mod)\nmodFT7 <- glm(negGrowth ~ meanFlowZ * meanTempZ, family = \"binomial\", data = cd1Mod)\n\n\nmodFT8 <- glm(negGrowth ~ meanFlowZ * meanTempZ * river * factor(season) + species, family = \"binomial\", data = cd1Mod)\nmodFT9 <- glm(negGrowth ~ meanFlowZ * meanTempZ * river * factor(season) * species, family = \"binomial\", data = cd1Mod)\nmodFT10 <- glm(negGrowth ~ meanFlowZ + meanTempZ * river * factor(season) * species, family = \"binomial\", data = cd1Mod)\n\nmodFT11 <- glm(negGrowth ~ meanFlowZ * meanTempZ * river * factor(season) * observedWeight + species, family = \"binomial\", data = cd1Mod)\nmodFT12 <- glm(negGrowth ~ meanFlowZ * meanTempZ * river * factor(season) * species * observedWeight, family = \"binomial\", data = cd1Mod)\n\nAIC(modFT0, modFT1,modFT2, modFT3,modFT4,modFT5, modFT6,modFT7,modFT8,modFT9,modFT10, modFT11, modFT12) |> arrange(AIC)\n\n\n         df        AIC\nmodFT11 130   4828.164\nmodFT8   66   5231.416\nmodFT1   18   6391.283\nmodFT0   36   6397.411\nmodFT2    9   6397.992\nmodFT6    6   6403.777\nmodFT3    8   6405.421\nmodFT4    7   6620.511\nmodFT5    7   6620.511\nmodFT7    4   6629.994\nmodFT12 261  90126.522\nmodFT9  136 100401.269\nmodFT10  71 113535.334\n\n\n\n\n13.11.2 Model results for additive model (not very good)\n\n\nCode\n# https://www.statology.org/logistic-regression-in-r/\n#summary(modFT3)\n#anova(modFT3)\n\npscl::pR2(modFT3)[\"McFadden\"]\n\n\nfitting null model for pseudo-r2\n\n\n  McFadden \n0.06214128 \n\n\nCode\ncaret::varImp(modFT3) |> arrange(desc(Overall))\n\n\n                   Overall\nspeciesbnt       12.871111\nmeanFlowZ        11.836474\nspeciesbkt        5.218343\nriverwb mitchell  3.040767\nmeanTempZ         2.465196\nriverwb obear     2.368152\nriverwest brook   1.643614\n\n\n\n\n13.11.3 Model results for full interactive model (best model)\n\n\nCode\n# https://www.statology.org/logistic-regression-in-r/\n#summary(modFT11)\n#anova(modFT11)\n\n# full interaction\npscl::pR2(modFT11)[\"McFadden\"]\n\n\nfitting null model for pseudo-r2\n\n\nMcFadden \n0.329471 \n\n\nCode\ncaret::varImp(modFT11) |> arrange(desc(Overall))\n\n\n                                                                         Overall\nspeciesbnt                                                          1.724156e+01\nspeciesbkt                                                          9.578247e+00\nriverwest brook                                                     6.258752e-03\nriverwest brook:factor(season)2                                     6.250339e-03\nriverwest brook:factor(season)3                                     6.239932e-03\nriverwest brook:factor(season)4                                     6.208515e-03\nriverwest brook:factor(season)4:observedWeight                      3.786506e-03\nriverwest brook:observedWeight                                      3.756629e-03\nriverwest brook:factor(season)2:observedWeight                      3.751758e-03\nriverwest brook:factor(season)3:observedWeight                      3.750670e-03\nmeanFlowZ:meanTempZ:riverwest brook:factor(season)3                 2.435455e-03\nmeanFlowZ:meanTempZ:riverwest brook                                 2.427086e-03\nmeanFlowZ:meanTempZ:riverwest brook:factor(season)2                 2.379320e-03\nmeanFlowZ:meanTempZ:riverwest brook:factor(season)4                 2.315902e-03\nmeanFlowZ:meanTempZ:riverwest brook:factor(season)2:observedWeight  1.731148e-03\nmeanFlowZ:meanTempZ:riverwest brook:factor(season)3:observedWeight  1.693015e-03\nmeanFlowZ:meanTempZ:riverwest brook:observedWeight                  1.677688e-03\nmeanFlowZ:meanTempZ:riverwest brook:factor(season)4:observedWeight  1.659787e-03\nmeanFlowZ:riverwest brook                                           1.594505e-03\nmeanFlowZ:riverwest brook:factor(season)4                           1.588976e-03\nmeanFlowZ:riverwest brook:factor(season)3                           1.579828e-03\nmeanFlowZ:riverwest brook:factor(season)2                           1.566087e-03\nmeanFlowZ:riverwest brook:factor(season)2:observedWeight            1.297681e-03\nmeanFlowZ:riverwest brook:factor(season)4:observedWeight            1.286764e-03\nmeanFlowZ:riverwest brook:factor(season)3:observedWeight            1.259321e-03\nmeanFlowZ:riverwest brook:observedWeight                            1.255746e-03\nmeanTempZ:riverwest brook:factor(season)2                           1.092213e-03\nmeanTempZ:riverwest brook                                           1.074680e-03\nmeanTempZ:riverwest brook:factor(season)3                           1.056160e-03\nmeanTempZ:riverwest brook:factor(season)4                           9.942500e-04\nmeanTempZ:riverwest brook:factor(season)3:observedWeight            9.746357e-04\nmeanTempZ:riverwest brook:factor(season)4:observedWeight            9.686650e-04\nmeanTempZ:riverwest brook:observedWeight                            9.667011e-04\nmeanTempZ:riverwest brook:factor(season)2:observedWeight            9.561087e-04\nfactor(season)2                                                     8.863375e-04\nfactor(season)3                                                     8.681221e-04\nfactor(season)4                                                     8.597991e-04\nmeanFlowZ:meanTempZ:riverwb mitchell:factor(season)2                1.512107e-04\nmeanFlowZ:meanTempZ:riverwb obear:factor(season)4:observedWeight    1.342146e-04\nriverwb mitchell:factor(season)4                                    1.267654e-04\nmeanFlowZ:meanTempZ:riverwb obear:factor(season)4                   1.060398e-04\nriverwb mitchell:factor(season)4:observedWeight                     1.010907e-04\nmeanFlowZ:meanTempZ:riverwb mitchell:factor(season)4                1.000620e-04\nmeanFlowZ:meanTempZ:riverwb mitchell:factor(season)4:observedWeight 8.075502e-05\nmeanFlowZ:meanTempZ:riverwb obear:factor(season)2                   7.516081e-05\nmeanFlowZ:meanTempZ:riverwb obear:factor(season)2:observedWeight    7.470611e-05\nmeanFlowZ:meanTempZ:riverwb mitchell:factor(season)2:observedWeight 7.148640e-05\nriverwb mitchell:factor(season)3                                    6.153447e-05\nmeanFlowZ:riverwb obear:factor(season)2                             5.222059e-05\nmeanFlowZ:riverwb mitchell:factor(season)2:observedWeight           4.923587e-05\nmeanFlowZ:meanTempZ:factor(season)2:observedWeight                  4.784910e-05\nmeanTempZ:riverwb obear:factor(season)4                             4.511330e-05\nmeanTempZ:riverwb obear:factor(season)4:observedWeight              4.348570e-05\nmeanTempZ:riverwb mitchell:factor(season)2                          4.110689e-05\nriverwb mitchell:factor(season)3:observedWeight                     3.942864e-05\nmeanFlowZ:meanTempZ:factor(season)2                                 3.928556e-05\nmeanFlowZ:factor(season)4:observedWeight                            3.891697e-05\nmeanFlowZ:factor(season)2:observedWeight                            3.832563e-05\nriverwb obear:factor(season)2                                       3.771589e-05\nmeanTempZ:riverwb mitchell:factor(season)4                          3.683344e-05\nriverwb obear:factor(season)3:observedWeight                        3.478327e-05\nmeanFlowZ:riverwb obear:factor(season)4                             3.306020e-05\nmeanFlowZ:meanTempZ:riverwb mitchell:factor(season)3:observedWeight 3.276077e-05\nmeanFlowZ:riverwb obear:factor(season)2:observedWeight              3.221078e-05\nmeanFlowZ:riverwb mitchell:factor(season)2                          2.907830e-05\nfactor(season)3:observedWeight                                      2.836871e-05\nmeanFlowZ:meanTempZ:riverwb mitchell:factor(season)3                2.643093e-05\nriverwb mitchell:factor(season)2                                    2.571385e-05\nmeanFlowZ:riverwb mitchell:factor(season)4                          2.465836e-05\nmeanFlowZ:meanTempZ:factor(season)4                                 2.409151e-05\nmeanFlowZ:riverwb mitchell:factor(season)4:observedWeight           2.101191e-05\nfactor(season)2:observedWeight                                      2.077892e-05\nmeanFlowZ:meanTempZ:factor(season)4:observedWeight                  2.054229e-05\nmeanTempZ:riverwb obear:factor(season)2                             1.671369e-05\nmeanFlowZ:factor(season)4                                           1.584970e-05\nriverwb obear:factor(season)3                                       1.478057e-05\nmeanTempZ:factor(season)4:observedWeight                            1.457490e-05\nmeanFlowZ:riverwb mitchell:factor(season)3                          1.356946e-05\nmeanFlowZ:meanTempZ:riverwb obear:factor(season)3:observedWeight    1.352772e-05\nmeanTempZ:factor(season)2:observedWeight                            1.311915e-05\nmeanTempZ:factor(season)4                                           1.253780e-05\nmeanTempZ:factor(season)3                                           1.199747e-05\nmeanFlowZ:meanTempZ:factor(season)3                                 1.186717e-05\nriverwb obear:factor(season)4                                       1.119500e-05\nmeanFlowZ:meanTempZ:riverwb obear:factor(season)3                   1.115532e-05\nmeanFlowZ:riverwb obear:factor(season)3                             1.081428e-05\nriverwb obear:factor(season)4:observedWeight                        8.747563e-06\nmeanFlowZ:riverwb mitchell:factor(season)3:observedWeight           8.276959e-06\nmeanFlowZ:meanTempZ:riverwb mitchell                                7.808426e-06\nmeanTempZ:riverwb mitchell:observedWeight                           7.729219e-06\nmeanFlowZ:riverwb obear:factor(season)4:observedWeight              7.654778e-06\nmeanFlowZ:meanTempZ:riverwb mitchell:observedWeight                 7.156913e-06\nmeanTempZ:riverwb mitchell:factor(season)2:observedWeight           6.958585e-06\nmeanTempZ:riverwb obear:factor(season)3                             6.760363e-06\nriverwb obear:factor(season)2:observedWeight                        6.514177e-06\nmeanTempZ:factor(season)3:observedWeight                            6.437914e-06\nmeanTempZ:riverwb obear:factor(season)3:observedWeight              6.122778e-06\nmeanTempZ:observedWeight                                            6.043743e-06\nriverwb mitchell:observedWeight                                     5.211127e-06\nriverwb mitchell:factor(season)2:observedWeight                     5.166369e-06\nmeanFlowZ:factor(season)3:observedWeight                            4.781577e-06\nmeanTempZ:factor(season)2                                           4.727616e-06\nmeanFlowZ:riverwb mitchell                                          4.094466e-06\nobservedWeight                                                      3.893763e-06\nmeanFlowZ:observedWeight                                            3.825481e-06\nmeanTempZ                                                           3.629231e-06\nmeanTempZ:riverwb obear:observedWeight                              3.401550e-06\nmeanTempZ:riverwb mitchell:factor(season)3:observedWeight           3.055419e-06\nmeanFlowZ:riverwb obear:factor(season)3:observedWeight              2.933116e-06\nmeanFlowZ:riverwb mitchell:observedWeight                           2.871728e-06\nmeanTempZ:riverwb obear:factor(season)2:observedWeight              2.519733e-06\nriverwb obear:observedWeight                                        2.458162e-06\nmeanTempZ:riverwb obear                                             2.409944e-06\nmeanTempZ:riverwb mitchell:factor(season)3                          2.201399e-06\nfactor(season)4:observedWeight                                      2.063375e-06\nmeanTempZ:riverwb mitchell:factor(season)4:observedWeight           2.028577e-06\nriverwb obear                                                       1.818350e-06\nmeanTempZ:riverwb mitchell                                          1.760005e-06\nmeanFlowZ:meanTempZ:observedWeight                                  1.698072e-06\nmeanFlowZ:riverwb obear:observedWeight                              1.645443e-06\nmeanFlowZ:meanTempZ                                                 1.212975e-06\nmeanFlowZ:factor(season)3                                           1.000376e-06\nriverwb mitchell                                                    9.267063e-07\nmeanFlowZ:meanTempZ:riverwb obear:observedWeight                    8.379480e-07\nmeanFlowZ:meanTempZ:factor(season)3:observedWeight                  8.238561e-07\nmeanFlowZ:meanTempZ:riverwb obear                                   7.049926e-07\nmeanFlowZ                                                           6.697925e-07\nmeanFlowZ:riverwb obear                                             3.745791e-07\nmeanFlowZ:factor(season)2                                           2.217086e-07\n\n\n\n\n13.11.4 Precict p(neg growth in mass)\n\n\nCode\npredD <- expand.grid(\n  meanFlowZ = seq(-1.5,1.5,0.25), \n  meanTempZ = seq(-1.5,1.5,0.25), \n  river = unique(cd1$river), \n  species = unique(cd1$species), \n  season = unique(cd1$season),\n  observedWeight = seq(min(cd1$observedWeight, na.rm = TRUE), max(cd1$observedWeight, na.rm = TRUE), 40)\n  )\n\n\npred <- add_column(predD, \n                   pred = predict.glm(modFT11, predD, type = \"response\")) |> \n        mutate(groupT = paste(river, species, season, meanTempZ, sep = \"_\"),\n               groupF = paste(river, species, season, meanFlowZ, sep = \"_\"))\n\n\n\n\n13.11.5 Plot predictions\n\n\nCode\nggplot(pred |> filter(meanTempZ %in% c(-1.5,0,1.5), observedWeight == 161.3), aes(meanFlowZ, pred, group= groupT)) +\n  geom_line(aes(color = factor(meanTempZ))) +\n  labs(y = \"Probability of negative growth in mass\", x = \"Mean flow\") +\n  facet_grid(season~species+river)"
  }
]
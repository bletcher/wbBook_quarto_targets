<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>West Brook story - 16&nbsp; Growth in mass</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./modelsCMR_NN_OB.html" rel="next">
<link href="./modelConditionFactor.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./modelYOY.html">General models</a></li><li class="breadcrumb-item"><a href="./modelGrowthInMass.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Growth in mass</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">West Brook story</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Targets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vizTargets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Visualize targets</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Get data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Get data info</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getDataEnv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Get environmental data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getDataElectro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Get electrofishing data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getDataCMR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Create Capture-Recapture data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getDataWanding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Get wanding data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getDataAntenna.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Get antenna data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataAll.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">All fish data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataFlow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Flow data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Flow by Area/River models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelGrowthFlowByRiver.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Growth in mass byRiver/byArea</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelsCMR_ft_cohort_Flow_OB.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Flow/survival models - O’Bear (IS) only</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelsCMR_ft_cohort_Flow_WB.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Survival by river/area</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">General models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelYOY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Young-of-year size model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelFlow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Flow model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelConditionFactor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Condition factor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelGrowthInMass.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Growth in mass</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Neural network/CMR model comparison - river 4 (IS) only</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelsCMR_NN_OB.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">CJS model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelsCMR_Growth_NN_OB.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">CJS - growth model</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#get-data" id="toc-get-data" class="nav-link active" data-scroll-target="#get-data"><span class="header-section-number">16.1</span> Get data</a>
  <ul class="collapse">
  <li><a href="#get-electrofishing-data" id="toc-get-electrofishing-data" class="nav-link" data-scroll-target="#get-electrofishing-data"><span class="header-section-number">16.1.1</span> Get electrofishing data</a></li>
  <li><a href="#get-environmental-data" id="toc-get-environmental-data" class="nav-link" data-scroll-target="#get-environmental-data"><span class="header-section-number">16.1.2</span> Get environmental data</a></li>
  </ul></li>
  <li><a href="#examine-raw-data" id="toc-examine-raw-data" class="nav-link" data-scroll-target="#examine-raw-data"><span class="header-section-number">16.2</span> Examine raw data</a>
  <ul class="collapse">
  <li><a href="#limit-data-to-consecutive-sample-captures-cd1" id="toc-limit-data-to-consecutive-sample-captures-cd1" class="nav-link" data-scroll-target="#limit-data-to-consecutive-sample-captures-cd1"><span class="header-section-number">16.2.1</span> Limit data to consecutive sample captures (cd1)</a></li>
  <li><a href="#find-outlier-growth-rates" id="toc-find-outlier-growth-rates" class="nav-link" data-scroll-target="#find-outlier-growth-rates"><span class="header-section-number">16.2.2</span> Find outlier growth rates</a></li>
  <li><a href="#numbers-of-observations-for-analysis" id="toc-numbers-of-observations-for-analysis" class="nav-link" data-scroll-target="#numbers-of-observations-for-analysis"><span class="header-section-number">16.2.3</span> Numbers of observations for analysis</a></li>
  <li><a href="#raw-length-weight-data-graphs" id="toc-raw-length-weight-data-graphs" class="nav-link" data-scroll-target="#raw-length-weight-data-graphs"><span class="header-section-number">16.2.4</span> Raw length, weight data graphs</a></li>
  <li><a href="#length-vs-weight-by-species" id="toc-length-vs-weight-by-species" class="nav-link" data-scroll-target="#length-vs-weight-by-species"><span class="header-section-number">16.2.5</span> Length vs weight by species</a></li>
  <li><a href="#weight-vs-weight-at-next-sample" id="toc-weight-vs-weight-at-next-sample" class="nav-link" data-scroll-target="#weight-vs-weight-at-next-sample"><span class="header-section-number">16.2.6</span> Weight vs weight at next sample</a></li>
  <li><a href="#growth-rate-pairs-plots" id="toc-growth-rate-pairs-plots" class="nav-link" data-scroll-target="#growth-rate-pairs-plots"><span class="header-section-number">16.2.7</span> Growth rate pairs plots</a></li>
  <li><a href="#growth-rate-in-length-vs-growth-rate-in-mass" id="toc-growth-rate-in-length-vs-growth-rate-in-mass" class="nav-link" data-scroll-target="#growth-rate-in-length-vs-growth-rate-in-mass"><span class="header-section-number">16.2.8</span> Growth rate in length vs growth rate in mass</a></li>
  </ul></li>
  <li><a href="#body-size-effect-on-prop-neg-growth" id="toc-body-size-effect-on-prop-neg-growth" class="nav-link" data-scroll-target="#body-size-effect-on-prop-neg-growth"><span class="header-section-number">16.3</span> Body size effect on prop neg growth</a></li>
  <li><a href="#flow-and-temperature-growth-relationships" id="toc-flow-and-temperature-growth-relationships" class="nav-link" data-scroll-target="#flow-and-temperature-growth-relationships"><span class="header-section-number">16.4</span> Flow and temperature growth relationships</a>
  <ul class="collapse">
  <li><a href="#mean-flow-effect-on-growth" id="toc-mean-flow-effect-on-growth" class="nav-link" data-scroll-target="#mean-flow-effect-on-growth"><span class="header-section-number">16.4.1</span> Mean flow effect on growth?</a></li>
  <li><a href="#mean-temperature-effect-on-growth" id="toc-mean-temperature-effect-on-growth" class="nav-link" data-scroll-target="#mean-temperature-effect-on-growth"><span class="header-section-number">16.4.2</span> Mean temperature effect on growth?</a></li>
  </ul></li>
  <li><a href="#proportion-of-fish-with-negative-growth" id="toc-proportion-of-fish-with-negative-growth" class="nav-link" data-scroll-target="#proportion-of-fish-with-negative-growth"><span class="header-section-number">16.5</span> Proportion of fish with <strong>negative growth</strong></a>
  <ul class="collapse">
  <li><a href="#proportion-of-observations-with-negative-growth-by-speciesriverseason" id="toc-proportion-of-observations-with-negative-growth-by-speciesriverseason" class="nav-link" data-scroll-target="#proportion-of-observations-with-negative-growth-by-speciesriverseason"><span class="header-section-number">16.5.1</span> Proportion of observations with negative growth by species/river/season</a></li>
  <li><a href="#proportion-of-observations-with-negative-growth-by-speciesseason" id="toc-proportion-of-observations-with-negative-growth-by-speciesseason" class="nav-link" data-scroll-target="#proportion-of-observations-with-negative-growth-by-speciesseason"><span class="header-section-number">16.5.2</span> Proportion of observations with negative growth by species/season</a></li>
  <li><a href="#proportion-of-observations-with-negative-growth-by-speciesriveryear" id="toc-proportion-of-observations-with-negative-growth-by-speciesriveryear" class="nav-link" data-scroll-target="#proportion-of-observations-with-negative-growth-by-speciesriveryear"><span class="header-section-number">16.5.3</span> Proportion of observations with negative growth by species/river/year</a></li>
  <li><a href="#proportion-of-observations-with-negative-growth-by-speciesriveryear-1" id="toc-proportion-of-observations-with-negative-growth-by-speciesriveryear-1" class="nav-link" data-scroll-target="#proportion-of-observations-with-negative-growth-by-speciesriveryear-1"><span class="header-section-number">16.5.4</span> Proportion of observations with negative growth by species/river/year</a></li>
  </ul></li>
  <li><a href="#negative-growth-by-individual" id="toc-negative-growth-by-individual" class="nav-link" data-scroll-target="#negative-growth-by-individual"><span class="header-section-number">16.6</span> Negative growth by individual</a></li>
  <li><a href="#environmental-effects-on-proportion-of-observations-with-negative-growth" id="toc-environmental-effects-on-proportion-of-observations-with-negative-growth" class="nav-link" data-scroll-target="#environmental-effects-on-proportion-of-observations-with-negative-growth"><span class="header-section-number">16.7</span> Environmental effects on Proportion of observations with negative growth</a>
  <ul class="collapse">
  <li><a href="#models-for-proportions" id="toc-models-for-proportions" class="nav-link" data-scroll-target="#models-for-proportions"><span class="header-section-number">16.7.1</span> Models for proportions</a></li>
  <li><a href="#proportion-of-observations-with-negative-growth-by-flow" id="toc-proportion-of-observations-with-negative-growth-by-flow" class="nav-link" data-scroll-target="#proportion-of-observations-with-negative-growth-by-flow"><span class="header-section-number">16.7.2</span> Proportion of observations with negative growth by <strong>flow</strong></a></li>
  <li><a href="#proportion-of-observations-with-negative-growth-by-temperature" id="toc-proportion-of-observations-with-negative-growth-by-temperature" class="nav-link" data-scroll-target="#proportion-of-observations-with-negative-growth-by-temperature"><span class="header-section-number">16.7.3</span> Proportion of observations with negative growth by <strong>temperature</strong></a></li>
  <li><a href="#proportion-of-observations-with-negative-growth-by-3-species-fish-counts" id="toc-proportion-of-observations-with-negative-growth-by-3-species-fish-counts" class="nav-link" data-scroll-target="#proportion-of-observations-with-negative-growth-by-3-species-fish-counts"><span class="header-section-number">16.7.4</span> Proportion of observations with negative growth by <strong>3 species fish counts</strong></a></li>
  <li><a href="#proportion-of-observations-with-negative-growth-by-conspecific-fish-counts" id="toc-proportion-of-observations-with-negative-growth-by-conspecific-fish-counts" class="nav-link" data-scroll-target="#proportion-of-observations-with-negative-growth-by-conspecific-fish-counts"><span class="header-section-number">16.7.5</span> Proportion of observations with negative growth by <strong>conspecific fish counts</strong></a></li>
  </ul></li>
  <li><a href="#xgboost-model-for-proportion-of-fish-with-negative-growth" id="toc-xgboost-model-for-proportion-of-fish-with-negative-growth" class="nav-link" data-scroll-target="#xgboost-model-for-proportion-of-fish-with-negative-growth"><span class="header-section-number">16.8</span> XGBoost model for proportion of fish with negative growth</a>
  <ul class="collapse">
  <li><a href="#hyperparameter-search-grid" id="toc-hyperparameter-search-grid" class="nav-link" data-scroll-target="#hyperparameter-search-grid"><span class="header-section-number">16.8.1</span> Hyperparameter search grid</a></li>
  <li><a href="#function-to-run-models" id="toc-function-to-run-models" class="nav-link" data-scroll-target="#function-to-run-models"><span class="header-section-number">16.8.2</span> Function to run models</a></li>
  <li><a href="#brook-trout-7" id="toc-brook-trout-7" class="nav-link" data-scroll-target="#brook-trout-7"><span class="header-section-number">16.8.3</span> Brook trout</a></li>
  <li><a href="#brown-trout-7" id="toc-brown-trout-7" class="nav-link" data-scroll-target="#brown-trout-7"><span class="header-section-number">16.8.4</span> Brown trout</a></li>
  <li><a href="#atlantic-salmon-7" id="toc-atlantic-salmon-7" class="nav-link" data-scroll-target="#atlantic-salmon-7"><span class="header-section-number">16.8.5</span> Atlantic salmon</a></li>
  <li><a href="#species-together" id="toc-species-together" class="nav-link" data-scroll-target="#species-together"><span class="header-section-number">16.8.6</span> 3 species together</a></li>
  </ul></li>
  <li><a href="#ft-cycle-graphs" id="toc-ft-cycle-graphs" class="nav-link" data-scroll-target="#ft-cycle-graphs"><span class="header-section-number">16.9</span> F/T cycle graphs</a>
  <ul class="collapse">
  <li><a href="#mean-flow-and-temperature" id="toc-mean-flow-and-temperature" class="nav-link" data-scroll-target="#mean-flow-and-temperature"><span class="header-section-number">16.9.1</span> Mean flow and temperature</a></li>
  <li><a href="#mean-flow-and-temperature-with-year-labels" id="toc-mean-flow-and-temperature-with-year-labels" class="nav-link" data-scroll-target="#mean-flow-and-temperature-with-year-labels"><span class="header-section-number">16.9.2</span> Mean flow and temperature with year labels</a></li>
  <li><a href="#brook-trout-9" id="toc-brook-trout-9" class="nav-link" data-scroll-target="#brook-trout-9"><span class="header-section-number">16.9.3</span> Brook trout</a></li>
  <li><a href="#yearly-temperatureflow-cycles-of-daily-data" id="toc-yearly-temperatureflow-cycles-of-daily-data" class="nav-link" data-scroll-target="#yearly-temperatureflow-cycles-of-daily-data"><span class="header-section-number">16.9.4</span> Yearly temperature/flow cycles of daily data</a></li>
  <li><a href="#smooths-of-temperatureflow-cycles-of-daily-data-by-season" id="toc-smooths-of-temperatureflow-cycles-of-daily-data-by-season" class="nav-link" data-scroll-target="#smooths-of-temperatureflow-cycles-of-daily-data-by-season"><span class="header-section-number">16.9.5</span> Smooths of temperature/flow cycles of daily data by season</a></li>
  <li><a href="#ft-cycles-with-labels" id="toc-ft-cycles-with-labels" class="nav-link" data-scroll-target="#ft-cycles-with-labels"><span class="header-section-number">16.9.6</span> F/T cycles with labels</a></li>
  </ul></li>
  <li><a href="#consequences-of-negative-growth" id="toc-consequences-of-negative-growth" class="nav-link" data-scroll-target="#consequences-of-negative-growth"><span class="header-section-number">16.10</span> Consequences of negative growth</a>
  <ul class="collapse">
  <li><a href="#growth-and-last-observation" id="toc-growth-and-last-observation" class="nav-link" data-scroll-target="#growth-and-last-observation"><span class="header-section-number">16.10.1</span> Growth and last observation</a></li>
  <li><a href="#growth-and-movement-distance" id="toc-growth-and-movement-distance" class="nav-link" data-scroll-target="#growth-and-movement-distance"><span class="header-section-number">16.10.2</span> Growth and movement distance</a></li>
  </ul></li>
  <li><a href="#machine-learning-models---individual-data" id="toc-machine-learning-models---individual-data" class="nav-link" data-scroll-target="#machine-learning-models---individual-data"><span class="header-section-number">16.11</span> Machine Learning models - individual data</a>
  <ul class="collapse">
  <li><a href="#binary-model-with-negative-growth-yesno" id="toc-binary-model-with-negative-growth-yesno" class="nav-link" data-scroll-target="#binary-model-with-negative-growth-yesno"><span class="header-section-number">16.11.1</span> Binary model with negative growth, yes:no</a></li>
  <li><a href="#function-to-run-hyperparameters" id="toc-function-to-run-hyperparameters" class="nav-link" data-scroll-target="#function-to-run-hyperparameters"><span class="header-section-number">16.11.2</span> Function to run hyperparameters</a></li>
  <li><a href="#function-to-run-models-1" id="toc-function-to-run-models-1" class="nav-link" data-scroll-target="#function-to-run-models-1"><span class="header-section-number">16.11.3</span> Function to run models</a></li>
  <li><a href="#brook-trout-10" id="toc-brook-trout-10" class="nav-link" data-scroll-target="#brook-trout-10"><span class="header-section-number">16.11.4</span> Brook trout</a></li>
  <li><a href="#brown-trout-10" id="toc-brown-trout-10" class="nav-link" data-scroll-target="#brown-trout-10"><span class="header-section-number">16.11.5</span> Brown trout</a></li>
  <li><a href="#atlantic-salmon-10" id="toc-atlantic-salmon-10" class="nav-link" data-scroll-target="#atlantic-salmon-10"><span class="header-section-number">16.11.6</span> Atlantic salmon</a></li>
  <li><a href="#all-3-species" id="toc-all-3-species" class="nav-link" data-scroll-target="#all-3-species"><span class="header-section-number">16.11.7</span> All 3 species</a></li>
  <li><a href="#growth-model-continuous-growth" id="toc-growth-model-continuous-growth" class="nav-link" data-scroll-target="#growth-model-continuous-growth"><span class="header-section-number">16.11.8</span> Growth model, continuous growth</a></li>
  </ul></li>
  <li><a href="#gam-for-individual-growth" id="toc-gam-for-individual-growth" class="nav-link" data-scroll-target="#gam-for-individual-growth"><span class="header-section-number">16.12</span> GAM for individual growth</a>
  <ul class="collapse">
  <li><a href="#linear-models-for-growth" id="toc-linear-models-for-growth" class="nav-link" data-scroll-target="#linear-models-for-growth"><span class="header-section-number">16.12.1</span> Linear models for growth</a></li>
  <li><a href="#gam-models-for-growth" id="toc-gam-models-for-growth" class="nav-link" data-scroll-target="#gam-models-for-growth"><span class="header-section-number">16.12.2</span> GAM models for growth</a></li>
  </ul></li>
  <li><a href="#logistic-models-for-environmental-effects-on-neggrowth" id="toc-logistic-models-for-environmental-effects-on-neggrowth" class="nav-link" data-scroll-target="#logistic-models-for-environmental-effects-on-neggrowth"><span class="header-section-number">16.13</span> Logistic models for environmental effects on negGrowth</a>
  <ul class="collapse">
  <li><a href="#standardize-flow-and-temperature" id="toc-standardize-flow-and-temperature" class="nav-link" data-scroll-target="#standardize-flow-and-temperature"><span class="header-section-number">16.13.1</span> Standardize flow and temperature</a></li>
  <li><a href="#raw-data-with-logistic-fit-for-flow-effect" id="toc-raw-data-with-logistic-fit-for-flow-effect" class="nav-link" data-scroll-target="#raw-data-with-logistic-fit-for-flow-effect"><span class="header-section-number">16.13.2</span> Raw data with logistic fit for flow effect</a></li>
  <li><a href="#raw-data-with-logistic-fit-for-temperature-effect" id="toc-raw-data-with-logistic-fit-for-temperature-effect" class="nav-link" data-scroll-target="#raw-data-with-logistic-fit-for-temperature-effect"><span class="header-section-number">16.13.3</span> Raw data with logistic fit for temperature effect</a></li>
  <li><a href="#raw-data-with-logistic-fit-for-observedweight-effect" id="toc-raw-data-with-logistic-fit-for-observedweight-effect" class="nav-link" data-scroll-target="#raw-data-with-logistic-fit-for-observedweight-effect"><span class="header-section-number">16.13.4</span> Raw data with logistic fit for observedWeight effect</a></li>
  </ul></li>
  <li><a href="#logistic-model-for-flow-and-temperature-one-species-at-a-time" id="toc-logistic-model-for-flow-and-temperature-one-species-at-a-time" class="nav-link" data-scroll-target="#logistic-model-for-flow-and-temperature-one-species-at-a-time"><span class="header-section-number">16.14</span> Logistic model for flow and temperature, one species at a time</a>
  <ul class="collapse">
  <li><a href="#predict-pneg-growth-in-mass" id="toc-predict-pneg-growth-in-mass" class="nav-link" data-scroll-target="#predict-pneg-growth-in-mass"><span class="header-section-number">16.14.1</span> Predict p(neg growth in mass)</a></li>
  <li><a href="#brook-trout-12" id="toc-brook-trout-12" class="nav-link" data-scroll-target="#brook-trout-12"><span class="header-section-number">16.14.2</span> Brook trout</a></li>
  <li><a href="#brown-trout-12" id="toc-brown-trout-12" class="nav-link" data-scroll-target="#brown-trout-12"><span class="header-section-number">16.14.3</span> Brown trout</a></li>
  <li><a href="#atlantic-salmon-11" id="toc-atlantic-salmon-11" class="nav-link" data-scroll-target="#atlantic-salmon-11"><span class="header-section-number">16.14.4</span> Atlantic salmon</a></li>
  </ul></li>
  <li><a href="#two-growth-models" id="toc-two-growth-models" class="nav-link" data-scroll-target="#two-growth-models"><span class="header-section-number">16.15</span> Two growth models</a>
  <ul class="collapse">
  <li><a href="#size-adjusted-growth-model" id="toc-size-adjusted-growth-model" class="nav-link" data-scroll-target="#size-adjusted-growth-model"><span class="header-section-number">16.15.1</span> Size-adjusted growth model</a></li>
  <li><a href="#compare-size-adjusted-and-instantaneous-growth" id="toc-compare-size-adjusted-and-instantaneous-growth" class="nav-link" data-scroll-target="#compare-size-adjusted-and-instantaneous-growth"><span class="header-section-number">16.15.2</span> Compare size-adjusted and instantaneous growth</a></li>
  </ul></li>
  <li><a href="#compare-growth-in-length-and-mass" id="toc-compare-growth-in-length-and-mass" class="nav-link" data-scroll-target="#compare-growth-in-length-and-mass"><span class="header-section-number">16.16</span> Compare growth in length and mass</a>
  <ul class="collapse">
  <li><a href="#growth-rate-in-length-vs-size-independent-growth-rate-in-mass" id="toc-growth-rate-in-length-vs-size-independent-growth-rate-in-mass" class="nav-link" data-scroll-target="#growth-rate-in-length-vs-size-independent-growth-rate-in-mass"><span class="header-section-number">16.16.1</span> Growth rate in length vs size-independent growth rate in mass</a></li>
  </ul></li>
  <li><a href="#deprecated-logistic-models-below" id="toc-deprecated-logistic-models-below" class="nav-link" data-scroll-target="#deprecated-logistic-models-below"><span class="header-section-number">16.17</span> <strong>Deprecated</strong> logistic models below</a>
  <ul class="collapse">
  <li><a href="#logistic-model-for-flow-and-temperature-all-species" id="toc-logistic-model-for-flow-and-temperature-all-species" class="nav-link" data-scroll-target="#logistic-model-for-flow-and-temperature-all-species"><span class="header-section-number">16.17.1</span> Logistic model for flow and temperature, all species</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection"><span class="header-section-number">16.17.2</span> Model selection</a></li>
  <li><a href="#model-results-for-additive-model-not-very-good" id="toc-model-results-for-additive-model-not-very-good" class="nav-link" data-scroll-target="#model-results-for-additive-model-not-very-good"><span class="header-section-number">16.17.3</span> Model results for additive model (not very good)</a></li>
  <li><a href="#model-results-for-full-interactive-model-best-model" id="toc-model-results-for-full-interactive-model-best-model" class="nav-link" data-scroll-target="#model-results-for-full-interactive-model-best-model"><span class="header-section-number">16.17.4</span> Model results for full interactive model (best model)</a></li>
  <li><a href="#precict-pneg-growth-in-mass" id="toc-precict-pneg-growth-in-mass" class="nav-link" data-scroll-target="#precict-pneg-growth-in-mass"><span class="header-section-number">16.17.5</span> Precict p(neg growth in mass)</a></li>
  <li><a href="#plot-predictions" id="toc-plot-predictions" class="nav-link" data-scroll-target="#plot-predictions"><span class="header-section-number">16.17.6</span> Plot predictions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Growth in mass</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Distribution of growth, negative growth<br>
- Seasonal differences<br>
- Species differences in size/growth/CF - Patterns of negative growth</p>
<p>Causes of neg growth<br>
- Extrinsic<br>
- river, season, flow, temp<br>
- intrinsic<br>
- Sex (fall), life history, section, size, age, previous growth (CF?), movement (section/river)<br>
consequences of neg growth - survival<br>
- future growth (length and mass)<br>
- movement (section/river)<br>
- reprod success?<br>
- local density (con and hetero)</p>
<p>Probs with growth in mass<br>
spawning loss mass in the fall, esp in OB</p>
<p>Interaction between flow:temp, diff btw WB (groundwater dominated at low flow so cold) and tribs (combo of surface and gw?)</p>
<p>Compare growth with t/f cycle diagrams for each river</p>
<p>compare condition factor among species - looks like bkt growing faster in weight</p>
<p>flow/temp circles with gr on top</p>
<section id="get-data" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="get-data"><span class="header-section-number">16.1</span> Get data</h2>
<section id="get-electrofishing-data" class="level3" data-number="16.1.1">
<h3 data-number="16.1.1" class="anchored" data-anchor-id="get-electrofishing-data"><span class="header-section-number">16.1.1</span> Get electrofishing data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>cd <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(cdWB_electro_target) <span class="co"># raw data</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>cd1 <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(cd1_target) <span class="co"># from modelGrowthInMass_target</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>propNegSRS <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(propNegSRS_target)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>propNegSRsN <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(propNegSRsN_target)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>indCountsBySpp <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(indCountsBySpp_target) </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>indCounts <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(indCounts_target) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>propNegLabels <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(propNegLabels_target)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>negGr_beforeLast <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(negGr_beforeLast_target)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>negGr_beforeLastMean <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(negGr_beforeLastMean_target)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>negGr_beforeLastMean_year <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(negGr_beforeLastMean_year_target)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>meanNegSRsN <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(meanNegSRsN_target)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>meanNegSRsNWide <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(meanNegSRsNWide_target)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># df for pairs plots</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>cd1Wide_grWeight <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(cd1Wide_grWeight_target)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>cd1Wide_observedWeight <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(cd1Wide_observedWeight_target)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>dGAM <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(dGAM_target) <span class="co"># from modelGrowthInMass_target</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="get-environmental-data" class="level3" data-number="16.1.2">
<h3 data-number="16.1.2" class="anchored" data-anchor-id="get-environmental-data"><span class="header-section-number">16.1.2</span> Get environmental data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dummy<span class="ot">=</span><span class="dv">0</span> <span class="co"># change to force cache update??</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>envIn <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(envIn_target)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>envIn_propNeg <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(envIn_propNeg_target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="examine-raw-data" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="examine-raw-data"><span class="header-section-number">16.2</span> Examine raw data</h2>
<section id="limit-data-to-consecutive-sample-captures-cd1" class="level3" data-number="16.2.1">
<h3 data-number="16.2.1" class="anchored" data-anchor-id="limit-data-to-consecutive-sample-captures-cd1"><span class="header-section-number">16.2.1</span> Limit data to consecutive sample captures (cd1)</h3>
<p>Previous growth models with length used all possible observations for a fish and interpolated missing observations. Here, we are just looking at consecutive captures to estimate growth over just that interval.</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/consecSamples_a10a32899388171a12c51673ef12811b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table(as.numeric(cd$sampleNumber), as.numeric(cd$lagSampleNumber), cd$season, cd$year) |&gt; </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame() |&gt; </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Freq &gt; 0) |&gt; </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(Var1, Var2) |&gt; </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(firstCapt = Var1, secondCapt = Var2, season = Var3, year = Var4) |&gt; </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year == 2010)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="do">##### in targets</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cd1 &lt;- cd |&gt; </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(sampleNumberDiff == 1,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#          tag %notin% c('1bf20ff490', '1bf20ebe4e')) |&gt; </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(negGrowth = grWeight &lt; 0,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#          month = month(date),</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#          dummy = 1) # change to force cache update</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="find-outlier-growth-rates" class="level3" data-number="16.2.2">
<h3 data-number="16.2.2" class="anchored" data-anchor-id="find-outlier-growth-rates"><span class="header-section-number">16.2.2</span> Find outlier growth rates</h3>
<section id="negative-outlier-growth" class="level4" data-number="16.2.2.1">
<h4 data-number="16.2.2.1" class="anchored" data-anchor-id="negative-outlier-growth"><span class="header-section-number">16.2.2.1</span> Negative outlier growth</h4>
<p><code>1bf20ebe4e</code> and <code>1bf20ff490</code> have incorrect weights leading to very negative growth rates.<br>
Exclude these tags in <code>cd1_target</code>. The rest of the quite negative growth fish seem plausible (remember we can’t account for stomach contents or egg loss).</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negOutlier_b3fbbf52a7c0353c5ab43065a3bf4be4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>cd <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(grWeightS) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tag, species, season, sampleNumber, lagSampleNumber, observedWeight, lagObservedWeight, grWeightS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 91,103 × 8
   tag        species season sampleNumber lagSampleNumber observedWeight
   &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;
 1 1bf20ebe4e bnt          3           55              56           46.5
 2 257c67e414 bkt          3           59              60            7.3
 3 1bf0fec291 bkt          3           27              28            2.7
 4 1bf20ff490 bnt          2           54              55          167. 
 5 257c67b532 bnt          3           63              64           34  
 6 1bf1984439 bnt          1           41              43           61.8
 7 00088d1ad4 bnt          3           63              64            4.5
 8 257c67db60 bnt          3           63              64           24.2
 9 00088d0b59 bnt          3           63              64            3.7
10 414b684955 ats          3           15              16            5.7
# ℹ 91,093 more rows
# ℹ 2 more variables: lagObservedWeight &lt;dbl&gt;, grWeightS &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="positive-outlier-growth" class="level4" data-number="16.2.2.2">
<h4 data-number="16.2.2.2" class="anchored" data-anchor-id="positive-outlier-growth"><span class="header-section-number">16.2.2.2</span> Positive outlier growth</h4>
<p>Lots of very fast growth mostly in the spring. No clear way to exclude fish. <code>1c2c582218</code> is excluded in <code>cd1_target</code> because of very high growth in length.</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/posOutlier_f5345ca48e8b0683cf101eb2e2bec8dc">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(grWeightS)) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tag, species, season, sampleNumber, lagSampleNumber, observedWeight, lagObservedWeight, grWeightS) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24,297 × 8
   tag        species season sampleNumber lagSampleNumber observedWeight
   &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;
 1 1bf1020623 bkt          1           29              30            1.3
 2 0009f6eef4 bkt          1           77              78            2.3
 3 413f4b1845 ats          1           13              14            1.8
 4 1bf16366cf bnt          1           33              34            2  
 5 410a015165 ats          1           13              14            2.1
 6 00088d2d2c bkt          1           73              74            1.8
 7 410a0f0653 ats          1           13              14            2.2
 8 1bf18b7637 bkt          1           33              34            2.5
 9 1bf20e4e30 bnt          1           53              54            2.3
10 1bf1930917 ats          1           37              38            1.9
# ℹ 24,287 more rows
# ℹ 2 more variables: lagObservedWeight &lt;dbl&gt;, grWeightS &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="numbers-of-observations-for-analysis" class="level3" data-number="16.2.3">
<h3 data-number="16.2.3" class="anchored" data-anchor-id="numbers-of-observations-for-analysis"><span class="header-section-number">16.2.3</span> Numbers of observations for analysis</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/rawObs_5fed95019355fafdc4f868cad2866b7d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(cd1<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1997</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(cd1<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2016</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cd1<span class="sc">$</span>species, cd1<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     
      1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010
  ats  762 1576 1395 1183 1004  615 1076  935  644  234   31    8    0    0
  bkt    0    0    0  139  367  535 1135  953  874  588  344  589  971  890
  bnt    0    0    0  357  453  211  190  161  368  467  204  298  483  469
     
      2011 2012 2013 2014 2015 2016
  ats    0    0    0    0    0    0
  bkt  382  618  708  582  471    1
  bnt   89  119  513  161  144    0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cd1<span class="sc">$</span>species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  ats   bkt   bnt 
 9463 10147  4687 </code></pre>
</div>
</div>
<div class="cell" data-hash="modelGrowthInMass_cache/html/rawUniques_e33553213e14465673a0b0d4f193e6a5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(cd1<span class="sc">$</span>tag))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13119</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tag =</span> (<span class="fu">unique</span>(tag))) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">count =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  species count
  &lt;chr&gt;   &lt;int&gt;
1 ats      4541
2 bkt      5786
3 bnt      2792</code></pre>
</div>
</div>
</section>
<section id="raw-length-weight-data-graphs" class="level3" data-number="16.2.4">
<h3 data-number="16.2.4" class="anchored" data-anchor-id="raw-length-weight-data-graphs"><span class="header-section-number">16.2.4</span> Raw length, weight data graphs</h3>
<section id="distribution-of-growth-rates" class="level4" data-number="16.2.4.1">
<h4 data-number="16.2.4.1" class="anchored" data-anchor-id="distribution-of-growth-rates"><span class="header-section-number">16.2.4.1</span> Distribution of growth rates</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/rawlengthWeight_950b944099ee858f3881ac4fccb0fd36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grWeight, <span class="at">color =</span> speciesGG, <span class="at">linetype =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in mass (/d)"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_discrete() +</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.028</span>)) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/rawlengthWeight-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grLength, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in Length (mm/d)"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/rawlengthWeight-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="length-vs-weight-by-species" class="level3" data-number="16.2.5">
<h3 data-number="16.2.5" class="anchored" data-anchor-id="length-vs-weight-by-species"><span class="header-section-number">16.2.5</span> Length vs weight by species</h3>
<p>Very few outliers</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/len_v_weight_7634a9aeeed40bb79e7e4c0a1bb950d1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plotLenW <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s){</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> s), <span class="fu">aes</span>(observedLength, observedWeight)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ggtitle(s) +</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Length (mm)"</span>, <span class="at">y =</span> <span class="st">"Mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>year, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Brook trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Brown trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Atlantic salmon</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/len_v_weight_bkt_40b9aa789d4d15edbb0c1bcb39f27aa6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLenW</span>(cd1, <span class="st">"bkt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/len_v_weight_bkt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/len_v_weight_bnt_3ed8c5d872925358d3093b37ffaa39d5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLenW</span>(cd1, <span class="st">"bnt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/len_v_weight_bnt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/len_v_weight_ats_d64c8c900f41aae6d32c2755006da127">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLenW</span>(cd1, <span class="st">"ats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/len_v_weight_ats-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="weight-vs-weight-at-next-sample" class="level3" data-number="16.2.6">
<h3 data-number="16.2.6" class="anchored" data-anchor-id="weight-vs-weight-at-next-sample"><span class="header-section-number">16.2.6</span> Weight vs weight at next sample</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/weight_v_weight_03d9c458e4172a5fbe105e3d6abdbebf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>plotWW <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp){</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> spp), <span class="fu">aes</span>(observedWeight, lagObservedWeight, <span class="at">color =</span> seasonGG)) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mass (mg)"</span>, <span class="at">y =</span> <span class="st">"Mass (mg) at next sample"</span>) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Brook trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Brown trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Atlantic salmon</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/weight_v_weight_bkt_2dddd50ae4b55015f43b4a45931de486">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotWW</span>(cd1, <span class="st">"bkt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/weight_v_weight_bkt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/weight_v_weight_bnt_f873b30ea73f6ba67042992a9ffebc25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotWW</span>(cd1, <span class="st">"bnt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/weight_v_weight_bnt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/weight_v_weight_ats_f39603e562f945831499791c69e8685f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotWW</span>(cd1, <span class="st">"ats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/weight_v_weight_ats-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="growth-rate-pairs-plots" class="level3" data-number="16.2.7">
<h3 data-number="16.2.7" class="anchored" data-anchor-id="growth-rate-pairs-plots"><span class="header-section-number">16.2.7</span> Growth rate pairs plots</h3>
<p>By species, all cohorts<br>
Row and column labels in the pairs plots are ‘age’_‘season’</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_eb97da63cccf091013dfa3d850e8789d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plotPairs <span class="ot">&lt;-</span> <span class="cf">function</span>(d0, sppIn, cohortIn, <span class="at">firstSamp =</span> <span class="dv">1</span>, <span class="at">lastSamp =</span> <span class="dv">9</span>, <span class="at">upperBlank =</span> <span class="cn">FALSE</span>){</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d0 <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(speciesGG <span class="sc">==</span> sppIn, cohort <span class="sc">%in%</span> cohortIn) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select_if</span>(<span class="sc">~</span><span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(.))) <span class="sc">|&gt;</span>  <span class="co"># remove all-NA columns</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(firstObserved <span class="sc">!=</span> lastObserved <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># remove single obs fish</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  lowerFn <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, <span class="at">method =</span> <span class="st">"lm"</span>, ...) {</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(cohort)), <span class="at">method =</span> method, <span class="at">se =</span> <span class="cn">FALSE</span>, ...) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">'black'</span>, <span class="at">size =</span> <span class="fl">1.1</span>, <span class="at">method =</span> method, <span class="at">se =</span> <span class="cn">FALSE</span>, ...) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_publication</span>() </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(upperBlank) {</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>      d <span class="sc">|&gt;</span> </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(speciesGG, tag, firstObserved, lastObserved)),</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> (firstSamp<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(lastSamp<span class="sc">+</span><span class="dv">1</span>), <span class="co"># +1 to skip cohort column</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(lowerFn, <span class="at">method =</span> <span class="st">"lm"</span>)),</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="st">"blank"</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>      d <span class="sc">|&gt;</span> </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(speciesGG, tag, firstObserved, lastObserved)),</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> (firstSamp<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(lastSamp<span class="sc">+</span><span class="dv">1</span>), <span class="co"># +1 to skip cohort column</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(lowerFn, <span class="at">method =</span> <span class="st">"lm"</span>))</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Brook trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Brown trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Atlantic salmon</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt_2d9c21fbc2fc41656bf25f228fd5c995">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2000</span><span class="sc">:</span><span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plotPairs(cd1Wide_observedWeight, "Brook trout", 2000:2015)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bnt_60771a7b8e6f6221bd5c2498be28a25a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brown trout"</span>, <span class="dv">2000</span><span class="sc">:</span><span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bnt-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plotPairs(cd1Wide_observedWeight, "Brook trout", 2000:2015)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_ats_632433103b247545e84e999818b127fc">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span><span class="sc">:</span><span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">8</span>) <span class="co"># missing data in column 9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_ats-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plotPairs(cd1Wide_observedWeight, "Atlantic salmon", 2000:2015)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<section id="brook-trout-by-cohort" class="level4" data-number="16.2.7.1">
<h4 data-number="16.2.7.1" class="anchored" data-anchor-id="brook-trout-by-cohort"><span class="header-section-number">16.2.7.1</span> Brook trout by cohort</h4>
<p>Row and column labels are ‘age’_‘season’<br>
Color by river - make new function</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">2000</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">2001</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">2002</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">2003</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false">2004</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-6" role="tab" aria-controls="tabset-4-6" aria-selected="false">2005</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-7" role="tab" aria-controls="tabset-4-7" aria-selected="false">2006</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-8" role="tab" aria-controls="tabset-4-8" aria-selected="false">2007</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-9" role="tab" aria-controls="tabset-4-9" aria-selected="false">2008</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-10" role="tab" aria-controls="tabset-4-10" aria-selected="false">2009</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-11-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-11" role="tab" aria-controls="tabset-4-11" aria-selected="false">2010</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-12-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-12" role="tab" aria-controls="tabset-4-12" aria-selected="false">2011</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-13-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-13" role="tab" aria-controls="tabset-4-13" aria-selected="false">2012</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-14-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-14" role="tab" aria-controls="tabset-4-14" aria-selected="false">2013</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-15-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-15" role="tab" aria-controls="tabset-4-15" aria-selected="false">2014</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2000_9861176957bb398f9ab8177e78a3c636">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2000-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2001_bc90b57332ff345676cf3f444d9e9d81">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2001</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2001-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2002_6601a4b7fa0348c5a6f020fb38e3e1ee">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2002</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2002-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2003_6852f4e7856f216d263b0579c7caba63">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2003</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2003-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2004_f1de9301e3242c062af02413a1863c43">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2004</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2004-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-6-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2005_6b5410615853e04639e225569c47afe5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2005</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2005-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-7-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2006_7f3e1be11480c9b905faff4cb565c01f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2006</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2006-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-8-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2007_e9ae19e29e36ac07720f97492c0ca87e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2007</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2007-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-9-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2008_adb6a65b54696d0997eeaa669e144458">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2008</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2008-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-10-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2009_404396b620811a847ccddc64a3a201ec">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2009</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2009-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-11" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-11-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2010_3ff2db3e96b729577630a164f056323b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2010</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2010-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-12" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-12-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2011_9687dd6a2a6f1b908017ca9a28582d3a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2011-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-13" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-13-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2012_c83d31c317a736020b6ecc98e14a0096">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2012</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2012-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-14" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-14-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2013_766a34f3a3a0308f37dde727e1ed476f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2013</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2013-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-15" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-15-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairs_bkt2014_203494ad22f17fd5b5fc25ea74bc399f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2014</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairs_bkt2014-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="consecutive-season-growth-comparisons-by-age_season" class="level4" data-number="16.2.7.2">
<h4 data-number="16.2.7.2" class="anchored" data-anchor-id="consecutive-season-growth-comparisons-by-age_season"><span class="header-section-number">16.2.7.2</span> Consecutive season growth comparisons by age_season</h4>
<p>Brook trout</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/pairsByAgeSeason_67f33770fedffc680f43312226245078">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2014</span>, <span class="st">`</span><span class="at">0_4</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="fl">0.01</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">0_3</span><span class="st">`</span>, <span class="st">`</span><span class="at">0_4</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(intercept = 0, slope = 1) +</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'#45454d'</span>) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairsByAgeSeason-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2014</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">0_4</span><span class="st">`</span>, <span class="st">`</span><span class="at">1_1</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(intercept = 0, slope = 1) +</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'#45454d'</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairsByAgeSeason-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2014</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">1_1</span><span class="st">`</span>, <span class="st">`</span><span class="at">1_2</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(intercept = 0, slope = 1) +</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairsByAgeSeason-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2014</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">1_2</span><span class="st">`</span>, <span class="st">`</span><span class="at">1_3</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(intercept = 0, slope = 1) +</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'#45454d'</span>) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairsByAgeSeason-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2012</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">1_1</span><span class="st">`</span>, <span class="st">`</span><span class="at">2_1</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'#45454d'</span>) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pairsByAgeSeason-5.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="growth-rate-in-length-vs-growth-rate-in-mass" class="level3" data-number="16.2.8">
<h3 data-number="16.2.8" class="anchored" data-anchor-id="growth-rate-in-length-vs-growth-rate-in-mass"><span class="header-section-number">16.2.8</span> Growth rate in length vs growth rate in mass</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/grLen_v_grWeight_672ead004e8a6eb30cc4d02f5235ea87">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grLength, grWeight)) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> observedWeight), <span class="at">alpha =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in length"</span>, <span class="at">y =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/grLen_v_grWeight-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plotGrLenMass <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s){</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(species<span class="sc">==</span>s), <span class="fu">aes</span>(grLength, grWeight, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in length"</span>, <span class="at">y =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>(<span class="at">legendPosition =</span> <span class="st">"right"</span>, <span class="at">legendDirection =</span> <span class="st">"vertical"</span>) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">'free'</span>)  </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  facet_wrap(~year)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Brook trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Brown trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Atlantic salmon</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/grLen_v_grWeight_bkt_6afeb9165ffb70d9e2a2b10893b43f9d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrLenMass</span>(cd1, <span class="st">"bkt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/grLen_v_grWeight_bkt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/grLen_v_grWeight_bnt_44513be8f60b9dd311398bb8332109b5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrLenMass</span>(cd1, <span class="st">"bnt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/grLen_v_grWeight_bnt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/grLen_v_grWeight_ats_7d86c6ed15aafec025a05494bd43c9b3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrLenMass</span>(cd1, <span class="st">"ats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/grLen_v_grWeight_ats-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>No relationship between means of neg and pos growth</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/posNegGR_717f97e4b6f8caddd208dbffe27c3d59">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meanNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>), <span class="fu">aes</span>(year, meanNegPos, <span class="at">color =</span> negGrowth, <span class="at">group =</span> negGrowth)) <span class="sc">+</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/posNegGR-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meanNegSRsNWide, <span class="fu">aes</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/posNegGR-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="body-size-effect-on-prop-neg-growth" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="body-size-effect-on-prop-neg-growth"><span class="header-section-number">16.3</span> Body size effect on prop neg growth</h2>
<div class="cell" data-hash="modelGrowthInMass_cache/html/propNegSize_0ab80d7c20394cf81a190807d154f922">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">"bkt"</span>, seasonGG <span class="sc">!=</span> <span class="st">"Spring"</span>), <span class="fu">aes</span>(observedWeight, negGrowth<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegSize-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>), <span class="fu">aes</span>(observedWeight, negGrowth<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegSize-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>), <span class="fu">aes</span>(observedWeight, negGrowth<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)<span class="co">#, scales = "free")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegSize-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>), <span class="fu">aes</span>(observedWeight, grWeight<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)<span class="co">#, scales = "free")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegSize-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>), <span class="fu">aes</span>(ageInSamples, grWeight<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)<span class="co">#, scales = "free")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegSize-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>, ageInSamples <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="fu">aes</span>(ageInSamples, negGrowth<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)<span class="co">#, scales = "free")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegSize-6.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="flow-and-temperature-growth-relationships" class="level2" data-number="16.4">
<h2 data-number="16.4" class="anchored" data-anchor-id="flow-and-temperature-growth-relationships"><span class="header-section-number">16.4</span> Flow and temperature growth relationships</h2>
<section id="mean-flow-effect-on-growth" class="level3" data-number="16.4.1">
<h3 data-number="16.4.1" class="anchored" data-anchor-id="mean-flow-effect-on-growth"><span class="header-section-number">16.4.1</span> Mean flow effect on growth?</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_weight_df343a04fed5434d49f8bfa3c3e084b9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>plotFlowGR <span class="ot">&lt;-</span> <span class="cf">function</span>(d, r){</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(river <span class="sc">==</span> r), <span class="fu">aes</span>(meanFlowByRiver, grWeight, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.05</span>)  <span class="sc">+</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span><span class="cn">FALSE</span>, <span class="at">formula =</span> y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean flow"</span>, <span class="at">y =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle(r) +</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)<span class="co">#, scales = 'free')</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">West Brook</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Open Large</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Open Small</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">Isolated small</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_weight_wb_4160659d80ac0f8ee38972181d053941">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFlowGR</span>(cd1, <span class="st">"west brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_weight_wb-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_weight_ol_27087bfab0b4be30352c69ef31e9a98e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFlowGR</span>(cd1, <span class="st">"wb jimmy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_weight_ol-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_weight_os_7ae021db6eb381e8d31cbe5759b23d1f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFlowGR</span>(cd1, <span class="st">"wb mitchell"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_weight_os-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_weight_is_1e384b491fb9e2bbb1857c0088b82ee9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFlowGR</span>(cd1, <span class="st">"wb obear"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_weight_is-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="mean-temperature-effect-on-growth" class="level3" data-number="16.4.2">
<h3 data-number="16.4.2" class="anchored" data-anchor-id="mean-temperature-effect-on-growth"><span class="header-section-number">16.4.2</span> Mean temperature effect on growth?</h3>
<p>Maybe in Jimmy for bnt, or for ats</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/temp_grWeight_f937e1991e294ea1787415d417740fab">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>plotTempGR <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s){</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(seasonGG <span class="sc">==</span> s), <span class="fu">aes</span>(meanTemperature, grWeight, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)  <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span><span class="cn">FALSE</span>, <span class="at">formula =</span> y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>), <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean temperature (c)"</span>, <span class="at">y =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>   <span class="co"># ggtitle(s) +</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>riverGG)<span class="co">#, scales = 'free')</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Spring</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Summer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Autumn</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false">Winter</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/temp_grWeight_spring_43761252434449271776c63f23ee6ca3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTempGR</span>(cd1, <span class="st">"Spring"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/temp_grWeight_spring-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/temp_grWeight_summer_fd91251e4dc4679e4d39c8e31a69c82a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTempGR</span>(cd1, <span class="st">"Summer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/temp_grWeight_summer-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/temp_grWeight_autumn_969d61406c16ab3e2877a12ab46485b7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTempGR</span>(cd1, <span class="st">"Autumn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/temp_grWeight_autumn-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-7-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/temp_grWeight_winter_f0cb4a7eb3b5d3e9af68b197ffe1f5f1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTempGR</span>(cd1, <span class="st">"Winter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/temp_grWeight_winter-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="proportion-of-fish-with-negative-growth" class="level2" data-number="16.5">
<h2 data-number="16.5" class="anchored" data-anchor-id="proportion-of-fish-with-negative-growth"><span class="header-section-number">16.5</span> Proportion of fish with <strong>negative growth</strong></h2>
<p>Counts/proportions of negative growth<br>
Proportions for Table 1</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/neg_posCounts_7ea169ec115ac9e97f69b93c3997a6cb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nTotal =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nTotal, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span>nTotal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
# Groups:   nTotal [1]
  nTotal negGrowth     n  prop
   &lt;int&gt; &lt;lgl&gt;     &lt;int&gt; &lt;dbl&gt;
1  24193 FALSE     20620 0.852
2  24193 TRUE       3573 0.148</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#by river</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   riverGG [4]
  riverGG        `FALSE` `TRUE`   prop
  &lt;ord&gt;            &lt;int&gt;  &lt;int&gt;  &lt;dbl&gt;
1 West Brook       15496   2937 0.159 
2 Open Large        1661    268 0.139 
3 Open Small        1129     93 0.0761
4 Isolated Small    2334    275 0.105 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#by species</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
# Groups:   species [3]
  species `FALSE` `TRUE`   prop
  &lt;chr&gt;     &lt;int&gt;  &lt;int&gt;  &lt;dbl&gt;
1 ats        7445   2003 0.212 
2 bkt        8745   1344 0.133 
3 bnt        4430    226 0.0485</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by season</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   season [4]
  season `FALSE` `TRUE`    prop
   &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt;   &lt;dbl&gt;
1      1    5857      7 0.00119
2      2    5438   2151 0.283  
3      3    5675   1150 0.168  
4      4    3650    265 0.0677 </code></pre>
</div>
</div>
<section id="brook-trout-4" class="level4" data-number="16.5.0.1">
<h4 data-number="16.5.0.1" class="anchored" data-anchor-id="brook-trout-4"><span class="header-section-number">16.5.0.1</span> Brook trout</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/propBKT_0f5c118c745edc6f80c0190f71c2dfe5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by season</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bkt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   season [4]
  season `FALSE` `TRUE`     prop
   &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
1      1    2435      1 0.000411
2      2    2492    825 0.249   
3      3    2250    449 0.166   
4      4    1568     69 0.0422  </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by river</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bkt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   riverGG [4]
  riverGG        `FALSE` `TRUE`   prop
  &lt;ord&gt;            &lt;int&gt;  &lt;int&gt;  &lt;dbl&gt;
1 West Brook        4121    739 0.152 
2 Open Large        1255    241 0.161 
3 Open Small        1035     89 0.0792
4 Isolated Small    2334    275 0.105 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by season/river</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bkt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
# Groups:   season, riverGG [16]
   season riverGG        `FALSE` `TRUE`      prop
    &lt;dbl&gt; &lt;ord&gt;            &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;
 1      1 West Brook        1247      1  0.000801
 2      1 Open Large         307     NA NA       
 3      1 Open Small         294     NA NA       
 4      1 Isolated Small     587     NA NA       
 5      2 West Brook        1340    565  0.297   
 6      2 Open Large         342    135  0.283   
 7      2 Open Small         231     44  0.16    
 8      2 Isolated Small     579     81  0.123   
 9      3 West Brook         959    159  0.142   
10      3 Open Large         368     83  0.184   
11      3 Open Small         264     33  0.111   
12      3 Isolated Small     659    174  0.209   
13      4 West Brook         575     14  0.0238  
14      4 Open Large         238     23  0.0881  
15      4 Open Small         246     12  0.0465  
16      4 Isolated Small     509     20  0.0378  </code></pre>
</div>
</div>
</section>
<section id="brown-trout-4" class="level4" data-number="16.5.0.2">
<h4 data-number="16.5.0.2" class="anchored" data-anchor-id="brown-trout-4"><span class="header-section-number">16.5.0.2</span> Brown trout</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/propBNT_5a878bdbb6b4b18b1ef197a7b78d4c3e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by season</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bnt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   season [4]
  season `FALSE` `TRUE`    prop
   &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt;   &lt;dbl&gt;
1      1    1067      4 0.00373
2      2    1299    108 0.0768 
3      3    1454     83 0.0540 
4      4     610     31 0.0484 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by river</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bnt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
# Groups:   riverGG [3]
  riverGG    `FALSE` `TRUE`   prop
  &lt;ord&gt;        &lt;int&gt;  &lt;int&gt;  &lt;dbl&gt;
1 West Brook    3946    201 0.0485
2 Open Large     390     21 0.0511
3 Open Small      94      4 0.0408</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by season/river</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bnt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 5
# Groups:   season, riverGG [12]
   season riverGG    `FALSE` `TRUE`     prop
    &lt;dbl&gt; &lt;ord&gt;        &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
 1      1 West Brook     959      4  0.00415
 2      1 Open Large      85     NA NA      
 3      1 Open Small      23     NA NA      
 4      2 West Brook    1172    103  0.0808 
 5      2 Open Large     102      4  0.0377 
 6      2 Open Small      25      1  0.0385 
 7      3 West Brook    1309     71  0.0514 
 8      3 Open Large     121     11  0.0833 
 9      3 Open Small      24      1  0.04   
10      4 West Brook     506     23  0.0435 
11      4 Open Large      82      6  0.0682 
12      4 Open Small      22      2  0.0833 </code></pre>
</div>
</div>
</section>
<section id="atlantic-salmon-4" class="level4" data-number="16.5.0.3">
<h4 data-number="16.5.0.3" class="anchored" data-anchor-id="atlantic-salmon-4"><span class="header-section-number">16.5.0.3</span> Atlantic salmon</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/propATS_d8ef209e75da79062fc63f51f0d64236">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by season</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'ats'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   season [4]
  season `FALSE` `TRUE`     prop
   &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
1      1    2355      2 0.000849
2      2    1647   1218 0.425   
3      3    1971    618 0.239   
4      4    1472    165 0.101   </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by river</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'ats'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
# Groups:   riverGG [2]
  riverGG    `FALSE` `TRUE`  prop
  &lt;ord&gt;        &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
1 West Brook    7429   1997 0.212
2 Open Large      16      6 0.273</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by season/river</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'ats'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
# Groups:   season, riverGG [8]
  season riverGG    `FALSE` `TRUE`      prop
   &lt;dbl&gt; &lt;ord&gt;        &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;
1      1 West Brook    2350      2  0.000850
2      1 Open Large       5     NA NA       
3      2 West Brook    1644   1216  0.425   
4      2 Open Large       3      2  0.4     
5      3 West Brook    1966    617  0.239   
6      3 Open Large       5      1  0.167   
7      4 West Brook    1469    162  0.0993  
8      4 Open Large       3      3  0.5     </code></pre>
</div>
</div>
</section>
<section id="proportion-of-observations-with-negative-growth-by-speciesriverseason" class="level3" data-number="16.5.1">
<h3 data-number="16.5.1" class="anchored" data-anchor-id="proportion-of-observations-with-negative-growth-by-speciesriverseason"><span class="header-section-number">16.5.1</span> Proportion of observations with negative growth by species/river/season</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/neg_pos_2f88db30b97063d6d26b5e55d425b13a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(negGrowth)) <span class="sc">+</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG<span class="sc">+</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/neg_pos-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="proportion-of-observations-with-negative-growth-by-speciesseason" class="level3" data-number="16.5.2">
<h3 data-number="16.5.2" class="anchored" data-anchor-id="proportion-of-observations-with-negative-growth-by-speciesseason"><span class="header-section-number">16.5.2</span> Proportion of observations with negative growth by species/season</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/propNegBySeason_bdff02cafa0ccd2110345531a3d466c1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRS <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">50</span>), <span class="fu">aes</span>(seasonGG, propNeg, <span class="at">color =</span> riverGG, <span class="at">group =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Season"</span>, <span class="at">y =</span> <span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">360-45</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegBySeason-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="proportion-of-observations-with-negative-growth-by-speciesriveryear" class="level3" data-number="16.5.3">
<h3 data-number="16.5.3" class="anchored" data-anchor-id="proportion-of-observations-with-negative-growth-by-speciesriveryear"><span class="header-section-number">16.5.3</span> Proportion of observations with negative growth by species/river/year</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/propNegWB_BKT_1d32ab0ad68b5406fbc5aeda93314a02">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>plotPropNegByRiver <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp){</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">20</span>,  speciesGG <span class="sc">==</span> spp), </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(year, propNeg, <span class="at">color =</span> <span class="fu">factor</span>(seasonGG))) <span class="sc">+</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Proportion of opnservations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverGG)</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Brook trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Brown trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Atlantic salmon</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/propNegWB_BKT_bkt_7664cfe6521bca596ad7774d16043fc4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPropNegByRiver</span>(propNegSRsN, <span class="st">"Brook trout"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegWB_BKT_bkt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/propNegWB_BKT_bnt_b4d3f237257e92467623453ef3b8ef04">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPropNegByRiver</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(riverGG <span class="sc">!=</span> <span class="st">"Open Small"</span>), <span class="st">"Brown trout"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegWB_BKT_bnt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/propNegWB_BKT_ats_6e3fda474179247db11f45654ed5db50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPropNegByRiver</span>(propNegSRsN, <span class="st">"Atlantic salmon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propNegWB_BKT_ats-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="proportion-of-observations-with-negative-growth-by-speciesriveryear-1" class="level3" data-number="16.5.4">
<h3 data-number="16.5.4" class="anchored" data-anchor-id="proportion-of-observations-with-negative-growth-by-speciesriveryear-1"><span class="header-section-number">16.5.4</span> Proportion of observations with negative growth by species/river/year</h3>
<p>Break down season by year, compare across rivers</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/neg_posN_6e73cf0375ff6b86d3ee25b4d6a8516b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>), <span class="fu">aes</span>(year, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/neg_posN-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">15</span>, seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>), <span class="fu">aes</span>(year, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/neg_posN-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="negative-growth-by-individual" class="level2" data-number="16.6">
<h2 data-number="16.6" class="anchored" data-anchor-id="negative-growth-by-individual"><span class="header-section-number">16.6</span> Negative growth by individual</h2>
<p>Plot growth negative/positive for individual fish that lost mass. Order the individuals on the y-axis by proportion of observations that were negative.</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/plotNegGrInd_8bc98c69275b8db1a94ef94f8a41a4ab">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>plotIndNegGrowth <span class="ot">&lt;-</span> <span class="cf">function</span>(sppIn){</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    cd1 <span class="sc">|&gt;</span> </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>        species <span class="sc">==</span> sppIn, </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>        cohort <span class="sc">&gt;=</span> <span class="dv">2000</span>, cohort <span class="sc">&lt;=</span> <span class="dv">2013</span>, </span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.na</span>(negGrowth), </span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>        ageInSamples <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>        propNegGrowthByInd <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>        ageInSamples <span class="sc">&lt;</span> <span class="dv">12</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>        ), </span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(ageInSamples, <span class="fu">reorder</span>(tag, propNegGrowthByInd))</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> negGrowth)<span class="co">#, colour = "grey50", linewidth = 0.2</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="st">"Individual fish"</span>) <span class="sc">+</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Season and age"</span>,</span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>),</span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"F0"</span>, <span class="st">"W0"</span>, <span class="st">"S1"</span>, <span class="st">"S1"</span>, <span class="st">"F1"</span>, <span class="st">"W1"</span>, <span class="st">"S2"</span>, <span class="st">"S2"</span>,<span class="st">"F2"</span>, <span class="st">"W2"</span>, <span class="st">"S3"</span>, <span class="st">"S3"</span>,<span class="st">"F3"</span>, <span class="st">"W3"</span>, <span class="st">"S4"</span>)) <span class="sc">+</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E66100"</span>, <span class="st">"#5D3A9B"</span>)) <span class="sc">+</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>()</span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Brook trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Brown trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">Atlantic salmon</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/propIndNegWB_bkt_8c701f36c9d2c515e7f3d78484183b4a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndNegGrowth</span>(<span class="st">"bkt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propIndNegWB_bkt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/propIndNegWB_bnt_f3663732051859a5fb596d8eade0c74b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndNegGrowth</span>(<span class="st">"bnt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propIndNegWB_bnt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/propIndNegWB_ats_ff4654e17021d8852f1fb386cbdaa611">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndNegGrowth</span>(<span class="st">"ats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/propIndNegWB_ats-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="environmental-effects-on-proportion-of-observations-with-negative-growth" class="level2" data-number="16.7">
<h2 data-number="16.7" class="anchored" data-anchor-id="environmental-effects-on-proportion-of-observations-with-negative-growth"><span class="header-section-number">16.7</span> Environmental effects on Proportion of observations with negative growth</h2>
<section id="models-for-proportions" class="level3" data-number="16.7.1">
<h3 data-number="16.7.1" class="anchored" data-anchor-id="models-for-proportions"><span class="header-section-number">16.7.1</span> Models for proportions</h3>
<section id="brool-trout" class="level4" data-number="16.7.1.1">
<h4 data-number="16.7.1.1" class="anchored" data-anchor-id="brool-trout"><span class="header-section-number">16.7.1.1</span> Brool trout</h4>
<p>Probably delete this section</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/propModBKT_d926dac9815c692856ac836417b3a560">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>propModBKT1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10 <span class="sc">+</span> nInd <span class="sc">+</span> seasonGG <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>propModBKT2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10 <span class="sc">+</span> nInd <span class="sc">+</span> seasonGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>propModBKT3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10 <span class="sc">+</span> nInd )<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>propModBKT4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10  <span class="sc">+</span> seasonGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>propModBKT5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT  <span class="sc">+</span> nInd <span class="sc">+</span> seasonGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>propModBKT6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10 <span class="sc">+</span> nInd )<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>propModBKT7 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10  <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>propModBKT8 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> seasonGG <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>propModBKT9 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (nInd <span class="sc">+</span> seasonGG <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>propModBKT10 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mF_log10 <span class="sc">+</span> seasonGG <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>propModBKT11 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>propModBKT12<span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (seasonGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>propModBKT13 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (nInd)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a>propModBKT14 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mF_log10)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a>propModBKT15 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a>propModAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(propModBKT1, propModBKT2, propModBKT3, propModBKT4, propModBKT5, propModBKT6, propModBKT7, propModBKT8, propModBKT9, propModBKT10, propModBKT11, propModBKT12, propModBKT13, propModBKT14, propModBKT15) <span class="sc">|&gt;</span>  <span class="fu">arrange</span>(AIC)</span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rownames</span>(propModAIC)[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Length     Class      Mode 
        1 character character </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="fu">rownames</span>(propModAIC)[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = propNeg ~ (mF_log10 + seasonGG + riverGG)^2, data = filter(propNegSRsN, 
    speciesGG == "Brook trout"))

Coefficients:
         (Intercept)              mF_log10            seasonGG.L  
           -0.102080             -0.125794              0.212557  
          seasonGG.Q            seasonGG.C             riverGG.L  
            0.188602             -0.568568             -0.169175  
           riverGG.Q             riverGG.C   mF_log10:seasonGG.L  
            0.080556              0.011321              0.115009  
 mF_log10:seasonGG.Q   mF_log10:seasonGG.C    mF_log10:riverGG.L  
            0.215843             -0.395742             -0.044697  
  mF_log10:riverGG.Q    mF_log10:riverGG.C  seasonGG.L:riverGG.L  
            0.046653             -0.001675              0.155177  
seasonGG.Q:riverGG.L  seasonGG.C:riverGG.L  seasonGG.L:riverGG.Q  
            0.269973             -0.466788             -0.049743  
seasonGG.Q:riverGG.Q  seasonGG.C:riverGG.Q  seasonGG.L:riverGG.C  
           -0.099291              0.099554              0.028025  
seasonGG.Q:riverGG.C  seasonGG.C:riverGG.C  
            0.022183             -0.054596  </code></pre>
</div>
</div>
</section>
</section>
<section id="proportion-of-observations-with-negative-growth-by-flow" class="level3" data-number="16.7.2">
<h3 data-number="16.7.2" class="anchored" data-anchor-id="proportion-of-observations-with-negative-growth-by-flow"><span class="header-section-number">16.7.2</span> Proportion of observations with negative growth by <strong>flow</strong></h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_flow_a42827f0901cc06165c2a9db2159fe78">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(mF, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="fu">bquote</span>(<span class="st">"Mean flow "</span> <span class="sc">~</span> (m<span class="sc">^</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"·"</span> <span class="sc">~</span> s<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}))) <span class="sc">+</span> <span class="co">#alt-250 for dot +</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"West Brook"</span>) <span class="sc">+</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_flow-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">!=</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(mF, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="fu">bquote</span>(<span class="st">"Mean flow "</span> <span class="sc">~</span> (m<span class="sc">^</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"·"</span> <span class="sc">~</span> s<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}))) <span class="sc">+</span> <span class="co">#alt-250 for dot</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tributaries"</span>) <span class="sc">+</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_flow-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="proportion-of-observations-with-negative-growth-by-temperature" class="level3" data-number="16.7.3">
<h3 data-number="16.7.3" class="anchored" data-anchor-id="proportion-of-observations-with-negative-growth-by-temperature"><span class="header-section-number">16.7.3</span> Proportion of observations with negative growth by <strong>temperature</strong></h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_temp_24b19b2dfce2c79020ff6fb7b0c1124c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>plotNegGrowth_temp <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s){</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, seasonGG <span class="sc">==</span> s), <span class="fu">aes</span>(mT, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Mean temperature (C)"</span>) <span class="sc">+</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(s) <span class="sc">+</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>speciesGG)</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Spring</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Summer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">Autumn</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-4" role="tab" aria-controls="tabset-10-4" aria-selected="false">Winter</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_tempSPring_2560931d1308cd8cd8588cc576248ed7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotNegGrowth_temp</span>(propNegSRsN, <span class="st">"Spring"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_tempSPring-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_tempSummer_838a35d918827989268130c91b0d6a2a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotNegGrowth_temp</span>(propNegSRsN, <span class="st">"Summer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_tempSummer-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_tempAutumn_45046092c9632cd28eb0782ca921b20d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotNegGrowth_temp</span>(propNegSRsN, <span class="st">"Autumn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_tempAutumn-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-10-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_tempWinter_34b0575742af1dbd68490100a939daab">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotNegGrowth_temp</span>(propNegSRsN, <span class="st">"Winter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_tempWinter-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="proportion-of-observations-with-negative-growth-by-3-species-fish-counts" class="level3" data-number="16.7.4">
<h3 data-number="16.7.4" class="anchored" data-anchor-id="proportion-of-observations-with-negative-growth-by-3-species-fish-counts"><span class="header-section-number">16.7.4</span> Proportion of observations with negative growth by <strong>3 species fish counts</strong></h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_counts3Spp_d44533f63b75966277d2e7b2066f3d74">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(nInd, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"3 species count"</span>) <span class="sc">+</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"West Brook"</span>) <span class="sc">+</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_counts3Spp-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">!=</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(nInd, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"3 species count"</span>) <span class="sc">+</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tributaries"</span>) <span class="sc">+</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_counts3Spp-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="proportion-of-observations-with-negative-growth-by-conspecific-fish-counts" class="level3" data-number="16.7.5">
<h3 data-number="16.7.5" class="anchored" data-anchor-id="proportion-of-observations-with-negative-growth-by-conspecific-fish-counts"><span class="header-section-number">16.7.5</span> Proportion of observations with negative growth by <strong>conspecific fish counts</strong></h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_counts1Spp_3599deae00e2d2880e3f02f9fcd161c5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(nIndBySpp, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"conspecific count"</span>) <span class="sc">+</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"West Brook"</span>) <span class="sc">+</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_counts1Spp-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">!=</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(nIndBySpp, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"conspecific count"</span>) <span class="sc">+</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tributaries"</span>) <span class="sc">+</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_counts1Spp-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="xgboost-model-for-proportion-of-fish-with-negative-growth" class="level2" data-number="16.8">
<h2 data-number="16.8" class="anchored" data-anchor-id="xgboost-model-for-proportion-of-fish-with-negative-growth"><span class="header-section-number">16.8</span> XGBoost model for proportion of fish with negative growth</h2>
<section id="hyperparameter-search-grid" class="level3" data-number="16.8.1">
<h3 data-number="16.8.1" class="anchored" data-anchor-id="hyperparameter-search-grid"><span class="header-section-number">16.8.1</span> Hyperparameter search grid</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/runML_HP_propNeg_c4c9d80252d2e1e4c582110653b6f7c8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>runHyperparamSearch <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> propNegSRsN, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"speciesGG"</span>, <span class="st">"riverGG"</span>, <span class="st">"year"</span>, <span class="st">"mT"</span>, <span class="st">"mF_log10"</span>, <span class="st">"nInd"</span>, <span class="st">"propNeg"</span>), <span class="at">nRoundsIn =</span> <span class="dv">100000</span>, <span class="at">early_stopping_roundsIn =</span> <span class="dv">500</span>) {</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  dML_propNeg <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars)) </span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variable names</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  features_propNeg <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dML_propNeg), <span class="st">"propNeg"</span>)</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the treatment plan from the training data</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>  treatplan_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">designTreatmentsZ</span>(dML_propNeg, features_propNeg, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the "clean" variable names from the scoreFrame</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  new_vars_propNeg <span class="ot">&lt;-</span> treatplan_propNeg <span class="sc">%&gt;%</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>        </span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)     </span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the training data</span></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>  features_train_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_propNeg, dML_propNeg, <span class="at">varRestriction =</span> new_vars_propNeg) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>  response_train_propNeg <span class="ot">&lt;-</span> dML_propNeg<span class="sc">$</span>propNeg</span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create hyperparameter grid</span></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>  hyper_grid_propNeg <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">3</span>),</span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_child_weight =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">subsample =</span> <span class="fu">c</span>(.<span class="dv">65</span>, .<span class="dv">8</span>, <span class="dv">1</span>),</span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">colsample_bytree =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">9</span>, <span class="dv">1</span>),</span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">optimal_trees =</span> <span class="dv">0</span>,               <span class="co"># a place to dump results</span></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_RMSE =</span> <span class="dv">0</span>                     <span class="co"># a place to dump results</span></span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reproducibility</span></span>
<span id="cb133-36"><a href="#cb133-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb133-37"><a href="#cb133-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   </span></span>
<span id="cb133-38"><a href="#cb133-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># grid search</span></span>
<span id="cb133-39"><a href="#cb133-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hyper_grid_propNeg)) {</span>
<span id="cb133-40"><a href="#cb133-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(i, <span class="st">" out of "</span>, <span class="fu">nrow</span>(hyper_grid_propNeg)))</span>
<span id="cb133-41"><a href="#cb133-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create parameter list</span></span>
<span id="cb133-42"><a href="#cb133-42" aria-hidden="true" tabindex="-1"></a>    params_propNeg <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb133-43"><a href="#cb133-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">eta =</span> hyper_grid_propNeg<span class="sc">$</span>eta[i],</span>
<span id="cb133-44"><a href="#cb133-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_depth =</span> hyper_grid_propNeg<span class="sc">$</span>max_depth[i],</span>
<span id="cb133-45"><a href="#cb133-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_child_weight =</span> hyper_grid_propNeg<span class="sc">$</span>min_child_weight[i],</span>
<span id="cb133-46"><a href="#cb133-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">subsample =</span> hyper_grid_propNeg<span class="sc">$</span>subsample[i],</span>
<span id="cb133-47"><a href="#cb133-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">colsample_bytree =</span> hyper_grid_propNeg<span class="sc">$</span>colsample_bytree[i]</span>
<span id="cb133-48"><a href="#cb133-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb133-49"><a href="#cb133-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-50"><a href="#cb133-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-51"><a href="#cb133-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># train model</span></span>
<span id="cb133-52"><a href="#cb133-52" aria-hidden="true" tabindex="-1"></a>    xgb.tune_propNeg <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb133-53"><a href="#cb133-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> params_propNeg,</span>
<span id="cb133-54"><a href="#cb133-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> features_train_propNeg,</span>
<span id="cb133-55"><a href="#cb133-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> response_train_propNeg,</span>
<span id="cb133-56"><a href="#cb133-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrounds =</span> <span class="dv">100000</span>,</span>
<span id="cb133-57"><a href="#cb133-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb133-58"><a href="#cb133-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="co">#"reg:linear",  # for regression models</span></span>
<span id="cb133-59"><a href="#cb133-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="dv">0</span>,               <span class="co"># silent,</span></span>
<span id="cb133-60"><a href="#cb133-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">early_stopping_rounds =</span> early_stopping_roundsIn <span class="co"># stop if no improvement for x consecutive trees</span></span>
<span id="cb133-61"><a href="#cb133-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb133-62"><a href="#cb133-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-63"><a href="#cb133-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add min training error and trees to grid</span></span>
<span id="cb133-64"><a href="#cb133-64" aria-hidden="true" tabindex="-1"></a>    hyper_grid_propNeg<span class="sc">$</span>optimal_trees[i] <span class="ot">&lt;-</span> <span class="fu">which.min</span>(xgb.tune_propNeg<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_rmse_mean)</span>
<span id="cb133-65"><a href="#cb133-65" aria-hidden="true" tabindex="-1"></a>    hyper_grid_propNeg<span class="sc">$</span>min_RMSE[i] <span class="ot">&lt;-</span> <span class="fu">min</span>(xgb.tune_propNeg<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_rmse_mean)</span>
<span id="cb133-66"><a href="#cb133-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb133-67"><a href="#cb133-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-68"><a href="#cb133-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(hyper_grid_propNeg <span class="sc">|&gt;</span> <span class="fu">arrange</span>(min_RMSE))</span>
<span id="cb133-69"><a href="#cb133-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-70"><a href="#cb133-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb133-71"><a href="#cb133-71" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; #     eta max_depth min_child_weight subsample colsample_bytree optimal_trees  min_RMSE</span></span>
<span id="cb133-72"><a href="#cb133-72" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 1  0.10         1                7      0.80              0.9            57 0.1833918</span></span>
<span id="cb133-73"><a href="#cb133-73" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 2  0.10         3                3      1.00              1.0            52 0.1835447</span></span>
<span id="cb133-74"><a href="#cb133-74" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 3  0.05         3                1      0.65              0.9            88 0.1849762</span></span>
<span id="cb133-75"><a href="#cb133-75" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 4  0.01         3                7      1.00              0.9           514 0.1853950</span></span>
<span id="cb133-76"><a href="#cb133-76" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 5  0.30         5                1      0.80              1.0            17 0.1854102</span></span>
<span id="cb133-77"><a href="#cb133-77" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 6  0.01         3                3      0.65              0.8           438 0.1854346</span></span>
<span id="cb133-78"><a href="#cb133-78" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 7  0.30         5                1      1.00              0.9            14 0.1856684</span></span>
<span id="cb133-79"><a href="#cb133-79" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 8  0.01         1                3      0.65              0.9           560 0.1857717</span></span>
<span id="cb133-80"><a href="#cb133-80" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 9  0.30         3                1      1.00              1.0            13 0.1859183</span></span>
<span id="cb133-81"><a href="#cb133-81" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 10 0.30         3                3      0.65              0.8            21 0.1860299</span></span>
<span id="cb133-82"><a href="#cb133-82" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 11 0.05         7                3      0.80              0.8           123 0.1860336</span></span>
<span id="cb133-83"><a href="#cb133-83" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 12 0.01         3                5      0.80              1.0           512 0.1861016</span></span>
<span id="cb133-84"><a href="#cb133-84" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 13 0.10         3                7      0.65              1.0            45 0.1861042</span></span>
<span id="cb133-85"><a href="#cb133-85" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 14 0.10         3                5      1.00              1.0            55 0.1861160</span></span>
<span id="cb133-86"><a href="#cb133-86" aria-hidden="true" tabindex="-1"></a><span class="co"># # &gt; # 15 0.10         1                1      1.00              0.9           179 0.1861891</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function-to-run-models" class="level3" data-number="16.8.2">
<h3 data-number="16.8.2" class="anchored" data-anchor-id="function-to-run-models"><span class="header-section-number">16.8.2</span> Function to run models</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/xgBoostPropNegFunction_33169e15f9e028a7b77302440fce64df">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># http://uc-r.github.io/gbm_regression</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>runXGB <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> propNegSRsN, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"speciesGG"</span>, <span class="st">"riverGG"</span>, <span class="st">"year"</span>, <span class="st">"mT"</span>, <span class="st">"mF_log10"</span>, <span class="st">"nInd"</span>, <span class="st">"propNeg"</span>), <span class="at">nRoundsIn =</span> <span class="dv">100000</span>, <span class="at">params =</span> params_propNegIn) {</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">125</span>)</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  dML_propNeg <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars)) </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variable names</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  features_propNeg <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dML_propNeg), <span class="st">"propNeg"</span>)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the treatment plan from the training data</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  treatplan_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">designTreatmentsZ</span>(dML_propNeg, features_propNeg, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the "clean" variable names from the scoreFrame</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>  new_vars_propNeg <span class="ot">&lt;-</span> treatplan_propNeg <span class="sc">%&gt;%</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>        </span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)     </span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the training data</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>  features_train_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_propNeg, dML_propNeg, <span class="at">varRestriction =</span> new_vars_propNeg) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  response_train_propNeg <span class="ot">&lt;-</span> dML_propNeg<span class="sc">$</span>propNeg</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the test data</span></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>  features_test_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_propNeg, dML_propNeg, <span class="at">varRestriction =</span> new_vars_propNeg) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>  response_test_propNeg <span class="ot">&lt;-</span> dML_propNeg<span class="sc">$</span>propNeg</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Run model</span></span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># parameter list - from the top model of the grid search above</span></span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>  params_propNeg <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta =</span> params<span class="sc">$</span>eta, <span class="co">#0.01,</span></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_depth =</span> params<span class="sc">$</span>max_depth, <span class="co">#1,</span></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_child_weight =</span> params<span class="sc">$</span>min_child_weight, <span class="co">#7,</span></span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">subsample =</span> params<span class="sc">$</span>subsample, <span class="co">#0.8,</span></span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">colsample_bytree =</span> params<span class="sc">$</span>colsample_bytree <span class="co">#0.9</span></span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>   <span class="co"># optimal_trees = params$optimal_trees</span></span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># train final model</span></span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>  xgb.fit.final_propNeg <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> params_propNeg,</span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> features_train_propNeg,</span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> response_train_propNeg,</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrounds =</span> nRoundsIn,</span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>,</span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_rounds =</span> <span class="dv">250</span> <span class="co"># stop if no improvement for 20 consecutive trees</span></span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">dat =</span> dML_propNeg,</span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">xgb =</span> xgb.fit.final_propNeg,</span>
<span id="cb134-56"><a href="#cb134-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">new_vars =</span> new_vars_propNeg,</span>
<span id="cb134-57"><a href="#cb134-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">features_train =</span> features_train_propNeg,</span>
<span id="cb134-58"><a href="#cb134-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">response_train =</span> response_train_propNeg</span>
<span id="cb134-59"><a href="#cb134-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb134-60"><a href="#cb134-60" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-61"><a href="#cb134-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-62"><a href="#cb134-62" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="brook-trout-7" class="level3" data-number="16.8.3">
<h3 data-number="16.8.3" class="anchored" data-anchor-id="brook-trout-7"><span class="header-section-number">16.8.3</span> Brook trout</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/runXGB_BKT1_3036a16d0e955e491097adeb32fc7e4e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### uncomment to run hyperparameter search grid</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hpPropNegBKT &lt;- runHyperparamSearch(</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt;  filter(speciesGG == "Brook trout", year &gt; 2001),</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("riverGG", "year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   early_stopping_roundsIn = 250</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co"># save(hpPropNegBKT, file = "./data/out/XGBoost/hyperParam/hpPropNegBKT_250.RData")</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpPropNegBKT_250.RData"</span>)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>hpPropNegBKT[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    eta max_depth min_child_weight subsample colsample_bytree optimal_trees
1  0.01         5                5      0.80              0.9           596
2  0.01         3                3      1.00              0.8          1375
3  0.05         3                1      0.80              0.9           208
4  0.01         3                5      0.80              0.8          1132
5  0.01         7                7      1.00              1.0           392
6  0.01         7                5      0.65              0.8           581
7  0.10         5                3      0.80              0.8            38
8  0.01         5                7      0.80              0.9           450
9  0.30         3                1      0.80              0.8            57
10 0.05         5                3      1.00              0.9           123
    min_RMSE
1  0.1289382
2  0.1294819
3  0.1301824
4  0.1302462
5  0.1302568
6  0.1306034
7  0.1308955
8  0.1308964
9  0.1310481
10 0.1313799</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### uncomment to run XGBoost</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="co"># propNegBKT &lt;- runXGB(</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt;  filter(speciesGG == "Brook trout", year &gt; 2001),</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("riverGG", "year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   params = hpPropNegBKT[1,]</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="co"># save(propNegBKT, file = "./data/out/XGBoost/modelRuns/XGBpropNegBKT_250.RData")</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBpropNegBKT_250.RData"</span>)</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>propNegBKT<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 67631</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>propNegBKT<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0005971119</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>viBKT <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> propNegBKT<span class="sc">$</span>xgb)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viBKT, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>s_propNegBKT <span class="ot">&lt;-</span> <span class="fu">hstats</span>(propNegBKT<span class="sc">$</span>xgb, <span class="at">v =</span> propNegBKT<span class="sc">$</span>new_vars, <span class="at">X =</span> propNegBKT<span class="sc">$</span>features_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1-way calculations...

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=========                                                             |  12%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==========================                                            |  38%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |======================================================================| 100%
2-way calculations...

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>s_propNegBKT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'hstats' object. Use plot() or summary() for details.

H^2 (normalized)
[1] 0.364951</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_propNegBKT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_propNegBKT, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_propNegBKT, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">normalize =</span> F, <span class="at">squared =</span> F, <span class="at">facet_scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegBKT, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>pFlow_propNeg <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>pTemp_propNeg <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>pNInd_propNeg <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>pYear_propNeg <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pFlow_propNeg, pTemp_propNeg, pNInd_propNeg, pYear_propNeg, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>pFlow_propNegDataBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mF_log10<span class="sc">-</span><span class="fu">mean</span>(mF_log10))<span class="sc">/</span><span class="fu">sd</span>(mF_log10),</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>pMT_propNegDataBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mT<span class="sc">-</span><span class="fu">mean</span>(mT))<span class="sc">/</span><span class="fu">sd</span>(mT),</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>pNInd_propNegDataBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>pYear_propNegDataBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a>all_propNegDataBKT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pFlow_propNegDataBKT, pMT_propNegDataBKT, pNInd_propNegDataBKT, pYear_propNegDataBKT)</span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>all_propNegDataBKT_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegDataBKT, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All river on one graph</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>partialWBBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"West Brook"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>)</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>partialOLBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Large"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>)</span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>partialOSBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>)</span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a>partialISBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Isolated_Small"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Isolated Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Isolated_Small"</span>)</span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a>partialRiversBKT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partialWBBKT, partialOLBKT, partialOSBKT, partialISBKT) <span class="sc">|&gt;</span> </span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RiverEffect =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span><span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">riverOrdered =</span> <span class="fu">factor</span>(riverGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>, <span class="st">"Isolated Small"</span>), </span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> T))</span>
<span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(partialRiversBKT, <span class="fu">aes</span>(riverOrdered, yhat, <span class="at">fill =</span> <span class="fu">factor</span>(RiverEffect))) <span class="sc">+</span></span>
<span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb150-31"><a href="#cb150-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mT"</span>, <span class="at">X =</span> propNegBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mF_log10"</span>)) <span class="sc">+</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mF_log10), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-7.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mT"</span>)) <span class="sc">+</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mT), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-8.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BKT1-9.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="brown-trout-7" class="level3" data-number="16.8.4">
<h3 data-number="16.8.4" class="anchored" data-anchor-id="brown-trout-7"><span class="header-section-number">16.8.4</span> Brown trout</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/runXGB_BNT_a2d6348122f882040b1320850ef520b5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hpPropNegBNT &lt;- runHyperparamSearch(</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt;  filter(speciesGG == "Brown trout", year &gt; 2001),</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("riverGG", "year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   early_stopping_roundsIn = 250</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save(hpPropNegBNT, file = "./data/out/XGBoost/hyperParam/hpPropNegBNT_250.RData")</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpPropNegBNT_250.RData"</span>)</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>hpPropNegBNT[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    eta max_depth min_child_weight subsample colsample_bytree optimal_trees
1  0.30         1                3      0.65              0.9            11
2  0.30         1                3      1.00              0.9            17
3  0.05         1                3      0.80              0.9           178
4  0.10         1                3      0.80              0.9            48
5  0.01         1                3      1.00              0.9           455
6  0.10         3                1      0.65              0.9            29
7  0.30         1                3      0.65              1.0            21
8  0.01         1                3      0.65              0.8           523
9  0.10         1                3      0.80              1.0            44
10 0.30         1                5      0.80              0.9            41
    min_RMSE
1  0.1271580
2  0.1275897
3  0.1293155
4  0.1307409
5  0.1308256
6  0.1312113
7  0.1312372
8  0.1314425
9  0.1314432
10 0.1316114</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>propNegBNT <span class="ot">&lt;-</span> <span class="fu">runXGB</span>(</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> propNegSRsN <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brown trout"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>, nInd <span class="sc">&gt;</span> <span class="dv">10</span>),</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"year"</span>, <span class="st">"mT"</span>, <span class="st">"mF_log10"</span>, <span class="st">"nInd"</span>, <span class="st">"propNeg"</span>),</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nRoundsIn =</span> <span class="dv">250000</span>,</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> hpPropNegBNT[<span class="dv">1</span>,]</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="co"># save(propNegBNT, file = "./data/out/XGBoost/modelRuns/XGBpropNegBNT_250.RData")</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBpropNegBNT_250.RData"</span>)</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>propNegBNT<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13581</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>propNegBNT<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0004765856</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>viBNT <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> propNegBNT<span class="sc">$</span>xgb)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viBNT, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BNT-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="co">#s_propNegBNT &lt;- hstats(propNegBNT$xgb, v = propNegBNT$new_vars, X = propNegBNT$features_train)</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># s_propNegBNT</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegBNT)</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_propNegBNT, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegBNT, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>pFlow_propNeg <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb162-20"><a href="#cb162-20" aria-hidden="true" tabindex="-1"></a>pTemp_propNeg <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb162-21"><a href="#cb162-21" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb162-22"><a href="#cb162-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb162-23"><a href="#cb162-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb162-24"><a href="#cb162-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-25"><a href="#cb162-25" aria-hidden="true" tabindex="-1"></a>pNInd_propNeg <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb162-26"><a href="#cb162-26" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb162-27"><a href="#cb162-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb162-28"><a href="#cb162-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb162-29"><a href="#cb162-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-30"><a href="#cb162-30" aria-hidden="true" tabindex="-1"></a>pYear_propNeg <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb162-31"><a href="#cb162-31" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb162-32"><a href="#cb162-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb162-33"><a href="#cb162-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb162-34"><a href="#cb162-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-35"><a href="#cb162-35" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pFlow_propNeg, pTemp_propNeg, pNInd_propNeg, pYear_propNeg, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BNT-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all partials on one graph</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>pFlow_propNegDataBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mF_log10<span class="sc">-</span><span class="fu">mean</span>(mF_log10))<span class="sc">/</span><span class="fu">sd</span>(mF_log10),</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>pMT_propNegDataBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mT<span class="sc">-</span><span class="fu">mean</span>(mT))<span class="sc">/</span><span class="fu">sd</span>(mT),</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a>pNInd_propNegDataBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb163-18"><a href="#cb163-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb163-19"><a href="#cb163-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb163-20"><a href="#cb163-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-21"><a href="#cb163-21" aria-hidden="true" tabindex="-1"></a>pYear_propNegDataBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb163-22"><a href="#cb163-22" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb163-23"><a href="#cb163-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb163-24"><a href="#cb163-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb163-25"><a href="#cb163-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb163-26"><a href="#cb163-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-27"><a href="#cb163-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-28"><a href="#cb163-28" aria-hidden="true" tabindex="-1"></a>all_propNegDataBNT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pFlow_propNegDataBNT, pMT_propNegDataBNT, pNInd_propNegDataBNT, pYear_propNegDataBNT)</span>
<span id="cb163-29"><a href="#cb163-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-30"><a href="#cb163-30" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb163-31"><a href="#cb163-31" aria-hidden="true" tabindex="-1"></a>all_propNegDataBNT_gg <span class="ot">&lt;-</span> </span>
<span id="cb163-32"><a href="#cb163-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(all_propNegDataBNT, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb163-33"><a href="#cb163-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb163-34"><a href="#cb163-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb163-35"><a href="#cb163-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb163-36"><a href="#cb163-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb163-37"><a href="#cb163-37" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BNT-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All river on one graph</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>partialWBBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"West Brook"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>)</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>partialOLBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Large"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>)</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>partialOSBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>)</span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a>partialRiversBNT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partialWBBNT, partialOLBNT, partialOSBNT) <span class="sc">|&gt;</span> </span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RiverEffect =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span><span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb164-22"><a href="#cb164-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">riverOrdered =</span> <span class="fu">factor</span>(riverGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>), </span>
<span id="cb164-23"><a href="#cb164-23" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> T))</span>
<span id="cb164-24"><a href="#cb164-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-25"><a href="#cb164-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(partialRiversBNT, <span class="fu">aes</span>(riverOrdered, yhat, <span class="at">fill =</span> <span class="fu">factor</span>(RiverEffect))) <span class="sc">+</span></span>
<span id="cb164-26"><a href="#cb164-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb164-27"><a href="#cb164-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BNT-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mT"</span>, <span class="at">X =</span> propNegBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mF_log10"</span>)) <span class="sc">+</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mF_log10), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BNT-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mT"</span>)) <span class="sc">+</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mT), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BNT-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_BNT-7.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="atlantic-salmon-7" class="level3" data-number="16.8.5">
<h3 data-number="16.8.5" class="anchored" data-anchor-id="atlantic-salmon-7"><span class="header-section-number">16.8.5</span> Atlantic salmon</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/runXGB_ATS_ca7a0193e5462f58b4770443794aed58">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hpPropNegATS &lt;- runHyperparamSearch(</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt;  filter(speciesGG == "Atlantic salmon", riverGG == "West Brook", year &lt; 2007),</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   early_stopping_roundsIn = 250</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save(hpPropNegATS, file = "./data/out/XGBoost/hyperParam/hpPropNegATS_250.RData")</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpPropNegATS_250.RData"</span>)</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>hpPropNegATS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    eta max_depth min_child_weight subsample colsample_bytree optimal_trees
1  0.30         1                1      0.65              0.9            17
2  0.10         5                3      0.65              0.8            36
3  0.30         1                5      0.80              1.0            85
4  0.01         1                3      0.80              0.9           427
5  0.30         1                1      0.80              1.0            16
6  0.01         7                3      0.80              0.8           351
7  0.01         7                1      0.65              0.9           371
8  0.10         7                1      0.65              0.9            34
9  0.30         5                3      0.65              0.9            20
10 0.10         3                5      0.80              0.8            47
    min_RMSE
1  0.1802524
2  0.1810207
3  0.1825029
4  0.1834041
5  0.1839152
6  0.1856746
7  0.1866094
8  0.1871390
9  0.1874577
10 0.1887720</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Atlantic salmon"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, n, <span class="at">color =</span> seasonGG)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_ATS-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># propNegATS &lt;- runXGB(</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt; filter(speciesGG == "Atlantic salmon", riverGG == "West Brook", year &lt; 2007),</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   params = hpPropNegATS[1,]</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save(propNegATS, file = "./data/out/XGBoost/modelRuns/XGBpropNegATS_250.RData")</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBpropNegATS_250.RData"</span>)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>propNegATS<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2720</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>propNegATS<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0004255186</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>viATS <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> propNegATS<span class="sc">$</span>xgb)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viATS, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_ATS-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="co">#s_propNegATS &lt;- hstats(propNegATS$xgb, v = propNegATS$new_vars, X = propNegATS$features_train)</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="co"># s_propNegATS</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegATS)</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_propNegATS, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegATS, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>pFlow_propNegATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a>pTemp_propNegATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb177-21"><a href="#cb177-21" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb177-22"><a href="#cb177-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb177-23"><a href="#cb177-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb177-24"><a href="#cb177-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-25"><a href="#cb177-25" aria-hidden="true" tabindex="-1"></a>pNInd_propNegATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb177-26"><a href="#cb177-26" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb177-27"><a href="#cb177-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb177-28"><a href="#cb177-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb177-29"><a href="#cb177-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-30"><a href="#cb177-30" aria-hidden="true" tabindex="-1"></a>pYear_propNegATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb177-31"><a href="#cb177-31" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb177-32"><a href="#cb177-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb177-33"><a href="#cb177-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb177-34"><a href="#cb177-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-35"><a href="#cb177-35" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pFlow_propNegATS, pTemp_propNegATS, pNInd_propNegATS, pYear_propNegATS, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_ATS-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>pFlow_propNegDataATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mF_log10<span class="sc">-</span><span class="fu">mean</span>(mF_log10))<span class="sc">/</span><span class="fu">sd</span>(mF_log10),</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>pMT_propNegDataATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mT<span class="sc">-</span><span class="fu">mean</span>(mT))<span class="sc">/</span><span class="fu">sd</span>(mT),</span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>pNInd_propNegDataATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>pYear_propNegDataATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a>all_propNegDataATS <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pFlow_propNegDataATS, pMT_propNegDataATS, pNInd_propNegDataATS, pYear_propNegDataATS)</span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb178-31"><a href="#cb178-31" aria-hidden="true" tabindex="-1"></a>all_propNegDataATS_gg <span class="ot">&lt;-</span> </span>
<span id="cb178-32"><a href="#cb178-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_propNegDataATS, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb178-33"><a href="#cb178-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb178-34"><a href="#cb178-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb178-35"><a href="#cb178-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb178-36"><a href="#cb178-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb178-37"><a href="#cb178-37" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_ATS-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mT"</span>, <span class="at">X =</span> propNegATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mF_log10"</span>)) <span class="sc">+</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mF_log10), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_ATS-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mT"</span>)) <span class="sc">+</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mT), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_ATS-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runXGB_ATS-7.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="species-together" class="level3" data-number="16.8.6">
<h3 data-number="16.8.6" class="anchored" data-anchor-id="species-together"><span class="header-section-number">16.8.6</span> 3 species together</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/threeSppVIP_5aca610e7f3dcc13ff741e8a34b8af25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plots</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>viAll <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  viBKT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>),</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  viBNT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>),</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>  viATS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sppOrdered =</span> <span class="fu">factor</span>(speciesGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Brook Trout"</span>, <span class="st">"Brown Trout"</span>, <span class="st">"Atlantic Salmon"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">feature2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"mF_log10"</span> <span class="sc">~</span> <span class="st">"Flow"</span>,</span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"mT"</span> <span class="sc">~</span> <span class="st">"Temperature"</span>,</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"nInd"</span> <span class="sc">~</span> <span class="st">"Num Individuals"</span>,</span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"year"</span> <span class="sc">~</span> <span class="st">"Year"</span>)</span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(viAll <span class="sc">|&gt;</span> <span class="fu">filter</span>(Feature <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"mF_log10"</span>, <span class="st">"mT"</span>, <span class="st">"nInd"</span>, <span class="st">"year"</span>)), <span class="fu">aes</span>(feature2, Gain, <span class="at">fill =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>() <span class="sc">+</span></span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Variable importance for the proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Variable"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/threeSppVIP-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>all_propNegData3spp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_propNegDataBKT, all_propNegDataBNT, all_propNegDataATS) <span class="sc">|&gt;</span> </span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sppOrdered =</span> <span class="fu">factor</span>(speciesGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Brook Trout"</span>, <span class="st">"Brown Trout"</span>, <span class="st">"Atlantic Salmon"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>all_propNegData3sppFlow_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Flow"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled flow"</span>) <span class="sc">+</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>all_propNegData3sppTemp_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Temperature"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled temperature"</span>) <span class="sc">+</span></span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a>all_propNegData3sppNInd_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Num inds"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb184-27"><a href="#cb184-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb184-28"><a href="#cb184-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled Number of individuals"</span>) <span class="sc">+</span></span>
<span id="cb184-29"><a href="#cb184-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb184-30"><a href="#cb184-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-31"><a href="#cb184-31" aria-hidden="true" tabindex="-1"></a>all_propNegData3sppYear_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Year"</span>), <span class="fu">aes</span>(year, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb184-32"><a href="#cb184-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb184-33"><a href="#cb184-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb184-34"><a href="#cb184-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb184-35"><a href="#cb184-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb184-36"><a href="#cb184-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb184-37"><a href="#cb184-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb184-38"><a href="#cb184-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-39"><a href="#cb184-39" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb184-40"><a href="#cb184-40" aria-hidden="true" tabindex="-1"></a>  all_propNegData3sppFlow_gg, </span>
<span id="cb184-41"><a href="#cb184-41" aria-hidden="true" tabindex="-1"></a>  all_propNegData3sppTemp_gg,</span>
<span id="cb184-42"><a href="#cb184-42" aria-hidden="true" tabindex="-1"></a>  all_propNegData3sppNInd_gg,</span>
<span id="cb184-43"><a href="#cb184-43" aria-hidden="true" tabindex="-1"></a>  all_propNegData3sppYear_gg,</span>
<span id="cb184-44"><a href="#cb184-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">left =</span> <span class="fu">textGrob</span>(<span class="fu">expression</span>(<span class="fu">bold</span>(<span class="st">"Effect on proportion of negative observations"</span>)), <span class="at">rot =</span> <span class="dv">90</span>, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">16</span>))</span>
<span id="cb184-45"><a href="#cb184-45" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/threeSppVIP-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="ft-cycle-graphs" class="level2" data-number="16.9">
<h2 data-number="16.9" class="anchored" data-anchor-id="ft-cycle-graphs"><span class="header-section-number">16.9</span> F/T cycle graphs</h2>
<section id="mean-flow-and-temperature" class="level3" data-number="16.9.1">
<h3 data-number="16.9.1" class="anchored" data-anchor-id="mean-flow-and-temperature"><span class="header-section-number">16.9.1</span> Mean flow and temperature</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_temp_cycle_bySpecies_3986965e2eb1f7347bebcd515ee8b81d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>plot_mT_mF <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s, plotText){</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">25</span>, speciesGG <span class="sc">==</span> s), <span class="fu">aes</span>(mT, mF_log10, <span class="at">color =</span> <span class="fu">factor</span>(seasonGG))) <span class="sc">+</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> propNeg)) <span class="sc">+</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>    {<span class="cf">if</span>(plotText) <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> year), <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.075</span>, <span class="at">check_overlap =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">3</span>)} <span class="sc">+</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean temperature (C)"</span>, <span class="at">y =</span> <span class="st">"log10 of mean Flow"</span>) <span class="sc">+</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Brook trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Brown trout</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">Atlantic salmon</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_temp_cycle_bySpecies_bkt_5cf2a16b3c9218d343a05ddeb7542246">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Brook trout"</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_temp_cycle_bySpecies_bkt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_temp_cycle_bySpecies_bnt_83271acfc4b54759a1bb7ab5731b8a17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Brown trout"</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_temp_cycle_bySpecies_bnt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_temp_cycle_bySpecies_ats_5d0b599c00c32375c33b025c1b5c2cea">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Atlantic salmon"</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_temp_cycle_bySpecies_ats-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="mean-flow-and-temperature-with-year-labels" class="level3" data-number="16.9.2">
<h3 data-number="16.9.2" class="anchored" data-anchor-id="mean-flow-and-temperature-with-year-labels"><span class="header-section-number">16.9.2</span> Mean flow and temperature with year labels</h3>
<section id="panel-tabset" class="level4" data-number="16.9.2.1">
<h4 data-number="16.9.2.1" class="anchored" data-anchor-id="panel-tabset"><span class="header-section-number">16.9.2.1</span> panel-tabset</h4>
</section>
</section>
<section id="brook-trout-9" class="level3" data-number="16.9.3">
<h3 data-number="16.9.3" class="anchored" data-anchor-id="brook-trout-9"><span class="header-section-number">16.9.3</span> Brook trout</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_temp_cycle_bySpeciesYear_bkt_25085fddc44b315735fa2aaf50bada16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Brook trout"</span>, <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_temp_cycle_bySpeciesYear_bkt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="brown-trout-9" class="level4" data-number="16.9.3.1">
<h4 data-number="16.9.3.1" class="anchored" data-anchor-id="brown-trout-9"><span class="header-section-number">16.9.3.1</span> Brown trout</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_temp_cycle_bySpeciesYear_bnt_361bfb70a1f66fdf1e0c9b89e0978836">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Brown trout"</span>, <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_temp_cycle_bySpeciesYear_bnt-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="atlantic-salmon-9" class="level4" data-number="16.9.3.2">
<h4 data-number="16.9.3.2" class="anchored" data-anchor-id="atlantic-salmon-9"><span class="header-section-number">16.9.3.2</span> Atlantic salmon</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_temp_cycle_bySpeciesYear_ats_828709961436f07ae670b1b96eed75b3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Atlantic salmon"</span>, <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_temp_cycle_bySpeciesYear_ats-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>:::</p>
<p>Mean flow and temperature values for each season and year for the West Brook<br>
Not very informative</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/flow_temp_cycle_bySpeciesYear2_a5114daba30097a390327bcb7d361ec4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">==</span> <span class="st">'West Brook'</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(riverGG, speciesGG, year, seasonGG), <span class="fu">aes</span>(mT, mF_log10)) <span class="sc">+</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(seasonGG))) <span class="sc">+</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/flow_temp_cycle_bySpeciesYear2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="yearly-temperatureflow-cycles-of-daily-data" class="level3" data-number="16.9.4">
<h3 data-number="16.9.4" class="anchored" data-anchor-id="yearly-temperatureflow-cycles-of-daily-data"><span class="header-section-number">16.9.4</span> Yearly temperature/flow cycles of daily data</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/mergePropNegPlot_d12d9e169e87b268091a255d7b943621">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>plotMerged <span class="ot">&lt;-</span> <span class="cf">function</span>(d, r, <span class="at">minYear =</span> <span class="dv">2000</span>, <span class="at">maxYear =</span> <span class="dv">2017</span>){</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(riverGG <span class="sc">==</span> r, year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear)), </span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(temperature, <span class="fu">log10</span>(flowByRiver), <span class="at">color =</span> seasonGG, <span class="at">group =</span> seasonGG)) <span class="sc">+</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_line() +</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (C)"</span>, <span class="at">y =</span> <span class="st">"log10 of Flow"</span>) <span class="sc">+</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(r) <span class="sc">+</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>year, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="co"># this plots f/t for all three species - good for filling in gaps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">West Brook</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Open Large</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false">Open Small</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-4" role="tab" aria-controls="tabset-12-4" aria-selected="false">Isolated small</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/mergePropNegPlot_wb_24c71dca08ac7f6ef9458deb3fe1af79">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMerged</span>(envIn_propNeg, <span class="st">"West Brook"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/mergePropNegPlot_wb-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/mergePropNegPlot_ol_28cddf96ee27a03c6bce27f1d8dcbe7e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMerged</span>(envIn_propNeg, <span class="st">"Open Large"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/mergePropNegPlot_ol-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/mergePropNegPlot_os_5d103c97b5712af849d8abd5f3deaf7c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMerged</span>(envIn_propNeg, <span class="st">"Open Small"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/mergePropNegPlot_os-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-12-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/fmergePropNegPlot_is_fea5f978c0e083cc805529f7597967cf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMerged</span>(envIn_propNeg, <span class="st">"Isolated Small"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/fmergePropNegPlot_is-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="smooths-of-temperatureflow-cycles-of-daily-data-by-season" class="level3" data-number="16.9.5">
<h3 data-number="16.9.5" class="anchored" data-anchor-id="smooths-of-temperatureflow-cycles-of-daily-data-by-season"><span class="header-section-number">16.9.5</span> Smooths of temperature/flow cycles of daily data by season</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/plotMergedBySeason_0053161b24e0aecfa5affe9aa906eba3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>plotMergedBySeason <span class="ot">&lt;-</span> <span class="cf">function</span>(d, r, <span class="at">minYear =</span> <span class="dv">2000</span>, <span class="at">maxYear =</span> <span class="dv">2017</span>) {</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(riverGG <span class="sc">==</span> r, year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear), <span class="sc">!</span><span class="fu">is.na</span>(seasonGG)), </span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(temperature, <span class="fu">log10</span>(flowByRiver), </span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">factor</span>(year), <span class="at">group =</span> year</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point() +</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (C)"</span>, <span class="at">y =</span> <span class="st">"log10 of Flow"</span>) <span class="sc">+</span></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(r) <span class="sc">+</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>(<span class="at">legendPosition =</span> <span class="st">"right"</span>, <span class="at">legendDirection =</span> <span class="st">"vertical"</span>) <span class="sc">+</span>  </span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">West Brook</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Open Large</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false">Open Small</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-4" role="tab" aria-controls="tabset-13-4" aria-selected="false">Isolated small</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/plotMergedBySeason_wb_cc5bb6782f0053c405a80afef3961d47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeason</span>(envIn_propNeg, <span class="st">"West Brook"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/plotMergedBySeason_wb-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/plotMergedBySeason_ol_ea7dcec355449d97d3ad0f2db6e2b4cc">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeason</span>(envIn_propNeg, <span class="st">"Open Large"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/plotMergedBySeason_ol-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/plotMergedBySeason_os_70b8fcaac41c4aa8c55cda4a83711110">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeason</span>(envIn_propNeg, <span class="st">"Open Small"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/plotMergedBySeason_os-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-13-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/plotMergedBySeason_is_e5a4f4e549ff37dc45b75b7463fd4ef0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeason</span>(envIn_propNeg, <span class="st">"Isolated Small"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/plotMergedBySeason_is-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>TO ADD: low flow high density important? Look at interaction btw flow:density</p>
</section>
<section id="ft-cycles-with-labels" class="level3" data-number="16.9.6">
<h3 data-number="16.9.6" class="anchored" data-anchor-id="ft-cycles-with-labels"><span class="header-section-number">16.9.6</span> F/T cycles with labels</h3>
<p>Plot F/T cycles by river, season, species with label for propNeg and conspecific and all-species abundances</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/plotMergedBySeasonByEverything_83d0ed2fe2493c3912162dce05a82a5a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>plotMergedBySeasonByEverything <span class="ot">&lt;-</span> <span class="cf">function</span>(d, d2, r, s, spp, <span class="at">minYear =</span> <span class="dv">2000</span>, <span class="at">maxYear =</span> <span class="dv">2017</span>){</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> </span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(riverGG <span class="sc">==</span> r,</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>                  year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear), </span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(seasonGG), </span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>                  seasonGG <span class="sc">==</span> s, </span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>                  speciesGG <span class="sc">==</span> spp), </span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(temperature, <span class="fu">log10</span>(flowByRiver))</span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>) <span class="sc">+</span></span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> yday)) <span class="sc">+</span></span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> minTemp <span class="sc">+</span> <span class="fl">3.0</span>, </span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">log10</span>(minFlow) <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb204-15"><a href="#cb204-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"propNeg="</span>,<span class="fu">round</span>(propNeg, <span class="dv">2</span>)) </span>
<span id="cb204-16"><a href="#cb204-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">#size = propNeg</span></span>
<span id="cb204-17"><a href="#cb204-17" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb204-18"><a href="#cb204-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> d2<span class="sc">|&gt;</span> </span>
<span id="cb204-19"><a href="#cb204-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(riverGG <span class="sc">==</span> r, </span>
<span id="cb204-20"><a href="#cb204-20" aria-hidden="true" tabindex="-1"></a>                 year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear),</span>
<span id="cb204-21"><a href="#cb204-21" aria-hidden="true" tabindex="-1"></a>                 seasonGG <span class="sc">==</span> s, </span>
<span id="cb204-22"><a href="#cb204-22" aria-hidden="true" tabindex="-1"></a>                 speciesGG <span class="sc">==</span> spp)</span>
<span id="cb204-23"><a href="#cb204-23" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb204-24"><a href="#cb204-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb204-25"><a href="#cb204-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> minTemp <span class="sc">+</span> <span class="fl">3.0</span>,</span>
<span id="cb204-26"><a href="#cb204-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">log10</span>(minFlow) <span class="sc">-</span> <span class="fl">0.3</span>,</span>
<span id="cb204-27"><a href="#cb204-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">paste</span>(<span class="st">"nIndAllSpp="</span>, nInd), <span class="fu">paste</span>(<span class="st">"nIndBySpp="</span>, nIndBySpp), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb204-28"><a href="#cb204-28" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb204-29"><a href="#cb204-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> d2<span class="sc">|&gt;</span></span>
<span id="cb204-30"><a href="#cb204-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(riverGG <span class="sc">==</span> r,</span>
<span id="cb204-31"><a href="#cb204-31" aria-hidden="true" tabindex="-1"></a>                 year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear),</span>
<span id="cb204-32"><a href="#cb204-32" aria-hidden="true" tabindex="-1"></a>                 seasonGG <span class="sc">==</span> s,</span>
<span id="cb204-33"><a href="#cb204-33" aria-hidden="true" tabindex="-1"></a>                 speciesGG <span class="sc">==</span> spp)</span>
<span id="cb204-34"><a href="#cb204-34" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb204-35"><a href="#cb204-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (c)"</span>, <span class="at">y =</span> <span class="st">"log10 Flow"</span>) <span class="sc">+</span></span>
<span id="cb204-36"><a href="#cb204-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(r, s, spp, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb204-37"><a href="#cb204-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb204-38"><a href="#cb204-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)</span>
<span id="cb204-39"><a href="#cb204-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="west-brook-3" class="level4" data-number="16.9.6.1">
<h4 data-number="16.9.6.1" class="anchored" data-anchor-id="west-brook-3"><span class="header-section-number">16.9.6.1</span> West Brook</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Spring</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Summer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false">Autumn</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-4" role="tab" aria-controls="tabset-14-4" aria-selected="false">Winter</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/WBPanelSpring_e27e0a475ad6b530cdbcec8fdcf73cae">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Spring"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelSpring-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Spring"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelSpring-2.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Spring"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelSpring-3.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/WBPanelSummer_27f4dfbf6978a397c39f8b196a32cddc">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Summer"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelSummer-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Summer"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelSummer-2.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Summer"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelSummer-3.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-14-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/WBPanelAutumn_76f43f50b0f786d4e021673c2bf776ca">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelAutumn-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelAutumn-2.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Autumn"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelAutumn-3.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-14-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/WBPanelWinter_0d86cf04e1476d7d532ea47221c61c50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Winter"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelWinter-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Winter"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelWinter-2.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Winter"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/WBPanelWinter-3.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="open-large-3" class="level4" data-number="16.9.6.2">
<h4 data-number="16.9.6.2" class="anchored" data-anchor-id="open-large-3"><span class="header-section-number">16.9.6.2</span> Open Large</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">Spring</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Summer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-3" role="tab" aria-controls="tabset-15-3" aria-selected="false">Autumn</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-4" role="tab" aria-controls="tabset-15-4" aria-selected="false">Winter</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/OLpanelSpring_fbba919e293f54b543edd06c33e825ec">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Spring"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLpanelSpring-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Spring"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLpanelSpring-2.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Spring"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLpanelSpring-3.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/OLPanelSummer_aac36b883f6b838d30f68b5de5b04a34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Summer"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelSummer-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Summer"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelSummer-2.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Summer"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelSummer-3.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-15-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/OLPanelAutumn_1f0727a8b01d87d421c0d8b3f06b07f6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelAutumn-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelAutumn-2.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Autumn"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelAutumn-3.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-15-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/OLPanelWinter_dd2ef5fe7fb796bb8f22a514bd932c5c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Winter"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelWinter-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Winter"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelWinter-2.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Winter"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OLPanelWinter-3.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="open-small-3" class="level4" data-number="16.9.6.3">
<h4 data-number="16.9.6.3" class="anchored" data-anchor-id="open-small-3"><span class="header-section-number">16.9.6.3</span> Open Small</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Spring</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Summer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-3" role="tab" aria-controls="tabset-16-3" aria-selected="false">Autumn</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-4" role="tab" aria-controls="tabset-16-4" aria-selected="false">Winter</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/OSPanelSpring_0c07c83a0a4385cb0d7bc428a5223a89">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Spring"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OSPanelSpring-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Spring"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OSPanelSpring-2.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/OSPanelSummer_9f4b5c5ed30bb48a3f0cc5002dba99ef">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Summer"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OSPanelSummer-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Summer"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OSPanelSummer-2.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-16-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/OSPanelAutumn_0dd866f5811d058fc2569ece486ef593">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OSPanelAutumn-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OSPanelAutumn-2.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-16-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/OSPanelWinter_9e2ef213d028e4846e38df23fee0d97f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Winter"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OSPanelWinter-1.png" class="img-fluid" width="1248"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Winter"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/OSPanelWinter-2.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="isolated-small-3" class="level4" data-number="16.9.6.4">
<h4 data-number="16.9.6.4" class="anchored" data-anchor-id="isolated-small-3"><span class="header-section-number">16.9.6.4</span> Isolated Small</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">Spring</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Summer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-3" role="tab" aria-controls="tabset-17-3" aria-selected="false">Autumn</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-4" role="tab" aria-controls="tabset-17-4" aria-selected="false">Winter</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/ISPanelSpring_3a354fbb20cd71787d2d9ebe397d1bfd">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Isolated Small"</span>, <span class="st">"Spring"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/ISPanelSpring-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/ISPanelSummer_f36b2a09ed5bf916d21697c9c1c4dbe3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Isolated Small"</span>, <span class="st">"Summer"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/ISPanelSummer-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-17-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-3-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/ISPanelAutumn_6460c26d1f474688b6449fee0bb0e1f2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Isolated Small"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/ISPanelAutumn-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
<div id="tabset-17-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-4-tab">
<div class="cell" data-hash="modelGrowthInMass_cache/html/ISPanelWinter_ef0d440fff371fbf4aeb8e1ed7b6b177">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Isolated Small"</span>, <span class="st">"Winter"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/ISPanelWinter-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="consequences-of-negative-growth" class="level2" data-number="16.10">
<h2 data-number="16.10" class="anchored" data-anchor-id="consequences-of-negative-growth"><span class="header-section-number">16.10</span> Consequences of negative growth</h2>
<section id="growth-and-last-observation" class="level3" data-number="16.10.1">
<h3 data-number="16.10.1" class="anchored" data-anchor-id="growth-and-last-observation"><span class="header-section-number">16.10.1</span> Growth and last observation</h3>
<section id="all-years" class="level4" data-number="16.10.1.1">
<h4 data-number="16.10.1.1" class="anchored" data-anchor-id="all-years"><span class="header-section-number">16.10.1.1</span> All years</h4>
<p>Mean number of last observed sample as response variable</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_samplesLeftMean_c72ee268491061f93cf20d711348e79d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>plot_negGr_beforeLastMean <span class="ot">&lt;-</span> <span class="cf">function</span>(sppIn) {</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(negGr_beforeLastMean <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> sppIn, seasonGG <span class="sc">!=</span> <span class="st">"Spring"</span>), <span class="fu">aes</span>(negGrowth, meanSamplesBeforeLast, <span class="at">fill =</span> negGrowth)) <span class="sc">+</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)    </span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_negGr_beforeLastMean</span>(<span class="st">"Brook trout"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftMean-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_negGr_beforeLastMean</span>(<span class="st">"Brown trout"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftMean-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_negGr_beforeLastMean</span>(<span class="st">"Atlantic salmon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftMean-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(negGr_beforeLastMean <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, seasonGG <span class="sc">!=</span> <span class="st">"Spring"</span>), <span class="fu">aes</span>(meanGR, meanSamplesBeforeLast)) <span class="sc">+</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> riverGG, <span class="at">shape =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">shape =</span> riverGG, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_smooth(method = "lm", se = FALSE) +</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftMean-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="by-year" class="level4" data-number="16.10.1.2">
<h4 data-number="16.10.1.2" class="anchored" data-anchor-id="by-year"><span class="header-section-number">16.10.1.2</span> By year</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_samplesLeftMean_year_6d11b4d1a76aa548ed2ac9ab52918c7a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(negGr_beforeLastMean_year <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">2</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>, year <span class="sc">&lt;</span> <span class="dv">2015</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, seasonGG <span class="sc">!=</span> <span class="st">"Spring"</span>), <span class="fu">aes</span>(meanGR, meanSamplesBeforeLast)) <span class="sc">+</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> riverGG, <span class="at">shape =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">shape =</span> riverGG, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_smooth(method = "lm", se = FALSE) +</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> year, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftMean_year-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Split data by samplesBeforeLast = 1 and samplesBeforeLast &gt; 1.<br>
The graph shows mean growth for fish that were caught for the last time in the next sample or at some later sample</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_samplesLeft01_b030e5e98172dc9930abf52f151e21fe">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>numSamplesBeforeLastGT1_data <span class="ot">&lt;-</span>  cd1 <span class="sc">|&gt;</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numSamplesBeforeLastGT1 =</span> samplesBeforeLast <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(speciesGG, riverGG, seasonGG, numSamplesBeforeLastGT1) <span class="sc">|&gt;</span> </span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanGR =</span> <span class="fu">mean</span>(grWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdGR =</span> <span class="fu">sd</span>(grWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanSamplesBeforeLast =</span> <span class="fu">mean</span>(samplesBeforeLast, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdSamplesBeforeLast =</span> <span class="fu">sd</span>(samplesBeforeLast, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> meanGR <span class="sc">+</span> sdGR,</span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a> <span class="co">#  ggplot(tmp |&gt; filter(n &gt; 2, speciesGG == "Brook trout"), aes(numSamplesBeforeLastGT1, meanGR)) +</span></span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a> <span class="co">#    geom_errorbar(aes(x = numSamplesBeforeLastGT1, ymin = meanGR, ymax = ymax), width = 0.2) +</span></span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a> <span class="co">#    geom_col() +</span></span>
<span id="cb246-17"><a href="#cb246-17" aria-hidden="true" tabindex="-1"></a> <span class="co">#    theme_publication() +    </span></span>
<span id="cb246-18"><a href="#cb246-18" aria-hidden="true" tabindex="-1"></a> <span class="co">#    facet_grid(riverGG~seasonGG , scales = "free")</span></span>
<span id="cb246-19"><a href="#cb246-19" aria-hidden="true" tabindex="-1"></a> <span class="co">#  </span></span>
<span id="cb246-20"><a href="#cb246-20" aria-hidden="true" tabindex="-1"></a> <span class="co"># ggplot(tmp |&gt; filter(n &gt; 2, speciesGG == "Brown trout"), aes(numSamplesBeforeLastGT1, meanGR)) +</span></span>
<span id="cb246-21"><a href="#cb246-21" aria-hidden="true" tabindex="-1"></a> <span class="co">#    geom_errorbar(aes(x = numSamplesBeforeLastGT1, ymin = meanGR, ymax = ymax), width = 0.2) +</span></span>
<span id="cb246-22"><a href="#cb246-22" aria-hidden="true" tabindex="-1"></a> <span class="co">#    geom_col() +</span></span>
<span id="cb246-23"><a href="#cb246-23" aria-hidden="true" tabindex="-1"></a> <span class="co">#    theme_publication() +    </span></span>
<span id="cb246-24"><a href="#cb246-24" aria-hidden="true" tabindex="-1"></a> <span class="co">#    facet_grid(riverGG~seasonGG , scales = "free")</span></span>
<span id="cb246-25"><a href="#cb246-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb246-26"><a href="#cb246-26" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(numSamplesBeforeLastGT1_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="sc">!</span><span class="fu">is.na</span>(numSamplesBeforeLastGT1)), <span class="fu">aes</span>(numSamplesBeforeLastGT1, meanGR, <span class="at">fill =</span> speciesGG, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb246-27"><a href="#cb246-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> numSamplesBeforeLastGT1, <span class="at">ymin =</span> meanGR, <span class="at">ymax =</span> ymax), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb246-28"><a href="#cb246-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb246-29"><a href="#cb246-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb246-30"><a href="#cb246-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>seasonGG , <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeft01-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(numSamplesBeforeLastGT1_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="sc">!</span><span class="fu">is.na</span>(numSamplesBeforeLastGT1)), <span class="fu">aes</span>(speciesGG, meanGR, <span class="at">fill =</span> numSamplesBeforeLastGT1, <span class="at">color =</span> numSamplesBeforeLastGT1)) <span class="sc">+</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> speciesGG, <span class="at">ymin =</span> meanGR, <span class="at">ymax =</span> ymax), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">360</span> <span class="sc">-</span> <span class="dv">60</span>, <span class="at">vjust =</span> <span class="fl">0.3</span>, <span class="at">hjust =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>seasonGG , <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeft01-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Relationship between individual growth and length of subsequent observations (how many more observations before the last observation) for individual fish.</p>
</section>
<section id="broken-up-by-years" class="level4" data-number="16.10.1.3">
<h4 data-number="16.10.1.3" class="anchored" data-anchor-id="broken-up-by-years"><span class="header-section-number">16.10.1.3</span> Broken up by years</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_samplesLeft_9a1c9c281017f8b8fd117d3ff1cdfe8f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>plotGrowthSamplesLeft <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>, samplesBeforeLast <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="fu">aes</span>(grWeight, samplesBeforeLast)) <span class="sc">+</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>year)</span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeft-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Large"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeft-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeft-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Isolated Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeft-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeft-5.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="all-years-1" class="level4" data-number="16.10.1.4">
<h4 data-number="16.10.1.4" class="anchored" data-anchor-id="all-years-1"><span class="header-section-number">16.10.1.4</span> All years</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_samplesLeftNoYear_970300476401efab363955493c291ba6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>plotGrowthSamplesLeftNoYear <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>, samplesBeforeLast <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="fu">aes</span>(grWeight, samplesBeforeLast)) <span class="sc">+</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Number of samples before last observation"</span>) <span class="sc">+</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG)</span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftNoYear-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Large"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftNoYear-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftNoYear-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Isolated Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftNoYear-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftNoYear-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Atlantic salmon"</span>, <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_samplesLeftNoYear-6.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="break-up-by-posneg-growth" class="level4" data-number="16.10.1.5">
<h4 data-number="16.10.1.5" class="anchored" data-anchor-id="break-up-by-posneg-growth"><span class="header-section-number">16.10.1.5</span> Break up by pos/neg growth</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negGrowth_means_9e36e519bf45f6424ab3b73b2d753325">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>plotGR_sampsBL <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>, speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r), <span class="fu">aes</span>(meanGR, samplesBeforeLast, <span class="at">color =</span> negGrowth)) <span class="sc">+</span> </span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Number of samples before last observation"</span>) <span class="sc">+</span></span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>seasonGG<span class="sc">+</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_sampsBL</span>(negGr_beforeLast, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_means-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>plotGR_sampsBL2 <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>, speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r, <span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(meanGR, samplesBeforeLast, <span class="at">color =</span> speciesGG)) <span class="sc">+</span> </span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Number of samples before last observation"</span>) <span class="sc">+</span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>negGrowth<span class="sc">+</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_sampsBL2</span>(negGr_beforeLast, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_means-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>plotGR_sampsBL3 <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r, ng) {</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>, speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r, negGrowth <span class="sc">%in%</span> ng), <span class="fu">aes</span>(meanGR, samplesBeforeLast, <span class="at">color =</span> speciesGG)) <span class="sc">+</span> </span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, ng, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Number of samples before last observation"</span>) <span class="sc">+</span></span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(negGrowth<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_sampsBL3</span>(negGr_beforeLast, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>), <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_means-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_sampsBL3</span>(negGr_beforeLast, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>), <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/negGrowth_means-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>TO ADD: mean samplesBeforeLast by negGR</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/growthKnkownZPosNeg_fd0cdde687f4f54c5b6476b604f0c599">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>plotGrowthKnownZPosNeg <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>, <span class="sc">!</span><span class="fu">is.na</span>(samplesBeforeLast)), <span class="fu">aes</span>(grWeight, <span class="at">color =</span> samplesBeforeLast <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(r)) <span class="sc">+</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>   </span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZPosNeg</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>, <span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZPosNeg-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZPosNeg</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>, <span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="st">"Open Large"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZPosNeg-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZPosNeg</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>, <span class="st">"Brown trout"</span>), <span class="st">"Open Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZPosNeg-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZPosNeg</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>), <span class="st">"Isolated Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZPosNeg-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>TO ADD: knownZ=0 vs knownZ==1, growth in previous interval</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/growthKnkownZ_644fa9926323d4bb0943b159f2b4e681">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>plotGrowthKnownZ <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>), <span class="fu">aes</span>(grWeight, <span class="at">color =</span> samplesBeforeLast <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZ-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Large"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZ-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZ-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Isolated Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZ-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZ-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"Open Large"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZ-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"Open Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZ-7.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>By year</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/growthKnkownZByYear_910e463ffeff3916471fb66c9f4fedd5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>plotGrowthKnownZByYear <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>), <span class="fu">aes</span>(grWeight, <span class="at">color =</span> samplesBeforeLast <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(year<span class="sc">~</span>seasonGG)</span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb274-9"><a href="#cb274-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-10"><a href="#cb274-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZByYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"West Brook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZByYear-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZByYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Large"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZByYear-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZByYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZByYear-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZByYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Isolated Small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthKnkownZByYear-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="growth-and-movement-distance" class="level3" data-number="16.10.2">
<h3 data-number="16.10.2" class="anchored" data-anchor-id="growth-and-movement-distance"><span class="header-section-number">16.10.2</span> Growth and movement distance</h3>
<p>TO add: break avg move into negGR/not negGR</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/growthMovementNegPos_cf46b83e96e98f699129432da501abce">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>plotGR_moveDistNegPos <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r, <span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(distMoved, <span class="at">color =</span> negGrowth)) <span class="sc">+</span> </span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Movement distance"</span>) <span class="sc">+</span></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_moveDistNegPos</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>,<span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthMovementNegPos-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="modelGrowthInMass_cache/html/growthMovement_031234c43571486ed67ec5206d362e02">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>plotGR_moveDist <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r), <span class="fu">aes</span>(grWeight, distMoved, <span class="at">color =</span> speciesGG)) <span class="sc">+</span> </span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Movement distance"</span>) <span class="sc">+</span></span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_moveDist</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>,<span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthMovement-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="modelGrowthInMass_cache/html/growthMovement2_6d9c9b09701e880d1ec0fc6c99e280fb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>plotGR_moveDist2 <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r), <span class="fu">aes</span>(grWeight, distMoved, <span class="at">color =</span> speciesGG)) <span class="sc">+</span> </span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Movement distance"</span>) <span class="sc">+</span></span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb280-11"><a href="#cb280-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-12"><a href="#cb280-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_moveDist2</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>, <span class="st">"Isolated Small"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthMovement2-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_moveDist2</span>(cd1, <span class="fu">c</span>(<span class="st">"Brown trout"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/growthMovement2-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="machine-learning-models---individual-data" class="level2" data-number="16.11">
<h2 data-number="16.11" class="anchored" data-anchor-id="machine-learning-models---individual-data"><span class="header-section-number">16.11</span> Machine Learning models - individual data</h2>
<p>Using xgBoost to explore patterns in:<br>
- Binary, lose mass:gain mass<br>
- Regression, growth in mass</p>
<section id="binary-model-with-negative-growth-yesno" class="level3" data-number="16.11.1">
<h3 data-number="16.11.1" class="anchored" data-anchor-id="binary-model-with-negative-growth-yesno"><span class="header-section-number">16.11.1</span> Binary model with negative growth, yes:no</h3>
<p>Not yet in targets….</p>
</section>
<section id="function-to-run-hyperparameters" class="level3" data-number="16.11.2">
<h3 data-number="16.11.2" class="anchored" data-anchor-id="function-to-run-hyperparameters"><span class="header-section-number">16.11.2</span> Function to run hyperparameters</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/runML_HP_negGrowth_c20b5cac68d9fefb5d070c31df99e83d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>runHyperparamSearchIndData <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> cd1, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"cohort"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"negGrowth"</span>), <span class="at">nRoundsIn =</span> <span class="dv">150000</span>, <span class="at">early_stopping_roundsIn =</span> <span class="dv">50</span>) {</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set.seed(123)</span></span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>  dML_negGrowth <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> year <span class="sc">-</span> cohort) <span class="sc">|&gt;</span> </span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars)) </span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variable names</span></span>
<span id="cb282-10"><a href="#cb282-10" aria-hidden="true" tabindex="-1"></a>  features_negGrowth <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dML_negGrowth), <span class="st">"negGrowth"</span>)</span>
<span id="cb282-11"><a href="#cb282-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-12"><a href="#cb282-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the treatment plan from the training data</span></span>
<span id="cb282-13"><a href="#cb282-13" aria-hidden="true" tabindex="-1"></a>  treatplan_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">designTreatmentsZ</span>(dML_negGrowth, features_negGrowth, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb282-14"><a href="#cb282-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-15"><a href="#cb282-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the "clean" variable names from the scoreFrame</span></span>
<span id="cb282-16"><a href="#cb282-16" aria-hidden="true" tabindex="-1"></a>  new_vars_negGrowth <span class="ot">&lt;-</span> treatplan_negGrowth <span class="sc">%&gt;%</span></span>
<span id="cb282-17"><a href="#cb282-17" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>        </span>
<span id="cb282-18"><a href="#cb282-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb282-19"><a href="#cb282-19" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)     </span>
<span id="cb282-20"><a href="#cb282-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-21"><a href="#cb282-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the training data</span></span>
<span id="cb282-22"><a href="#cb282-22" aria-hidden="true" tabindex="-1"></a>  features_train_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_negGrowth, dML_negGrowth, <span class="at">varRestriction =</span> new_vars_negGrowth) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb282-23"><a href="#cb282-23" aria-hidden="true" tabindex="-1"></a>  response_train_negGrowth <span class="ot">&lt;-</span> dML_negGrowth<span class="sc">$</span>negGrowth</span>
<span id="cb282-24"><a href="#cb282-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-25"><a href="#cb282-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create hyperparameter grid</span></span>
<span id="cb282-26"><a href="#cb282-26" aria-hidden="true" tabindex="-1"></a>  hyper_grid_negGrowth <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb282-27"><a href="#cb282-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">3</span>),</span>
<span id="cb282-28"><a href="#cb282-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb282-29"><a href="#cb282-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_child_weight =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb282-30"><a href="#cb282-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">subsample =</span> <span class="fu">c</span>(.<span class="dv">65</span>, .<span class="dv">8</span>, <span class="dv">1</span>),</span>
<span id="cb282-31"><a href="#cb282-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">colsample_bytree =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">9</span>, <span class="dv">1</span>),</span>
<span id="cb282-32"><a href="#cb282-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">optimal_trees =</span> <span class="dv">0</span>,               <span class="co"># a place to dump results</span></span>
<span id="cb282-33"><a href="#cb282-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_logloss =</span> <span class="dv">0</span>                     <span class="co"># a place to dump results</span></span>
<span id="cb282-34"><a href="#cb282-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb282-35"><a href="#cb282-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-36"><a href="#cb282-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reproducibility</span></span>
<span id="cb282-37"><a href="#cb282-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">#set.seed(123)</span></span>
<span id="cb282-38"><a href="#cb282-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   </span></span>
<span id="cb282-39"><a href="#cb282-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># grid search</span></span>
<span id="cb282-40"><a href="#cb282-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hyper_grid_negGrowth)) {</span>
<span id="cb282-41"><a href="#cb282-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(i, <span class="st">" out of "</span>, <span class="fu">nrow</span>(hyper_grid_negGrowth)))</span>
<span id="cb282-42"><a href="#cb282-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create parameter list</span></span>
<span id="cb282-43"><a href="#cb282-43" aria-hidden="true" tabindex="-1"></a>    params_negGrowth <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb282-44"><a href="#cb282-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">eta =</span> hyper_grid_negGrowth<span class="sc">$</span>eta[i],</span>
<span id="cb282-45"><a href="#cb282-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_depth =</span> hyper_grid_negGrowth<span class="sc">$</span>max_depth[i],</span>
<span id="cb282-46"><a href="#cb282-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_child_weight =</span> hyper_grid_negGrowth<span class="sc">$</span>min_child_weight[i],</span>
<span id="cb282-47"><a href="#cb282-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">subsample =</span> hyper_grid_negGrowth<span class="sc">$</span>subsample[i],</span>
<span id="cb282-48"><a href="#cb282-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">colsample_bytree =</span> hyper_grid_negGrowth<span class="sc">$</span>colsample_bytree[i]</span>
<span id="cb282-49"><a href="#cb282-49" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb282-50"><a href="#cb282-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-51"><a href="#cb282-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-52"><a href="#cb282-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># train model</span></span>
<span id="cb282-53"><a href="#cb282-53" aria-hidden="true" tabindex="-1"></a>    xgb.tune_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb282-54"><a href="#cb282-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> params_negGrowth,</span>
<span id="cb282-55"><a href="#cb282-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> features_train_negGrowth,</span>
<span id="cb282-56"><a href="#cb282-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> response_train_negGrowth,</span>
<span id="cb282-57"><a href="#cb282-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrounds =</span> nRoundsIn,</span>
<span id="cb282-58"><a href="#cb282-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb282-59"><a href="#cb282-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="co">#"reg:linear",  # for regression models</span></span>
<span id="cb282-60"><a href="#cb282-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="dv">0</span>,               <span class="co"># silent,</span></span>
<span id="cb282-61"><a href="#cb282-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">early_stopping_rounds =</span> early_stopping_roundsIn <span class="co"># stop if no improvement for x consecutive trees</span></span>
<span id="cb282-62"><a href="#cb282-62" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb282-63"><a href="#cb282-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-64"><a href="#cb282-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add min training error and trees to grid</span></span>
<span id="cb282-65"><a href="#cb282-65" aria-hidden="true" tabindex="-1"></a>    hyper_grid_negGrowth<span class="sc">$</span>optimal_trees[i] <span class="ot">&lt;-</span> <span class="fu">which.min</span>(xgb.tune_negGrowth<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_logloss_mean)</span>
<span id="cb282-66"><a href="#cb282-66" aria-hidden="true" tabindex="-1"></a>    hyper_grid_negGrowth<span class="sc">$</span>min_logloss[i] <span class="ot">&lt;-</span> <span class="fu">min</span>(xgb.tune_negGrowth<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_logloss_mean)</span>
<span id="cb282-67"><a href="#cb282-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb282-68"><a href="#cb282-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb282-69"><a href="#cb282-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(hyper_grid_negGrowth <span class="sc">|&gt;</span> <span class="fu">arrange</span>(min_logloss))</span>
<span id="cb282-70"><a href="#cb282-70" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function-to-run-models-1" class="level3" data-number="16.11.3">
<h3 data-number="16.11.3" class="anchored" data-anchor-id="function-to-run-models-1"><span class="header-section-number">16.11.3</span> Function to run models</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/xgBoostNegGrowthFunction_9142f8ca400792e832e11f6475073d08">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># http://uc-r.github.io/gbm_regression</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>runXGB_indData <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> cd1, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"negGrowth"</span>), <span class="at">nRoundsIn =</span> <span class="dv">200000</span>, <span class="at">early_stopping_roundsIn =</span> <span class="dv">50</span>, <span class="at">params =</span> params_negGrowthIn) {</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set.seed(125)</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>  dML <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> year <span class="sc">-</span> cohort) <span class="sc">|&gt;</span> </span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars))</span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb283-10"><a href="#cb283-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-11"><a href="#cb283-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variable names</span></span>
<span id="cb283-12"><a href="#cb283-12" aria-hidden="true" tabindex="-1"></a>  features_negGrowth <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dML), <span class="st">"negGrowth"</span>)</span>
<span id="cb283-13"><a href="#cb283-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-14"><a href="#cb283-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the treatment plan from the training data</span></span>
<span id="cb283-15"><a href="#cb283-15" aria-hidden="true" tabindex="-1"></a>  treatplan_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">designTreatmentsZ</span>(dML, features_negGrowth, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb283-16"><a href="#cb283-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-17"><a href="#cb283-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the "clean" variable names from the scoreFrame</span></span>
<span id="cb283-18"><a href="#cb283-18" aria-hidden="true" tabindex="-1"></a>  new_vars_negGrowth <span class="ot">&lt;-</span> treatplan_negGrowth <span class="sc">%&gt;%</span></span>
<span id="cb283-19"><a href="#cb283-19" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>        </span>
<span id="cb283-20"><a href="#cb283-20" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb283-21"><a href="#cb283-21" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)     </span>
<span id="cb283-22"><a href="#cb283-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-23"><a href="#cb283-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the training data</span></span>
<span id="cb283-24"><a href="#cb283-24" aria-hidden="true" tabindex="-1"></a>  features_train_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_negGrowth, dML, <span class="at">varRestriction =</span> new_vars_negGrowth) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb283-25"><a href="#cb283-25" aria-hidden="true" tabindex="-1"></a>  response_train_negGrowth <span class="ot">&lt;-</span> dML<span class="sc">$</span>negGrowth</span>
<span id="cb283-26"><a href="#cb283-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-27"><a href="#cb283-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the test data</span></span>
<span id="cb283-28"><a href="#cb283-28" aria-hidden="true" tabindex="-1"></a>  features_test_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_negGrowth, dML, <span class="at">varRestriction =</span> new_vars_negGrowth) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb283-29"><a href="#cb283-29" aria-hidden="true" tabindex="-1"></a>  response_test_negGrowth <span class="ot">&lt;-</span> dML<span class="sc">$</span>negGrowth</span>
<span id="cb283-30"><a href="#cb283-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-31"><a href="#cb283-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Run model</span></span>
<span id="cb283-32"><a href="#cb283-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># parameter list - from the top model of the grid search above</span></span>
<span id="cb283-33"><a href="#cb283-33" aria-hidden="true" tabindex="-1"></a>  params_negGrowth <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb283-34"><a href="#cb283-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta =</span> params<span class="sc">$</span>eta, <span class="co">#0.01,</span></span>
<span id="cb283-35"><a href="#cb283-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_depth =</span> params<span class="sc">$</span>max_depth, <span class="co">#1,</span></span>
<span id="cb283-36"><a href="#cb283-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_child_weight =</span> params<span class="sc">$</span>min_child_weight, <span class="co">#7,</span></span>
<span id="cb283-37"><a href="#cb283-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">subsample =</span> params<span class="sc">$</span>subsample, <span class="co">#0.8,</span></span>
<span id="cb283-38"><a href="#cb283-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">colsample_bytree =</span> params<span class="sc">$</span>colsample_bytree <span class="co">#0.9</span></span>
<span id="cb283-39"><a href="#cb283-39" aria-hidden="true" tabindex="-1"></a>   <span class="co"># optimal_trees = params$optimal_trees</span></span>
<span id="cb283-40"><a href="#cb283-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb283-41"><a href="#cb283-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-42"><a href="#cb283-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># train final model</span></span>
<span id="cb283-43"><a href="#cb283-43" aria-hidden="true" tabindex="-1"></a>  xgb.fit.final_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(</span>
<span id="cb283-44"><a href="#cb283-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> params_negGrowth,</span>
<span id="cb283-45"><a href="#cb283-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> features_train_negGrowth,</span>
<span id="cb283-46"><a href="#cb283-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> response_train_negGrowth,</span>
<span id="cb283-47"><a href="#cb283-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrounds =</span> nRoundsIn,</span>
<span id="cb283-48"><a href="#cb283-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb283-49"><a href="#cb283-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">1</span>,</span>
<span id="cb283-50"><a href="#cb283-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_rounds =</span> early_stopping_roundsIn <span class="co"># stop if no improvement for 20 consecutive trees</span></span>
<span id="cb283-51"><a href="#cb283-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb283-52"><a href="#cb283-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-53"><a href="#cb283-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-54"><a href="#cb283-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb283-55"><a href="#cb283-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb283-56"><a href="#cb283-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">dat =</span> dML,</span>
<span id="cb283-57"><a href="#cb283-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">xgb =</span> xgb.fit.final_negGrowth,</span>
<span id="cb283-58"><a href="#cb283-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">new_vars =</span> new_vars_negGrowth,</span>
<span id="cb283-59"><a href="#cb283-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">features_train =</span> features_train_negGrowth,</span>
<span id="cb283-60"><a href="#cb283-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">response_train =</span> response_train_negGrowth</span>
<span id="cb283-61"><a href="#cb283-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb283-62"><a href="#cb283-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb283-63"><a href="#cb283-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-64"><a href="#cb283-64" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="brook-trout-10" class="level3" data-number="16.11.4">
<h3 data-number="16.11.4" class="anchored" data-anchor-id="brook-trout-10"><span class="header-section-number">16.11.4</span> Brook trout</h3>
<section id="run-hyperparameter-grid-and-main-model" class="level4" data-number="16.11.4.1">
<h4 data-number="16.11.4.1" class="anchored" data-anchor-id="run-hyperparameter-grid-and-main-model"><span class="header-section-number">16.11.4.1</span> Run hyperparameter grid and main model</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/xgbIndBKT_8692e1e7f99808cf7979f7f9dde56981">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>runHP_BKT <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>runXGB_BKT <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runHP_BKT) {</span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>  hpNegGrowthBKT <span class="ot">&lt;-</span> <span class="fu">runHyperparamSearchIndData</span>(</span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight), year <span class="sc">&gt;</span> <span class="dv">2001</span>) <span class="sc">|&gt;</span></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">50000</span>,</span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">10</span></span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(hpNegGrowthBKT, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthBKT.RData"</span>)</span>
<span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthBKT.RData"</span>)</span>
<span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb284-17"><a href="#cb284-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-18"><a href="#cb284-18" aria-hidden="true" tabindex="-1"></a>hpNegGrowthBKT[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    eta max_depth min_child_weight subsample colsample_bytree optimal_trees
1  0.05         7                3      1.00              0.8           174
2  0.05         5                1      0.80              0.9           208
3  0.10         3                5      1.00              0.9           337
4  0.01         5                1      1.00              0.8          1362
5  0.10         3                1      1.00              0.8           324
6  0.10         5                1      0.80              0.9           124
7  0.10         5                1      0.65              1.0           112
8  0.30         3                1      1.00              0.9           105
9  0.10         5                3      1.00              0.8           159
10 0.10         3                5      0.80              0.8           296
   min_logloss
1    0.2516642
2    0.2526194
3    0.2528114
4    0.2531555
5    0.2532081
6    0.2532191
7    0.2532716
8    0.2533034
9    0.2533418
10   0.2533950</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runXGB_BKT) {</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>  negGrowthBKT <span class="ot">&lt;-</span> <span class="fu">runXGB_indData</span>(</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight), year <span class="sc">&gt;</span> <span class="dv">2001</span>) <span class="sc">|&gt;</span></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">200000</span>,</span>
<span id="cb286-8"><a href="#cb286-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">20</span>,</span>
<span id="cb286-9"><a href="#cb286-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> hpNegGrowthBKT[<span class="dv">1</span>,]</span>
<span id="cb286-10"><a href="#cb286-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb286-11"><a href="#cb286-11" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(negGrowthBKT, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthBKT.RData"</span>)</span>
<span id="cb286-12"><a href="#cb286-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb286-13"><a href="#cb286-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthBKT.RData"</span>)</span>
<span id="cb286-14"><a href="#cb286-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb286-15"><a href="#cb286-15" aria-hidden="true" tabindex="-1"></a>negGrowthBKT<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2e+05</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>negGrowthBKT<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01244459</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs number trees</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(negGrowthBKT<span class="sc">$</span>xgb<span class="sc">$</span>evaluation_log) <span class="sc">+</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, train_logloss), <span class="at">color =</span> <span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_line(aes(iter, test_logloss), color = "blue")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="modelGrowthInMass_cache/html/xgbIndBKT_figs_13c3b06247076b051c0b45cb184580e9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>viBKT_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> negGrowthBKT<span class="sc">$</span>xgb)</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viBKT_negGrowth, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>s_negGrowthBKT <span class="ot">&lt;-</span> <span class="fu">hstats</span>(negGrowthBKT<span class="sc">$</span>xgb, <span class="at">v =</span> negGrowthBKT<span class="sc">$</span>new_vars, <span class="at">X =</span> negGrowthBKT<span class="sc">$</span>features_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1-way calculations...

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |======================================================================| 100%
2-way calculations...

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>s_negGrowthBKT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'hstats' object. Use plot() or summary() for details.

H^2 (normalized)
[1] 0.7491042</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthBKT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_negGrowthBKT, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthBKT, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">normalize =</span> F, <span class="at">squared =</span> F, <span class="at">facet_scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_negGrowthBKT, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb299-8"><a href="#cb299-8" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">25</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb299-9"><a href="#cb299-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb299-10"><a href="#cb299-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb299-11"><a href="#cb299-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-12"><a href="#cb299-12" aria-hidden="true" tabindex="-1"></a><span class="co">#n.trees = 1082, grid.resolution = 100,</span></span>
<span id="cb299-13"><a href="#cb299-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-14"><a href="#cb299-14" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb299-15"><a href="#cb299-15" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb299-16"><a href="#cb299-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb299-17"><a href="#cb299-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb299-18"><a href="#cb299-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb299-19"><a href="#cb299-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb299-20"><a href="#cb299-20" aria-hidden="true" tabindex="-1"></a>pTemp_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb299-21"><a href="#cb299-21" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb299-22"><a href="#cb299-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb299-23"><a href="#cb299-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb299-24"><a href="#cb299-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-25"><a href="#cb299-25" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb299-26"><a href="#cb299-26" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb299-27"><a href="#cb299-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb299-28"><a href="#cb299-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb299-29"><a href="#cb299-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-30"><a href="#cb299-30" aria-hidden="true" tabindex="-1"></a>pYear_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb299-31"><a href="#cb299-31" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb299-32"><a href="#cb299-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb299-33"><a href="#cb299-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb299-34"><a href="#cb299-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-35"><a href="#cb299-35" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pWeight_negGrowth, pFlow_negGrowth, pTemp_negGrowth, pNInd_negGrowth, pYear_negGrowth, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (observedWeight<span class="sc">-</span><span class="fu">mean</span>(observedWeight))<span class="sc">/</span><span class="fu">sd</span>(observedWeight),</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Mass"</span>,</span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb300-10"><a href="#cb300-10" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb300-11"><a href="#cb300-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanFlowByRiver<span class="sc">-</span><span class="fu">mean</span>(meanFlowByRiver))<span class="sc">/</span><span class="fu">sd</span>(meanFlowByRiver),</span>
<span id="cb300-12"><a href="#cb300-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb300-13"><a href="#cb300-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb300-14"><a href="#cb300-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-15"><a href="#cb300-15" aria-hidden="true" tabindex="-1"></a>pMT_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb300-16"><a href="#cb300-16" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb300-17"><a href="#cb300-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanTemperature<span class="sc">-</span><span class="fu">mean</span>(meanTemperature))<span class="sc">/</span><span class="fu">sd</span>(meanTemperature),</span>
<span id="cb300-18"><a href="#cb300-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb300-19"><a href="#cb300-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb300-20"><a href="#cb300-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-21"><a href="#cb300-21" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb300-22"><a href="#cb300-22" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb300-23"><a href="#cb300-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb300-24"><a href="#cb300-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb300-25"><a href="#cb300-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb300-26"><a href="#cb300-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-27"><a href="#cb300-27" aria-hidden="true" tabindex="-1"></a>pYear_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb300-28"><a href="#cb300-28" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb300-29"><a href="#cb300-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb300-30"><a href="#cb300-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb300-31"><a href="#cb300-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb300-32"><a href="#cb300-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-33"><a href="#cb300-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-34"><a href="#cb300-34" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataBKT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pWeight_negGrowthDataBKT, pFlow_negGrowthDataBKT, pMT_negGrowthDataBKT, pNInd_negGrowthDataBKT, pYear_negGrowthDataBKT)</span>
<span id="cb300-35"><a href="#cb300-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-36"><a href="#cb300-36" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb300-37"><a href="#cb300-37" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataBKT_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthDataBKT, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb300-38"><a href="#cb300-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb300-39"><a href="#cb300-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb300-40"><a href="#cb300-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb300-41"><a href="#cb300-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb300-42"><a href="#cb300-42" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All river on one graph</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>partialWBBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"West Brook"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>)</span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a>partialOLBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Large"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>)</span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-13"><a href="#cb301-13" aria-hidden="true" tabindex="-1"></a>partialOSBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb301-14"><a href="#cb301-14" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb301-15"><a href="#cb301-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb301-16"><a href="#cb301-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>)</span>
<span id="cb301-17"><a href="#cb301-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-18"><a href="#cb301-18" aria-hidden="true" tabindex="-1"></a>partialISBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb301-19"><a href="#cb301-19" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Isolated_Small"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb301-20"><a href="#cb301-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Isolated Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb301-21"><a href="#cb301-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Isolated_Small"</span>)</span>
<span id="cb301-22"><a href="#cb301-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-23"><a href="#cb301-23" aria-hidden="true" tabindex="-1"></a>partialRiversBKT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partialWBBKT, partialOLBKT, partialOSBKT, partialISBKT) <span class="sc">|&gt;</span> </span>
<span id="cb301-24"><a href="#cb301-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb301-25"><a href="#cb301-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RiverEffect =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span><span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb301-26"><a href="#cb301-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">riverOrdered =</span> <span class="fu">factor</span>(riverGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>, <span class="st">"Isolated Small"</span>), </span>
<span id="cb301-27"><a href="#cb301-27" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> T))</span>
<span id="cb301-28"><a href="#cb301-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-29"><a href="#cb301-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(partialRiversBKT, <span class="fu">aes</span>(riverOrdered, yhat, <span class="at">fill =</span> <span class="fu">factor</span>(RiverEffect))) <span class="sc">+</span></span>
<span id="cb301-30"><a href="#cb301-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb301-31"><a href="#cb301-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanTemperature"</span>, <span class="at">X =</span> negGrowthBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanFlowByRiver"</span>)) <span class="sc">+</span></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanFlowByRiver), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-7.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanTemperature"</span>)) <span class="sc">+</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanTemperature), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-8.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBKT_figs-9.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="brown-trout-10" class="level3" data-number="16.11.5">
<h3 data-number="16.11.5" class="anchored" data-anchor-id="brown-trout-10"><span class="header-section-number">16.11.5</span> Brown trout</h3>
<section id="run-hyperparameter-grid-and-main-model-1" class="level4" data-number="16.11.5.1">
<h4 data-number="16.11.5.1" class="anchored" data-anchor-id="run-hyperparameter-grid-and-main-model-1"><span class="header-section-number">16.11.5.1</span> Run hyperparameter grid and main model</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/xgbIndBNT_1b216e539e0e7e4d629a4279d5c61dfc">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>runHP_BNT <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>runXGB_BNT <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runHP_BNT) {</span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>  hpNegGrowthBNT <span class="ot">&lt;-</span> <span class="fu">runHyperparamSearchIndData</span>(</span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brown trout"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight), year <span class="sc">&gt;</span> <span class="dv">2001</span>) <span class="sc">|&gt;</span></span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">50000</span>,</span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">10</span></span>
<span id="cb305-12"><a href="#cb305-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb305-13"><a href="#cb305-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(hpNegGrowthBNT, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthBNT.RData"</span>)</span>
<span id="cb305-14"><a href="#cb305-14" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb305-15"><a href="#cb305-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthBNT.RData"</span>)</span>
<span id="cb305-16"><a href="#cb305-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb305-17"><a href="#cb305-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb305-18"><a href="#cb305-18" aria-hidden="true" tabindex="-1"></a>  hpNegGrowthBNT[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    eta max_depth min_child_weight subsample colsample_bytree optimal_trees
1  0.30         7                7      0.80              0.9            23
2  0.10         3                1      0.80              0.9            98
3  0.10         5                1      0.65              1.0            62
4  0.05         3                3      1.00              1.0           258
5  0.05         5                3      1.00              0.9           203
6  0.10         5                7      0.65              0.8           100
7  0.05         3                1      0.80              0.9           233
8  0.10         3                3      0.80              0.8           120
9  0.01         3                5      1.00              1.0          1343
10 0.30         7                7      1.00              0.8            26
   min_logloss
1    0.1390132
2    0.1394058
3    0.1395776
4    0.1398355
5    0.1401673
6    0.1404485
7    0.1406171
8    0.1406177
9    0.1406708
10   0.1408398</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runXGB_BNT) {</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>  negGrowthBNT <span class="ot">&lt;-</span> <span class="fu">runXGB_indData</span>(</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brown trout"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight), year <span class="sc">&gt;</span> <span class="dv">2001</span>) <span class="sc">|&gt;</span></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">200000</span>,</span>
<span id="cb307-8"><a href="#cb307-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">20</span>,</span>
<span id="cb307-9"><a href="#cb307-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> hpNegGrowthBNT[<span class="dv">1</span>,]</span>
<span id="cb307-10"><a href="#cb307-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb307-11"><a href="#cb307-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(negGrowthBNT, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthBNT.RData"</span>)</span>
<span id="cb307-12"><a href="#cb307-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb307-13"><a href="#cb307-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthBNT.RData"</span>)</span>
<span id="cb307-14"><a href="#cb307-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb307-15"><a href="#cb307-15" aria-hidden="true" tabindex="-1"></a>negGrowthBNT<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2807</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>negGrowthBNT<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01994943</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs number trees</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(negGrowthBNT<span class="sc">$</span>xgb<span class="sc">$</span>evaluation_log) <span class="sc">+</span></span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, train_logloss), <span class="at">color =</span> <span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_line(aes(iter, test_logloss), color = "blue")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="modelGrowthInMass_cache/html/xgbIndBNT_figs_4f07edd6a9cf848cc0d62dd82e2d88fb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>viBNT_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> negGrowthBNT<span class="sc">$</span>xgb)</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viBNT_negGrowth, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>s_negGrowthBNT <span class="ot">&lt;-</span> <span class="fu">hstats</span>(negGrowthBNT<span class="sc">$</span>xgb, <span class="at">v =</span> negGrowthBNT<span class="sc">$</span>new_vars, <span class="at">X =</span> negGrowthBNT<span class="sc">$</span>features_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1-way calculations...

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |======================================================================| 100%
2-way calculations...

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>s_negGrowthBNT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'hstats' object. Use plot() or summary() for details.

H^2 (normalized)
[1] 0.8319475</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthBNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_negGrowthBNT, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthBNT, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">normalize =</span> F, <span class="at">squared =</span> F, <span class="at">facet_scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_negGrowthBNT, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb320-9"><a href="#cb320-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb320-10"><a href="#cb320-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb320-11"><a href="#cb320-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-12"><a href="#cb320-12" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb320-13"><a href="#cb320-13" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb320-14"><a href="#cb320-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb320-15"><a href="#cb320-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb320-16"><a href="#cb320-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb320-17"><a href="#cb320-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb320-18"><a href="#cb320-18" aria-hidden="true" tabindex="-1"></a>pTemp_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb320-19"><a href="#cb320-19" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb320-20"><a href="#cb320-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb320-21"><a href="#cb320-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb320-22"><a href="#cb320-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-23"><a href="#cb320-23" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb320-24"><a href="#cb320-24" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb320-25"><a href="#cb320-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb320-26"><a href="#cb320-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb320-27"><a href="#cb320-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-28"><a href="#cb320-28" aria-hidden="true" tabindex="-1"></a>pYear_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb320-29"><a href="#cb320-29" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb320-30"><a href="#cb320-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb320-31"><a href="#cb320-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb320-32"><a href="#cb320-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-33"><a href="#cb320-33" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pWeight_negGrowth, pFlow_negGrowth, pTemp_negGrowth, pNInd_negGrowth, pYear_negGrowth, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowthDataBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanFlowByRiver<span class="sc">-</span><span class="fu">mean</span>(meanFlowByRiver))<span class="sc">/</span><span class="fu">sd</span>(meanFlowByRiver),</span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a>pMT_negGrowthDataBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb321-11"><a href="#cb321-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanTemperature<span class="sc">-</span><span class="fu">mean</span>(meanTemperature))<span class="sc">/</span><span class="fu">sd</span>(meanTemperature),</span>
<span id="cb321-12"><a href="#cb321-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb321-13"><a href="#cb321-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb321-14"><a href="#cb321-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-15"><a href="#cb321-15" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowthDataBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb321-16"><a href="#cb321-16" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb321-17"><a href="#cb321-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb321-18"><a href="#cb321-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb321-19"><a href="#cb321-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb321-20"><a href="#cb321-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-21"><a href="#cb321-21" aria-hidden="true" tabindex="-1"></a>pYear_negGrowthDataBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb321-22"><a href="#cb321-22" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb321-23"><a href="#cb321-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb321-24"><a href="#cb321-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb321-25"><a href="#cb321-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb321-26"><a href="#cb321-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-27"><a href="#cb321-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-28"><a href="#cb321-28" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataBNT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pFlow_negGrowthDataBNT, pMT_negGrowthDataBNT, pNInd_negGrowthDataBNT, pYear_negGrowthDataBNT)</span>
<span id="cb321-29"><a href="#cb321-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-30"><a href="#cb321-30" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb321-31"><a href="#cb321-31" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataBNT_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthDataBNT, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb321-32"><a href="#cb321-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb321-33"><a href="#cb321-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb321-34"><a href="#cb321-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb321-35"><a href="#cb321-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb321-36"><a href="#cb321-36" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All river on one graph</span></span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>partialWBBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"West Brook"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>)</span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a>partialOLBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb322-9"><a href="#cb322-9" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb322-10"><a href="#cb322-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Large"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb322-11"><a href="#cb322-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>)</span>
<span id="cb322-12"><a href="#cb322-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-13"><a href="#cb322-13" aria-hidden="true" tabindex="-1"></a>partialOSBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb322-14"><a href="#cb322-14" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb322-15"><a href="#cb322-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb322-16"><a href="#cb322-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>)</span>
<span id="cb322-17"><a href="#cb322-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-18"><a href="#cb322-18" aria-hidden="true" tabindex="-1"></a>partialRiversBNT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partialWBBNT, partialOLBNT, partialOSBNT) <span class="sc">|&gt;</span> </span>
<span id="cb322-19"><a href="#cb322-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb322-20"><a href="#cb322-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RiverEffect =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span><span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb322-21"><a href="#cb322-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">riverOrdered =</span> <span class="fu">factor</span>(riverGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>), </span>
<span id="cb322-22"><a href="#cb322-22" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> T))</span>
<span id="cb322-23"><a href="#cb322-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-24"><a href="#cb322-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(partialRiversBNT, <span class="fu">aes</span>(riverOrdered, yhat, <span class="at">fill =</span> <span class="fu">factor</span>(RiverEffect))) <span class="sc">+</span></span>
<span id="cb322-25"><a href="#cb322-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb322-26"><a href="#cb322-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanTemperature"</span>, <span class="at">X =</span> negGrowthBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanFlowByRiver"</span>)) <span class="sc">+</span></span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanFlowByRiver), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-7.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanTemperature"</span>)) <span class="sc">+</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanTemperature), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-8.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndBNT_figs-9.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="atlantic-salmon-10" class="level3" data-number="16.11.6">
<h3 data-number="16.11.6" class="anchored" data-anchor-id="atlantic-salmon-10"><span class="header-section-number">16.11.6</span> Atlantic salmon</h3>
<section id="run-hyperparameter-grid-and-main-model-2" class="level4" data-number="16.11.6.1">
<h4 data-number="16.11.6.1" class="anchored" data-anchor-id="run-hyperparameter-grid-and-main-model-2"><span class="header-section-number">16.11.6.1</span> Run hyperparameter grid and main model</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/xgbIndATS_5ba99581736b72f897b8ab6509da30f1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>runHP_ATS <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>runXGB_ATS <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runHP_ATS) {</span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a>  hpNegGrowthATS <span class="ot">&lt;-</span> <span class="fu">runHyperparamSearchIndData</span>(</span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Atlantic salmon"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight)) <span class="sc">|&gt;</span></span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb326-8"><a href="#cb326-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb326-9"><a href="#cb326-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb326-10"><a href="#cb326-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">50000</span>,</span>
<span id="cb326-11"><a href="#cb326-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">10</span></span>
<span id="cb326-12"><a href="#cb326-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb326-13"><a href="#cb326-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(hpNegGrowthATS, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthATS.RData"</span>)</span>
<span id="cb326-14"><a href="#cb326-14" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {  </span>
<span id="cb326-15"><a href="#cb326-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthATS.RData"</span>)</span>
<span id="cb326-16"><a href="#cb326-16" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb326-17"><a href="#cb326-17" aria-hidden="true" tabindex="-1"></a>hpNegGrowthATS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    eta max_depth min_child_weight subsample colsample_bytree optimal_trees
1  0.01         5                3      0.80              1.0          1081
2  0.10         5                1      0.80              0.8           134
3  0.01         7                7      0.80              0.9           681
4  0.01         7                3      1.00              0.8           621
5  0.01         5                5      0.80              0.9           999
6  0.05         5                7      0.65              0.9           240
7  0.01         7                3      0.80              0.8           641
8  0.05         5                5      0.80              0.9           220
9  0.01         7                5      0.65              0.8           670
10 0.01         5                5      0.65              0.8          1017
   min_logloss
1    0.2966089
2    0.2969262
3    0.2972223
4    0.2973879
5    0.2975546
6    0.2975606
7    0.2977132
8    0.2978511
9    0.2979202
10   0.2979286</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runXGB_ATS) {</span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>  negGrowthATS <span class="ot">&lt;-</span> <span class="fu">runXGB_indData</span>(</span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Atlantic salmon"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight)) <span class="sc">|&gt;</span></span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb328-7"><a href="#cb328-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">200000</span>,</span>
<span id="cb328-8"><a href="#cb328-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">20</span>,</span>
<span id="cb328-9"><a href="#cb328-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> hpNegGrowthATS[<span class="dv">1</span>,]</span>
<span id="cb328-10"><a href="#cb328-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb328-11"><a href="#cb328-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(negGrowthATS, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthATS.RData"</span>)</span>
<span id="cb328-12"><a href="#cb328-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb328-13"><a href="#cb328-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthATS.RData"</span>)</span>
<span id="cb328-14"><a href="#cb328-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb328-15"><a href="#cb328-15" aria-hidden="true" tabindex="-1"></a>negGrowthATS<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2e+05</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>negGrowthATS<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03559097</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs number trees</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(negGrowthATS<span class="sc">$</span>xgb<span class="sc">$</span>evaluation_log) <span class="sc">+</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, train_logloss), <span class="at">color =</span> <span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_line(aes(iter, test_logloss), color = "blue")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="modelGrowthInMass_cache/html/xgbIndATS_figs_4ef5cbd863ea6f4c25d5abd946e6060b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>viATS_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> negGrowthATS<span class="sc">$</span>xgb)</span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viATS_negGrowth, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS_figs-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>s_negGrowthATS <span class="ot">&lt;-</span> <span class="fu">hstats</span>(negGrowthATS<span class="sc">$</span>xgb, <span class="at">v =</span> negGrowthATS<span class="sc">$</span>new_vars, <span class="at">X =</span> negGrowthATS<span class="sc">$</span>features_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1-way calculations...

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |======================================================================| 100%
2-way calculations...

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>s_negGrowthATS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'hstats' object. Use plot() or summary() for details.

H^2 (normalized)
[1] 0.6452019</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthATS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS_figs-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_negGrowthATS, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthATS, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">normalize =</span> F, <span class="at">squared =</span> F, <span class="at">facet_scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS_figs-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_negGrowthATS, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb341-8"><a href="#cb341-8" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb341-9"><a href="#cb341-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb341-10"><a href="#cb341-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb341-11"><a href="#cb341-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-12"><a href="#cb341-12" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb341-13"><a href="#cb341-13" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb341-14"><a href="#cb341-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb341-15"><a href="#cb341-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb341-16"><a href="#cb341-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb341-17"><a href="#cb341-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb341-18"><a href="#cb341-18" aria-hidden="true" tabindex="-1"></a>pTemp_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb341-19"><a href="#cb341-19" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb341-20"><a href="#cb341-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb341-21"><a href="#cb341-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb341-22"><a href="#cb341-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-23"><a href="#cb341-23" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb341-24"><a href="#cb341-24" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb341-25"><a href="#cb341-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb341-26"><a href="#cb341-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb341-27"><a href="#cb341-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-28"><a href="#cb341-28" aria-hidden="true" tabindex="-1"></a>pYear_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb341-29"><a href="#cb341-29" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb341-30"><a href="#cb341-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb341-31"><a href="#cb341-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb341-32"><a href="#cb341-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-33"><a href="#cb341-33" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pWeight_negGrowth, pFlow_negGrowth, pTemp_negGrowth, pNInd_negGrowth, pYear_negGrowth, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS_figs-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (observedWeight<span class="sc">-</span><span class="fu">mean</span>(observedWeight))<span class="sc">/</span><span class="fu">sd</span>(observedWeight),</span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Mass"</span>,</span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb342-9"><a href="#cb342-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-10"><a href="#cb342-10" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb342-11"><a href="#cb342-11" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb342-12"><a href="#cb342-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanFlowByRiver<span class="sc">-</span><span class="fu">mean</span>(meanFlowByRiver))<span class="sc">/</span><span class="fu">sd</span>(meanFlowByRiver),</span>
<span id="cb342-13"><a href="#cb342-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb342-14"><a href="#cb342-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb342-15"><a href="#cb342-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-16"><a href="#cb342-16" aria-hidden="true" tabindex="-1"></a>pMT_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb342-17"><a href="#cb342-17" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb342-18"><a href="#cb342-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanTemperature<span class="sc">-</span><span class="fu">mean</span>(meanTemperature))<span class="sc">/</span><span class="fu">sd</span>(meanTemperature),</span>
<span id="cb342-19"><a href="#cb342-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb342-20"><a href="#cb342-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb342-21"><a href="#cb342-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-22"><a href="#cb342-22" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb342-23"><a href="#cb342-23" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb342-24"><a href="#cb342-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb342-25"><a href="#cb342-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb342-26"><a href="#cb342-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb342-27"><a href="#cb342-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-28"><a href="#cb342-28" aria-hidden="true" tabindex="-1"></a>pYear_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb342-29"><a href="#cb342-29" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb342-30"><a href="#cb342-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb342-31"><a href="#cb342-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb342-32"><a href="#cb342-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb342-33"><a href="#cb342-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-34"><a href="#cb342-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-35"><a href="#cb342-35" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataATS <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pWeight_negGrowthDataATS, pFlow_negGrowthDataATS, pMT_negGrowthDataATS, pNInd_negGrowthDataATS, pYear_negGrowthDataATS)</span>
<span id="cb342-36"><a href="#cb342-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-37"><a href="#cb342-37" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb342-38"><a href="#cb342-38" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataATS_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthDataATS, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb342-39"><a href="#cb342-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb342-40"><a href="#cb342-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb342-41"><a href="#cb342-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb342-42"><a href="#cb342-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb342-43"><a href="#cb342-43" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS_figs-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanTemperature"</span>, <span class="at">X =</span> negGrowthATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanFlowByRiver"</span>)) <span class="sc">+</span></span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanFlowByRiver), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS_figs-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanTemperature"</span>)) <span class="sc">+</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanTemperature), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS_figs-7.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/xgbIndATS_figs-8.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="all-3-species" class="level3" data-number="16.11.7">
<h3 data-number="16.11.7" class="anchored" data-anchor-id="all-3-species"><span class="header-section-number">16.11.7</span> All 3 species</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/partial3sppIndProbNeg_7c91eb3c4800854389de1982c8a91c20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plots</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>viAll_negGrowth <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>  viBKT_negGrowth <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>),</span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>  viBNT_negGrowth <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>),</span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a>  viATS_negGrowth <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sppOrdered =</span> <span class="fu">factor</span>(speciesGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Brook Trout"</span>, <span class="st">"Brown Trout"</span>, <span class="st">"Atlantic Salmon"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">feature2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb346-10"><a href="#cb346-10" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"observedWeight"</span> <span class="sc">~</span> <span class="st">"Fish mass"</span>,</span>
<span id="cb346-11"><a href="#cb346-11" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"meanFlowByRiver"</span> <span class="sc">~</span> <span class="st">"Flow"</span>,</span>
<span id="cb346-12"><a href="#cb346-12" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"meanTemperature"</span> <span class="sc">~</span> <span class="st">"Temperature"</span>,</span>
<span id="cb346-13"><a href="#cb346-13" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"nInd"</span> <span class="sc">~</span> <span class="st">"Num Individuals"</span>,</span>
<span id="cb346-14"><a href="#cb346-14" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"year"</span> <span class="sc">~</span> <span class="st">"Year"</span>)</span>
<span id="cb346-15"><a href="#cb346-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb346-16"><a href="#cb346-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-17"><a href="#cb346-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(viAll_negGrowth <span class="sc">|&gt;</span> <span class="fu">filter</span>(Feature <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"observedWeight"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"nInd"</span>, <span class="st">"year"</span>)), <span class="fu">aes</span>(feature2, Gain, <span class="at">fill =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb346-18"><a href="#cb346-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb346-19"><a href="#cb346-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb346-20"><a href="#cb346-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>() <span class="sc">+</span></span>
<span id="cb346-21"><a href="#cb346-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Variable importance for the proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Variable"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/partial3sppIndProbNeg-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################</span></span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3spp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_negGrowthDataBKT, all_negGrowthDataBNT, all_negGrowthDataATS) <span class="sc">|&gt;</span> </span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sppOrdered =</span> <span class="fu">factor</span>(speciesGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Brook Trout"</span>, <span class="st">"Brown Trout"</span>, <span class="st">"Atlantic Salmon"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppMass_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Mass"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb347-8"><a href="#cb347-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb347-9"><a href="#cb347-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb347-10"><a href="#cb347-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb347-11"><a href="#cb347-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled fish mass"</span>) <span class="sc">+</span></span>
<span id="cb347-12"><a href="#cb347-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb347-13"><a href="#cb347-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-14"><a href="#cb347-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-15"><a href="#cb347-15" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppFlow_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Flow"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb347-16"><a href="#cb347-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb347-17"><a href="#cb347-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb347-18"><a href="#cb347-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb347-19"><a href="#cb347-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb347-20"><a href="#cb347-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled flow"</span>) <span class="sc">+</span></span>
<span id="cb347-21"><a href="#cb347-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb347-22"><a href="#cb347-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-23"><a href="#cb347-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-24"><a href="#cb347-24" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppTemp_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Temperature"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb347-25"><a href="#cb347-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb347-26"><a href="#cb347-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb347-27"><a href="#cb347-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb347-28"><a href="#cb347-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb347-29"><a href="#cb347-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled temperature"</span>) <span class="sc">+</span></span>
<span id="cb347-30"><a href="#cb347-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb347-31"><a href="#cb347-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-32"><a href="#cb347-32" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppNInd_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Num inds"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb347-33"><a href="#cb347-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb347-34"><a href="#cb347-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb347-35"><a href="#cb347-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb347-36"><a href="#cb347-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb347-37"><a href="#cb347-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled Number of individuals"</span>) <span class="sc">+</span></span>
<span id="cb347-38"><a href="#cb347-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb347-39"><a href="#cb347-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-40"><a href="#cb347-40" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppYear_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Year"</span>), <span class="fu">aes</span>(year, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb347-41"><a href="#cb347-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb347-42"><a href="#cb347-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb347-43"><a href="#cb347-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb347-44"><a href="#cb347-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb347-45"><a href="#cb347-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb347-46"><a href="#cb347-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb347-47"><a href="#cb347-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-48"><a href="#cb347-48" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb347-49"><a href="#cb347-49" aria-hidden="true" tabindex="-1"></a>  all_negGrowthData3sppMass_gg,</span>
<span id="cb347-50"><a href="#cb347-50" aria-hidden="true" tabindex="-1"></a>  all_negGrowthData3sppFlow_gg, </span>
<span id="cb347-51"><a href="#cb347-51" aria-hidden="true" tabindex="-1"></a>  all_negGrowthData3sppTemp_gg,</span>
<span id="cb347-52"><a href="#cb347-52" aria-hidden="true" tabindex="-1"></a>  all_negGrowthData3sppNInd_gg,</span>
<span id="cb347-53"><a href="#cb347-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#all_negGrowthData3sppYear_gg,</span></span>
<span id="cb347-54"><a href="#cb347-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">left =</span> <span class="fu">textGrob</span>(<span class="fu">expression</span>(<span class="fu">bold</span>(<span class="st">"Effect on proportion of negative observations"</span>)), <span class="at">rot =</span> <span class="dv">90</span>, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">16</span>))</span>
<span id="cb347-55"><a href="#cb347-55" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/partial3sppIndProbNeg-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppYear_gg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/partial3sppIndProbNeg-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="growth-model-continuous-growth" class="level3" data-number="16.11.8">
<h3 data-number="16.11.8" class="anchored" data-anchor-id="growth-model-continuous-growth"><span class="header-section-number">16.11.8</span> Growth model, continuous growth</h3>
<p>can we add season, river interactions? or do separate analyses?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>dML_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(dML_W_target)</span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>treatplan_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(treatplan_W_target)</span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a>features_train_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(features_train_W_target)</span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>new_vars_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(new_vars_W_target)</span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dimensions of one-hot encoded data</span></span>
<span id="cb350-8"><a href="#cb350-8" aria-hidden="true" tabindex="-1"></a>features_train_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(features_train_W_target)</span>
<span id="cb350-9"><a href="#cb350-9" aria-hidden="true" tabindex="-1"></a>features_test_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(features_test_W_target)</span>
<span id="cb350-10"><a href="#cb350-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-11"><a href="#cb350-11" aria-hidden="true" tabindex="-1"></a>response_train_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(response_train_W_target)</span>
<span id="cb350-12"><a href="#cb350-12" aria-hidden="true" tabindex="-1"></a>response_test_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(response_test_W_target)</span>
<span id="cb350-13"><a href="#cb350-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-14"><a href="#cb350-14" aria-hidden="true" tabindex="-1"></a><span class="co"># run from targets</span></span>
<span id="cb350-15"><a href="#cb350-15" aria-hidden="true" tabindex="-1"></a>hyper_grid_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(hyper_grid_W_target)</span>
<span id="cb350-16"><a href="#cb350-16" aria-hidden="true" tabindex="-1"></a>topModel_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(topModel_W_target)</span>
<span id="cb350-17"><a href="#cb350-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-18"><a href="#cb350-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-19"><a href="#cb350-19" aria-hidden="true" tabindex="-1"></a>finalModels_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(finalModels_W_target)</span>
<span id="cb350-20"><a href="#cb350-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-21"><a href="#cb350-21" aria-hidden="true" tabindex="-1"></a>modelToUse <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="run-first-model" class="level4" data-number="16.11.8.1">
<h4 data-number="16.11.8.1" class="anchored" data-anchor-id="run-first-model"><span class="header-section-number">16.11.8.1</span> Run first model</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/runML1_W_413c8ca0f1471027334c7bde771f437d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducibility</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>xgb.fit1_W <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> features_train_W,</span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> response_train_W,</span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">500</span>,</span>
<span id="cb351-8"><a href="#cb351-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb351-9"><a href="#cb351-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>,  <span class="co"># for regression models</span></span>
<span id="cb351-10"><a href="#cb351-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,               <span class="co"># silent,</span></span>
<span id="cb351-11"><a href="#cb351-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span></span>
<span id="cb351-12"><a href="#cb351-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb351-13"><a href="#cb351-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-14"><a href="#cb351-14" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of trees that minimize error</span></span>
<span id="cb351-15"><a href="#cb351-15" aria-hidden="true" tabindex="-1"></a>xgb.fit1_W<span class="sc">$</span>evaluation_log <span class="sc">%&gt;%</span></span>
<span id="cb351-16"><a href="#cb351-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb351-17"><a href="#cb351-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ntrees.train =</span> <span class="fu">which</span>(train_rmse_mean <span class="sc">==</span> <span class="fu">min</span>(train_rmse_mean))[<span class="dv">1</span>],</span>
<span id="cb351-18"><a href="#cb351-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmse.train   =</span> <span class="fu">min</span>(train_rmse_mean),</span>
<span id="cb351-19"><a href="#cb351-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ntrees.test  =</span> <span class="fu">which</span>(test_rmse_mean <span class="sc">==</span> <span class="fu">min</span>(test_rmse_mean))[<span class="dv">1</span>],</span>
<span id="cb351-20"><a href="#cb351-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmse.test   =</span> <span class="fu">min</span>(test_rmse_mean),</span>
<span id="cb351-21"><a href="#cb351-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  ntrees.train  rmse.train ntrees.test   rmse.test
1           67 0.001534427          65 0.001884902</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs number trees</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xgb.fit1_W<span class="sc">$</span>evaluation_log) <span class="sc">+</span></span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, train_rmse_mean), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, test_rmse_mean), <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/runML1_W-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="hyperparameter-search-grid-1" class="level4" data-number="16.11.8.2">
<h4 data-number="16.11.8.2" class="anchored" data-anchor-id="hyperparameter-search-grid-1"><span class="header-section-number">16.11.8.2</span> Hyperparameter search grid</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/runML_HP_W_da47712662b72c5933b0a4f226a6b28d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create hyperparameter grid</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="co"># original grid - using a smaller one in targets</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a><span class="co"># hyper_grid_W0 &lt;- expand.grid(</span></span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   eta = c(.01, .05, .1, .3),</span></span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   max_depth = c(1, 3, 5, 7),</span></span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   min_child_weight = c(1, 3, 5, 7),</span></span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   subsample = c(.65, .8, 1), </span></span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   colsample_bytree = c(.8, .9, 1),</span></span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   optimal_trees = 0,               # a place to dump results</span></span>
<span id="cb354-10"><a href="#cb354-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   min_RMSE = 0                     # a place to dump results</span></span>
<span id="cb354-11"><a href="#cb354-11" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb354-12"><a href="#cb354-12" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow(hyper_grid_W0)</span></span>
<span id="cb354-13"><a href="#cb354-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-14"><a href="#cb354-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-15"><a href="#cb354-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-16"><a href="#cb354-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Original run using hyper_grid_W0 </span></span>
<span id="cb354-17"><a href="#cb354-17" aria-hidden="true" tabindex="-1"></a><span class="co"># eta max_depth min_child_weight</span></span>
<span id="cb354-18"><a href="#cb354-18" aria-hidden="true" tabindex="-1"></a><span class="co"># subsample colsample_bytree optimal_trees min_RMSE 1 0.01 7 5 0.65 0.8</span></span>
<span id="cb354-19"><a href="#cb354-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 1376 0.001847600 2 0.05 7 3 0.80 0.9 292 0.001848465 3 0.01 7 7 0.80 0.9</span></span>
<span id="cb354-20"><a href="#cb354-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 1382 0.001849086 4 0.01 5 1 0.80 0.8 2399 0.001849250 5 0.05 7 3 0.80</span></span>
<span id="cb354-21"><a href="#cb354-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.8 281 0.001849258 6 0.01 5 3 0.65 0.8 2147 0.001849905 7 0.05 5 1 0.65</span></span>
<span id="cb354-22"><a href="#cb354-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.8 459 0.001849931 8 0.01 5 5 0.80 0.9 2296 0.001850049 9 0.01 7 5 0.65</span></span>
<span id="cb354-23"><a href="#cb354-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.9 1402 0.001850246 10 0.01 7 7 0.65 0.8 1382 0.001850544 11 0.01 7 3</span></span>
<span id="cb354-24"><a href="#cb354-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.65 0.8 1384 0.001850704 12 0.05 3 3 0.80 0.8 1509 0.001850763 13 0.01</span></span>
<span id="cb354-25"><a href="#cb354-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 7 0.80 0.8 1453 0.001850975 14 0.01 7 1 0.80 1.0 1281 0.001851069 15</span></span>
<span id="cb354-26"><a href="#cb354-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.01 7 1 0.80 0.8 1473 0.001851078</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="variable-importance-plot" class="level4" data-number="16.11.8.3">
<h4 data-number="16.11.8.3" class="anchored" data-anchor-id="variable-importance-plot"><span class="header-section-number">16.11.8.3</span> Variable importance plot</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co">#importance_matrix_W &lt;- tar_read(importance_matrix_W_target)</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="partial-dependence-plots" class="level4" data-number="16.11.8.4">
<h4 data-number="16.11.8.4" class="anchored" data-anchor-id="partial-dependence-plots"><span class="header-section-number">16.11.8.4</span> Partial dependence plots</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/pdpContinuous_W_4b1b46e3bf71f427b0e0d22f78e972db">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>create_xgb_plots <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> finalModels_W, <span class="at">f =</span> features_train_W, <span class="at">modelToUse =</span> modelToUse) {</span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a>  imp <span class="ot">&lt;-</span> <span class="fu">xgb.ggplot.importance</span>(d<span class="sc">$</span>importanceMatrix[[modelToUse]], <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>) <span class="sc">+</span> </span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"Model #"</span>, modelToUse))</span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a>  pW_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb356-8"><a href="#cb356-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f) </span>
<span id="cb356-9"><a href="#cb356-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb356-10"><a href="#cb356-10" aria-hidden="true" tabindex="-1"></a>  pFlow_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb356-11"><a href="#cb356-11" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb356-12"><a href="#cb356-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f)</span>
<span id="cb356-13"><a href="#cb356-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb356-14"><a href="#cb356-14" aria-hidden="true" tabindex="-1"></a>  pTemp_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb356-15"><a href="#cb356-15" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb356-16"><a href="#cb356-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f)</span>
<span id="cb356-17"><a href="#cb356-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb356-18"><a href="#cb356-18" aria-hidden="true" tabindex="-1"></a>  pAge_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb356-19"><a href="#cb356-19" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"age"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb356-20"><a href="#cb356-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f)</span>
<span id="cb356-21"><a href="#cb356-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb356-22"><a href="#cb356-22" aria-hidden="true" tabindex="-1"></a>  pCohort_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb356-23"><a href="#cb356-23" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"cohort"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb356-24"><a href="#cb356-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f)</span>
<span id="cb356-25"><a href="#cb356-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-26"><a href="#cb356-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-27"><a href="#cb356-27" aria-hidden="true" tabindex="-1"></a>  partials <span class="ot">&lt;-</span> gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pW_W, pFlow_W, pTemp_W, pAge_W, pCohort_W, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">top=</span><span class="fu">textGrob</span>(<span class="fu">paste0</span>(<span class="st">"Model #"</span>, modelToUse)))</span>
<span id="cb356-28"><a href="#cb356-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb356-29"><a href="#cb356-29" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">list</span>(imp, partials)) </span>
<span id="cb356-30"><a href="#cb356-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb356-31"><a href="#cb356-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-32"><a href="#cb356-32" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]
TableGrob (4 x 2) "arrange": 6 grobs
  z     cells    name                 grob
1 1 (2-2,1-1) arrange       gtable[layout]
2 2 (2-2,2-2) arrange       gtable[layout]
3 3 (3-3,1-1) arrange       gtable[layout]
4 4 (3-3,2-2) arrange       gtable[layout]
5 5 (4-4,1-1) arrange       gtable[layout]
6 6 (1-1,1-2) arrange text[GRID.text.1272]</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]
TableGrob (4 x 2) "arrange": 6 grobs
  z     cells    name                 grob
1 1 (2-2,1-1) arrange       gtable[layout]
2 2 (2-2,2-2) arrange       gtable[layout]
3 3 (3-3,1-1) arrange       gtable[layout]
4 4 (3-3,2-2) arrange       gtable[layout]
5 5 (4-4,1-1) arrange       gtable[layout]
6 6 (1-1,1-2) arrange text[GRID.text.1527]</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]
TableGrob (4 x 2) "arrange": 6 grobs
  z     cells    name                 grob
1 1 (2-2,1-1) arrange       gtable[layout]
2 2 (2-2,2-2) arrange       gtable[layout]
3 3 (3-3,1-1) arrange       gtable[layout]
4 4 (3-3,2-2) arrange       gtable[layout]
5 5 (4-4,1-1) arrange       gtable[layout]
6 6 (1-1,1-2) arrange text[GRID.text.1781]</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-8.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]
TableGrob (4 x 2) "arrange": 6 grobs
  z     cells    name                 grob
1 1 (2-2,1-1) arrange       gtable[layout]
2 2 (2-2,2-2) arrange       gtable[layout]
3 3 (3-3,1-1) arrange       gtable[layout]
4 4 (3-3,2-2) arrange       gtable[layout]
5 5 (4-4,1-1) arrange       gtable[layout]
6 6 (1-1,1-2) arrange text[GRID.text.2035]</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-9.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-10.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]
TableGrob (4 x 2) "arrange": 6 grobs
  z     cells    name                 grob
1 1 (2-2,1-1) arrange       gtable[layout]
2 2 (2-2,2-2) arrange       gtable[layout]
3 3 (3-3,1-1) arrange       gtable[layout]
4 4 (3-3,2-2) arrange       gtable[layout]
5 5 (4-4,1-1) arrange       gtable[layout]
6 6 (1-1,1-2) arrange text[GRID.text.2289]</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-11.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/pdpContinuous_W-12.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]
TableGrob (4 x 2) "arrange": 6 grobs
  z     cells    name                 grob
1 1 (2-2,1-1) arrange       gtable[layout]
2 2 (2-2,2-2) arrange       gtable[layout]
3 3 (3-3,1-1) arrange       gtable[layout]
4 4 (3-3,2-2) arrange       gtable[layout]
5 5 (4-4,1-1) arrange       gtable[layout]
6 6 (1-1,1-2) arrange text[GRID.text.2543]</code></pre>
</div>
</div>
</section>
<section id="lime" class="level4" data-number="16.11.8.5">
<h4 data-number="16.11.8.5" class="anchored" data-anchor-id="lime"><span class="header-section-number">16.11.8.5</span> Lime</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/limeContinuous_W_60191b1786fdc2bfb371055c8a930de1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get a few observations to perform local interpretation on</span></span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>local_obs_W <span class="ot">&lt;-</span> dML_W[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ]</span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a><span class="co"># one-hot encode the local observations to be assessed.</span></span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>local_obs_onehot_W <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_W, local_obs_W, <span class="at">varRestriction =</span> new_vars_W)</span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-7"><a href="#cb374-7" aria-hidden="true" tabindex="-1"></a><span class="co"># apply LIME</span></span>
<span id="cb374-8"><a href="#cb374-8" aria-hidden="true" tabindex="-1"></a>explainer_W <span class="ot">&lt;-</span> <span class="fu">lime</span>(<span class="fu">data.frame</span>(features_train_W), finalModels_W<span class="sc">$</span>xgb[[modelToUse]], <span class="at">quantile_bins =</span> <span class="cn">FALSE</span>)</span>
<span id="cb374-9"><a href="#cb374-9" aria-hidden="true" tabindex="-1"></a>explanation_W <span class="ot">&lt;-</span> lime<span class="sc">::</span><span class="fu">explain</span>(local_obs_onehot_W, explainer_W, <span class="at">n_features =</span> <span class="dv">5</span>, <span class="at">n_labels =</span> <span class="dv">2</span>)</span>
<span id="cb374-10"><a href="#cb374-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_features</span>(explanation_W)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/limeContinuous_W-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="predict" class="level4" data-number="16.11.8.6">
<h4 data-number="16.11.8.6" class="anchored" data-anchor-id="predict"><span class="header-section-number">16.11.8.6</span> Predict</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/predict_W_b691380b0cccb2d96e2e845f40440667">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>createPredictions <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> finalModels_W, <span class="at">f =</span> features_test_W, <span class="at">r =</span> response_test_W, <span class="at">modelToUse =</span> modelToUse) {</span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a>  pred_W <span class="ot">&lt;-</span> <span class="fu">predict</span>(d<span class="sc">$</span>xgb[[modelToUse]], f)</span>
<span id="cb375-4"><a href="#cb375-4" aria-hidden="true" tabindex="-1"></a>  rmse <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">RMSE</span>(pred_W, r)</span>
<span id="cb375-5"><a href="#cb375-5" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">R2</span>(pred_W, r)</span>
<span id="cb375-6"><a href="#cb375-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb375-7"><a href="#cb375-7" aria-hidden="true" tabindex="-1"></a>  obsPred_W <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">obs =</span> r, <span class="at">pred =</span> pred_W, f)</span>
<span id="cb375-8"><a href="#cb375-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb375-9"><a href="#cb375-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">r2 =</span> r2, <span class="at">rmse =</span> rmse, <span class="at">obsPred_W =</span> obsPred_W))</span>
<span id="cb375-10"><a href="#cb375-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="modelGrowthInMass_cache/html/obsPred_W_d5aff484269c360ef75065c628f08fe7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a>predsOP_W <span class="ot">&lt;-</span> <span class="fu">createPredictions</span>(finalModels_W, features_test_W, response_test_W, modelToUse) </span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predsOP_W<span class="sc">$</span>obsPred_W, <span class="fu">aes</span>(obs, pred)) <span class="sc">+</span></span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observed growth rate"</span>, <span class="at">y =</span> <span class="st">"Predicted growth rate"</span>) <span class="sc">+</span></span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"r2 = "</span>, <span class="fu">round</span>(predsOP_W<span class="sc">$</span>r2, <span class="dv">2</span>), <span class="st">" RMSE = "</span>, <span class="fu">round</span>(predsOP_W<span class="sc">$</span>rmse, <span class="dv">5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/obsPred_W-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predsOP_W<span class="sc">$</span>obsPred_W, <span class="fu">aes</span>(obs, pred)) <span class="sc">+</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observed growth rate"</span>, <span class="at">y =</span> <span class="st">"Predicted growth rate"</span>) <span class="sc">+</span></span>
<span id="cb377-4"><a href="#cb377-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb377-5"><a href="#cb377-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/obsPred_W-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="modelGrowthInMass_cache/html/UsingGridInputs_baca0cc7026af7af37cc21685a974556">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb378"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a>renameLev <span class="ot">&lt;-</span> <span class="cf">function</span>(d) {</span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">|&gt;</span>  </span>
<span id="cb378-3"><a href="#cb378-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">"_lev_x_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb378-4"><a href="#cb378-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span>.x[<span class="dv">2</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb378-5"><a href="#cb378-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>()</span>
<span id="cb378-6"><a href="#cb378-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb378-7"><a href="#cb378-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-8"><a href="#cb378-8" aria-hidden="true" tabindex="-1"></a>createPredictionsGrid <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> finalModels_W, <span class="at">pg =</span> gridPred, <span class="at">modelToUse =</span> modelToUse){</span>
<span id="cb378-9"><a href="#cb378-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#, f = features_test_W, r = response_test_W, nSeq = 5, modelToUse = modelToUse) {</span></span>
<span id="cb378-10"><a href="#cb378-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb378-11"><a href="#cb378-11" aria-hidden="true" tabindex="-1"></a>  predGrid <span class="ot">&lt;-</span> <span class="fu">predict</span>(d<span class="sc">$</span>xgb[[modelToUse]], pg)</span>
<span id="cb378-12"><a href="#cb378-12" aria-hidden="true" tabindex="-1"></a>  gridPredOut <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(pg, <span class="at">pred =</span> predGrid) <span class="sc">|&gt;</span> </span>
<span id="cb378-13"><a href="#cb378-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(</span>
<span id="cb378-14"><a href="#cb378-14" aria-hidden="true" tabindex="-1"></a>      renameLev,  </span>
<span id="cb378-15"><a href="#cb378-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">contains</span>(<span class="st">"_lev_x_"</span>)</span>
<span id="cb378-16"><a href="#cb378-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>  </span>
<span id="cb378-17"><a href="#cb378-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb378-18"><a href="#cb378-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb378-19"><a href="#cb378-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">sumRiver =</span> <span class="fu">sum</span>(Isolated_Small <span class="sc">+</span> Open_Large <span class="sc">+</span> Open_Small <span class="sc">+</span> West_Brook),</span>
<span id="cb378-20"><a href="#cb378-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">sumSeason =</span> <span class="fu">sum</span>(Autumn <span class="sc">+</span> Spring <span class="sc">+</span> Summer <span class="sc">+</span> Winter)</span>
<span id="cb378-21"><a href="#cb378-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>   </span>
<span id="cb378-22"><a href="#cb378-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb378-23"><a href="#cb378-23" aria-hidden="true" tabindex="-1"></a>      sumRiver <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb378-24"><a href="#cb378-24" aria-hidden="true" tabindex="-1"></a>      sumSeason <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb378-25"><a href="#cb378-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>   </span>
<span id="cb378-26"><a href="#cb378-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb378-27"><a href="#cb378-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">'Isolated_Small'</span><span class="sc">:</span><span class="st">'Winter'</span>), <span class="sc">~</span>.x <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb378-28"><a href="#cb378-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb378-29"><a href="#cb378-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-30"><a href="#cb378-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gridPredOut)</span>
<span id="cb378-31"><a href="#cb378-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb378-32"><a href="#cb378-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-33"><a href="#cb378-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-34"><a href="#cb378-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-35"><a href="#cb378-35" aria-hidden="true" tabindex="-1"></a>nSeq <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb378-36"><a href="#cb378-36" aria-hidden="true" tabindex="-1"></a>xGrid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb378-37"><a href="#cb378-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">observedWeight =</span> <span class="dv">40</span>, <span class="co">#seq(min(f[,"observedWeight"]), max(f[,"observedWeight"]), length.out = nSeq),</span></span>
<span id="cb378-38"><a href="#cb378-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort =</span> <span class="dv">2010</span>, <span class="co">#seq(min(f[,"cohort"]), max(f[,"cohort"]), length.out = nSeq),</span></span>
<span id="cb378-39"><a href="#cb378-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="dv">1</span>, <span class="co">#seq(min(f[,"age"]), max(f[,"age"]), length.out = nSeq),</span></span>
<span id="cb378-40"><a href="#cb378-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanTemperature =</span> <span class="fu">seq</span>(<span class="fu">min</span>(features_test_W[,<span class="st">"meanTemperature"</span>]), <span class="fu">max</span>(features_test_W[,<span class="st">"meanTemperature"</span>]), <span class="at">length.out =</span> nSeq <span class="sc">*</span> <span class="dv">3</span>),</span>
<span id="cb378-41"><a href="#cb378-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiver =</span> <span class="fu">seq</span>(<span class="fu">min</span>(features_test_W[,<span class="st">"meanFlowByRiver"</span>]), <span class="fu">max</span>(features_test_W[,<span class="st">"meanFlowByRiver"</span>]), <span class="at">length.out =</span> nSeq <span class="sc">*</span> <span class="dv">3</span>),</span>
<span id="cb378-42"><a href="#cb378-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">riverGG_lev_x_Isolated_Small =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb378-43"><a href="#cb378-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">riverGG_lev_x_Open_Large =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb378-44"><a href="#cb378-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">riverGG_lev_x_Open_Small =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb378-45"><a href="#cb378-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">riverGG_lev_x_West_Brook =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb378-46"><a href="#cb378-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonGG_lev_x_Autumn =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb378-47"><a href="#cb378-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonGG_lev_x_Spring =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb378-48"><a href="#cb378-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonGG_lev_x_Summer =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb378-49"><a href="#cb378-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonGG_lev_x_Winter =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb378-50"><a href="#cb378-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb378-51"><a href="#cb378-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb378-52"><a href="#cb378-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-53"><a href="#cb378-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-54"><a href="#cb378-54" aria-hidden="true" tabindex="-1"></a>preds_W <span class="ot">&lt;-</span> <span class="fu">createPredictionsGrid</span>(</span>
<span id="cb378-55"><a href="#cb378-55" aria-hidden="true" tabindex="-1"></a>  finalModels_W, </span>
<span id="cb378-56"><a href="#cb378-56" aria-hidden="true" tabindex="-1"></a>  xGrid,</span>
<span id="cb378-57"><a href="#cb378-57" aria-hidden="true" tabindex="-1"></a>  modelToUse</span>
<span id="cb378-58"><a href="#cb378-58" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb378-59"><a href="#cb378-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-60"><a href="#cb378-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-61"><a href="#cb378-61" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(preds_W <span class="sc">|&gt;</span> </span>
<span id="cb378-62"><a href="#cb378-62" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(</span>
<span id="cb378-63"><a href="#cb378-63" aria-hidden="true" tabindex="-1"></a>           <span class="co">#Isolated_Small, Open_Large, Open_Small, West_Brook, </span></span>
<span id="cb378-64"><a href="#cb378-64" aria-hidden="true" tabindex="-1"></a>           <span class="co">#Autumn, Spring, Summer, Winter</span></span>
<span id="cb378-65"><a href="#cb378-65" aria-hidden="true" tabindex="-1"></a>           ), </span>
<span id="cb378-66"><a href="#cb378-66" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(meanFlowByRiver, pred, <span class="at">color =</span> meanTemperature, <span class="at">group =</span> meanTemperature)) <span class="sc">+</span></span>
<span id="cb378-67"><a href="#cb378-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb378-68"><a href="#cb378-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">y =</span> <span class="st">"Predicted growth rate"</span>) <span class="sc">+</span></span>
<span id="cb378-69"><a href="#cb378-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb378-70"><a href="#cb378-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb378-71"><a href="#cb378-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Isolated_Small<span class="sc">+</span>Open_Large<span class="sc">+</span>Open_Small<span class="sc">+</span>West_Brook <span class="sc">~</span> Spring<span class="sc">+</span>Summer<span class="sc">+</span>Autumn<span class="sc">+</span>Winter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/UsingGridInputs-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use seasonal zScores for environmetnal data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="when-and-where-do-fish-have-predicted-negative-growth" class="level4" data-number="16.11.8.7">
<h4 data-number="16.11.8.7" class="anchored" data-anchor-id="when-and-where-do-fish-have-predicted-negative-growth"><span class="header-section-number">16.11.8.7</span> When and where do fish have predicted negative growth?</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/negPredGrowth_W_5557b58866720c220ffc7a4c3359ef48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb380"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a>predNeg <span class="ot">&lt;-</span> preds_W <span class="sc">|&gt;</span> <span class="fu">filter</span>(pred <span class="sc">&lt;</span> <span class="fl">0.000</span>)</span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a>predNeg <span class="sc">|&gt;</span> </span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Isolated_Small, Open_Large, Open_Small, West_Brook, Autumn, Spring, Summer, Winter) <span class="sc">|&gt;</span> </span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 9
# Rowwise: 
   Isolated_Small Open_Large Open_Small West_Brook Autumn Spring Summer Winter
   &lt;lgl&gt;          &lt;lgl&gt;      &lt;lgl&gt;      &lt;lgl&gt;      &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt; 
 1 FALSE          FALSE      FALSE      TRUE       TRUE   FALSE  FALSE  FALSE 
 2 FALSE          TRUE       FALSE      FALSE      TRUE   FALSE  FALSE  FALSE 
 3 FALSE          FALSE      TRUE       FALSE      TRUE   FALSE  FALSE  FALSE 
 4 TRUE           FALSE      FALSE      FALSE      TRUE   FALSE  FALSE  FALSE 
 5 FALSE          FALSE      FALSE      TRUE       FALSE  FALSE  FALSE  TRUE  
 6 FALSE          FALSE      FALSE      TRUE       FALSE  FALSE  TRUE   FALSE 
 7 FALSE          TRUE       FALSE      FALSE      FALSE  FALSE  FALSE  TRUE  
 8 FALSE          TRUE       FALSE      FALSE      FALSE  FALSE  TRUE   FALSE 
 9 TRUE           FALSE      FALSE      FALSE      FALSE  FALSE  FALSE  TRUE  
10 TRUE           FALSE      FALSE      FALSE      FALSE  FALSE  TRUE   FALSE 
# ℹ 1 more variable: n &lt;int&gt;</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>predNeg <span class="sc">|&gt;</span> </span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Autumn, Spring, Summer, Winter) <span class="sc">|&gt;</span> </span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
# Rowwise: 
  Autumn Spring Summer Winter     n
  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;int&gt;
1 TRUE   FALSE  FALSE  FALSE    190
2 FALSE  FALSE  FALSE  TRUE      37
3 FALSE  FALSE  TRUE   FALSE     29</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>predNeg <span class="sc">|&gt;</span> </span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Isolated_Small, Open_Large, Open_Small, West_Brook) <span class="sc">|&gt;</span> </span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
# Rowwise: 
  Isolated_Small Open_Large Open_Small West_Brook     n
  &lt;lgl&gt;          &lt;lgl&gt;      &lt;lgl&gt;      &lt;lgl&gt;      &lt;int&gt;
1 FALSE          FALSE      FALSE      TRUE         103
2 FALSE          TRUE       FALSE      FALSE         74
3 TRUE           FALSE      FALSE      FALSE         42
4 FALSE          FALSE      TRUE       FALSE         37</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="gam-for-individual-growth" class="level2" data-number="16.12">
<h2 data-number="16.12" class="anchored" data-anchor-id="gam-for-individual-growth"><span class="header-section-number">16.12</span> GAM for individual growth</h2>
<div class="cell" data-hash="modelGrowthInMass_cache/html/gamGrowthRaw_0bf61690e5a5544eab517b4f231e6ca3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co">#riverGG, seasonGG, observedWeight, cohort, age, meanTemperature, meanFlowByRiver, negGrowth</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a>kValue <span class="ot">&lt;-</span> <span class="dv">4</span> </span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">!=</span> <span class="st">"Atlantic salmon"</span>), <span class="fu">aes</span>(flowByRiverS, grWeight, <span class="at">group =</span> speciesGG, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, </span>
<span id="cb386-9"><a href="#cb386-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>, <span class="at">k =</span> kValue), </span>
<span id="cb386-10"><a href="#cb386-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb386-11"><a href="#cb386-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb386-12"><a href="#cb386-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/gamGrowthRaw-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">!=</span> <span class="st">"Atlantic salmon"</span>), <span class="fu">aes</span>(flowByRiverSR, grWeight, <span class="at">group =</span> speciesGG, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, </span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>, <span class="at">k =</span> kValue), </span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb387-8"><a href="#cb387-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb387-9"><a href="#cb387-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/gamGrowthRaw-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">!=</span> <span class="st">"Atlantic salmon"</span>), <span class="fu">aes</span>(tempSR, grWeight, <span class="at">group =</span> speciesGG, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, </span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>, <span class="at">k =</span> kValue), </span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb388-7"><a href="#cb388-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb388-8"><a href="#cb388-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb388-9"><a href="#cb388-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/gamGrowthRaw-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="linear-models-for-growth" class="level3" data-number="16.12.1">
<h3 data-number="16.12.1" class="anchored" data-anchor-id="linear-models-for-growth"><span class="header-section-number">16.12.1</span> Linear models for growth</h3>
<p>Initial test of model structure for GAMs</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/linearModelGrowth_ad9b4d11ca3f6c4a78572c48f50db0ae">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a>runLinearModels <span class="ot">&lt;-</span> <span class="cf">function</span>(d, speciesIn) {</span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">=</span></span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">model =</span> </span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG * tempSR * flowByRiverSR * observedWeight + cohortF * ageF)'</span>,</span>
<span id="cb389-6"><a href="#cb389-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG * tempSR * flowByRiverSR * observedWeight + cohortF)'</span>,</span>
<span id="cb389-7"><a href="#cb389-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG * tempSR * flowByRiverSR + cohortF * ageF)'</span>,</span>
<span id="cb389-8"><a href="#cb389-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG * tempSR * flowByRiverSR + cohortF)'</span>,</span>
<span id="cb389-9"><a href="#cb389-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG + tempSR * flowByRiverSR + cohortF * ageF)'</span>,</span>
<span id="cb389-10"><a href="#cb389-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG + tempSR + flowByRiverSR + cohortF * ageF)'</span></span>
<span id="cb389-11"><a href="#cb389-11" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb389-12"><a href="#cb389-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb389-13"><a href="#cb389-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb389-14"><a href="#cb389-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit =</span> <span class="fu">map</span>(model, <span class="sc">~</span><span class="fu">lm</span>(.x, <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn))),</span>
<span id="cb389-15"><a href="#cb389-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">glanced =</span> <span class="fu">map</span>(fit, broom<span class="sc">::</span>glance),</span>
<span id="cb389-16"><a href="#cb389-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">tidied =</span> <span class="fu">map</span>(fit, broom<span class="sc">::</span>tidy)</span>
<span id="cb389-17"><a href="#cb389-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb389-18"><a href="#cb389-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(models)</span>
<span id="cb389-19"><a href="#cb389-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="brook-trout-11" class="level4" data-number="16.12.1.1">
<h4 data-number="16.12.1.1" class="anchored" data-anchor-id="brook-trout-11"><span class="header-section-number">16.12.1.1</span> Brook trout</h4>
<p>Most complex model has lowest AIC</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/linBKT_b9fa3d4fcc9322892d76a9308997e25f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"Brook trout"</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>modLinearBKT <span class="ot">&lt;-</span> <span class="fu">runLinearModels</span>(dGAM, speciesIn)</span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a>modLinearBKT <span class="sc">|&gt;</span> </span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(glanced) <span class="sc">|&gt;</span></span>
<span id="cb390-6"><a href="#cb390-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb390-7"><a href="#cb390-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, df.residual, fit, tidied)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  model                                           AIC df.residual fit   tidied  
  &lt;chr&gt;                                         &lt;dbl&gt;       &lt;int&gt; &lt;lis&gt; &lt;list&gt;  
1 grWeight ~ (riverGG * seasonGG * tempSR * … -94812.        9893 &lt;lm&gt;  &lt;tibble&gt;
2 grWeight ~ (riverGG * seasonGG * tempSR * … -93880.        9943 &lt;lm&gt;  &lt;tibble&gt;
3 grWeight ~ (riverGG * seasonGG * tempSR * … -92957.        9957 &lt;lm&gt;  &lt;tibble&gt;
4 grWeight ~ (riverGG * seasonGG + tempSR * … -91713.       10002 &lt;lm&gt;  &lt;tibble&gt;
5 grWeight ~ (riverGG * seasonGG + tempSR + … -91576.       10003 &lt;lm&gt;  &lt;tibble&gt;
6 grWeight ~ (riverGG * seasonGG * tempSR * … -90183.       10007 &lt;lm&gt;  &lt;tibble&gt;</code></pre>
</div>
</div>
</section>
<section id="brown-trout-11" class="level4" data-number="16.12.1.2">
<h4 data-number="16.12.1.2" class="anchored" data-anchor-id="brown-trout-11"><span class="header-section-number">16.12.1.2</span> Brown trout</h4>
<p>Most complex model has lowest AIC</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/linBNT_0ebcfb2e77431409d9d932afd14b94df">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"Brown trout"</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>modLinearBNT <span class="ot">&lt;-</span> <span class="fu">runLinearModels</span>(dGAM, speciesIn)</span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>modLinearBNT <span class="sc">|&gt;</span> </span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(glanced) <span class="sc">|&gt;</span></span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, df.residual, fit, tidied)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  model                                           AIC df.residual fit   tidied  
  &lt;chr&gt;                                         &lt;dbl&gt;       &lt;int&gt; &lt;lis&gt; &lt;list&gt;  
1 grWeight ~ (riverGG * seasonGG * tempSR * … -45804.        4491 &lt;lm&gt;  &lt;tibble&gt;
2 grWeight ~ (riverGG * seasonGG * tempSR * … -44981.        4543 &lt;lm&gt;  &lt;tibble&gt;
3 grWeight ~ (riverGG * seasonGG * tempSR * … -44366.        4539 &lt;lm&gt;  &lt;tibble&gt;
4 grWeight ~ (riverGG * seasonGG + tempSR * … -43783.        4572 &lt;lm&gt;  &lt;tibble&gt;
5 grWeight ~ (riverGG * seasonGG + tempSR + … -43714.        4573 &lt;lm&gt;  &lt;tibble&gt;
6 grWeight ~ (riverGG * seasonGG * tempSR * … -42537.        4591 &lt;lm&gt;  &lt;tibble&gt;</code></pre>
</div>
</div>
<p>These linear models suggest that we need significant complexity in GAM models</p>
</section>
</section>
<section id="gam-models-for-growth" class="level3" data-number="16.12.2">
<h3 data-number="16.12.2" class="anchored" data-anchor-id="gam-models-for-growth"><span class="header-section-number">16.12.2</span> GAM models for growth</h3>
<p>This modeling approach map() (which I would like to use), throws an error using bam(). Use gamX model approach below.</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/gamModelsGrowth_3811578ccb9c54bfb27c63476a6cccde">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>runGAMModels <span class="ot">&lt;-</span> <span class="cf">function</span>(d, speciesIn, kIn) {</span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">=</span></span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">model =</span> </span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'grWeight ~ riverGG * seasonGG * observedWeight + cohortF * ageF +             </span></span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a><span class="st">               s(flowByRiverSR, bs = "cr", k = kIn, by = riverGG) +</span></span>
<span id="cb394-7"><a href="#cb394-7" aria-hidden="true" tabindex="-1"></a><span class="st">               s(flowByRiverSR, bs = "cr", k = kIn, by = seasonGG) +</span></span>
<span id="cb394-8"><a href="#cb394-8" aria-hidden="true" tabindex="-1"></a><span class="st">               s(tempSR, bs = "cr", k = kIn, by = riverGG) +</span></span>
<span id="cb394-9"><a href="#cb394-9" aria-hidden="true" tabindex="-1"></a><span class="st">               s(tempSR, bs = "cr", k = kIn, by = seasonGG)'</span>,</span>
<span id="cb394-10"><a href="#cb394-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb394-11"><a href="#cb394-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'grWeight ~ riverGG * seasonGG * observedWeight * tempSR * flowByRiverSR + cohortF * ageF +             </span></span>
<span id="cb394-12"><a href="#cb394-12" aria-hidden="true" tabindex="-1"></a><span class="st">               s(flowByRiverSR, bs = "cr", k = kIn, by = riverGG) +</span></span>
<span id="cb394-13"><a href="#cb394-13" aria-hidden="true" tabindex="-1"></a><span class="st">               s(flowByRiverSR, bs = "cr", k = kIn, by = seasonGG) +</span></span>
<span id="cb394-14"><a href="#cb394-14" aria-hidden="true" tabindex="-1"></a><span class="st">               s(tempSR, bs = "cr", k = kIn, by = riverGG) +</span></span>
<span id="cb394-15"><a href="#cb394-15" aria-hidden="true" tabindex="-1"></a><span class="st">               s(tempSR, bs = "cr", k = kIn, by = seasonGG)'</span></span>
<span id="cb394-16"><a href="#cb394-16" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb394-17"><a href="#cb394-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb394-18"><a href="#cb394-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb394-19"><a href="#cb394-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit =</span> <span class="fu">map</span>(model, <span class="sc">~</span> <span class="fu">bam</span>(.x, <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>)))</span>
<span id="cb394-20"><a href="#cb394-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    glanced = map(fit, broom::glance),</span></span>
<span id="cb394-21"><a href="#cb394-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    tidied = map(fit, broom::tidy)</span></span>
<span id="cb394-22"><a href="#cb394-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb394-23"><a href="#cb394-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(models)</span>
<span id="cb394-24"><a href="#cb394-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb394-25"><a href="#cb394-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-26"><a href="#cb394-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-27"><a href="#cb394-27" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb394-28"><a href="#cb394-28" aria-hidden="true" tabindex="-1"></a><span class="co"># speciesIn &lt;- "Brook trout"</span></span>
<span id="cb394-29"><a href="#cb394-29" aria-hidden="true" tabindex="-1"></a><span class="co"># modLinearBKT &lt;- runGAMModels(dGAM, speciesIn, kValue)</span></span>
<span id="cb394-30"><a href="#cb394-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb394-31"><a href="#cb394-31" aria-hidden="true" tabindex="-1"></a><span class="co"># modLinearBKT |&gt; </span></span>
<span id="cb394-32"><a href="#cb394-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     unnest(glanced) |&gt;</span></span>
<span id="cb394-33"><a href="#cb394-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(AIC) |&gt;</span></span>
<span id="cb394-34"><a href="#cb394-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     dplyr::select(model, AIC, df.residual, fit, tidied)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="brook-trout---flow-by-river" class="level4" data-number="16.12.2.1">
<h4 data-number="16.12.2.1" class="anchored" data-anchor-id="brook-trout---flow-by-river"><span class="header-section-number">16.12.2.1</span> Brook trout - flow by river</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/gamModsBKTFBR_c9995612a230322b612a6c4c67bf5117">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"Brook trout"</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>kIn <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>gam0 <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG <span class="sc">+</span> observedWeight <span class="sc">+</span> tempSR <span class="sc">+</span> flowSR)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> cohortF <span class="sc">*</span> ageF <span class="sc">+</span>             </span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-8"><a href="#cb395-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb395-9"><a href="#cb395-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb395-10"><a href="#cb395-10" aria-hidden="true" tabindex="-1"></a><span class="do">######</span></span>
<span id="cb395-11"><a href="#cb395-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-12"><a href="#cb395-12" aria-hidden="true" tabindex="-1"></a>gam0ByRiver <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG <span class="sc">+</span> observedWeight <span class="sc">+</span> tempSR <span class="sc">+</span> flowByRiverSR)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> cohortF <span class="sc">*</span> ageF <span class="sc">+</span>             </span>
<span id="cb395-13"><a href="#cb395-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-14"><a href="#cb395-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb395-15"><a href="#cb395-15" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-16"><a href="#cb395-16" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb395-17"><a href="#cb395-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb395-18"><a href="#cb395-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-19"><a href="#cb395-19" aria-hidden="true" tabindex="-1"></a>gam1ByRiver <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG <span class="sc">+</span> observedWeight <span class="sc">+</span> tempSR <span class="sc">+</span> flowByRiverSR)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> cohortF <span class="sc">+</span>             </span>
<span id="cb395-20"><a href="#cb395-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-21"><a href="#cb395-21" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb395-22"><a href="#cb395-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-23"><a href="#cb395-23" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb395-24"><a href="#cb395-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb395-25"><a href="#cb395-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-26"><a href="#cb395-26" aria-hidden="true" tabindex="-1"></a><span class="co"># age matters, what about taking out length?</span></span>
<span id="cb395-27"><a href="#cb395-27" aria-hidden="true" tabindex="-1"></a>gam2ByRiver <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG  <span class="sc">+</span> tempSR <span class="sc">+</span> flowByRiverSR)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> cohortF <span class="sc">*</span> ageF <span class="sc">+</span>             </span>
<span id="cb395-28"><a href="#cb395-28" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-29"><a href="#cb395-29" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb395-30"><a href="#cb395-30" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-31"><a href="#cb395-31" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb395-32"><a href="#cb395-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb395-33"><a href="#cb395-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-34"><a href="#cb395-34" aria-hidden="true" tabindex="-1"></a><span class="co">#nope, need to keep length</span></span>
<span id="cb395-35"><a href="#cb395-35" aria-hidden="true" tabindex="-1"></a><span class="co">#How about without the interactions?</span></span>
<span id="cb395-36"><a href="#cb395-36" aria-hidden="true" tabindex="-1"></a>gam3ByRiver <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG <span class="sc">+</span> observedWeight <span class="sc">+</span> tempSR <span class="sc">+</span> flowByRiverSR) <span class="sc">+</span> cohortF <span class="sc">*</span> ageF <span class="sc">+</span>             </span>
<span id="cb395-37"><a href="#cb395-37" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-38"><a href="#cb395-38" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb395-39"><a href="#cb395-39" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb395-40"><a href="#cb395-40" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb395-41"><a href="#cb395-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb395-42"><a href="#cb395-42" aria-hidden="true" tabindex="-1"></a><span class="co">#nope, need the interactions</span></span>
<span id="cb395-43"><a href="#cb395-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-44"><a href="#cb395-44" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(gam0ByRiver, gam1ByRiver, gam2ByRiver, gam3ByRiver) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(AIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   df       AIC
gam0ByRiver 116.89094 -87224.07
gam1ByRiver  70.59026 -86375.49
gam2ByRiver 105.40682 -85711.79
gam3ByRiver 102.06380 -85375.03</code></pre>
</div>
</div>
</section>
<section id="brook-trout---compare-flow-and-flow-by-river-gams" class="level4" data-number="16.12.2.2">
<h4 data-number="16.12.2.2" class="anchored" data-anchor-id="brook-trout---compare-flow-and-flow-by-river-gams"><span class="header-section-number">16.12.2.2</span> Brook trout - compare flow and flow by river gams</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/gamModsCompare_1dde3d3d63b74ed96f720ce2037ee8e4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a>predictBKTgam <span class="ot">&lt;-</span> <span class="cf">function</span>(dIn, modInFlowByRiver){</span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predMat0 &lt;- </span></span>
<span id="cb397-4"><a href="#cb397-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   expand.grid(</span></span>
<span id="cb397-5"><a href="#cb397-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     flowSR = seq(-1.5,1.5,0.25), </span></span>
<span id="cb397-6"><a href="#cb397-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     tempSR = seq(-1.5,1.5,0.25), </span></span>
<span id="cb397-7"><a href="#cb397-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     riverGG = unique(dIn$riverGG), </span></span>
<span id="cb397-8"><a href="#cb397-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     seasonGG= unique(dIn$seasonGG),</span></span>
<span id="cb397-9"><a href="#cb397-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     observedWeight = seq(2, max(dIn$observedWeight, na.rm = TRUE)/2, 20),</span></span>
<span id="cb397-10"><a href="#cb397-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     cohortF = 2000:2013,#uunique(dIn$cohortF),</span></span>
<span id="cb397-11"><a href="#cb397-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     ageF = 0:4,#unique(dIn$ageF),</span></span>
<span id="cb397-12"><a href="#cb397-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     byRiver = FALSE</span></span>
<span id="cb397-13"><a href="#cb397-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb397-14"><a href="#cb397-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predMat &lt;- </span></span>
<span id="cb397-15"><a href="#cb397-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   add_column(</span></span>
<span id="cb397-16"><a href="#cb397-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     pred = predict.bam(modInFlow, predMat0),</span></span>
<span id="cb397-17"><a href="#cb397-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     predMat0</span></span>
<span id="cb397-18"><a href="#cb397-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ) |&gt; </span></span>
<span id="cb397-19"><a href="#cb397-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   rename(flow = flowSR, temp = tempSR)</span></span>
<span id="cb397-20"><a href="#cb397-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb397-21"><a href="#cb397-21" aria-hidden="true" tabindex="-1"></a>  predMatByRiver0 <span class="ot">&lt;-</span> </span>
<span id="cb397-22"><a href="#cb397-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand.grid</span>(</span>
<span id="cb397-23"><a href="#cb397-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">flowByRiverSR =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb397-24"><a href="#cb397-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">tempSR =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb397-25"><a href="#cb397-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">riverGG =</span> <span class="fu">unique</span>(dIn<span class="sc">$</span>riverGG), </span>
<span id="cb397-26"><a href="#cb397-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">seasonGG=</span> <span class="fu">unique</span>(dIn<span class="sc">$</span>seasonGG),</span>
<span id="cb397-27"><a href="#cb397-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">observedWeight =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">max</span>(dIn<span class="sc">$</span>observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">2</span>, <span class="dv">20</span>),</span>
<span id="cb397-28"><a href="#cb397-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">cohortF =</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>,<span class="co">#unique(dIn$cohortF),</span></span>
<span id="cb397-29"><a href="#cb397-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">ageF =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,<span class="co">#unique(dIn$ageF),</span></span>
<span id="cb397-30"><a href="#cb397-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">byRiver =</span> <span class="cn">TRUE</span></span>
<span id="cb397-31"><a href="#cb397-31" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb397-32"><a href="#cb397-32" aria-hidden="true" tabindex="-1"></a>  predMatByRiver <span class="ot">&lt;-</span> </span>
<span id="cb397-33"><a href="#cb397-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(</span>
<span id="cb397-34"><a href="#cb397-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred =</span> <span class="fu">predict.bam</span>(modInFlowByRiver, predMatByRiver0),</span>
<span id="cb397-35"><a href="#cb397-35" aria-hidden="true" tabindex="-1"></a>      predMatByRiver0</span>
<span id="cb397-36"><a href="#cb397-36" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb397-37"><a href="#cb397-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">flow =</span> flowByRiverSR, <span class="at">temp =</span> tempSR)</span>
<span id="cb397-38"><a href="#cb397-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-39"><a href="#cb397-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(predMatByRiver)</span>
<span id="cb397-40"><a href="#cb397-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb397-41"><a href="#cb397-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-42"><a href="#cb397-42" aria-hidden="true" tabindex="-1"></a>gamBKTPredictions <span class="ot">&lt;-</span> <span class="fu">predictBKTgam</span>(dGAM, gam0ByRiver)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="graph-predictions" class="level4" data-number="16.12.2.3">
<h4 data-number="16.12.2.3" class="anchored" data-anchor-id="graph-predictions"><span class="header-section-number">16.12.2.3</span> Graph predictions</h4>
<div class="cell" data-hash="modelGrowthInMass_cache/html/graphGAMPredictions_af46436f85c809af5baaed7da7f1ea90">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(gamBKTPredictions<span class="sc">$</span>observedWeight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   2  22  42  62  82 102 122 142 162 182</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>  gamBKTPredictions <span class="sc">|&gt;</span> </span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a>      observedWeight <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">22</span>), </span>
<span id="cb400-5"><a href="#cb400-5" aria-hidden="true" tabindex="-1"></a>      cohortF <span class="sc">==</span> <span class="dv">2012</span>, </span>
<span id="cb400-6"><a href="#cb400-6" aria-hidden="true" tabindex="-1"></a>      ageF <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb400-7"><a href="#cb400-7" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb400-8"><a href="#cb400-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(temp, pred, <span class="at">color =</span> (flow), <span class="at">group =</span> (flow))) <span class="sc">+</span></span>
<span id="cb400-9"><a href="#cb400-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb400-10"><a href="#cb400-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Stream temperature"</span>, <span class="at">y =</span> <span class="st">"Predicted growth rate"</span>) <span class="sc">+</span></span>
<span id="cb400-11"><a href="#cb400-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_smooth(se = FALSE) +</span></span>
<span id="cb400-12"><a href="#cb400-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb400-13"><a href="#cb400-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb400-14"><a href="#cb400-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG<span class="sc">+</span>byRiver, <span class="at">scales =</span> <span class="st">'free'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/graphGAMPredictions-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="logistic-models-for-environmental-effects-on-neggrowth" class="level2" data-number="16.13">
<h2 data-number="16.13" class="anchored" data-anchor-id="logistic-models-for-environmental-effects-on-neggrowth"><span class="header-section-number">16.13</span> Logistic models for environmental effects on negGrowth</h2>
<section id="standardize-flow-and-temperature" class="level3" data-number="16.13.1">
<h3 data-number="16.13.1" class="anchored" data-anchor-id="standardize-flow-and-temperature"><span class="header-section-number">16.13.1</span> Standardize flow and temperature</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/flowTempZ_8464e30d098503777a557bb94bfa5559">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co"># getZ &lt;- function(d){</span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   list(</span></span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     mean = mean(d, na.rm = TRUE),</span></span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     sd = sd(d, na.rm = TRUE)</span></span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb401-6"><a href="#cb401-6" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb401-7"><a href="#cb401-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fZ &lt;- getZ(cd1$meanFlowByRiver)</span></span>
<span id="cb401-8"><a href="#cb401-8" aria-hidden="true" tabindex="-1"></a><span class="co"># fT &lt;- getZ(cd1$meanTemperature)</span></span>
<span id="cb401-9"><a href="#cb401-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-10"><a href="#cb401-10" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> cd1 <span class="sc">|&gt;</span> </span>
<span id="cb401-11"><a href="#cb401-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb401-12"><a href="#cb401-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)) <span class="sc">|&gt;</span> </span>
<span id="cb401-13"><a href="#cb401-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, speciesGG) <span class="sc">|&gt;</span> </span>
<span id="cb401-14"><a href="#cb401-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb401-15"><a href="#cb401-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fQMean =</span> <span class="fu">mean</span>(meanFlowByRiver, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-16"><a href="#cb401-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fQSd =</span> <span class="fu">sd</span>(meanFlowByRiver, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-17"><a href="#cb401-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fTMean =</span> <span class="fu">mean</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-18"><a href="#cb401-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fTSd =</span> <span class="fu">sd</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-19"><a href="#cb401-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fMMean =</span> <span class="fu">mean</span>(observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-20"><a href="#cb401-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">fMSd =</span> <span class="fu">sd</span>(observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-21"><a href="#cb401-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnIndMean =</span> <span class="fu">mean</span>(nInd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-22"><a href="#cb401-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnIndSd =</span> <span class="fu">sd</span>(nInd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-23"><a href="#cb401-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnIndBySpeciesMean =</span> <span class="fu">mean</span>(nIndBySpp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-24"><a href="#cb401-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnIndBySpeciesSd =</span> <span class="fu">sd</span>(nIndBySpp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb401-25"><a href="#cb401-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb401-26"><a href="#cb401-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-27"><a href="#cb401-27" aria-hidden="true" tabindex="-1"></a>zBySeason <span class="ot">&lt;-</span> cd1 <span class="sc">|&gt;</span> </span>
<span id="cb401-28"><a href="#cb401-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, speciesGG, seasonGG) <span class="sc">|&gt;</span> </span>
<span id="cb401-29"><a href="#cb401-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">fQbySeasonMean =</span> <span class="fu">mean</span>(meanFlowByRiver, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-30"><a href="#cb401-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">fQbySeasonSd =</span> <span class="fu">sd</span>(meanFlowByRiver, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-31"><a href="#cb401-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">fTbySeasonMean =</span> <span class="fu">mean</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb401-32"><a href="#cb401-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">fTbySeasonSd =</span> <span class="fu">sd</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb401-33"><a href="#cb401-33" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb401-34"><a href="#cb401-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-35"><a href="#cb401-35" aria-hidden="true" tabindex="-1"></a>cd1_z <span class="ot">&lt;-</span> cd1 <span class="sc">|&gt;</span> </span>
<span id="cb401-36"><a href="#cb401-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb401-37"><a href="#cb401-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)) <span class="sc">|&gt;</span> </span>
<span id="cb401-38"><a href="#cb401-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(z) <span class="sc">|&gt;</span> </span>
<span id="cb401-39"><a href="#cb401-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(zBySeason) <span class="sc">|&gt;</span> </span>
<span id="cb401-40"><a href="#cb401-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb401-41"><a href="#cb401-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiverZ =</span> (meanFlowByRiver <span class="sc">-</span> fQMean)<span class="sc">/</span>fQSd,</span>
<span id="cb401-42"><a href="#cb401-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">nIndZ =</span> (nInd <span class="sc">-</span> fnIndMean)<span class="sc">/</span>fnIndSd,</span>
<span id="cb401-43"><a href="#cb401-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">nIndBySpeciesZ =</span> (nIndBySpp <span class="sc">-</span> fnIndBySpeciesMean)<span class="sc">/</span>fnIndBySpeciesSd,</span>
<span id="cb401-44"><a href="#cb401-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">observedWeightZ =</span> (observedWeight <span class="sc">-</span> fMMean)<span class="sc">/</span>fMSd,</span>
<span id="cb401-45"><a href="#cb401-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb401-46"><a href="#cb401-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiverZ =</span> (meanFlowByRiver <span class="sc">-</span> fQMean)<span class="sc">/</span>fQSd,</span>
<span id="cb401-47"><a href="#cb401-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanTempZ =</span> (meanTemperature <span class="sc">-</span> fTMean)<span class="sc">/</span>fTSd,</span>
<span id="cb401-48"><a href="#cb401-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb401-49"><a href="#cb401-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiverZbySeason =</span> (meanFlowByRiver <span class="sc">-</span> fQbySeasonMean)<span class="sc">/</span>fQbySeasonSd,</span>
<span id="cb401-50"><a href="#cb401-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanTempZbySeason =</span> (meanTemperature <span class="sc">-</span> fTbySeasonMean)<span class="sc">/</span>fTbySeasonSd,</span>
<span id="cb401-51"><a href="#cb401-51" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="raw-data-with-logistic-fit-for-flow-effect" class="level3" data-number="16.13.2">
<h3 data-number="16.13.2" class="anchored" data-anchor-id="raw-data-with-logistic-fit-for-flow-effect"><span class="header-section-number">16.13.2</span> Raw data with logistic fit for flow effect</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/logisticFlow_d03211ebfde000cbbefec67b30d81cf7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb402"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(meanFlowByRiverZ, negGrowth <span class="sc">*</span> <span class="dv">1</span>, <span class="at">color =</span> river)) <span class="sc">+</span></span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>),</span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb402-6"><a href="#cb402-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mean flow"</span>) <span class="sc">+</span></span>
<span id="cb402-7"><a href="#cb402-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb402-8"><a href="#cb402-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/logisticFlow-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb403"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(meanFlowByRiverZ, negGrowth <span class="sc">*</span> <span class="dv">1</span>, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>),</span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mean flow"</span>) <span class="sc">+</span></span>
<span id="cb403-7"><a href="#cb403-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb403-8"><a href="#cb403-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> speciesGG <span class="sc">+</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/logisticFlow-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(cd1_z |&gt; filter(!is.na(negGrowth)), aes(meanFlowByRiverZbySeason, negGrowth * 1, color = riverGG)) +</span></span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(alpha = 0.1) +</span></span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_smooth(method = "glm", </span></span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a><span class="co">#               method.args = list(family = "binomial"),</span></span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a><span class="co">#               se = FALSE) +</span></span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(y = "Probability of negative growth in mass", x = "Mean flow (scaled by season)") +</span></span>
<span id="cb404-7"><a href="#cb404-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_publication() +    </span></span>
<span id="cb404-8"><a href="#cb404-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(seasonGG ~ speciesGG + riverGG)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="raw-data-with-logistic-fit-for-temperature-effect" class="level3" data-number="16.13.3">
<h3 data-number="16.13.3" class="anchored" data-anchor-id="raw-data-with-logistic-fit-for-temperature-effect"><span class="header-section-number">16.13.3</span> Raw data with logistic fit for temperature effect</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/logisticTemp_2e58eb1e8919c85ad5fb95f9b77868ff">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), meanTempZbySeason <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">4</span>), <span class="fu">aes</span>(meanTempZbySeason, negGrowth <span class="sc">*</span> <span class="dv">1</span>, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>),</span>
<span id="cb405-5"><a href="#cb405-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb405-6"><a href="#cb405-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mean temperature (scaled by season)"</span>) <span class="sc">+</span></span>
<span id="cb405-7"><a href="#cb405-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb405-8"><a href="#cb405-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/logisticTemp-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="raw-data-with-logistic-fit-for-observedweight-effect" class="level3" data-number="16.13.4">
<h3 data-number="16.13.4" class="anchored" data-anchor-id="raw-data-with-logistic-fit-for-observedweight-effect"><span class="header-section-number">16.13.4</span> Raw data with logistic fit for observedWeight effect</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/logisticWeight_c7257a612e131c74628543e74f9c56e2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), meanTempZbySeason <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">4</span>), <span class="fu">aes</span>(observedWeightZ, negGrowth <span class="sc">*</span> <span class="dv">1</span>, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>),</span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mass (mg, scaled by species and river)"</span>) <span class="sc">+</span></span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/logisticWeight-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="logistic-model-for-flow-and-temperature-one-species-at-a-time" class="level2" data-number="16.14">
<h2 data-number="16.14" class="anchored" data-anchor-id="logistic-model-for-flow-and-temperature-one-species-at-a-time"><span class="header-section-number">16.14</span> Logistic model for flow and temperature, one species at a time</h2>
<p>Species occupy different rivers, so an all-species model will have unequal river representation across species and don’t need to predict where species are not.</p>
<p>Need to think through whether these models make sense…</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/runLogisticModels_85aadeb277a3aa7834f3ae47d0606461">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb407"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a>runSppModels <span class="ot">&lt;-</span> <span class="cf">function</span>(d, speciesIn) {</span>
<span id="cb407-4"><a href="#cb407-4" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">=</span></span>
<span id="cb407-5"><a href="#cb407-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">model =</span> </span>
<span id="cb407-6"><a href="#cb407-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb407-7"><a href="#cb407-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason'</span>,</span>
<span id="cb407-8"><a href="#cb407-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanTempZbySeason'</span>,</span>
<span id="cb407-9"><a href="#cb407-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ river'</span>,</span>
<span id="cb407-10"><a href="#cb407-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ factor(season)'</span>,</span>
<span id="cb407-11"><a href="#cb407-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ observedWeightZ'</span>,</span>
<span id="cb407-12"><a href="#cb407-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ nIndBySpeciesZ'</span>,</span>
<span id="cb407-13"><a href="#cb407-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ nIndZ'</span>,</span>
<span id="cb407-14"><a href="#cb407-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb407-15"><a href="#cb407-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river'</span>,</span>
<span id="cb407-16"><a href="#cb407-16" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason + river'</span>,</span>
<span id="cb407-17"><a href="#cb407-17" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason + meanTempZbySeason + river'</span>, </span>
<span id="cb407-18"><a href="#cb407-18" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb407-19"><a href="#cb407-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason'</span>, </span>
<span id="cb407-20"><a href="#cb407-20" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb407-21"><a href="#cb407-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * factor(season)'</span>,</span>
<span id="cb407-22"><a href="#cb407-22" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb407-23"><a href="#cb407-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason + meanTempZbySeason * river * factor(season)'</span>, </span>
<span id="cb407-24"><a href="#cb407-24" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb407-25"><a href="#cb407-25" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * factor(season) * observedWeightZ'</span>,</span>
<span id="cb407-26"><a href="#cb407-26" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ)^2'</span>,</span>
<span id="cb407-27"><a href="#cb407-27" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ + nIndBySpeciesZ)^2'</span>,</span>
<span id="cb407-28"><a href="#cb407-28" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ + nIndZ)^2'</span>,</span>
<span id="cb407-29"><a href="#cb407-29" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ + nIndZ + nIndBySpeciesZ)^2'</span>,</span>
<span id="cb407-30"><a href="#cb407-30" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ + nIndZ)^3'</span>,</span>
<span id="cb407-31"><a href="#cb407-31" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb407-32"><a href="#cb407-32" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * factor(season) * observedWeightZ * nIndBySpeciesZ'</span>,</span>
<span id="cb407-33"><a href="#cb407-33" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * factor(season) * observedWeightZ + nIndBySpeciesZ'</span>,</span>
<span id="cb407-34"><a href="#cb407-34" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * observedWeightZ + nIndBySpeciesZ + factor(season)'</span>,</span>
<span id="cb407-35"><a href="#cb407-35" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * observedWeightZ + nIndBySpeciesZ * factor(season)'</span>,</span>
<span id="cb407-36"><a href="#cb407-36" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * observedWeightZ * nIndBySpeciesZ + factor(season)'</span>,</span>
<span id="cb407-37"><a href="#cb407-37" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb407-38"><a href="#cb407-38" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * nIndBySpeciesZ + river + observedWeightZ + factor(season)'</span>,</span>
<span id="cb407-39"><a href="#cb407-39" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + nIndBySpeciesZ)^2 + river + observedWeightZ + factor(season)'</span></span>
<span id="cb407-40"><a href="#cb407-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb407-41"><a href="#cb407-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb407-42"><a href="#cb407-42" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb407-43"><a href="#cb407-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb407-44"><a href="#cb407-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit =</span> <span class="fu">map</span>(model, <span class="sc">~</span><span class="fu">glm</span>(.x, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn))),</span>
<span id="cb407-45"><a href="#cb407-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">glanced =</span> <span class="fu">map</span>(fit, broom<span class="sc">::</span>glance),</span>
<span id="cb407-46"><a href="#cb407-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">tidied =</span> <span class="fu">map</span>(fit, broom<span class="sc">::</span>tidy)</span>
<span id="cb407-47"><a href="#cb407-47" aria-hidden="true" tabindex="-1"></a>      <span class="co"># anova = map(fit, anova),</span></span>
<span id="cb407-48"><a href="#cb407-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># summary = map(fit, summary),</span></span>
<span id="cb407-49"><a href="#cb407-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># confint = map(fit, confint)</span></span>
<span id="cb407-50"><a href="#cb407-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb407-51"><a href="#cb407-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(models)</span>
<span id="cb407-52"><a href="#cb407-52" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="predict-pneg-growth-in-mass" class="level3" data-number="16.14.1">
<h3 data-number="16.14.1" class="anchored" data-anchor-id="predict-pneg-growth-in-mass"><span class="header-section-number">16.14.1</span> Predict p(neg growth in mass)</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/predictLogistic_d43d8456a8d91a0eb87ddddd1bc382f4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>predictSpp <span class="ot">&lt;-</span> <span class="cf">function</span>(dIn, modIn, speciesIn){</span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> dIn <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn)</span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb408-4"><a href="#cb408-4" aria-hidden="true" tabindex="-1"></a>  byAIC <span class="ot">=</span> modIn <span class="sc">|&gt;</span> </span>
<span id="cb408-5"><a href="#cb408-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(glanced) <span class="sc">|&gt;</span> </span>
<span id="cb408-6"><a href="#cb408-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb408-7"><a href="#cb408-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, df.residual, deviance, fit, tidied) </span>
<span id="cb408-8"><a href="#cb408-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb408-9"><a href="#cb408-9" aria-hidden="true" tabindex="-1"></a>  predDSpp <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb408-10"><a href="#cb408-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiverZbySeason =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb408-11"><a href="#cb408-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanTempZbySeason =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb408-12"><a href="#cb408-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">river =</span> <span class="fu">unique</span>(d<span class="sc">$</span>river), </span>
<span id="cb408-13"><a href="#cb408-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">unique</span>(d<span class="sc">$</span>season),</span>
<span id="cb408-14"><a href="#cb408-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">observedWeightZ =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>),</span>
<span id="cb408-15"><a href="#cb408-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">nIndBySpeciesZ =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>),</span>
<span id="cb408-16"><a href="#cb408-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">nIndZ =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>)</span>
<span id="cb408-17"><a href="#cb408-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb408-18"><a href="#cb408-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb408-19"><a href="#cb408-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb408-20"><a href="#cb408-20" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">add_column</span>(predDSpp, </span>
<span id="cb408-21"><a href="#cb408-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pred =</span> <span class="fu">predict.glm</span>(byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]], predDSpp, <span class="at">type =</span> <span class="st">"response"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb408-22"><a href="#cb408-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">mutate</span>(<span class="at">groupT =</span> <span class="fu">paste</span>(river, season, meanTempZbySeason, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb408-23"><a href="#cb408-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">groupF =</span> <span class="fu">paste</span>(river, season, meanFlowByRiverZbySeason, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb408-24"><a href="#cb408-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">groupTM =</span> <span class="fu">paste</span>(river, season, meanTempZbySeason, observedWeightZ, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb408-25"><a href="#cb408-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">groupFN =</span> <span class="fu">paste</span>(river, season, meanFlowByRiverZbySeason, nIndZ, <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb408-26"><a href="#cb408-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addGG_noSpecies</span>()</span>
<span id="cb408-27"><a href="#cb408-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb408-28"><a href="#cb408-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb408-29"><a href="#cb408-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb408-30"><a href="#cb408-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred =</span> pred,</span>
<span id="cb408-31"><a href="#cb408-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">byAIC =</span> byAIC</span>
<span id="cb408-32"><a href="#cb408-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb408-33"><a href="#cb408-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb408-34"><a href="#cb408-34" aria-hidden="true" tabindex="-1"></a>}  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="brook-trout-12" class="level3" data-number="16.14.2">
<h3 data-number="16.14.2" class="anchored" data-anchor-id="brook-trout-12"><span class="header-section-number">16.14.2</span> Brook trout</h3>
<p>In the figures with the shading, the shading is the range of effects from number of individuals, with the darker line on one edge of the shaded area representing high numbers of individuals.</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/modBKT_3a9dc4ea23d2db7157b0c5396725c1eb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb409"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"bkt"</span></span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a>  cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn) <span class="sc">|&gt;</span> </span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(meanFlowByRiverZbySeason, meanTempZbySeason, observedWeightZ, nIndBySpeciesZ, nIndZ, river, season)</span>
<span id="cb409-6"><a href="#cb409-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBKT-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a>modBKT <span class="ot">&lt;-</span> <span class="fu">runSppModels</span>(cd1_z, speciesIn)</span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>predBKT <span class="ot">&lt;-</span> <span class="fu">predictSpp</span>(cd1_z, modBKT, speciesIn)</span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a>predBKT<span class="sc">$</span>byAIC <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, deviance) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26 × 3
   model                                                            AIC deviance
   &lt;chr&gt;                                                          &lt;dbl&gt;    &lt;dbl&gt;
 1 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 5547.    5447.
 2 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 5556.    5476.
 3 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 5575.    5319.
 4 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 5577.    5319.
 5 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 5807.    5673.
 6 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 5898.    5826.
 7 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 5900.    5822.
 8 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * nI… 5904.    5874.
 9 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + n… 5906.    5878.
10 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 6249.    6121.
# ℹ 16 more rows</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://rcompanion.org/rcompanion/e_06.html</span></span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(predBKT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]]) <span class="sc">|&gt;</span> </span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb412-4"><a href="#cb412-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb412-5"><a href="#cb412-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lo =</span> <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb412-6"><a href="#cb412-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">hi =</span>  <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb412-7"><a href="#cb412-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlap0 =</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                   2.5 %        97.5 %    lo
(Intercept)                                -475.00402288 -406.56540869 FALSE
meanFlowByRiverZbySeason                    -84.09603589  -68.36729167 FALSE
meanTempZbySeason                            -7.30214216   20.94594044 FALSE
riverwb mitchell                            -44.72399744  -41.47000528 FALSE
riverwb obear                               -25.66035543  -23.03664463 FALSE
riverwest brook                             317.24926727  375.09391827  TRUE
factor(season)2                             385.55546528  442.79513644  TRUE
factor(season)3                             397.09986984  462.73330667  TRUE
factor(season)4                             375.24029255  425.96285514  TRUE
observedWeightZ                              -6.21321438    0.89543718 FALSE
nIndZ                                        -2.32866427   14.47538363 FALSE
meanFlowByRiverZbySeason:meanTempZbySeason    0.03373671    0.21583984  TRUE
meanFlowByRiverZbySeason:riverwb mitchell    -0.52780516    0.13909522 FALSE
meanFlowByRiverZbySeason:riverwb obear       -0.82176505   -0.29344342 FALSE
meanFlowByRiverZbySeason:riverwest brook     -0.41844001    0.03342069 FALSE
meanFlowByRiverZbySeason:factor(season)2     69.41475656   85.77466832  TRUE
meanFlowByRiverZbySeason:factor(season)3     70.73457177   87.23566171  TRUE
meanFlowByRiverZbySeason:factor(season)4     70.46152197   86.69043471  TRUE
meanFlowByRiverZbySeason:observedWeightZ     -0.12466615    0.02603119 FALSE
meanFlowByRiverZbySeason:nIndZ                0.06577492    0.28487614  TRUE
meanTempZbySeason:riverwb mitchell           -0.12254961    0.47527034 FALSE
meanTempZbySeason:riverwb obear               0.01579146    0.46195142  TRUE
meanTempZbySeason:riverwest brook             0.11526013    0.50737114  TRUE
meanTempZbySeason:factor(season)2           -16.32568736    7.50378760 FALSE
meanTempZbySeason:factor(season)3           -89.54071600   24.36203624 FALSE
meanTempZbySeason:factor(season)4           -90.04527658   22.36554354 FALSE
meanTempZbySeason:observedWeightZ            -0.06457146    0.06933106 FALSE
meanTempZbySeason:nIndZ                      -0.10383446    0.06097225 FALSE
riverwb mitchell:factor(season)2             40.64354334   43.80498102  TRUE
riverwb obear:factor(season)2                21.69125946   24.23650909  TRUE
riverwest brook:factor(season)2            -388.39742959 -325.02681021 FALSE
riverwb mitchell:factor(season)3             40.78235541   44.15586180  TRUE
riverwb obear:factor(season)3                23.10691834   25.77516618  TRUE
riverwest brook:factor(season)3            -356.44799065 -306.43155442 FALSE
riverwb mitchell:factor(season)4             40.72766825   43.81267602  TRUE
riverwb obear:factor(season)4                22.07660551   24.79174184  TRUE
riverwest brook:factor(season)4            -379.74745330 -320.46489836 FALSE
riverwb mitchell:observedWeightZ             -0.24862602    0.28671382 FALSE
riverwb obear:observedWeightZ                -0.30573578    0.14069559 FALSE
riverwest brook:observedWeightZ              -0.10831961    0.26296321 FALSE
riverwb mitchell:nIndZ                       -0.72804651   -0.05272598 FALSE
riverwb obear:nIndZ                          -0.10693440    0.42704641 FALSE
riverwest brook:nIndZ                        -0.13976104    0.30051204 FALSE
factor(season)2:observedWeightZ              -0.38387371    6.71122219 FALSE
factor(season)3:observedWeightZ               0.44399707    7.55244070  TRUE
factor(season)4:observedWeightZ              -0.23577639    6.88414305 FALSE
factor(season)2:nIndZ                       -14.23703692    1.61610311 FALSE
factor(season)3:nIndZ                       -14.12608247    1.50948895 FALSE
factor(season)4:nIndZ                       -14.83661892    1.85804697 FALSE
observedWeightZ:nIndZ                        -0.11150745    0.02987495 FALSE
                                              hi overlap0
(Intercept)                                 TRUE    FALSE
meanFlowByRiverZbySeason                    TRUE    FALSE
meanTempZbySeason                          FALSE     TRUE
riverwb mitchell                            TRUE    FALSE
riverwb obear                               TRUE    FALSE
riverwest brook                            FALSE    FALSE
factor(season)2                            FALSE    FALSE
factor(season)3                            FALSE    FALSE
factor(season)4                            FALSE    FALSE
observedWeightZ                            FALSE     TRUE
nIndZ                                      FALSE     TRUE
meanFlowByRiverZbySeason:meanTempZbySeason FALSE    FALSE
meanFlowByRiverZbySeason:riverwb mitchell  FALSE     TRUE
meanFlowByRiverZbySeason:riverwb obear      TRUE    FALSE
meanFlowByRiverZbySeason:riverwest brook   FALSE     TRUE
meanFlowByRiverZbySeason:factor(season)2   FALSE    FALSE
meanFlowByRiverZbySeason:factor(season)3   FALSE    FALSE
meanFlowByRiverZbySeason:factor(season)4   FALSE    FALSE
meanFlowByRiverZbySeason:observedWeightZ   FALSE     TRUE
meanFlowByRiverZbySeason:nIndZ             FALSE    FALSE
meanTempZbySeason:riverwb mitchell         FALSE     TRUE
meanTempZbySeason:riverwb obear            FALSE    FALSE
meanTempZbySeason:riverwest brook          FALSE    FALSE
meanTempZbySeason:factor(season)2          FALSE     TRUE
meanTempZbySeason:factor(season)3          FALSE     TRUE
meanTempZbySeason:factor(season)4          FALSE     TRUE
meanTempZbySeason:observedWeightZ          FALSE     TRUE
meanTempZbySeason:nIndZ                    FALSE     TRUE
riverwb mitchell:factor(season)2           FALSE    FALSE
riverwb obear:factor(season)2              FALSE    FALSE
riverwest brook:factor(season)2             TRUE    FALSE
riverwb mitchell:factor(season)3           FALSE    FALSE
riverwb obear:factor(season)3              FALSE    FALSE
riverwest brook:factor(season)3             TRUE    FALSE
riverwb mitchell:factor(season)4           FALSE    FALSE
riverwb obear:factor(season)4              FALSE    FALSE
riverwest brook:factor(season)4             TRUE    FALSE
riverwb mitchell:observedWeightZ           FALSE     TRUE
riverwb obear:observedWeightZ              FALSE     TRUE
riverwest brook:observedWeightZ            FALSE     TRUE
riverwb mitchell:nIndZ                      TRUE    FALSE
riverwb obear:nIndZ                        FALSE     TRUE
riverwest brook:nIndZ                      FALSE     TRUE
factor(season)2:observedWeightZ            FALSE     TRUE
factor(season)3:observedWeightZ            FALSE    FALSE
factor(season)4:observedWeightZ            FALSE     TRUE
factor(season)2:nIndZ                      FALSE     TRUE
factor(season)3:nIndZ                      FALSE     TRUE
factor(season)4:nIndZ                      FALSE     TRUE
observedWeightZ:nIndZ                      FALSE     TRUE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(predBKT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model: binomial, link: logit

Response: negGrowth

Terms added sequentially (first to last)

                                           Df Deviance Resid. Df Resid. Dev
NULL                                                       10088     7918.9
meanFlowByRiverZbySeason                    1   146.01     10087     7772.9
meanTempZbySeason                           1     0.19     10086     7772.7
river                                       3    75.72     10083     7697.0
factor(season)                              3  1158.29     10080     6538.7
observedWeightZ                             1   636.99     10079     5901.7
nIndZ                                       1     6.38     10078     5895.3
meanFlowByRiverZbySeason:meanTempZbySeason  1    10.62     10077     5884.7
meanFlowByRiverZbySeason:river              3     7.01     10074     5877.7
meanFlowByRiverZbySeason:factor(season)     3   155.15     10071     5722.5
meanFlowByRiverZbySeason:observedWeightZ    1     0.60     10070     5721.9
meanFlowByRiverZbySeason:nIndZ              1     9.86     10069     5712.1
meanTempZbySeason:river                     3    10.61     10066     5701.5
meanTempZbySeason:factor(season)            3    18.19     10063     5683.3
meanTempZbySeason:observedWeightZ           1     0.00     10062     5683.3
meanTempZbySeason:nIndZ                     1     0.29     10061     5683.0
river:factor(season)                        9   110.72     10052     5572.3
river:observedWeightZ                       3     1.16     10049     5571.1
river:nIndZ                                 3    13.69     10046     5557.4
factor(season):observedWeightZ              3   107.98     10043     5449.4
factor(season):nIndZ                        3     1.33     10040     5448.1
observedWeightZ:nIndZ                       1     1.28     10039     5446.8</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb416"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(predBKT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]], <span class="at">type=</span><span class="st">"II"</span>, <span class="at">test=</span><span class="st">"Wald"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II tests)

Response: negGrowth
                                           Df    Chisq Pr(&gt;Chisq)    
meanFlowByRiverZbySeason                    1 148.2611  &lt; 2.2e-16 ***
meanTempZbySeason                           1   8.3974  0.0037575 ** 
river                                       5  89.1425  &lt; 2.2e-16 ***
factor(season)                              5 158.5604  &lt; 2.2e-16 ***
observedWeightZ                             1 462.5555  &lt; 2.2e-16 ***
nIndZ                                       1   0.1316  0.7168010    
meanFlowByRiverZbySeason:meanTempZbySeason  1   7.1947  0.0073120 ** 
meanFlowByRiverZbySeason:river              3  17.4199  0.0005792 ***
meanFlowByRiverZbySeason:factor(season)     3 109.7067  &lt; 2.2e-16 ***
meanFlowByRiverZbySeason:observedWeightZ    1   1.6091  0.2046238    
meanFlowByRiverZbySeason:nIndZ              1   9.6856  0.0018572 ** 
meanTempZbySeason:river                     3  10.0616  0.0180501 *  
meanTempZbySeason:factor(season)            3  12.3412  0.0063012 ** 
meanTempZbySeason:observedWeightZ           1   0.0055  0.9406173    
meanTempZbySeason:nIndZ                     1   0.2400  0.6242108    
river:factor(season)                        9  65.5556  1.125e-10 ***
river:observedWeightZ                       3   3.0759  0.3800777    
river:nIndZ                                 3  12.2999  0.0064235 ** 
factor(season):observedWeightZ              3  97.5802  &lt; 2.2e-16 ***
factor(season):nIndZ                        3   1.1988  0.7532887    
observedWeightZ:nIndZ                       1   1.2842  0.2571244    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb418"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">efronRSquared</span>(predBKT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>EfronRSquared 
        0.267 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb420"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb420-3"><a href="#cb420-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb420-4"><a href="#cb420-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb420-5"><a href="#cb420-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG <span class="sc">+</span> meanTempZbySeason)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBKT-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb421"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">==</span> <span class="dv">0</span>, meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBKT-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb422"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, pred, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason))) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb422-3"><a href="#cb422-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>) <span class="sc">+</span></span>
<span id="cb422-4"><a href="#cb422-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb422-5"><a href="#cb422-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBKT-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>predBKTWider <span class="ot">&lt;-</span> predBKT<span class="sc">$</span>pred <span class="sc">|&gt;</span> </span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nIndZ <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>groupFN) <span class="sc">|&gt;</span> </span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> pred, <span class="at">names_from =</span> nIndZ, <span class="at">names_prefix =</span> <span class="st">"nIndZ"</span>)</span>
<span id="cb423-5"><a href="#cb423-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-6"><a href="#cb423-6" aria-hidden="true" tabindex="-1"></a>tempColors <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"grey"</span>, <span class="st">"red"</span>)</span>
<span id="cb423-7"><a href="#cb423-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-8"><a href="#cb423-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="sc">-</span><span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb423-9"><a href="#cb423-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb423-10"><a href="#cb423-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb423-11"><a href="#cb423-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb423-12"><a href="#cb423-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb423-13"><a href="#cb423-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb423-14"><a href="#cb423-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb423-15"><a href="#cb423-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Small fish"</span>) <span class="sc">+</span></span>
<span id="cb423-16"><a href="#cb423-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb423-17"><a href="#cb423-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBKT-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb424"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb424-5"><a href="#cb424-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb424-6"><a href="#cb424-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb424-7"><a href="#cb424-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb424-8"><a href="#cb424-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Medium fish"</span>) <span class="sc">+</span></span>
<span id="cb424-9"><a href="#cb424-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb424-10"><a href="#cb424-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBKT-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Large fish"</span>) <span class="sc">+</span></span>
<span id="cb425-9"><a href="#cb425-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb425-10"><a href="#cb425-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBKT-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="brown-trout-12" class="level3" data-number="16.14.3">
<h3 data-number="16.14.3" class="anchored" data-anchor-id="brown-trout-12"><span class="header-section-number">16.14.3</span> Brown trout</h3>
<p>to do: exclude OS in all models</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/modBnt_b74e95c0aa8ce810f183644ac043ea6b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb426"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"bnt"</span></span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-3"><a href="#cb426-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb426-4"><a href="#cb426-4" aria-hidden="true" tabindex="-1"></a>  cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn) <span class="sc">|&gt;</span> </span>
<span id="cb426-5"><a href="#cb426-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(meanFlowByRiverZbySeason, meanTempZbySeason, observedWeightZ, nIndBySpeciesZ, nIndZ, river, season)</span>
<span id="cb426-6"><a href="#cb426-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBnt-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a>modBNT <span class="ot">&lt;-</span> <span class="fu">runSppModels</span>(cd1_z, speciesIn)</span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a>predBNT <span class="ot">&lt;-</span> <span class="fu">predictSpp</span>(cd1_z, modBNT, speciesIn)</span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a>predBNT<span class="sc">$</span>byAIC <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26 × 3
   model                                                            AIC deviance
   &lt;chr&gt;                                                          &lt;dbl&gt;    &lt;dbl&gt;
 1 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 1375.    1271.
 2 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 1398.    1314.
 3 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 1400.    1316.
 4 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 1420.    1358.
 5 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 1422.    1356.
 6 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + n… 1431.    1405.
 7 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * nI… 1433.    1405.
 8 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 1442.    1340.
 9 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 1446.    1390.
10 negGrowth ~ observedWeightZ                                    1560.    1556.
# ℹ 16 more rows</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://rcompanion.org/rcompanion/e_06.html</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(predBNT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]]) <span class="sc">|&gt;</span> </span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lo =</span> <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">hi =</span>  <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlap0 =</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                   2.5 %        97.5 %    lo
(Intercept)                                -301.15199955 -3.642621e+02 FALSE
meanFlowByRiverZbySeason                    -15.00975426  6.310428e+00 FALSE
meanTempZbySeason                             0.85448928  2.453874e+01  TRUE
riverwb mitchell                            -13.48586891  1.027090e+01 FALSE
riverwest brook                             251.93727718  2.221651e+02  TRUE
factor(season)2                             373.25450703  2.978181e+02  TRUE
factor(season)3                             419.02779974  3.008522e+02  TRUE
factor(season)4                             387.61528136  3.374702e+02  TRUE
observedWeightZ                               0.46038643  3.598083e+00  TRUE
nIndZ                                      -314.88416633 -6.888051e+01 FALSE
nIndBySpeciesZ                               60.76505212  2.334313e+02  TRUE
meanFlowByRiverZbySeason:meanTempZbySeason    0.01487906  5.854874e-01  TRUE
meanFlowByRiverZbySeason:riverwb mitchell    -4.28407124  2.217717e+00 FALSE
meanFlowByRiverZbySeason:riverwest brook     -0.46155827  1.104268e+00 FALSE
meanFlowByRiverZbySeason:factor(season)2     -7.61305213  1.364622e+01 FALSE
meanFlowByRiverZbySeason:factor(season)3     -6.73342569  1.456307e+01 FALSE
meanFlowByRiverZbySeason:factor(season)4     -5.58836764  1.577896e+01 FALSE
meanFlowByRiverZbySeason:observedWeightZ     -0.28086920  1.158485e-02 FALSE
meanFlowByRiverZbySeason:nIndZ               -0.39664740  2.808346e-01 FALSE
meanFlowByRiverZbySeason:nIndBySpeciesZ       0.25918245  8.157933e-01  TRUE
meanTempZbySeason:riverwb mitchell          -18.02815604 -3.575450e-01 FALSE
meanTempZbySeason:riverwest brook            -0.68092534  6.921110e-01 FALSE
meanTempZbySeason:factor(season)2           -24.58699806 -9.649093e-01 FALSE
meanTempZbySeason:factor(season)3           -24.37224737 -7.314921e-01 FALSE
meanTempZbySeason:factor(season)4           -25.34575666 -1.617221e+00 FALSE
meanTempZbySeason:observedWeightZ            -0.12804939  1.113831e-01 FALSE
meanTempZbySeason:nIndZ                      -0.27231523  3.732244e-01 FALSE
meanTempZbySeason:nIndBySpeciesZ             -0.39288426  4.734065e-01 FALSE
riverwb mitchell:factor(season)2            -23.02584697 -2.127269e+00 FALSE
riverwest brook:factor(season)2            -221.65430939 -2.572386e+02 FALSE
riverwb mitchell:factor(season)3            -13.41346618  9.175349e+00 FALSE
riverwest brook:factor(season)3            -227.19904327 -3.559891e+02 FALSE
riverwb mitchell:factor(season)4             -7.47976201  1.217443e+01 FALSE
riverwest brook:factor(season)4            -223.65122363 -2.744307e+02 FALSE
riverwb mitchell:observedWeightZ              0.87135992  1.212113e+01  TRUE
riverwest brook:observedWeightZ              -0.23182295  5.827210e-01 FALSE
riverwb mitchell:nIndZ                       -2.95933644  2.637899e+00 FALSE
riverwest brook:nIndZ                        -0.97607008  8.977106e-01 FALSE
riverwb mitchell:nIndBySpeciesZ               0.69357710  2.003143e+01  TRUE
riverwest brook:nIndBySpeciesZ               -1.06195959  6.992152e-01 FALSE
factor(season)2:observedWeightZ              -2.99873482  9.139869e-03 FALSE
factor(season)3:observedWeightZ              -2.69336960  3.554230e-01 FALSE
factor(season)4:observedWeightZ              -3.09574678 -9.734888e-03 FALSE
factor(season)2:nIndZ                        66.24637726  3.143420e+02  TRUE
factor(season)3:nIndZ                        80.69284441  3.155961e+02  TRUE
factor(season)4:nIndZ                        70.28869089  3.153682e+02  TRUE
factor(season)2:nIndBySpeciesZ             -232.71191681 -6.082840e+01 FALSE
factor(season)3:nIndBySpeciesZ             -233.70645219 -6.171401e+01 FALSE
factor(season)4:nIndBySpeciesZ             -235.46876832 -6.349440e+01 FALSE
observedWeightZ:nIndZ                        -0.11086135  1.930223e-01 FALSE
observedWeightZ:nIndBySpeciesZ               -0.14849280  1.668524e-01 FALSE
nIndZ:nIndBySpeciesZ                         -0.40726214  2.235470e-01 FALSE
                                              hi overlap0
(Intercept)                                 TRUE    FALSE
meanFlowByRiverZbySeason                   FALSE     TRUE
meanTempZbySeason                          FALSE    FALSE
riverwb mitchell                           FALSE     TRUE
riverwest brook                            FALSE    FALSE
factor(season)2                            FALSE    FALSE
factor(season)3                            FALSE    FALSE
factor(season)4                            FALSE    FALSE
observedWeightZ                            FALSE    FALSE
nIndZ                                       TRUE    FALSE
nIndBySpeciesZ                             FALSE    FALSE
meanFlowByRiverZbySeason:meanTempZbySeason FALSE    FALSE
meanFlowByRiverZbySeason:riverwb mitchell  FALSE     TRUE
meanFlowByRiverZbySeason:riverwest brook   FALSE     TRUE
meanFlowByRiverZbySeason:factor(season)2   FALSE     TRUE
meanFlowByRiverZbySeason:factor(season)3   FALSE     TRUE
meanFlowByRiverZbySeason:factor(season)4   FALSE     TRUE
meanFlowByRiverZbySeason:observedWeightZ   FALSE     TRUE
meanFlowByRiverZbySeason:nIndZ             FALSE     TRUE
meanFlowByRiverZbySeason:nIndBySpeciesZ    FALSE    FALSE
meanTempZbySeason:riverwb mitchell          TRUE    FALSE
meanTempZbySeason:riverwest brook          FALSE     TRUE
meanTempZbySeason:factor(season)2           TRUE    FALSE
meanTempZbySeason:factor(season)3           TRUE    FALSE
meanTempZbySeason:factor(season)4           TRUE    FALSE
meanTempZbySeason:observedWeightZ          FALSE     TRUE
meanTempZbySeason:nIndZ                    FALSE     TRUE
meanTempZbySeason:nIndBySpeciesZ           FALSE     TRUE
riverwb mitchell:factor(season)2            TRUE    FALSE
riverwest brook:factor(season)2             TRUE    FALSE
riverwb mitchell:factor(season)3           FALSE     TRUE
riverwest brook:factor(season)3             TRUE    FALSE
riverwb mitchell:factor(season)4           FALSE     TRUE
riverwest brook:factor(season)4             TRUE    FALSE
riverwb mitchell:observedWeightZ           FALSE    FALSE
riverwest brook:observedWeightZ            FALSE     TRUE
riverwb mitchell:nIndZ                     FALSE     TRUE
riverwest brook:nIndZ                      FALSE     TRUE
riverwb mitchell:nIndBySpeciesZ            FALSE    FALSE
riverwest brook:nIndBySpeciesZ             FALSE     TRUE
factor(season)2:observedWeightZ            FALSE     TRUE
factor(season)3:observedWeightZ            FALSE     TRUE
factor(season)4:observedWeightZ             TRUE    FALSE
factor(season)2:nIndZ                      FALSE    FALSE
factor(season)3:nIndZ                      FALSE    FALSE
factor(season)4:nIndZ                      FALSE    FALSE
factor(season)2:nIndBySpeciesZ              TRUE    FALSE
factor(season)3:nIndBySpeciesZ              TRUE    FALSE
factor(season)4:nIndBySpeciesZ              TRUE    FALSE
observedWeightZ:nIndZ                      FALSE     TRUE
observedWeightZ:nIndBySpeciesZ             FALSE     TRUE
nIndZ:nIndBySpeciesZ                       FALSE     TRUE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(predBNT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model: binomial, link: logit

Response: negGrowth

Terms added sequentially (first to last)

                                           Df Deviance Resid. Df Resid. Dev
NULL                                                        4655     1808.3
meanFlowByRiverZbySeason                    1   19.573      4654     1788.8
meanTempZbySeason                           1    5.969      4653     1782.8
river                                       2    0.194      4651     1782.6
factor(season)                              3   97.251      4648     1685.3
observedWeightZ                             1  244.900      4647     1440.4
nIndZ                                       1    8.756      4646     1431.7
nIndBySpeciesZ                              1    2.636      4645     1429.0
meanFlowByRiverZbySeason:meanTempZbySeason  1   13.560      4644     1415.5
meanFlowByRiverZbySeason:river              2    1.118      4642     1414.4
meanFlowByRiverZbySeason:factor(season)     3   33.420      4639     1380.9
meanFlowByRiverZbySeason:observedWeightZ    1    2.188      4638     1378.8
meanFlowByRiverZbySeason:nIndZ              1    2.044      4637     1376.7
meanFlowByRiverZbySeason:nIndBySpeciesZ     1    8.358      4636     1368.3
meanTempZbySeason:river                     2    1.135      4634     1367.2
meanTempZbySeason:factor(season)            3    9.394      4631     1357.8
meanTempZbySeason:observedWeightZ           1    0.178      4630     1357.6
meanTempZbySeason:nIndZ                     1    0.057      4629     1357.6
meanTempZbySeason:nIndBySpeciesZ            1    4.937      4628     1352.7
river:factor(season)                        6    5.806      4622     1346.8
river:observedWeightZ                       2    5.202      4620     1341.6
river:nIndZ                                 2    2.685      4618     1339.0
river:nIndBySpeciesZ                        2    6.388      4616     1332.6
factor(season):observedWeightZ              3    6.599      4613     1326.0
factor(season):nIndZ                        3   29.839      4610     1296.1
factor(season):nIndBySpeciesZ               3   23.924      4607     1272.2
observedWeightZ:nIndZ                       1    0.509      4606     1271.7
observedWeightZ:nIndBySpeciesZ              1    0.029      4605     1271.7
nIndZ:nIndBySpeciesZ                        1    0.289      4604     1271.4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(predBNT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]], <span class="at">type=</span><span class="st">"II"</span>, <span class="at">test=</span><span class="st">"Wald"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II tests)

Response: negGrowth
                                           Df    Chisq Pr(&gt;Chisq)    
meanFlowByRiverZbySeason                    1  20.3459  6.463e-06 ***
meanTempZbySeason                           1   0.1934  0.6600697    
river                                       2   3.6382  0.1621718    
factor(season)                              3   4.5887  0.2045118    
observedWeightZ                             1 206.4402  &lt; 2.2e-16 ***
nIndZ                                       1   2.0303  0.1541869    
nIndBySpeciesZ                              1   1.4231  0.2329018    
meanFlowByRiverZbySeason:meanTempZbySeason  1   4.1532  0.0415562 *  
meanFlowByRiverZbySeason:river              2   0.5991  0.7411593    
meanFlowByRiverZbySeason:factor(season)     3  13.7196  0.0033128 ** 
meanFlowByRiverZbySeason:observedWeightZ    1   3.1174  0.0774622 .  
meanFlowByRiverZbySeason:nIndZ              1   0.1457  0.7027101    
meanFlowByRiverZbySeason:nIndBySpeciesZ     1  13.7600  0.0002077 ***
meanTempZbySeason:river                     2   1.6118  0.4466823    
meanTempZbySeason:factor(season)            3   6.2547  0.0998564 .  
meanTempZbySeason:observedWeightZ           1   0.0187  0.8911618    
meanTempZbySeason:nIndZ                     1   0.0814  0.7754036    
meanTempZbySeason:nIndBySpeciesZ            1   0.0540  0.8163229    
river:factor(season)                        6   4.8994  0.5567762    
river:observedWeightZ                       2   3.2293  0.1989597    
river:nIndZ                                 2   0.0415  0.9794505    
river:nIndBySpeciesZ                        2   2.5596  0.2780985    
factor(season):observedWeightZ              3   6.7372  0.0807627 .  
factor(season):nIndZ                        3  21.5403  8.129e-05 ***
factor(season):nIndBySpeciesZ               3  20.4168  0.0001391 ***
observedWeightZ:nIndZ                       1   0.2624  0.6084521    
observedWeightZ:nIndBySpeciesZ              1   0.0149  0.9030032    
nIndZ:nIndBySpeciesZ                        1   0.2865  0.5924830    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb435"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">efronRSquared</span>(predBNT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>EfronRSquared 
        0.214 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb437"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG <span class="sc">+</span> meanTempZbySeason)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBnt-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb438"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">==</span> <span class="dv">0</span>, meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb438-5"><a href="#cb438-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBnt-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb439"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, pred, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb439-2"><a href="#cb439-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason))) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb439-3"><a href="#cb439-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>) <span class="sc">+</span></span>
<span id="cb439-4"><a href="#cb439-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb439-5"><a href="#cb439-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBnt-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb440"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a>predBNTWider <span class="ot">&lt;-</span> predBNT<span class="sc">$</span>pred <span class="sc">|&gt;</span> </span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nIndZ <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>groupFN) <span class="sc">|&gt;</span> </span>
<span id="cb440-4"><a href="#cb440-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> pred, <span class="at">names_from =</span> nIndZ, <span class="at">names_prefix =</span> <span class="st">"nIndZ"</span>)</span>
<span id="cb440-5"><a href="#cb440-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-6"><a href="#cb440-6" aria-hidden="true" tabindex="-1"></a>tempColors <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"grey"</span>, <span class="st">"red"</span>)</span>
<span id="cb440-7"><a href="#cb440-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-8"><a href="#cb440-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="sc">-</span><span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb440-9"><a href="#cb440-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb440-10"><a href="#cb440-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb440-11"><a href="#cb440-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb440-12"><a href="#cb440-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb440-13"><a href="#cb440-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb440-14"><a href="#cb440-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb440-15"><a href="#cb440-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Small fish"</span>) <span class="sc">+</span></span>
<span id="cb440-16"><a href="#cb440-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb440-17"><a href="#cb440-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBnt-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb441"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb441-4"><a href="#cb441-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb441-5"><a href="#cb441-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb441-6"><a href="#cb441-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb441-7"><a href="#cb441-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb441-8"><a href="#cb441-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Medium fish"</span>) <span class="sc">+</span></span>
<span id="cb441-9"><a href="#cb441-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb441-10"><a href="#cb441-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBnt-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb442"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb442-4"><a href="#cb442-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb442-5"><a href="#cb442-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb442-6"><a href="#cb442-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb442-7"><a href="#cb442-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb442-8"><a href="#cb442-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Large fish"</span>) <span class="sc">+</span></span>
<span id="cb442-9"><a href="#cb442-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb442-10"><a href="#cb442-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modBnt-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="atlantic-salmon-11" class="level3" data-number="16.14.4">
<h3 data-number="16.14.4" class="anchored" data-anchor-id="atlantic-salmon-11"><span class="header-section-number">16.14.4</span> Atlantic salmon</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/modAts_3f217f085c33abf56c7b8d4f36d72498">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb443"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"ats"</span></span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-3"><a href="#cb443-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb443-4"><a href="#cb443-4" aria-hidden="true" tabindex="-1"></a>  cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn) <span class="sc">|&gt;</span> </span>
<span id="cb443-5"><a href="#cb443-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(meanFlowByRiverZbySeason, meanTempZbySeason, observedWeightZ, nIndBySpeciesZ, nIndZ, river, season)</span>
<span id="cb443-6"><a href="#cb443-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modAts-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb444"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a>modATS <span class="ot">&lt;-</span> <span class="fu">runSppModels</span>(cd1_z, speciesIn)</span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a>predATS <span class="ot">&lt;-</span> <span class="fu">predictSpp</span>(cd1_z, modATS, speciesIn)</span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a>predATS<span class="sc">$</span>byAIC <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, deviance) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26 × 3
   model                                                            AIC deviance
   &lt;chr&gt;                                                          &lt;dbl&gt;    &lt;dbl&gt;
 1 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 6434.    6348.
 2 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 6589.    6521.
 3 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 6632.    6564.
 4 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + r… 6684.    6632.
 5 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 6779.    6709.
 6 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 6805.    6759.
 7 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 6874.    6834.
 8 negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + n… 6902.    6878.
 9 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * nI… 6903.    6877.
10 negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * ri… 7119.    7055.
# ℹ 16 more rows</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb446"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://rcompanion.org/rcompanion/e_06.html</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(predATS<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]]) <span class="sc">|&gt;</span> </span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb446-5"><a href="#cb446-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lo =</span> <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb446-6"><a href="#cb446-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">hi =</span>  <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb446-7"><a href="#cb446-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlap0 =</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                   2.5 %        97.5 %    lo
(Intercept)                                -5.394486e+03 -4.557456e+03 FALSE
meanFlowByRiverZbySeason                   -6.195946e+01 -4.020762e+01 FALSE
meanTempZbySeason                           3.148738e+01  1.130278e+02  TRUE
riverwest brook                             4.480003e+03  5.281240e+03  TRUE
factor(season)2                             4.547773e+03  5.413752e+03  TRUE
factor(season)3                             4.590335e+03  5.446417e+03  TRUE
factor(season)4                             4.818344e+03  5.681265e+03  TRUE
observedWeightZ                             1.614782e+01  1.487030e+01  TRUE
nIndZ                                       3.292589e+02  3.857591e+02  TRUE
nIndBySpeciesZ                             -1.484374e+01 -1.255211e+01 FALSE
meanFlowByRiverZbySeason:meanTempZbySeason -4.757394e-01 -1.929458e-01 FALSE
meanFlowByRiverZbySeason:riverwest brook    4.738654e+01  5.863053e+01  TRUE
meanFlowByRiverZbySeason:factor(season)2   -8.554282e+00  8.056581e-01 FALSE
meanFlowByRiverZbySeason:factor(season)3   -1.034186e+01 -1.571621e+00 FALSE
meanFlowByRiverZbySeason:factor(season)4   -1.221914e+00  7.930008e+00 FALSE
meanFlowByRiverZbySeason:observedWeightZ   -2.060068e-01 -3.717710e-02 FALSE
meanFlowByRiverZbySeason:nIndZ              8.653587e-01  1.335813e+00  TRUE
meanFlowByRiverZbySeason:nIndBySpeciesZ    -1.443640e+00 -8.642700e-01 FALSE
meanTempZbySeason:riverwest brook          -7.236147e+01 -3.966555e+01 FALSE
meanTempZbySeason:factor(season)2          -6.885899e+00 -8.356808e-01 FALSE
meanTempZbySeason:factor(season)3          -3.594578e+01 -2.527087e+00 FALSE
meanTempZbySeason:factor(season)4          -8.044405e+00 -2.337966e+00 FALSE
meanTempZbySeason:observedWeightZ           1.100925e-01  2.777140e-01  TRUE
meanTempZbySeason:nIndZ                    -1.674751e-01  1.225662e-01 FALSE
meanTempZbySeason:nIndBySpeciesZ           -1.525483e-01  2.015943e-01 FALSE
riverwest brook:factor(season)2            -5.473390e+03 -4.571732e+03 FALSE
riverwest brook:factor(season)3            -5.498613e+03 -4.610100e+03 FALSE
riverwest brook:factor(season)4            -5.514973e+03 -4.624588e+03 FALSE
riverwest brook:observedWeightZ            -4.323943e+01 -9.900848e+00 FALSE
riverwest brook:nIndZ                      -5.788929e+01 -1.257691e+01 FALSE
riverwest brook:nIndBySpeciesZ              5.103294e+00  5.048160e+00  TRUE
factor(season)2:observedWeightZ            -1.249492e+00  1.379425e+00 FALSE
factor(season)3:observedWeightZ            -4.044371e+00  7.745203e-01 FALSE
factor(season)4:observedWeightZ            -1.464341e+00  1.182757e+00 FALSE
factor(season)2:nIndZ                      -3.860249e+02 -3.248941e+02 FALSE
factor(season)3:nIndZ                      -3.973241e+02 -3.471580e+02 FALSE
factor(season)4:nIndZ                      -3.790332e+02 -3.181085e+02 FALSE
factor(season)2:nIndBySpeciesZ              8.380863e+00  1.061226e+01  TRUE
factor(season)3:nIndBySpeciesZ              8.950224e+00  1.108092e+01  TRUE
factor(season)4:nIndBySpeciesZ              6.565488e+00  8.805223e+00  TRUE
observedWeightZ:nIndZ                      -2.226427e-01  5.332988e-02 FALSE
observedWeightZ:nIndBySpeciesZ             -5.882043e-02  1.525532e-01 FALSE
nIndZ:nIndBySpeciesZ                       -2.297603e-01 -2.246706e-01 FALSE
                                              hi overlap0
(Intercept)                                 TRUE    FALSE
meanFlowByRiverZbySeason                    TRUE    FALSE
meanTempZbySeason                          FALSE    FALSE
riverwest brook                            FALSE    FALSE
factor(season)2                            FALSE    FALSE
factor(season)3                            FALSE    FALSE
factor(season)4                            FALSE    FALSE
observedWeightZ                            FALSE    FALSE
nIndZ                                      FALSE    FALSE
nIndBySpeciesZ                              TRUE    FALSE
meanFlowByRiverZbySeason:meanTempZbySeason  TRUE    FALSE
meanFlowByRiverZbySeason:riverwest brook   FALSE    FALSE
meanFlowByRiverZbySeason:factor(season)2   FALSE     TRUE
meanFlowByRiverZbySeason:factor(season)3    TRUE    FALSE
meanFlowByRiverZbySeason:factor(season)4   FALSE     TRUE
meanFlowByRiverZbySeason:observedWeightZ    TRUE    FALSE
meanFlowByRiverZbySeason:nIndZ             FALSE    FALSE
meanFlowByRiverZbySeason:nIndBySpeciesZ     TRUE    FALSE
meanTempZbySeason:riverwest brook           TRUE    FALSE
meanTempZbySeason:factor(season)2           TRUE    FALSE
meanTempZbySeason:factor(season)3           TRUE    FALSE
meanTempZbySeason:factor(season)4           TRUE    FALSE
meanTempZbySeason:observedWeightZ          FALSE    FALSE
meanTempZbySeason:nIndZ                    FALSE     TRUE
meanTempZbySeason:nIndBySpeciesZ           FALSE     TRUE
riverwest brook:factor(season)2             TRUE    FALSE
riverwest brook:factor(season)3             TRUE    FALSE
riverwest brook:factor(season)4             TRUE    FALSE
riverwest brook:observedWeightZ             TRUE    FALSE
riverwest brook:nIndZ                       TRUE    FALSE
riverwest brook:nIndBySpeciesZ             FALSE    FALSE
factor(season)2:observedWeightZ            FALSE     TRUE
factor(season)3:observedWeightZ            FALSE     TRUE
factor(season)4:observedWeightZ            FALSE     TRUE
factor(season)2:nIndZ                       TRUE    FALSE
factor(season)3:nIndZ                       TRUE    FALSE
factor(season)4:nIndZ                       TRUE    FALSE
factor(season)2:nIndBySpeciesZ             FALSE    FALSE
factor(season)3:nIndBySpeciesZ             FALSE    FALSE
factor(season)4:nIndBySpeciesZ             FALSE    FALSE
observedWeightZ:nIndZ                      FALSE     TRUE
observedWeightZ:nIndBySpeciesZ             FALSE     TRUE
nIndZ:nIndBySpeciesZ                        TRUE    FALSE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb448"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(predATS<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model: binomial, link: logit

Response: negGrowth

Terms added sequentially (first to last)

                                           Df Deviance Resid. Df Resid. Dev
NULL                                                        9342     9682.6
meanFlowByRiverZbySeason                    1   229.80      9341     9452.8
meanTempZbySeason                           1    22.08      9340     9430.8
river                                       1     0.50      9339     9430.2
factor(season)                              3  2000.77      9336     7429.5
observedWeightZ                             1   476.82      9335     6952.7
nIndZ                                       1    18.31      9334     6934.4
nIndBySpeciesZ                              1     3.39      9333     6931.0
meanFlowByRiverZbySeason:meanTempZbySeason  1    26.10      9332     6904.9
meanFlowByRiverZbySeason:river              1     0.79      9331     6904.1
meanFlowByRiverZbySeason:factor(season)     3    70.78      9328     6833.3
meanFlowByRiverZbySeason:observedWeightZ    1     5.80      9327     6827.5
meanFlowByRiverZbySeason:nIndZ              1    25.22      9326     6802.3
meanFlowByRiverZbySeason:nIndBySpeciesZ     1   131.14      9325     6671.1
meanTempZbySeason:river                     1     2.67      9324     6668.5
meanTempZbySeason:factor(season)            3   143.64      9321     6524.8
meanTempZbySeason:observedWeightZ           1    20.24      9320     6504.6
meanTempZbySeason:nIndZ                     1     2.97      9319     6501.6
meanTempZbySeason:nIndBySpeciesZ            1     0.22      9318     6501.4
river:factor(season)                        3     8.84      9315     6492.6
river:observedWeightZ                       1     1.39      9314     6491.2
river:nIndZ                                 1     0.03      9313     6491.1
river:nIndBySpeciesZ                        1     0.77      9312     6490.4
factor(season):observedWeightZ              3    50.72      9309     6439.6
factor(season):nIndZ                        3    22.53      9306     6417.1
factor(season):nIndBySpeciesZ               3    61.92      9303     6355.2
observedWeightZ:nIndZ                       1     0.29      9302     6354.9
observedWeightZ:nIndBySpeciesZ              1     1.18      9301     6353.7
nIndZ:nIndBySpeciesZ                        1     5.22      9300     6348.5</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb450"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(predATS<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]], <span class="at">type=</span><span class="st">"II"</span>, <span class="at">test=</span><span class="st">"Wald"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II tests)

Response: negGrowth
                                           Df    Chisq Pr(&gt;Chisq)    
meanFlowByRiverZbySeason                    1  41.1813  1.387e-10 ***
meanTempZbySeason                           1   0.1517   0.696911    
river                                       2   4.8088   0.090319 .  
factor(season)                              6 192.3949  &lt; 2.2e-16 ***
observedWeightZ                             1 275.1039  &lt; 2.2e-16 ***
nIndZ                                       2  27.5964  1.017e-06 ***
nIndBySpeciesZ                              1  16.3245  5.337e-05 ***
meanFlowByRiverZbySeason:meanTempZbySeason  1  21.3666  3.793e-06 ***
meanFlowByRiverZbySeason:river              1   1.0787   0.298999    
meanFlowByRiverZbySeason:factor(season)     3  96.5009  &lt; 2.2e-16 ***
meanFlowByRiverZbySeason:observedWeightZ    1   7.8609   0.005052 ** 
meanFlowByRiverZbySeason:nIndZ              1  83.9283  &lt; 2.2e-16 ***
meanFlowByRiverZbySeason:nIndBySpeciesZ     1  60.8633  6.118e-15 ***
meanTempZbySeason:river                     1   1.2029   0.272749    
meanTempZbySeason:factor(season)            3  55.9292  4.350e-12 ***
meanTempZbySeason:observedWeightZ           1  20.4272  6.194e-06 ***
meanTempZbySeason:nIndZ                     1   0.0932   0.760191    
meanTempZbySeason:nIndBySpeciesZ            1   0.0718   0.788797    
river:factor(season)                        3   1.9340   0.586221    
river:observedWeightZ                       1   0.8754   0.349461    
river:nIndZ                                 1   0.7293   0.393106    
river:nIndBySpeciesZ                        1   0.6375   0.424608    
factor(season):observedWeightZ              3  46.4062  4.649e-10 ***
factor(season):nIndZ                        3  59.9397  6.055e-13 ***
factor(season):nIndBySpeciesZ               3  67.4872  1.473e-14 ***
observedWeightZ:nIndZ                       1   1.4141   0.234369    
observedWeightZ:nIndBySpeciesZ              1   0.7441   0.388366    
nIndZ:nIndBySpeciesZ                        1   4.9598   0.025943 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb452"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="fu">efronRSquared</span>(predATS<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>EfronRSquared 
        0.333 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb454"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATS<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb454-3"><a href="#cb454-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb454-4"><a href="#cb454-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb454-5"><a href="#cb454-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG <span class="sc">+</span> meanTempZbySeason)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modAts-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb455"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATS<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">==</span> <span class="dv">0</span>, meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb455-3"><a href="#cb455-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb455-4"><a href="#cb455-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb455-5"><a href="#cb455-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modAts-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb456"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATS<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, pred, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason))) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb456-3"><a href="#cb456-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>) <span class="sc">+</span></span>
<span id="cb456-4"><a href="#cb456-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb456-5"><a href="#cb456-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modAts-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a>predATSWider <span class="ot">&lt;-</span> predATS<span class="sc">$</span>pred <span class="sc">|&gt;</span> </span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nIndZ <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>groupFN) <span class="sc">|&gt;</span> </span>
<span id="cb457-4"><a href="#cb457-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> pred, <span class="at">names_from =</span> nIndZ, <span class="at">names_prefix =</span> <span class="st">"nIndZ"</span>)</span>
<span id="cb457-5"><a href="#cb457-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-6"><a href="#cb457-6" aria-hidden="true" tabindex="-1"></a>tempColors <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"grey"</span>, <span class="st">"red"</span>)</span>
<span id="cb457-7"><a href="#cb457-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-8"><a href="#cb457-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATSWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="sc">-</span><span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb457-9"><a href="#cb457-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb457-10"><a href="#cb457-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb457-11"><a href="#cb457-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb457-12"><a href="#cb457-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb457-13"><a href="#cb457-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb457-14"><a href="#cb457-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb457-15"><a href="#cb457-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Small fish"</span>) <span class="sc">+</span></span>
<span id="cb457-16"><a href="#cb457-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb457-17"><a href="#cb457-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modAts-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb458"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATSWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>,  season <span class="sc">&gt;</span> <span class="dv">1</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb458-3"><a href="#cb458-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb458-4"><a href="#cb458-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb458-5"><a href="#cb458-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb458-6"><a href="#cb458-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb458-7"><a href="#cb458-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb458-8"><a href="#cb458-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Medium fish"</span>) <span class="sc">+</span></span>
<span id="cb458-9"><a href="#cb458-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb458-10"><a href="#cb458-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modAts-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb459"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATSWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>,  season <span class="sc">&gt;</span> <span class="dv">1</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb459-2"><a href="#cb459-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb459-3"><a href="#cb459-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb459-4"><a href="#cb459-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb459-5"><a href="#cb459-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb459-6"><a href="#cb459-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb459-7"><a href="#cb459-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb459-8"><a href="#cb459-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Large fish"</span>) <span class="sc">+</span></span>
<span id="cb459-9"><a href="#cb459-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb459-10"><a href="#cb459-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/modAts-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="two-growth-models" class="level2" data-number="16.15">
<h2 data-number="16.15" class="anchored" data-anchor-id="two-growth-models"><span class="header-section-number">16.15</span> Two growth models</h2>
<section id="size-adjusted-growth-model" class="level3" data-number="16.15.1">
<h3 data-number="16.15.1" class="anchored" data-anchor-id="size-adjusted-growth-model"><span class="header-section-number">16.15.1</span> Size-adjusted growth model</h3>
<section id="get-l-w-relationships-for-size-adjusted-growth-model" class="level4" data-number="16.15.1.1">
<h4 data-number="16.15.1.1" class="anchored" data-anchor-id="get-l-w-relationships-for-size-adjusted-growth-model"><span class="header-section-number">16.15.1.1</span> Get l-w relationships for size-adjusted growth model</h4>
<p>Here, we will explore size-independent growth in mass, see <code>Sigourney, D. B., B H Letcher, M. Obedzinski, and R. A. Cunjak. “Size-Independent Growth in Fishes: Patterns, Models and Metrics.” Journal of Fish Biology 72, no. 10 (2008): 2435–55. https://doi.org/10.1111/j.1095-8649.2008.01830.x.</code> Size-independent growth (<code>grWeightS</code>) is calculated in getDataElectro_targets.R file using addSizeIndGrowthWeight().<br>
<code>grWeightS</code> uses the slope of <code>log(observedWeight)</code> ~ <code>log(grWeight)</code> for each river and season and species to adjust growth.<br>
A simple linear models shows we need to get separate slopes for each river and season and species.</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/grW_models_3567552f01f40f3e96b0dbd7f244e8f1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb460"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">log</span>(observedWeight), <span class="fu">log</span>(grWeight), <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.05</span>)  <span class="sc">+</span></span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb460-5"><a href="#cb460-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Log of mass (mg)"</span>, <span class="at">x =</span> <span class="st">"Log of growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb460-6"><a href="#cb460-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb460-7"><a href="#cb460-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb460-8"><a href="#cb460-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/grW_models-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb461"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight), <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight) <span class="sc">*</span> river, <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight) <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season), <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb461-4"><a href="#cb461-4" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight) <span class="sc">*</span> <span class="fu">factor</span>(season), <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb461-5"><a href="#cb461-5" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight) <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> species, <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb461-6"><a href="#cb461-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-7"><a href="#cb461-7" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(mod0,mod1,mod2,mod3,mod4) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(AIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     df      AIC
mod4 73 43925.12
mod2 33 47539.49
mod3  9 48036.13
mod1  9 64659.88
mod0  3 64744.59</code></pre>
</div>
</div>
</section>
</section>
<section id="compare-size-adjusted-and-instantaneous-growth" class="level3" data-number="16.15.2">
<h3 data-number="16.15.2" class="anchored" data-anchor-id="compare-size-adjusted-and-instantaneous-growth"><span class="header-section-number">16.15.2</span> Compare size-adjusted and instantaneous growth</h3>
<p>Differences don’t seem big enough to warrant the extra complexity from the s-adjusted growth metric</p>
<div class="cell" data-hash="modelGrowthInMass_cache/html/grWeight_v_grWeightS_dc888feac474fd68bd3f56ce242927bf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb463"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grWeight, grWeightS, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.05</span>)  <span class="sc">+</span></span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb463-5"><a href="#cb463-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Gowth in mass"</span>, <span class="at">x =</span> <span class="st">"Size-adjusted growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb463-6"><a href="#cb463-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb463-7"><a href="#cb463-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb463-8"><a href="#cb463-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/grWeight_v_grWeightS-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb464"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> </span>
<span id="cb464-2"><a href="#cb464-2" aria-hidden="true" tabindex="-1"></a>         dplyr<span class="sc">::</span><span class="fu">select</span>(observedWeight, grWeight, grWeightS, seasonGG, speciesGG) <span class="sc">|&gt;</span> </span>
<span id="cb464-3"><a href="#cb464-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(grWeight, grWeightS)),</span>
<span id="cb464-4"><a href="#cb464-4" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb464-5"><a href="#cb464-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">log</span>(observedWeight), value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb464-6"><a href="#cb464-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.05</span> )  <span class="sc">+</span></span>
<span id="cb464-7"><a href="#cb464-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb464-8"><a href="#cb464-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Log of mass (mg)"</span>, <span class="at">x =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb464-9"><a href="#cb464-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb464-10"><a href="#cb464-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb464-11"><a href="#cb464-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/grWeight_v_grWeightS-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="compare-growth-in-length-and-mass" class="level2" data-number="16.16">
<h2 data-number="16.16" class="anchored" data-anchor-id="compare-growth-in-length-and-mass"><span class="header-section-number">16.16</span> Compare growth in length and mass</h2>
<section id="growth-rate-in-length-vs-size-independent-growth-rate-in-mass" class="level3" data-number="16.16.1">
<h3 data-number="16.16.1" class="anchored" data-anchor-id="growth-rate-in-length-vs-size-independent-growth-rate-in-mass"><span class="header-section-number">16.16.1</span> Growth rate in length vs size-independent growth rate in mass</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/grLen_v_grWeightS_cbe0b57e033447b224b5b9d0de9b4a1c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb465"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grLength, grWeightS)) <span class="sc">+</span></span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> observedWeight), <span class="at">alpha =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in length"</span>, <span class="at">y =</span> <span class="st">"Size-adjusted growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb465-5"><a href="#cb465-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb465-6"><a href="#cb465-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb465-7"><a href="#cb465-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/grLen_v_grWeightS-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="deprecated-logistic-models-below" class="level2" data-number="16.17">
<h2 data-number="16.17" class="anchored" data-anchor-id="deprecated-logistic-models-below"><span class="header-section-number">16.17</span> <strong>Deprecated</strong> logistic models below</h2>
<section id="logistic-model-for-flow-and-temperature-all-species" class="level3" data-number="16.17.1">
<h3 data-number="16.17.1" class="anchored" data-anchor-id="logistic-model-for-flow-and-temperature-all-species"><span class="header-section-number">16.17.1</span> Logistic model for flow and temperature, all species</h3>
</section>
<section id="model-selection" class="level3" data-number="16.17.2">
<h3 data-number="16.17.2" class="anchored" data-anchor-id="model-selection"><span class="header-section-number">16.17.2</span> Model selection</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/logistic models all species_54846b08adb28614c8f2b4c07108a2e2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb466"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a>modSpecies <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bkt"</span>, <span class="st">"ats"</span>, <span class="st">"bnt"</span>)</span>
<span id="cb466-2"><a href="#cb466-2" aria-hidden="true" tabindex="-1"></a>cd1Mod <span class="ot">&lt;-</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> modSpecies)</span>
<span id="cb466-3"><a href="#cb466-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-4"><a href="#cb466-4" aria-hidden="true" tabindex="-1"></a>modFT0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-5"><a href="#cb466-5" aria-hidden="true" tabindex="-1"></a>modFT1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-6"><a href="#cb466-6" aria-hidden="true" tabindex="-1"></a>modFT2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">+</span> river <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-7"><a href="#cb466-7" aria-hidden="true" tabindex="-1"></a>modFT3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">+</span> meanTemperatureScaledBySeason <span class="sc">+</span> river <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-8"><a href="#cb466-8" aria-hidden="true" tabindex="-1"></a>modFT4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">+</span> river , <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-9"><a href="#cb466-9" aria-hidden="true" tabindex="-1"></a>modFT5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">+</span> river , <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-10"><a href="#cb466-10" aria-hidden="true" tabindex="-1"></a>modFT6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">+</span> species , <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-11"><a href="#cb466-11" aria-hidden="true" tabindex="-1"></a>modFT7 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-12"><a href="#cb466-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-13"><a href="#cb466-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-14"><a href="#cb466-14" aria-hidden="true" tabindex="-1"></a>modFT8 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-15"><a href="#cb466-15" aria-hidden="true" tabindex="-1"></a>modFT9 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-16"><a href="#cb466-16" aria-hidden="true" tabindex="-1"></a>modFT10 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">+</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-17"><a href="#cb466-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-18"><a href="#cb466-18" aria-hidden="true" tabindex="-1"></a>modFT11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> observedWeight <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-19"><a href="#cb466-19" aria-hidden="true" tabindex="-1"></a>modFT12 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> species <span class="sc">*</span> observedWeight, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb466-20"><a href="#cb466-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-21"><a href="#cb466-21" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(modFT0, modFT1,modFT2, modFT3,modFT4,modFT5, modFT6,modFT7,modFT8,modFT9,modFT10, modFT11, modFT12) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(AIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         df        AIC
modFT8   66   5227.562
modFT1   18   6284.129
modFT0   36   6300.755
modFT2    9   6313.234
modFT3    8   6315.001
modFT6    6   6375.226
modFT4    7   6563.664
modFT5    7   6563.664
modFT7    4   6704.608
modFT11 130  92892.189
modFT12 261  93082.102
modFT10  71 107480.000
modFT9  137 110928.016</code></pre>
</div>
</div>
</section>
<section id="model-results-for-additive-model-not-very-good" class="level3" data-number="16.17.3">
<h3 data-number="16.17.3" class="anchored" data-anchor-id="model-results-for-additive-model-not-very-good"><span class="header-section-number">16.17.3</span> Model results for additive model (not very good)</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/badAdditiveModel_7837d979520e16adf392452b50930893">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb468"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.statology.org/logistic-regression-in-r/</span></span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(modFT3)</span></span>
<span id="cb468-3"><a href="#cb468-3" aria-hidden="true" tabindex="-1"></a><span class="co">#anova(modFT3)</span></span>
<span id="cb468-4"><a href="#cb468-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-5"><a href="#cb468-5" aria-hidden="true" tabindex="-1"></a>pscl<span class="sc">::</span><span class="fu">pR2</span>(modFT3)[<span class="st">"McFadden"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>fitting null model for pseudo-r2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  McFadden 
0.07356826 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb471"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">varImp</span>(modFT3) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Overall))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                Overall
speciesbnt                    13.395579
meanFlowByRiverScaledBySeason 10.698930
meanTemperatureScaledBySeason  6.888871
speciesbkt                     5.964425
riverwb mitchell               4.407149
riverwest brook                3.037801
riverwb obear                  2.973792</code></pre>
</div>
</div>
</section>
<section id="model-results-for-full-interactive-model-best-model" class="level3" data-number="16.17.4">
<h3 data-number="16.17.4" class="anchored" data-anchor-id="model-results-for-full-interactive-model-best-model"><span class="header-section-number">16.17.4</span> Model results for full interactive model (best model)</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/fullModel_fbacf8a2dbf679b71a6c6d539d701825">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb473"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.statology.org/logistic-regression-in-r/</span></span>
<span id="cb473-2"><a href="#cb473-2" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(modFT11)</span></span>
<span id="cb473-3"><a href="#cb473-3" aria-hidden="true" tabindex="-1"></a><span class="co">#anova(modFT11)</span></span>
<span id="cb473-4"><a href="#cb473-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-5"><a href="#cb473-5" aria-hidden="true" tabindex="-1"></a><span class="co"># full interaction</span></span>
<span id="cb473-6"><a href="#cb473-6" aria-hidden="true" tabindex="-1"></a>pscl<span class="sc">::</span><span class="fu">pR2</span>(modFT11)[<span class="st">"McFadden"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>fitting null model for pseudo-r2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> McFadden 
-12.62397 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb476"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">varImp</span>(modFT11) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Overall))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                 Overall
speciesbnt                                                                                                  1053786328.4
speciesbkt                                                                                                   284259874.7
meanTemperatureScaledBySeason:riverwb obear:factor(season)3                                                  206190180.6
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb obear:factor(season)3                    202492714.1
meanTemperatureScaledBySeason:riverwb obear                                                                  189037491.4
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb obear                                    186017710.2
meanTemperatureScaledBySeason:riverwb obear:factor(season)2:observedWeight                                   161645650.5
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb obear:factor(season)2:observedWeight     159547481.3
meanTemperatureScaledBySeason:riverwb obear:factor(season)2                                                  152548068.3
meanTemperatureScaledBySeason:riverwb obear:observedWeight                                                   150405795.3
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb obear:observedWeight                     149449176.8
meanTemperatureScaledBySeason:riverwb obear:factor(season)3:observedWeight                                   148420772.9
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb obear:factor(season)3:observedWeight     144812887.9
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb obear:factor(season)2                    142789878.0
meanTemperatureScaledBySeason:observedWeight                                                                 121754595.8
meanTemperatureScaledBySeason:riverwest brook:observedWeight                                                 120294666.6
riverwb obear:factor(season)4                                                                                119818800.5
meanFlowByRiverScaledBySeason:riverwb obear:factor(season)4                                                  119290709.9
riverwb obear:factor(season)4:observedWeight                                                                 118814327.3
meanTemperatureScaledBySeason:factor(season)3:observedWeight                                                 118323796.8
meanFlowByRiverScaledBySeason:riverwb obear:factor(season)4:observedWeight                                   118156185.0
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:observedWeight                                   117653131.9
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwest brook:observedWeight                   116023954.5
meanTemperatureScaledBySeason:riverwest brook:factor(season)3:observedWeight                                 113685884.1
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:factor(season)3:observedWeight                   111606650.7
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwest brook:factor(season)3:observedWeight   110512224.8
observedWeight                                                                                               108887205.0
factor(season)3:observedWeight                                                                               108824607.5
meanTemperatureScaledBySeason:factor(season)4:observedWeight                                                 108542695.0
riverwest brook:observedWeight                                                                               107931962.1
meanTemperatureScaledBySeason:riverwest brook:factor(season)4:observedWeight                                 106344025.7
meanFlowByRiverScaledBySeason:observedWeight                                                                 104692452.0
riverwest brook:factor(season)3:observedWeight                                                               104525701.0
meanFlowByRiverScaledBySeason:riverwest brook:observedWeight                                                 102703433.1
meanFlowByRiverScaledBySeason:factor(season)3:observedWeight                                                 101209723.0
meanTemperatureScaledBySeason:riverwest brook:factor(season)2:observedWeight                                 100089912.9
meanTemperatureScaledBySeason:factor(season)2:observedWeight                                                  99686484.3
meanFlowByRiverScaledBySeason:riverwest brook:factor(season)3:observedWeight                                  98433651.6
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwest brook:factor(season)4:observedWeight    95450552.8
factor(season)2:observedWeight                                                                                95233874.1
meanFlowByRiverScaledBySeason:riverwb obear:factor(season)3                                                   94371077.6
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:factor(season)4:observedWeight                    92346010.6
riverwest brook:factor(season)2:observedWeight                                                                91630216.0
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb mitchell:factor(season)3:observedWeight   90865763.7
riverwb obear:factor(season)3                                                                                 90834189.4
meanFlowByRiverScaledBySeason:riverwest brook:factor(season)2:observedWeight                                  90031516.6
meanFlowByRiverScaledBySeason:factor(season)2:observedWeight                                                  88905912.0
meanTemperatureScaledBySeason:riverwb mitchell:factor(season)3:observedWeight                                 88294339.7
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:factor(season)2:observedWeight                    87353582.3
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwest brook                                   85072563.4
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwest brook:factor(season)2:observedWeight    83243402.1
meanTemperatureScaledBySeason:riverwb mitchell:observedWeight                                                 81376979.8
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb mitchell:observedWeight                   81204962.6
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason                                                   80495127.8
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb mitchell:factor(season)3                  78174236.3
meanTemperatureScaledBySeason:riverwest brook:factor(season)2                                                 78007829.0
meanTemperatureScaledBySeason                                                                                 77308664.2
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwest brook:factor(season)3                   77054914.3
meanTemperatureScaledBySeason:factor(season)2                                                                 75968702.3
meanTemperatureScaledBySeason:riverwest brook                                                                 74404117.3
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:factor(season)2                                   73970227.0
riverwb obear:factor(season)2                                                                                 73068199.5
meanTemperatureScaledBySeason:factor(season)3                                                                 72660747.8
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwest brook:factor(season)2                   71921879.8
factor(season)4:observedWeight                                                                                71684212.1
meanTemperatureScaledBySeason:riverwest brook:factor(season)3                                                 71409760.7
meanTemperatureScaledBySeason:riverwb mitchell:factor(season)3                                                70675664.5
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:factor(season)3                                   70546012.6
meanFlowByRiverScaledBySeason:riverwb obear:factor(season)2:observedWeight                                    68933859.8
meanFlowByRiverScaledBySeason:riverwb obear:factor(season)2                                                   68930890.3
riverwest brook:factor(season)4:observedWeight                                                                67079100.6
meanTemperatureScaledBySeason:riverwb mitchell:factor(season)2:observedWeight                                 62493592.4
riverwb obear:factor(season)2:observedWeight                                                                  61178852.0
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb mitchell                                  58303859.6
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb mitchell:factor(season)2:observedWeight   58247446.2
meanTemperatureScaledBySeason:riverwb mitchell                                                                57530539.0
meanFlowByRiverScaledBySeason:riverwest brook:factor(season)4:observedWeight                                  57495116.6
meanFlowByRiverScaledBySeason:factor(season)4:observedWeight                                                  55561597.2
meanTemperatureScaledBySeason:riverwb mitchell:factor(season)4:observedWeight                                 54566845.5
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb obear:factor(season)4                     53205422.8
riverwest brook                                                                                               51723475.8
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb mitchell:factor(season)4:observedWeight   46298658.2
meanFlowByRiverScaledBySeason                                                                                 45759381.4
riverwest brook:factor(season)3                                                                               42760303.7
meanTemperatureScaledBySeason:riverwb obear:factor(season)4                                                   42481168.8
riverwb mitchell:observedWeight                                                                               42452478.0
meanTemperatureScaledBySeason:riverwb mitchell:factor(season)4                                                41310081.7
meanTemperatureScaledBySeason:factor(season)4                                                                 41038381.6
meanFlowByRiverScaledBySeason:factor(season)3                                                                 40739632.5
meanFlowByRiverScaledBySeason:riverwb mitchell:observedWeight                                                 39465254.6
riverwb mitchell:factor(season)4:observedWeight                                                               39129885.8
meanFlowByRiverScaledBySeason:riverwest brook                                                                 38858474.9
meanTemperatureScaledBySeason:riverwest brook:factor(season)4                                                 38823558.4
riverwb mitchell:factor(season)3:observedWeight                                                               38670169.2
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb mitchell:factor(season)4                  35714692.7
factor(season)3                                                                                               35462327.1
riverwb obear                                                                                                 34674805.4
meanFlowByRiverScaledBySeason:riverwb mitchell:factor(season)4:observedWeight                                 34248466.7
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwest brook:factor(season)4                   33658515.7
meanFlowByRiverScaledBySeason:riverwb obear:observedWeight                                                    33553609.2
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb obear:factor(season)4:observedWeight      33290054.3
meanFlowByRiverScaledBySeason:riverwest brook:factor(season)3                                                 32275488.3
meanFlowByRiverScaledBySeason:riverwb mitchell:factor(season)3:observedWeight                                 32046854.7
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:factor(season)4                                   30193110.9
meanFlowByRiverScaledBySeason:riverwb obear                                                                   29205676.4
meanFlowByRiverScaledBySeason:riverwb mitchell:factor(season)2                                                28487627.7
riverwb mitchell:factor(season)2                                                                              26014699.4
riverwb obear:observedWeight                                                                                  25051017.6
meanTemperatureScaledBySeason:riverwb obear:factor(season)4:observedWeight                                    20663389.1
meanFlowByRiverScaledBySeason:riverwb obear:factor(season)3:observedWeight                                    20638663.9
riverwest brook:factor(season)2                                                                               16126946.8
riverwb mitchell:factor(season)2:observedWeight                                                               14311118.6
meanFlowByRiverScaledBySeason:riverwb mitchell:factor(season)3                                                13948904.8
riverwb obear:factor(season)3:observedWeight                                                                  12135696.3
factor(season)2                                                                                               10472604.3
meanFlowByRiverScaledBySeason:factor(season)2                                                                 10135106.6
meanTemperatureScaledBySeason:riverwb mitchell:factor(season)2                                                 8273083.0
meanFlowByRiverScaledBySeason:riverwb mitchell:factor(season)2:observedWeight                                  7284177.1
meanFlowByRiverScaledBySeason:riverwest brook:factor(season)4                                                  7256830.7
meanFlowByRiverScaledBySeason:riverwest brook:factor(season)2                                                  6902771.9
meanFlowByRiverScaledBySeason:factor(season)4                                                                  5025268.1
meanFlowByRiverScaledBySeason:meanTemperatureScaledBySeason:riverwb mitchell:factor(season)2                   3723864.2
riverwb mitchell                                                                                               2206843.4
riverwb mitchell:factor(season)3                                                                               1764088.5
meanFlowByRiverScaledBySeason:riverwb mitchell:factor(season)4                                                 1579048.1
riverwb mitchell:factor(season)4                                                                               1292175.3
riverwest brook:factor(season)4                                                                                1137844.7
factor(season)4                                                                                                 920754.4
meanFlowByRiverScaledBySeason:riverwb mitchell                                                                  362710.3</code></pre>
</div>
</div>
</section>
<section id="precict-pneg-growth-in-mass" class="level3" data-number="16.17.5">
<h3 data-number="16.17.5" class="anchored" data-anchor-id="precict-pneg-growth-in-mass"><span class="header-section-number">16.17.5</span> Precict p(neg growth in mass)</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/predictFull_de4c8be77cc5fedaef94afcef19f1899">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb478"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a>predD <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">meanFlowByRiverScaledBySeason =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb478-3"><a href="#cb478-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">meanTemperatureScaledBySeason =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb478-4"><a href="#cb478-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">river =</span> <span class="fu">unique</span>(cd1<span class="sc">$</span>river), </span>
<span id="cb478-5"><a href="#cb478-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">species =</span> <span class="fu">unique</span>(cd1<span class="sc">$</span>species), </span>
<span id="cb478-6"><a href="#cb478-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">season =</span> <span class="fu">unique</span>(cd1<span class="sc">$</span>season),</span>
<span id="cb478-7"><a href="#cb478-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">observedWeight =</span> <span class="fu">seq</span>(<span class="fu">min</span>(cd1<span class="sc">$</span>observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">max</span>(cd1<span class="sc">$</span>observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">40</span>)</span>
<span id="cb478-8"><a href="#cb478-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb478-9"><a href="#cb478-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-10"><a href="#cb478-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-11"><a href="#cb478-11" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">add_column</span>(predD, </span>
<span id="cb478-12"><a href="#cb478-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">pred =</span> <span class="fu">predict.glm</span>(modFT11, predD, <span class="at">type =</span> <span class="st">"response"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb478-13"><a href="#cb478-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">groupT =</span> <span class="fu">paste</span>(river, species, season, meanTemperatureScaledBySeason, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb478-14"><a href="#cb478-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">groupF =</span> <span class="fu">paste</span>(river, species, season, meanFlowByRiverScaledBySeason, <span class="at">sep =</span> <span class="st">"_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot-predictions" class="level3" data-number="16.17.6">
<h3 data-number="16.17.6" class="anchored" data-anchor-id="plot-predictions"><span class="header-section-number">16.17.6</span> Plot predictions</h3>
<div class="cell" data-hash="modelGrowthInMass_cache/html/plotPred_bd3e1ec16b1b0618cd3f6efc4200acf2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb479"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTemperatureScaledBySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeight <span class="sc">==</span> <span class="fl">161.3</span>), <span class="fu">aes</span>(meanFlowByRiverScaledBySeason, pred, <span class="at">group=</span> groupT)) <span class="sc">+</span></span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTemperatureScaledBySeason))) <span class="sc">+</span></span>
<span id="cb479-3"><a href="#cb479-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mean flow"</span>) <span class="sc">+</span></span>
<span id="cb479-4"><a href="#cb479-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb479-5"><a href="#cb479-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(season<span class="sc">~</span>species<span class="sc">+</span>river)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="modelGrowthInMass_files/figure-html/plotPred-1.png" class="img-fluid" width="672"></p>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./modelConditionFactor.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Condition factor</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./modelsCMR_NN_OB.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">CJS model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb480" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> </span></span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb480-4"><a href="#cb480-4" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb480-5"><a href="#cb480-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb480-6"><a href="#cb480-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-7"><a href="#cb480-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Growth in mass</span></span>
<span id="cb480-8"><a href="#cb480-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-11"><a href="#cb480-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-12"><a href="#cb480-12" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: dataModelGrowthInMassOptions</span></span>
<span id="cb480-13"><a href="#cb480-13" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb480-14"><a href="#cb480-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">message =</span> <span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-15"><a href="#cb480-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-16"><a href="#cb480-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-19"><a href="#cb480-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-20"><a href="#cb480-20" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: librariesModelsFlow</span></span>
<span id="cb480-21"><a href="#cb480-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb480-22"><a href="#cb480-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-23"><a href="#cb480-23" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################</span></span>
<span id="cb480-24"><a href="#cb480-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-25"><a href="#cb480-25" aria-hidden="true" tabindex="-1"></a><span class="co"># for gams</span></span>
<span id="cb480-26"><a href="#cb480-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gratia)</span>
<span id="cb480-27"><a href="#cb480-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arm)</span>
<span id="cb480-28"><a href="#cb480-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(relaimpo)</span>
<span id="cb480-29"><a href="#cb480-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb480-30"><a href="#cb480-30" aria-hidden="true" tabindex="-1"></a><span class="co"># library(linkedModels)</span></span>
<span id="cb480-31"><a href="#cb480-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrayhelpers)</span>
<span id="cb480-32"><a href="#cb480-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb480-33"><a href="#cb480-33" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################</span></span>
<span id="cb480-34"><a href="#cb480-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-35"><a href="#cb480-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(getWBData)</span>
<span id="cb480-36"><a href="#cb480-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb480-37"><a href="#cb480-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb480-38"><a href="#cb480-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb480-39"><a href="#cb480-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb480-40"><a href="#cb480-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb480-41"><a href="#cb480-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(relaimpo)</span>
<span id="cb480-42"><a href="#cb480-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb480-43"><a href="#cb480-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb480-44"><a href="#cb480-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-45"><a href="#cb480-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(getPrepareWBData)</span>
<span id="cb480-46"><a href="#cb480-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-47"><a href="#cb480-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb480-48"><a href="#cb480-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb480-49"><a href="#cb480-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rcompanion)</span>
<span id="cb480-50"><a href="#cb480-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-51"><a href="#cb480-51" aria-hidden="true" tabindex="-1"></a><span class="co"># for xgboost models</span></span>
<span id="cb480-52"><a href="#cb480-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)      <span class="co"># data splitting </span></span>
<span id="cb480-53"><a href="#cb480-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gbm)          <span class="co"># basic implementation</span></span>
<span id="cb480-54"><a href="#cb480-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)      <span class="co"># a faster implementation of gbm</span></span>
<span id="cb480-55"><a href="#cb480-55" aria-hidden="true" tabindex="-1"></a><span class="co">#library(h2o)          # a java-based platform</span></span>
<span id="cb480-56"><a href="#cb480-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdp)          <span class="co"># model visualization</span></span>
<span id="cb480-57"><a href="#cb480-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lime)</span>
<span id="cb480-58"><a href="#cb480-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vtreat)</span>
<span id="cb480-59"><a href="#cb480-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Ckmeans<span class="fl">.1</span>d.dp)</span>
<span id="cb480-60"><a href="#cb480-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-61"><a href="#cb480-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hstats)</span>
<span id="cb480-62"><a href="#cb480-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-63"><a href="#cb480-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb480-64"><a href="#cb480-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-65"><a href="#cb480-65" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'./R/generalFunctions.R'</span>)</span>
<span id="cb480-66"><a href="#cb480-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-67"><a href="#cb480-67" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%notin%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">Negate</span>(<span class="st">`</span><span class="at">%in%</span><span class="st">`</span>)</span>
<span id="cb480-68"><a href="#cb480-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-69"><a href="#cb480-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-70"><a href="#cb480-70" aria-hidden="true" tabindex="-1"></a>Distribution of growth, negative growth\</span>
<span id="cb480-71"><a href="#cb480-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Seasonal differences\</span>
<span id="cb480-72"><a href="#cb480-72" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Species differences in size/growth/CF - Patterns of negative growth</span>
<span id="cb480-73"><a href="#cb480-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-74"><a href="#cb480-74" aria-hidden="true" tabindex="-1"></a>Causes of neg growth\</span>
<span id="cb480-75"><a href="#cb480-75" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Extrinsic\</span>
<span id="cb480-76"><a href="#cb480-76" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>river, season, flow, temp\</span>
<span id="cb480-77"><a href="#cb480-77" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>intrinsic\</span>
<span id="cb480-78"><a href="#cb480-78" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sex (fall), life history, section, size, age, previous growth (CF?),</span>
<span id="cb480-79"><a href="#cb480-79" aria-hidden="true" tabindex="-1"></a>movement (section/river)\</span>
<span id="cb480-80"><a href="#cb480-80" aria-hidden="true" tabindex="-1"></a>consequences of neg growth - survival\</span>
<span id="cb480-81"><a href="#cb480-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>future growth (length and mass)\</span>
<span id="cb480-82"><a href="#cb480-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>movement (section/river)\</span>
<span id="cb480-83"><a href="#cb480-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>reprod success?\</span>
<span id="cb480-84"><a href="#cb480-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>local density (con and hetero)</span>
<span id="cb480-85"><a href="#cb480-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-86"><a href="#cb480-86" aria-hidden="true" tabindex="-1"></a>Probs with growth in mass\</span>
<span id="cb480-87"><a href="#cb480-87" aria-hidden="true" tabindex="-1"></a>spawning loss mass in the fall, esp in OB</span>
<span id="cb480-88"><a href="#cb480-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-89"><a href="#cb480-89" aria-hidden="true" tabindex="-1"></a>Interaction between flow:temp, diff btw WB (groundwater dominated at low</span>
<span id="cb480-90"><a href="#cb480-90" aria-hidden="true" tabindex="-1"></a>flow so cold) and tribs (combo of surface and gw?)</span>
<span id="cb480-91"><a href="#cb480-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-92"><a href="#cb480-92" aria-hidden="true" tabindex="-1"></a>Compare growth with t/f cycle diagrams for each river</span>
<span id="cb480-93"><a href="#cb480-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-94"><a href="#cb480-94" aria-hidden="true" tabindex="-1"></a>compare condition factor among species - looks like bkt growing faster</span>
<span id="cb480-95"><a href="#cb480-95" aria-hidden="true" tabindex="-1"></a>in weight</span>
<span id="cb480-96"><a href="#cb480-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-97"><a href="#cb480-97" aria-hidden="true" tabindex="-1"></a>flow/temp circles with gr on top</span>
<span id="cb480-98"><a href="#cb480-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-99"><a href="#cb480-99" aria-hidden="true" tabindex="-1"></a><span class="fu">## Get data</span></span>
<span id="cb480-100"><a href="#cb480-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-101"><a href="#cb480-101" aria-hidden="true" tabindex="-1"></a><span class="fu">### Get electrofishing data</span></span>
<span id="cb480-102"><a href="#cb480-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-105"><a href="#cb480-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-106"><a href="#cb480-106" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: readInAllData</span></span>
<span id="cb480-107"><a href="#cb480-107" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb480-108"><a href="#cb480-108" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb480-109"><a href="#cb480-109" aria-hidden="true" tabindex="-1"></a>cd <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(cdWB_electro_target) <span class="co"># raw data</span></span>
<span id="cb480-110"><a href="#cb480-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-111"><a href="#cb480-111" aria-hidden="true" tabindex="-1"></a>cd1 <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(cd1_target) <span class="co"># from modelGrowthInMass_target</span></span>
<span id="cb480-112"><a href="#cb480-112" aria-hidden="true" tabindex="-1"></a>propNegSRS <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(propNegSRS_target)</span>
<span id="cb480-113"><a href="#cb480-113" aria-hidden="true" tabindex="-1"></a>propNegSRsN <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(propNegSRsN_target)</span>
<span id="cb480-114"><a href="#cb480-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-115"><a href="#cb480-115" aria-hidden="true" tabindex="-1"></a>indCountsBySpp <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(indCountsBySpp_target) </span>
<span id="cb480-116"><a href="#cb480-116" aria-hidden="true" tabindex="-1"></a>indCounts <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(indCounts_target) </span>
<span id="cb480-117"><a href="#cb480-117" aria-hidden="true" tabindex="-1"></a>propNegLabels <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(propNegLabels_target)</span>
<span id="cb480-118"><a href="#cb480-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-119"><a href="#cb480-119" aria-hidden="true" tabindex="-1"></a>negGr_beforeLast <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(negGr_beforeLast_target)</span>
<span id="cb480-120"><a href="#cb480-120" aria-hidden="true" tabindex="-1"></a>negGr_beforeLastMean <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(negGr_beforeLastMean_target)</span>
<span id="cb480-121"><a href="#cb480-121" aria-hidden="true" tabindex="-1"></a>negGr_beforeLastMean_year <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(negGr_beforeLastMean_year_target)</span>
<span id="cb480-122"><a href="#cb480-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-123"><a href="#cb480-123" aria-hidden="true" tabindex="-1"></a>meanNegSRsN <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(meanNegSRsN_target)</span>
<span id="cb480-124"><a href="#cb480-124" aria-hidden="true" tabindex="-1"></a>meanNegSRsNWide <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(meanNegSRsNWide_target)</span>
<span id="cb480-125"><a href="#cb480-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-126"><a href="#cb480-126" aria-hidden="true" tabindex="-1"></a><span class="co"># df for pairs plots</span></span>
<span id="cb480-127"><a href="#cb480-127" aria-hidden="true" tabindex="-1"></a>cd1Wide_grWeight <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(cd1Wide_grWeight_target)</span>
<span id="cb480-128"><a href="#cb480-128" aria-hidden="true" tabindex="-1"></a>cd1Wide_observedWeight <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(cd1Wide_observedWeight_target)</span>
<span id="cb480-129"><a href="#cb480-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-130"><a href="#cb480-130" aria-hidden="true" tabindex="-1"></a>dGAM <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(dGAM_target) <span class="co"># from modelGrowthInMass_target</span></span>
<span id="cb480-131"><a href="#cb480-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-132"><a href="#cb480-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-133"><a href="#cb480-133" aria-hidden="true" tabindex="-1"></a><span class="fu">### Get environmental data</span></span>
<span id="cb480-134"><a href="#cb480-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-137"><a href="#cb480-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-138"><a href="#cb480-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: readInAllDataEnv</span></span>
<span id="cb480-139"><a href="#cb480-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb480-140"><a href="#cb480-140" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb480-141"><a href="#cb480-141" aria-hidden="true" tabindex="-1"></a>dummy<span class="ot">=</span><span class="dv">0</span> <span class="co"># change to force cache update??</span></span>
<span id="cb480-142"><a href="#cb480-142" aria-hidden="true" tabindex="-1"></a>envIn <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(envIn_target)</span>
<span id="cb480-143"><a href="#cb480-143" aria-hidden="true" tabindex="-1"></a>envIn_propNeg <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(envIn_propNeg_target)</span>
<span id="cb480-144"><a href="#cb480-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-145"><a href="#cb480-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-146"><a href="#cb480-146" aria-hidden="true" tabindex="-1"></a><span class="fu">## Examine raw data</span></span>
<span id="cb480-147"><a href="#cb480-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-148"><a href="#cb480-148" aria-hidden="true" tabindex="-1"></a><span class="fu">### Limit data to consecutive sample captures (cd1)</span></span>
<span id="cb480-149"><a href="#cb480-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-150"><a href="#cb480-150" aria-hidden="true" tabindex="-1"></a>Previous growth models with length used all possible observations for a</span>
<span id="cb480-151"><a href="#cb480-151" aria-hidden="true" tabindex="-1"></a>fish and interpolated missing observations. Here, we are just looking at</span>
<span id="cb480-152"><a href="#cb480-152" aria-hidden="true" tabindex="-1"></a>consecutive captures to estimate growth over just that interval.</span>
<span id="cb480-153"><a href="#cb480-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-156"><a href="#cb480-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-157"><a href="#cb480-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: consecSamples</span></span>
<span id="cb480-158"><a href="#cb480-158" aria-hidden="true" tabindex="-1"></a><span class="co"># table(as.numeric(cd$sampleNumber), as.numeric(cd$lagSampleNumber), cd$season, cd$year) |&gt; </span></span>
<span id="cb480-159"><a href="#cb480-159" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame() |&gt; </span></span>
<span id="cb480-160"><a href="#cb480-160" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Freq &gt; 0) |&gt; </span></span>
<span id="cb480-161"><a href="#cb480-161" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(Var1, Var2) |&gt; </span></span>
<span id="cb480-162"><a href="#cb480-162" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(firstCapt = Var1, secondCapt = Var2, season = Var3, year = Var4) |&gt; </span></span>
<span id="cb480-163"><a href="#cb480-163" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(year == 2010)</span></span>
<span id="cb480-164"><a href="#cb480-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-165"><a href="#cb480-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-166"><a href="#cb480-166" aria-hidden="true" tabindex="-1"></a><span class="do">##### in targets</span></span>
<span id="cb480-167"><a href="#cb480-167" aria-hidden="true" tabindex="-1"></a><span class="co"># cd1 &lt;- cd |&gt; </span></span>
<span id="cb480-168"><a href="#cb480-168" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(sampleNumberDiff == 1,</span></span>
<span id="cb480-169"><a href="#cb480-169" aria-hidden="true" tabindex="-1"></a><span class="co">#          tag %notin% c('1bf20ff490', '1bf20ebe4e')) |&gt; </span></span>
<span id="cb480-170"><a href="#cb480-170" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(negGrowth = grWeight &lt; 0,</span></span>
<span id="cb480-171"><a href="#cb480-171" aria-hidden="true" tabindex="-1"></a><span class="co">#          month = month(date),</span></span>
<span id="cb480-172"><a href="#cb480-172" aria-hidden="true" tabindex="-1"></a><span class="co">#          dummy = 1) # change to force cache update</span></span>
<span id="cb480-173"><a href="#cb480-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-174"><a href="#cb480-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-175"><a href="#cb480-175" aria-hidden="true" tabindex="-1"></a><span class="fu">### Find outlier growth rates</span></span>
<span id="cb480-176"><a href="#cb480-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-177"><a href="#cb480-177" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Negative outlier growth</span></span>
<span id="cb480-178"><a href="#cb480-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-179"><a href="#cb480-179" aria-hidden="true" tabindex="-1"></a><span class="in">`1bf20ebe4e`</span> and <span class="in">`1bf20ff490`</span> have incorrect weights leading to very</span>
<span id="cb480-180"><a href="#cb480-180" aria-hidden="true" tabindex="-1"></a>negative growth rates.\</span>
<span id="cb480-181"><a href="#cb480-181" aria-hidden="true" tabindex="-1"></a>Exclude these tags in <span class="in">`cd1_target`</span>. The rest of the quite negative</span>
<span id="cb480-182"><a href="#cb480-182" aria-hidden="true" tabindex="-1"></a>growth fish seem plausible (remember we can't account for stomach</span>
<span id="cb480-183"><a href="#cb480-183" aria-hidden="true" tabindex="-1"></a>contents or egg loss).</span>
<span id="cb480-184"><a href="#cb480-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-187"><a href="#cb480-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-188"><a href="#cb480-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negOutlier</span></span>
<span id="cb480-189"><a href="#cb480-189" aria-hidden="true" tabindex="-1"></a>cd <span class="sc">|&gt;</span> </span>
<span id="cb480-190"><a href="#cb480-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(grWeightS) <span class="sc">|&gt;</span> </span>
<span id="cb480-191"><a href="#cb480-191" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tag, species, season, sampleNumber, lagSampleNumber, observedWeight, lagObservedWeight, grWeightS)</span>
<span id="cb480-192"><a href="#cb480-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-193"><a href="#cb480-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-194"><a href="#cb480-194" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Positive outlier growth</span></span>
<span id="cb480-195"><a href="#cb480-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-196"><a href="#cb480-196" aria-hidden="true" tabindex="-1"></a>Lots of very fast growth mostly in the spring. No clear way to exclude</span>
<span id="cb480-197"><a href="#cb480-197" aria-hidden="true" tabindex="-1"></a>fish. <span class="in">`1c2c582218`</span> is excluded in <span class="in">`cd1_target`</span> because of very high</span>
<span id="cb480-198"><a href="#cb480-198" aria-hidden="true" tabindex="-1"></a>growth in length.</span>
<span id="cb480-199"><a href="#cb480-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-202"><a href="#cb480-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-203"><a href="#cb480-203" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: posOutlier</span></span>
<span id="cb480-204"><a href="#cb480-204" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-205"><a href="#cb480-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(grWeightS)) <span class="sc">|&gt;</span> </span>
<span id="cb480-206"><a href="#cb480-206" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tag, species, season, sampleNumber, lagSampleNumber, observedWeight, lagObservedWeight, grWeightS) <span class="sc">|&gt;</span> </span>
<span id="cb480-207"><a href="#cb480-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb480-208"><a href="#cb480-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-209"><a href="#cb480-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-210"><a href="#cb480-210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Numbers of observations for analysis</span></span>
<span id="cb480-213"><a href="#cb480-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-214"><a href="#cb480-214" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rawObs</span></span>
<span id="cb480-215"><a href="#cb480-215" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-216"><a href="#cb480-216" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(cd1<span class="sc">$</span>year)</span>
<span id="cb480-217"><a href="#cb480-217" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(cd1<span class="sc">$</span>year)</span>
<span id="cb480-218"><a href="#cb480-218" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cd1<span class="sc">$</span>species, cd1<span class="sc">$</span>year)</span>
<span id="cb480-219"><a href="#cb480-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-220"><a href="#cb480-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-221"><a href="#cb480-221" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cd1<span class="sc">$</span>species)</span>
<span id="cb480-222"><a href="#cb480-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-223"><a href="#cb480-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-224"><a href="#cb480-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-225"><a href="#cb480-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-228"><a href="#cb480-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-229"><a href="#cb480-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rawUniques</span></span>
<span id="cb480-230"><a href="#cb480-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-231"><a href="#cb480-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-232"><a href="#cb480-232" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(cd1<span class="sc">$</span>tag))</span>
<span id="cb480-233"><a href="#cb480-233" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-234"><a href="#cb480-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span> </span>
<span id="cb480-235"><a href="#cb480-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tag =</span> (<span class="fu">unique</span>(tag))) <span class="sc">|&gt;</span> </span>
<span id="cb480-236"><a href="#cb480-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb480-237"><a href="#cb480-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-238"><a href="#cb480-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-239"><a href="#cb480-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-240"><a href="#cb480-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-241"><a href="#cb480-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-242"><a href="#cb480-242" aria-hidden="true" tabindex="-1"></a><span class="fu">### Raw length, weight data graphs</span></span>
<span id="cb480-243"><a href="#cb480-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-244"><a href="#cb480-244" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Distribution of growth rates</span></span>
<span id="cb480-245"><a href="#cb480-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-248"><a href="#cb480-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-249"><a href="#cb480-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rawlengthWeight</span></span>
<span id="cb480-250"><a href="#cb480-250" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grWeight, <span class="at">color =</span> speciesGG, <span class="at">linetype =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb480-251"><a href="#cb480-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb480-252"><a href="#cb480-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in mass (/d)"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb480-253"><a href="#cb480-253" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_discrete() +</span></span>
<span id="cb480-254"><a href="#cb480-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-255"><a href="#cb480-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.028</span>)) <span class="sc">+</span></span>
<span id="cb480-256"><a href="#cb480-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-257"><a href="#cb480-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-258"><a href="#cb480-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG)</span>
<span id="cb480-259"><a href="#cb480-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-260"><a href="#cb480-260" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grLength, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb480-261"><a href="#cb480-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb480-262"><a href="#cb480-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in Length (mm/d)"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb480-263"><a href="#cb480-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-264"><a href="#cb480-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-265"><a href="#cb480-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-266"><a href="#cb480-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG)</span>
<span id="cb480-267"><a href="#cb480-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-268"><a href="#cb480-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-269"><a href="#cb480-269" aria-hidden="true" tabindex="-1"></a><span class="fu">### Length vs weight by species</span></span>
<span id="cb480-270"><a href="#cb480-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-271"><a href="#cb480-271" aria-hidden="true" tabindex="-1"></a>Very few outliers</span>
<span id="cb480-272"><a href="#cb480-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-275"><a href="#cb480-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-276"><a href="#cb480-276" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: len_v_weight</span></span>
<span id="cb480-277"><a href="#cb480-277" aria-hidden="true" tabindex="-1"></a>plotLenW <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s){</span>
<span id="cb480-278"><a href="#cb480-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> s), <span class="fu">aes</span>(observedLength, observedWeight)) <span class="sc">+</span></span>
<span id="cb480-279"><a href="#cb480-279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb480-280"><a href="#cb480-280" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb480-281"><a href="#cb480-281" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb480-282"><a href="#cb480-282" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ggtitle(s) +</span></span>
<span id="cb480-283"><a href="#cb480-283" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Length (mm)"</span>, <span class="at">y =</span> <span class="st">"Mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb480-284"><a href="#cb480-284" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-285"><a href="#cb480-285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-286"><a href="#cb480-286" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>year, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb480-287"><a href="#cb480-287" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-288"><a href="#cb480-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-289"><a href="#cb480-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-290"><a href="#cb480-290" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-291"><a href="#cb480-291" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout</span></span>
<span id="cb480-292"><a href="#cb480-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-295"><a href="#cb480-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-296"><a href="#cb480-296" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: len_v_weight_bkt</span></span>
<span id="cb480-297"><a href="#cb480-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-298"><a href="#cb480-298" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLenW</span>(cd1, <span class="st">"bkt"</span>)</span>
<span id="cb480-299"><a href="#cb480-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-300"><a href="#cb480-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-301"><a href="#cb480-301" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-302"><a href="#cb480-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-305"><a href="#cb480-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-306"><a href="#cb480-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: len_v_weight_bnt</span></span>
<span id="cb480-307"><a href="#cb480-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-308"><a href="#cb480-308" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLenW</span>(cd1, <span class="st">"bnt"</span>)</span>
<span id="cb480-309"><a href="#cb480-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-310"><a href="#cb480-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-311"><a href="#cb480-311" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-312"><a href="#cb480-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-315"><a href="#cb480-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-316"><a href="#cb480-316" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: len_v_weight_ats</span></span>
<span id="cb480-317"><a href="#cb480-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-318"><a href="#cb480-318" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLenW</span>(cd1, <span class="st">"ats"</span>)</span>
<span id="cb480-319"><a href="#cb480-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-320"><a href="#cb480-320" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-321"><a href="#cb480-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-322"><a href="#cb480-322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Weight vs weight at next sample</span></span>
<span id="cb480-323"><a href="#cb480-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-326"><a href="#cb480-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-327"><a href="#cb480-327" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: weight_v_weight</span></span>
<span id="cb480-328"><a href="#cb480-328" aria-hidden="true" tabindex="-1"></a>plotWW <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp){</span>
<span id="cb480-329"><a href="#cb480-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> spp), <span class="fu">aes</span>(observedWeight, lagObservedWeight, <span class="at">color =</span> seasonGG)) <span class="sc">+</span></span>
<span id="cb480-330"><a href="#cb480-330" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb480-331"><a href="#cb480-331" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb480-332"><a href="#cb480-332" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mass (mg)"</span>, <span class="at">y =</span> <span class="st">"Mass (mg) at next sample"</span>) <span class="sc">+</span></span>
<span id="cb480-333"><a href="#cb480-333" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-334"><a href="#cb480-334" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-335"><a href="#cb480-335" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb480-336"><a href="#cb480-336" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-337"><a href="#cb480-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-338"><a href="#cb480-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-339"><a href="#cb480-339" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-340"><a href="#cb480-340" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout</span></span>
<span id="cb480-341"><a href="#cb480-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-344"><a href="#cb480-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-345"><a href="#cb480-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: weight_v_weight_bkt</span></span>
<span id="cb480-346"><a href="#cb480-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-347"><a href="#cb480-347" aria-hidden="true" tabindex="-1"></a><span class="fu">plotWW</span>(cd1, <span class="st">"bkt"</span>)</span>
<span id="cb480-348"><a href="#cb480-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-349"><a href="#cb480-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-350"><a href="#cb480-350" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-351"><a href="#cb480-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-354"><a href="#cb480-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-355"><a href="#cb480-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: weight_v_weight_bnt</span></span>
<span id="cb480-356"><a href="#cb480-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-357"><a href="#cb480-357" aria-hidden="true" tabindex="-1"></a><span class="fu">plotWW</span>(cd1, <span class="st">"bnt"</span>)</span>
<span id="cb480-358"><a href="#cb480-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-359"><a href="#cb480-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-360"><a href="#cb480-360" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-361"><a href="#cb480-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-364"><a href="#cb480-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-365"><a href="#cb480-365" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: weight_v_weight_ats</span></span>
<span id="cb480-366"><a href="#cb480-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-367"><a href="#cb480-367" aria-hidden="true" tabindex="-1"></a><span class="fu">plotWW</span>(cd1, <span class="st">"ats"</span>)</span>
<span id="cb480-368"><a href="#cb480-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-369"><a href="#cb480-369" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-370"><a href="#cb480-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-371"><a href="#cb480-371" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth rate pairs plots</span></span>
<span id="cb480-372"><a href="#cb480-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-373"><a href="#cb480-373" aria-hidden="true" tabindex="-1"></a>By species, all cohorts\</span>
<span id="cb480-374"><a href="#cb480-374" aria-hidden="true" tabindex="-1"></a>Row and column labels in the pairs plots are 'age'<span class="sc">\_</span>'season'</span>
<span id="cb480-375"><a href="#cb480-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-378"><a href="#cb480-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-379"><a href="#cb480-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs</span></span>
<span id="cb480-380"><a href="#cb480-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-381"><a href="#cb480-381" aria-hidden="true" tabindex="-1"></a>plotPairs <span class="ot">&lt;-</span> <span class="cf">function</span>(d0, sppIn, cohortIn, <span class="at">firstSamp =</span> <span class="dv">1</span>, <span class="at">lastSamp =</span> <span class="dv">9</span>, <span class="at">upperBlank =</span> <span class="cn">FALSE</span>){</span>
<span id="cb480-382"><a href="#cb480-382" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d0 <span class="sc">|&gt;</span> </span>
<span id="cb480-383"><a href="#cb480-383" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(speciesGG <span class="sc">==</span> sppIn, cohort <span class="sc">%in%</span> cohortIn) <span class="sc">|&gt;</span> </span>
<span id="cb480-384"><a href="#cb480-384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select_if</span>(<span class="sc">~</span><span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(.))) <span class="sc">|&gt;</span>  <span class="co"># remove all-NA columns</span></span>
<span id="cb480-385"><a href="#cb480-385" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(firstObserved <span class="sc">!=</span> lastObserved <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># remove single obs fish</span></span>
<span id="cb480-386"><a href="#cb480-386" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-387"><a href="#cb480-387" aria-hidden="true" tabindex="-1"></a>  lowerFn <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, <span class="at">method =</span> <span class="st">"lm"</span>, ...) {</span>
<span id="cb480-388"><a href="#cb480-388" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span></span>
<span id="cb480-389"><a href="#cb480-389" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-390"><a href="#cb480-390" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-391"><a href="#cb480-391" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb480-392"><a href="#cb480-392" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(cohort)), <span class="at">method =</span> method, <span class="at">se =</span> <span class="cn">FALSE</span>, ...) <span class="sc">+</span></span>
<span id="cb480-393"><a href="#cb480-393" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb480-394"><a href="#cb480-394" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">'black'</span>, <span class="at">size =</span> <span class="fl">1.1</span>, <span class="at">method =</span> method, <span class="at">se =</span> <span class="cn">FALSE</span>, ...) <span class="sc">+</span></span>
<span id="cb480-395"><a href="#cb480-395" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_publication</span>() </span>
<span id="cb480-396"><a href="#cb480-396" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb480-397"><a href="#cb480-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-398"><a href="#cb480-398" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(upperBlank) {</span>
<span id="cb480-399"><a href="#cb480-399" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb480-400"><a href="#cb480-400" aria-hidden="true" tabindex="-1"></a>      d <span class="sc">|&gt;</span> </span>
<span id="cb480-401"><a href="#cb480-401" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(speciesGG, tag, firstObserved, lastObserved)),</span>
<span id="cb480-402"><a href="#cb480-402" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> (firstSamp<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(lastSamp<span class="sc">+</span><span class="dv">1</span>), <span class="co"># +1 to skip cohort column</span></span>
<span id="cb480-403"><a href="#cb480-403" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(lowerFn, <span class="at">method =</span> <span class="st">"lm"</span>)),</span>
<span id="cb480-404"><a href="#cb480-404" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="st">"blank"</span></span>
<span id="cb480-405"><a href="#cb480-405" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb480-406"><a href="#cb480-406" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb480-407"><a href="#cb480-407" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb480-408"><a href="#cb480-408" aria-hidden="true" tabindex="-1"></a>      d <span class="sc">|&gt;</span> </span>
<span id="cb480-409"><a href="#cb480-409" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(speciesGG, tag, firstObserved, lastObserved)),</span>
<span id="cb480-410"><a href="#cb480-410" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> (firstSamp<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(lastSamp<span class="sc">+</span><span class="dv">1</span>), <span class="co"># +1 to skip cohort column</span></span>
<span id="cb480-411"><a href="#cb480-411" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(lowerFn, <span class="at">method =</span> <span class="st">"lm"</span>))</span>
<span id="cb480-412"><a href="#cb480-412" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-413"><a href="#cb480-413" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb480-414"><a href="#cb480-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb480-415"><a href="#cb480-415" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-416"><a href="#cb480-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-417"><a href="#cb480-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-418"><a href="#cb480-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-419"><a href="#cb480-419" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-420"><a href="#cb480-420" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout</span></span>
<span id="cb480-421"><a href="#cb480-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-424"><a href="#cb480-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-425"><a href="#cb480-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt</span></span>
<span id="cb480-426"><a href="#cb480-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-427"><a href="#cb480-427" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2000</span><span class="sc">:</span><span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">9</span>)</span>
<span id="cb480-428"><a href="#cb480-428" aria-hidden="true" tabindex="-1"></a><span class="co">#plotPairs(cd1Wide_observedWeight, "Brook trout", 2000:2015)</span></span>
<span id="cb480-429"><a href="#cb480-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-430"><a href="#cb480-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-431"><a href="#cb480-431" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-432"><a href="#cb480-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-435"><a href="#cb480-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-436"><a href="#cb480-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bnt</span></span>
<span id="cb480-437"><a href="#cb480-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-438"><a href="#cb480-438" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brown trout"</span>, <span class="dv">2000</span><span class="sc">:</span><span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">9</span>)</span>
<span id="cb480-439"><a href="#cb480-439" aria-hidden="true" tabindex="-1"></a><span class="co">#plotPairs(cd1Wide_observedWeight, "Brook trout", 2000:2015)</span></span>
<span id="cb480-440"><a href="#cb480-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-441"><a href="#cb480-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-442"><a href="#cb480-442" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-443"><a href="#cb480-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-446"><a href="#cb480-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-447"><a href="#cb480-447" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_ats</span></span>
<span id="cb480-448"><a href="#cb480-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-449"><a href="#cb480-449" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span><span class="sc">:</span><span class="dv">2015</span>, <span class="dv">1</span>, <span class="dv">8</span>) <span class="co"># missing data in column 9</span></span>
<span id="cb480-450"><a href="#cb480-450" aria-hidden="true" tabindex="-1"></a><span class="co">#plotPairs(cd1Wide_observedWeight, "Atlantic salmon", 2000:2015)</span></span>
<span id="cb480-451"><a href="#cb480-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-452"><a href="#cb480-452" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-453"><a href="#cb480-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-454"><a href="#cb480-454" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout by cohort</span></span>
<span id="cb480-455"><a href="#cb480-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-456"><a href="#cb480-456" aria-hidden="true" tabindex="-1"></a>Row and column labels are 'age'<span class="sc">\_</span>'season'\</span>
<span id="cb480-457"><a href="#cb480-457" aria-hidden="true" tabindex="-1"></a>Color by river - make new function</span>
<span id="cb480-458"><a href="#cb480-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-459"><a href="#cb480-459" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-460"><a href="#cb480-460" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2000</span></span>
<span id="cb480-461"><a href="#cb480-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-464"><a href="#cb480-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-465"><a href="#cb480-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2000</span></span>
<span id="cb480-466"><a href="#cb480-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-467"><a href="#cb480-467" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-468"><a href="#cb480-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-469"><a href="#cb480-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-470"><a href="#cb480-470" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2001</span></span>
<span id="cb480-471"><a href="#cb480-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-474"><a href="#cb480-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-475"><a href="#cb480-475" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2001</span></span>
<span id="cb480-476"><a href="#cb480-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-477"><a href="#cb480-477" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2001</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-478"><a href="#cb480-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-479"><a href="#cb480-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-480"><a href="#cb480-480" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2002</span></span>
<span id="cb480-481"><a href="#cb480-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-484"><a href="#cb480-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-485"><a href="#cb480-485" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2002</span></span>
<span id="cb480-486"><a href="#cb480-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-487"><a href="#cb480-487" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2002</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-488"><a href="#cb480-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-489"><a href="#cb480-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-490"><a href="#cb480-490" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2003</span></span>
<span id="cb480-491"><a href="#cb480-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-494"><a href="#cb480-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-495"><a href="#cb480-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2003</span></span>
<span id="cb480-496"><a href="#cb480-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-497"><a href="#cb480-497" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2003</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-498"><a href="#cb480-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-499"><a href="#cb480-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-500"><a href="#cb480-500" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2004</span></span>
<span id="cb480-501"><a href="#cb480-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-504"><a href="#cb480-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-505"><a href="#cb480-505" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2004</span></span>
<span id="cb480-506"><a href="#cb480-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-507"><a href="#cb480-507" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2004</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-508"><a href="#cb480-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-509"><a href="#cb480-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-510"><a href="#cb480-510" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2005</span></span>
<span id="cb480-511"><a href="#cb480-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-514"><a href="#cb480-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-515"><a href="#cb480-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2005</span></span>
<span id="cb480-516"><a href="#cb480-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-517"><a href="#cb480-517" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2005</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-518"><a href="#cb480-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-519"><a href="#cb480-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-520"><a href="#cb480-520" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2006</span></span>
<span id="cb480-521"><a href="#cb480-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-524"><a href="#cb480-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-525"><a href="#cb480-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2006</span></span>
<span id="cb480-526"><a href="#cb480-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-527"><a href="#cb480-527" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2006</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-528"><a href="#cb480-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-529"><a href="#cb480-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-530"><a href="#cb480-530" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2007</span></span>
<span id="cb480-531"><a href="#cb480-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-534"><a href="#cb480-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-535"><a href="#cb480-535" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2007</span></span>
<span id="cb480-536"><a href="#cb480-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-537"><a href="#cb480-537" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2007</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-538"><a href="#cb480-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-539"><a href="#cb480-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-540"><a href="#cb480-540" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2008</span></span>
<span id="cb480-541"><a href="#cb480-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-544"><a href="#cb480-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-545"><a href="#cb480-545" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2008</span></span>
<span id="cb480-546"><a href="#cb480-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-547"><a href="#cb480-547" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2008</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-548"><a href="#cb480-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-549"><a href="#cb480-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-550"><a href="#cb480-550" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2009</span></span>
<span id="cb480-551"><a href="#cb480-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-554"><a href="#cb480-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-555"><a href="#cb480-555" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2009</span></span>
<span id="cb480-556"><a href="#cb480-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-557"><a href="#cb480-557" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2009</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-558"><a href="#cb480-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-559"><a href="#cb480-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-560"><a href="#cb480-560" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2010</span></span>
<span id="cb480-561"><a href="#cb480-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-564"><a href="#cb480-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-565"><a href="#cb480-565" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2010</span></span>
<span id="cb480-566"><a href="#cb480-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-567"><a href="#cb480-567" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2010</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-568"><a href="#cb480-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-569"><a href="#cb480-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-570"><a href="#cb480-570" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2011</span></span>
<span id="cb480-571"><a href="#cb480-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-574"><a href="#cb480-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-575"><a href="#cb480-575" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2011</span></span>
<span id="cb480-576"><a href="#cb480-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-577"><a href="#cb480-577" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-578"><a href="#cb480-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-579"><a href="#cb480-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-580"><a href="#cb480-580" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2012</span></span>
<span id="cb480-581"><a href="#cb480-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-584"><a href="#cb480-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-585"><a href="#cb480-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2012</span></span>
<span id="cb480-586"><a href="#cb480-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-587"><a href="#cb480-587" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2012</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-588"><a href="#cb480-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-589"><a href="#cb480-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-590"><a href="#cb480-590" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2013</span></span>
<span id="cb480-591"><a href="#cb480-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-594"><a href="#cb480-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-595"><a href="#cb480-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2013</span></span>
<span id="cb480-596"><a href="#cb480-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-597"><a href="#cb480-597" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2013</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-598"><a href="#cb480-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-599"><a href="#cb480-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-600"><a href="#cb480-600" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2014</span></span>
<span id="cb480-601"><a href="#cb480-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-604"><a href="#cb480-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-605"><a href="#cb480-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairs_bkt2014</span></span>
<span id="cb480-606"><a href="#cb480-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-607"><a href="#cb480-607" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPairs</span>(cd1Wide_grWeight, <span class="st">"Brook trout"</span>, <span class="dv">2014</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="at">upperBlank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-608"><a href="#cb480-608" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-609"><a href="#cb480-609" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-610"><a href="#cb480-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-611"><a href="#cb480-611" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Consecutive season growth comparisons by age_season</span></span>
<span id="cb480-612"><a href="#cb480-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-613"><a href="#cb480-613" aria-hidden="true" tabindex="-1"></a>Brook trout</span>
<span id="cb480-614"><a href="#cb480-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-617"><a href="#cb480-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-618"><a href="#cb480-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pairsByAgeSeason</span></span>
<span id="cb480-619"><a href="#cb480-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-620"><a href="#cb480-620" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2014</span>, <span class="st">`</span><span class="at">0_4</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="fl">0.01</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">0_3</span><span class="st">`</span>, <span class="st">`</span><span class="at">0_4</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb480-621"><a href="#cb480-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-622"><a href="#cb480-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-623"><a href="#cb480-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-624"><a href="#cb480-624" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(intercept = 0, slope = 1) +</span></span>
<span id="cb480-625"><a href="#cb480-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'#45454d'</span>) <span class="sc">+</span></span>
<span id="cb480-626"><a href="#cb480-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-627"><a href="#cb480-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-628"><a href="#cb480-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span>
<span id="cb480-629"><a href="#cb480-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-630"><a href="#cb480-630" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2014</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">0_4</span><span class="st">`</span>, <span class="st">`</span><span class="at">1_1</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb480-631"><a href="#cb480-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-632"><a href="#cb480-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-633"><a href="#cb480-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-634"><a href="#cb480-634" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(intercept = 0, slope = 1) +</span></span>
<span id="cb480-635"><a href="#cb480-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'#45454d'</span>) <span class="sc">+</span></span>
<span id="cb480-636"><a href="#cb480-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-637"><a href="#cb480-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-638"><a href="#cb480-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span>
<span id="cb480-639"><a href="#cb480-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-640"><a href="#cb480-640" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2014</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">1_1</span><span class="st">`</span>, <span class="st">`</span><span class="at">1_2</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb480-641"><a href="#cb480-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-642"><a href="#cb480-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-643"><a href="#cb480-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-644"><a href="#cb480-644" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(intercept = 0, slope = 1) +</span></span>
<span id="cb480-645"><a href="#cb480-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-646"><a href="#cb480-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-647"><a href="#cb480-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-648"><a href="#cb480-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span>
<span id="cb480-649"><a href="#cb480-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-650"><a href="#cb480-650" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2014</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">1_2</span><span class="st">`</span>, <span class="st">`</span><span class="at">1_3</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb480-651"><a href="#cb480-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-652"><a href="#cb480-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-653"><a href="#cb480-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-654"><a href="#cb480-654" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(intercept = 0, slope = 1) +</span></span>
<span id="cb480-655"><a href="#cb480-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'#45454d'</span>) <span class="sc">+</span></span>
<span id="cb480-656"><a href="#cb480-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-657"><a href="#cb480-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-658"><a href="#cb480-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span>
<span id="cb480-659"><a href="#cb480-659" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb480-660"><a href="#cb480-660" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1Wide_grWeight <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2012</span>), <span class="fu">aes</span>(<span class="st">`</span><span class="at">1_1</span><span class="st">`</span>, <span class="st">`</span><span class="at">2_1</span><span class="st">`</span>, <span class="at">color =</span> <span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb480-661"><a href="#cb480-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-662"><a href="#cb480-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-663"><a href="#cb480-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-664"><a href="#cb480-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb480-665"><a href="#cb480-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'#45454d'</span>) <span class="sc">+</span></span>
<span id="cb480-666"><a href="#cb480-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-667"><a href="#cb480-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-668"><a href="#cb480-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span>
<span id="cb480-669"><a href="#cb480-669" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb480-670"><a href="#cb480-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-671"><a href="#cb480-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-672"><a href="#cb480-672" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth rate in length vs growth rate in mass</span></span>
<span id="cb480-673"><a href="#cb480-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-676"><a href="#cb480-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-677"><a href="#cb480-677" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grLen_v_grWeight</span></span>
<span id="cb480-678"><a href="#cb480-678" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grLength, grWeight)) <span class="sc">+</span></span>
<span id="cb480-679"><a href="#cb480-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> observedWeight), <span class="at">alpha =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb480-680"><a href="#cb480-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb480-681"><a href="#cb480-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in length"</span>, <span class="at">y =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-682"><a href="#cb480-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-683"><a href="#cb480-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-684"><a href="#cb480-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-685"><a href="#cb480-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-686"><a href="#cb480-686" aria-hidden="true" tabindex="-1"></a>plotGrLenMass <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s){</span>
<span id="cb480-687"><a href="#cb480-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(species<span class="sc">==</span>s), <span class="fu">aes</span>(grLength, grWeight, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb480-688"><a href="#cb480-688" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb480-689"><a href="#cb480-689" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-690"><a href="#cb480-690" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb480-691"><a href="#cb480-691" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in length"</span>, <span class="at">y =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-692"><a href="#cb480-692" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-693"><a href="#cb480-693" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>(<span class="at">legendPosition =</span> <span class="st">"right"</span>, <span class="at">legendDirection =</span> <span class="st">"vertical"</span>) <span class="sc">+</span></span>
<span id="cb480-694"><a href="#cb480-694" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">'free'</span>)  </span>
<span id="cb480-695"><a href="#cb480-695" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-696"><a href="#cb480-696" aria-hidden="true" tabindex="-1"></a><span class="co">#  facet_wrap(~year)</span></span>
<span id="cb480-697"><a href="#cb480-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-698"><a href="#cb480-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-699"><a href="#cb480-699" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-700"><a href="#cb480-700" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout</span></span>
<span id="cb480-701"><a href="#cb480-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-704"><a href="#cb480-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-705"><a href="#cb480-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grLen_v_grWeight_bkt</span></span>
<span id="cb480-706"><a href="#cb480-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-707"><a href="#cb480-707" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrLenMass</span>(cd1, <span class="st">"bkt"</span>)</span>
<span id="cb480-708"><a href="#cb480-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-709"><a href="#cb480-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-710"><a href="#cb480-710" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-711"><a href="#cb480-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-714"><a href="#cb480-714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-715"><a href="#cb480-715" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grLen_v_grWeight_bnt</span></span>
<span id="cb480-716"><a href="#cb480-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-717"><a href="#cb480-717" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrLenMass</span>(cd1, <span class="st">"bnt"</span>)</span>
<span id="cb480-718"><a href="#cb480-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-719"><a href="#cb480-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-720"><a href="#cb480-720" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-721"><a href="#cb480-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-724"><a href="#cb480-724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-725"><a href="#cb480-725" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grLen_v_grWeight_ats</span></span>
<span id="cb480-726"><a href="#cb480-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-727"><a href="#cb480-727" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrLenMass</span>(cd1, <span class="st">"ats"</span>)</span>
<span id="cb480-728"><a href="#cb480-728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-729"><a href="#cb480-729" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-730"><a href="#cb480-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-731"><a href="#cb480-731" aria-hidden="true" tabindex="-1"></a>No relationship between means of neg and pos growth</span>
<span id="cb480-732"><a href="#cb480-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-735"><a href="#cb480-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-736"><a href="#cb480-736" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: posNegGR</span></span>
<span id="cb480-737"><a href="#cb480-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-738"><a href="#cb480-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-739"><a href="#cb480-739" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meanNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>), <span class="fu">aes</span>(year, meanNegPos, <span class="at">color =</span> negGrowth, <span class="at">group =</span> negGrowth)) <span class="sc">+</span></span>
<span id="cb480-740"><a href="#cb480-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-741"><a href="#cb480-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb480-742"><a href="#cb480-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-743"><a href="#cb480-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-744"><a href="#cb480-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)</span>
<span id="cb480-745"><a href="#cb480-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-746"><a href="#cb480-746" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meanNegSRsNWide, <span class="fu">aes</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb480-747"><a href="#cb480-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-748"><a href="#cb480-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-749"><a href="#cb480-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-750"><a href="#cb480-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)</span>
<span id="cb480-751"><a href="#cb480-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-752"><a href="#cb480-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-753"><a href="#cb480-753" aria-hidden="true" tabindex="-1"></a><span class="fu">## Body size effect on prop neg growth</span></span>
<span id="cb480-756"><a href="#cb480-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-757"><a href="#cb480-757" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propNegSize</span></span>
<span id="cb480-758"><a href="#cb480-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-759"><a href="#cb480-759" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">"bkt"</span>, seasonGG <span class="sc">!=</span> <span class="st">"Spring"</span>), <span class="fu">aes</span>(observedWeight, negGrowth<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-760"><a href="#cb480-760" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb480-761"><a href="#cb480-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-762"><a href="#cb480-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb480-763"><a href="#cb480-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb480-764"><a href="#cb480-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-765"><a href="#cb480-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)</span>
<span id="cb480-766"><a href="#cb480-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-767"><a href="#cb480-767" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>), <span class="fu">aes</span>(observedWeight, negGrowth<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-768"><a href="#cb480-768" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb480-769"><a href="#cb480-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-770"><a href="#cb480-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb480-771"><a href="#cb480-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb480-772"><a href="#cb480-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-773"><a href="#cb480-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-774"><a href="#cb480-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-775"><a href="#cb480-775" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>), <span class="fu">aes</span>(observedWeight, negGrowth<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-776"><a href="#cb480-776" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb480-777"><a href="#cb480-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-778"><a href="#cb480-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-779"><a href="#cb480-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-780"><a href="#cb480-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-781"><a href="#cb480-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)<span class="co">#, scales = "free")</span></span>
<span id="cb480-782"><a href="#cb480-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-783"><a href="#cb480-783" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>), <span class="fu">aes</span>(observedWeight, grWeight<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-784"><a href="#cb480-784" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb480-785"><a href="#cb480-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-786"><a href="#cb480-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-787"><a href="#cb480-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-788"><a href="#cb480-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-789"><a href="#cb480-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)<span class="co">#, scales = "free")</span></span>
<span id="cb480-790"><a href="#cb480-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-791"><a href="#cb480-791" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>), <span class="fu">aes</span>(ageInSamples, grWeight<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-792"><a href="#cb480-792" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb480-793"><a href="#cb480-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-794"><a href="#cb480-794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-795"><a href="#cb480-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-796"><a href="#cb480-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-797"><a href="#cb480-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)<span class="co">#, scales = "free")</span></span>
<span id="cb480-798"><a href="#cb480-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-799"><a href="#cb480-799" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>, ageInSamples <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="fu">aes</span>(ageInSamples, negGrowth<span class="sc">*</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-800"><a href="#cb480-800" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.1, ) +</span></span>
<span id="cb480-801"><a href="#cb480-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.0</span>, <span class="at">height =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-802"><a href="#cb480-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-803"><a href="#cb480-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-804"><a href="#cb480-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-805"><a href="#cb480-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)<span class="co">#, scales = "free")</span></span>
<span id="cb480-806"><a href="#cb480-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-807"><a href="#cb480-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-808"><a href="#cb480-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-809"><a href="#cb480-809" aria-hidden="true" tabindex="-1"></a><span class="fu">## Flow and temperature growth relationships</span></span>
<span id="cb480-810"><a href="#cb480-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-811"><a href="#cb480-811" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean flow effect on growth?</span></span>
<span id="cb480-812"><a href="#cb480-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-815"><a href="#cb480-815" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-816"><a href="#cb480-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_weight</span></span>
<span id="cb480-817"><a href="#cb480-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-818"><a href="#cb480-818" aria-hidden="true" tabindex="-1"></a>plotFlowGR <span class="ot">&lt;-</span> <span class="cf">function</span>(d, r){</span>
<span id="cb480-819"><a href="#cb480-819" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(river <span class="sc">==</span> r), <span class="fu">aes</span>(meanFlowByRiver, grWeight, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb480-820"><a href="#cb480-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.05</span>)  <span class="sc">+</span></span>
<span id="cb480-821"><a href="#cb480-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-822"><a href="#cb480-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-823"><a href="#cb480-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span><span class="cn">FALSE</span>, <span class="at">formula =</span> y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb480-824"><a href="#cb480-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean flow"</span>, <span class="at">y =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-825"><a href="#cb480-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-826"><a href="#cb480-826" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle(r) +</span></span>
<span id="cb480-827"><a href="#cb480-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-828"><a href="#cb480-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)<span class="co">#, scales = 'free')</span></span>
<span id="cb480-829"><a href="#cb480-829" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-830"><a href="#cb480-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-831"><a href="#cb480-831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-832"><a href="#cb480-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-833"><a href="#cb480-833" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-834"><a href="#cb480-834" aria-hidden="true" tabindex="-1"></a><span class="fu">#### West Brook</span></span>
<span id="cb480-835"><a href="#cb480-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-838"><a href="#cb480-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-839"><a href="#cb480-839" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_weight_wb</span></span>
<span id="cb480-840"><a href="#cb480-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-841"><a href="#cb480-841" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFlowGR</span>(cd1, <span class="st">"west brook"</span>)</span>
<span id="cb480-842"><a href="#cb480-842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-843"><a href="#cb480-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-844"><a href="#cb480-844" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Open Large</span></span>
<span id="cb480-845"><a href="#cb480-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-848"><a href="#cb480-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-849"><a href="#cb480-849" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_weight_ol</span></span>
<span id="cb480-850"><a href="#cb480-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-851"><a href="#cb480-851" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFlowGR</span>(cd1, <span class="st">"wb jimmy"</span>)</span>
<span id="cb480-852"><a href="#cb480-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-853"><a href="#cb480-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-854"><a href="#cb480-854" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Open Small</span></span>
<span id="cb480-855"><a href="#cb480-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-858"><a href="#cb480-858" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-859"><a href="#cb480-859" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_weight_os</span></span>
<span id="cb480-860"><a href="#cb480-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-861"><a href="#cb480-861" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFlowGR</span>(cd1, <span class="st">"wb mitchell"</span>)</span>
<span id="cb480-862"><a href="#cb480-862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-863"><a href="#cb480-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-864"><a href="#cb480-864" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Isolated small</span></span>
<span id="cb480-865"><a href="#cb480-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-868"><a href="#cb480-868" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-869"><a href="#cb480-869" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_weight_is</span></span>
<span id="cb480-870"><a href="#cb480-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-871"><a href="#cb480-871" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFlowGR</span>(cd1, <span class="st">"wb obear"</span>)</span>
<span id="cb480-872"><a href="#cb480-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-873"><a href="#cb480-873" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-874"><a href="#cb480-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-875"><a href="#cb480-875" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean temperature effect on growth?</span></span>
<span id="cb480-876"><a href="#cb480-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-877"><a href="#cb480-877" aria-hidden="true" tabindex="-1"></a>Maybe in Jimmy for bnt, or for ats</span>
<span id="cb480-878"><a href="#cb480-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-881"><a href="#cb480-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-882"><a href="#cb480-882" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: temp_grWeight</span></span>
<span id="cb480-883"><a href="#cb480-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-884"><a href="#cb480-884" aria-hidden="true" tabindex="-1"></a>plotTempGR <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s){</span>
<span id="cb480-885"><a href="#cb480-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(seasonGG <span class="sc">==</span> s), <span class="fu">aes</span>(meanTemperature, grWeight, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb480-886"><a href="#cb480-886" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)  <span class="sc">+</span></span>
<span id="cb480-887"><a href="#cb480-887" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-888"><a href="#cb480-888" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-889"><a href="#cb480-889" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span><span class="cn">FALSE</span>, <span class="at">formula =</span> y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>), <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-890"><a href="#cb480-890" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean temperature (c)"</span>, <span class="at">y =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-891"><a href="#cb480-891" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-892"><a href="#cb480-892" aria-hidden="true" tabindex="-1"></a>   <span class="co"># ggtitle(s) +</span></span>
<span id="cb480-893"><a href="#cb480-893" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-894"><a href="#cb480-894" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>riverGG)<span class="co">#, scales = 'free')</span></span>
<span id="cb480-895"><a href="#cb480-895" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-896"><a href="#cb480-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-897"><a href="#cb480-897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-898"><a href="#cb480-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-899"><a href="#cb480-899" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-900"><a href="#cb480-900" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spring</span></span>
<span id="cb480-901"><a href="#cb480-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-904"><a href="#cb480-904" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-905"><a href="#cb480-905" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: temp_grWeight_spring</span></span>
<span id="cb480-906"><a href="#cb480-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-907"><a href="#cb480-907" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTempGR</span>(cd1, <span class="st">"Spring"</span>)</span>
<span id="cb480-908"><a href="#cb480-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-909"><a href="#cb480-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-910"><a href="#cb480-910" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summer</span></span>
<span id="cb480-911"><a href="#cb480-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-914"><a href="#cb480-914" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-915"><a href="#cb480-915" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: temp_grWeight_summer</span></span>
<span id="cb480-916"><a href="#cb480-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-917"><a href="#cb480-917" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTempGR</span>(cd1, <span class="st">"Summer"</span>)</span>
<span id="cb480-918"><a href="#cb480-918" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-919"><a href="#cb480-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-920"><a href="#cb480-920" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Autumn</span></span>
<span id="cb480-921"><a href="#cb480-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-924"><a href="#cb480-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-925"><a href="#cb480-925" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: temp_grWeight_autumn</span></span>
<span id="cb480-926"><a href="#cb480-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-927"><a href="#cb480-927" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTempGR</span>(cd1, <span class="st">"Autumn"</span>)</span>
<span id="cb480-928"><a href="#cb480-928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-929"><a href="#cb480-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-930"><a href="#cb480-930" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Winter</span></span>
<span id="cb480-931"><a href="#cb480-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-934"><a href="#cb480-934" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-935"><a href="#cb480-935" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: temp_grWeight_winter</span></span>
<span id="cb480-936"><a href="#cb480-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-937"><a href="#cb480-937" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTempGR</span>(cd1, <span class="st">"Winter"</span>)</span>
<span id="cb480-938"><a href="#cb480-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-939"><a href="#cb480-939" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-940"><a href="#cb480-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-941"><a href="#cb480-941" aria-hidden="true" tabindex="-1"></a><span class="fu">## Proportion of fish with **negative growth**  </span></span>
<span id="cb480-942"><a href="#cb480-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-943"><a href="#cb480-943" aria-hidden="true" tabindex="-1"></a>Counts/proportions of negative growth  </span>
<span id="cb480-944"><a href="#cb480-944" aria-hidden="true" tabindex="-1"></a>Proportions for Table 1</span>
<span id="cb480-947"><a href="#cb480-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-948"><a href="#cb480-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: neg_posCounts</span></span>
<span id="cb480-949"><a href="#cb480-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-950"><a href="#cb480-950" aria-hidden="true" tabindex="-1"></a><span class="co"># All</span></span>
<span id="cb480-951"><a href="#cb480-951" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-952"><a href="#cb480-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb480-953"><a href="#cb480-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nTotal =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-954"><a href="#cb480-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nTotal, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-955"><a href="#cb480-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-956"><a href="#cb480-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span>nTotal)</span>
<span id="cb480-957"><a href="#cb480-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-958"><a href="#cb480-958" aria-hidden="true" tabindex="-1"></a><span class="co">#by river</span></span>
<span id="cb480-959"><a href="#cb480-959" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-960"><a href="#cb480-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb480-961"><a href="#cb480-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-962"><a href="#cb480-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-963"><a href="#cb480-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-964"><a href="#cb480-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-965"><a href="#cb480-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-966"><a href="#cb480-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-967"><a href="#cb480-967" aria-hidden="true" tabindex="-1"></a><span class="co">#by species</span></span>
<span id="cb480-968"><a href="#cb480-968" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-969"><a href="#cb480-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb480-970"><a href="#cb480-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-971"><a href="#cb480-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-972"><a href="#cb480-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-973"><a href="#cb480-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-974"><a href="#cb480-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-975"><a href="#cb480-975" aria-hidden="true" tabindex="-1"></a><span class="co"># by season</span></span>
<span id="cb480-976"><a href="#cb480-976" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-977"><a href="#cb480-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb480-978"><a href="#cb480-978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-979"><a href="#cb480-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-980"><a href="#cb480-980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-981"><a href="#cb480-981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-982"><a href="#cb480-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-983"><a href="#cb480-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-984"><a href="#cb480-984" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-985"><a href="#cb480-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-986"><a href="#cb480-986" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout</span></span>
<span id="cb480-989"><a href="#cb480-989" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-990"><a href="#cb480-990" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propBKT</span></span>
<span id="cb480-991"><a href="#cb480-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-992"><a href="#cb480-992" aria-hidden="true" tabindex="-1"></a><span class="co"># by season</span></span>
<span id="cb480-993"><a href="#cb480-993" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-994"><a href="#cb480-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bkt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-995"><a href="#cb480-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-996"><a href="#cb480-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-997"><a href="#cb480-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-998"><a href="#cb480-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-999"><a href="#cb480-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1000"><a href="#cb480-1000" aria-hidden="true" tabindex="-1"></a><span class="co"># by river</span></span>
<span id="cb480-1001"><a href="#cb480-1001" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1002"><a href="#cb480-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bkt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1003"><a href="#cb480-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-1004"><a href="#cb480-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-1005"><a href="#cb480-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-1006"><a href="#cb480-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-1007"><a href="#cb480-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1008"><a href="#cb480-1008" aria-hidden="true" tabindex="-1"></a><span class="co"># by season/river</span></span>
<span id="cb480-1009"><a href="#cb480-1009" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1010"><a href="#cb480-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bkt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1011"><a href="#cb480-1011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-1012"><a href="#cb480-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-1013"><a href="#cb480-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-1014"><a href="#cb480-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-1015"><a href="#cb480-1015" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1016"><a href="#cb480-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1017"><a href="#cb480-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-1020"><a href="#cb480-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1021"><a href="#cb480-1021" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propBNT</span></span>
<span id="cb480-1022"><a href="#cb480-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1023"><a href="#cb480-1023" aria-hidden="true" tabindex="-1"></a><span class="co"># by season</span></span>
<span id="cb480-1024"><a href="#cb480-1024" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1025"><a href="#cb480-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bnt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1026"><a href="#cb480-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-1027"><a href="#cb480-1027" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-1028"><a href="#cb480-1028" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-1029"><a href="#cb480-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-1030"><a href="#cb480-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1031"><a href="#cb480-1031" aria-hidden="true" tabindex="-1"></a><span class="co"># by river</span></span>
<span id="cb480-1032"><a href="#cb480-1032" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1033"><a href="#cb480-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bnt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1034"><a href="#cb480-1034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-1035"><a href="#cb480-1035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-1036"><a href="#cb480-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-1037"><a href="#cb480-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-1038"><a href="#cb480-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1039"><a href="#cb480-1039" aria-hidden="true" tabindex="-1"></a><span class="co"># by season/river</span></span>
<span id="cb480-1040"><a href="#cb480-1040" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1041"><a href="#cb480-1041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'bnt'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1042"><a href="#cb480-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-1043"><a href="#cb480-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-1044"><a href="#cb480-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-1045"><a href="#cb480-1045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-1046"><a href="#cb480-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1047"><a href="#cb480-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1048"><a href="#cb480-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-1051"><a href="#cb480-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1052"><a href="#cb480-1052" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propATS</span></span>
<span id="cb480-1053"><a href="#cb480-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1054"><a href="#cb480-1054" aria-hidden="true" tabindex="-1"></a><span class="co"># by season</span></span>
<span id="cb480-1055"><a href="#cb480-1055" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1056"><a href="#cb480-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'ats'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1057"><a href="#cb480-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-1058"><a href="#cb480-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-1059"><a href="#cb480-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-1060"><a href="#cb480-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-1061"><a href="#cb480-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1062"><a href="#cb480-1062" aria-hidden="true" tabindex="-1"></a><span class="co"># by river</span></span>
<span id="cb480-1063"><a href="#cb480-1063" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1064"><a href="#cb480-1064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'ats'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1065"><a href="#cb480-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-1066"><a href="#cb480-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-1067"><a href="#cb480-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-1068"><a href="#cb480-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-1069"><a href="#cb480-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1070"><a href="#cb480-1070" aria-hidden="true" tabindex="-1"></a><span class="co"># by season/river</span></span>
<span id="cb480-1071"><a href="#cb480-1071" aria-hidden="true" tabindex="-1"></a>cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1072"><a href="#cb480-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), species <span class="sc">==</span> <span class="st">'ats'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1073"><a href="#cb480-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, riverGG, negGrowth) <span class="sc">|&gt;</span> </span>
<span id="cb480-1074"><a href="#cb480-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb480-1075"><a href="#cb480-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> negGrowth, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb480-1076"><a href="#cb480-1076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>))</span>
<span id="cb480-1077"><a href="#cb480-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1078"><a href="#cb480-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1079"><a href="#cb480-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1080"><a href="#cb480-1080" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion of observations with negative growth by species/river/season</span></span>
<span id="cb480-1081"><a href="#cb480-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1084"><a href="#cb480-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1085"><a href="#cb480-1085" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: neg_pos</span></span>
<span id="cb480-1086"><a href="#cb480-1086" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(negGrowth)) <span class="sc">+</span></span>
<span id="cb480-1087"><a href="#cb480-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb480-1088"><a href="#cb480-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1089"><a href="#cb480-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG<span class="sc">+</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-1090"><a href="#cb480-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1091"><a href="#cb480-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1092"><a href="#cb480-1092" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion of observations with negative growth by species/season</span></span>
<span id="cb480-1093"><a href="#cb480-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1096"><a href="#cb480-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1097"><a href="#cb480-1097" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propNegBySeason</span></span>
<span id="cb480-1098"><a href="#cb480-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1099"><a href="#cb480-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRS <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">50</span>), <span class="fu">aes</span>(seasonGG, propNeg, <span class="at">color =</span> riverGG, <span class="at">group =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1100"><a href="#cb480-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1101"><a href="#cb480-1101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb480-1102"><a href="#cb480-1102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Season"</span>, <span class="at">y =</span> <span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1103"><a href="#cb480-1103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1104"><a href="#cb480-1104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1105"><a href="#cb480-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">360-45</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb480-1106"><a href="#cb480-1106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1107"><a href="#cb480-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1108"><a href="#cb480-1108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1109"><a href="#cb480-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1110"><a href="#cb480-1110" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion of observations with negative growth by species/river/year</span></span>
<span id="cb480-1111"><a href="#cb480-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1114"><a href="#cb480-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1115"><a href="#cb480-1115" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propNegWB_BKT</span></span>
<span id="cb480-1116"><a href="#cb480-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1117"><a href="#cb480-1117" aria-hidden="true" tabindex="-1"></a>plotPropNegByRiver <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp){</span>
<span id="cb480-1118"><a href="#cb480-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">20</span>,  speciesGG <span class="sc">==</span> spp), </span>
<span id="cb480-1119"><a href="#cb480-1119" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(year, propNeg, <span class="at">color =</span> <span class="fu">factor</span>(seasonGG))) <span class="sc">+</span></span>
<span id="cb480-1120"><a href="#cb480-1120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1121"><a href="#cb480-1121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb480-1122"><a href="#cb480-1122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Proportion of opnservations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1123"><a href="#cb480-1123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1124"><a href="#cb480-1124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1125"><a href="#cb480-1125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverGG)</span>
<span id="cb480-1126"><a href="#cb480-1126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-1127"><a href="#cb480-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1128"><a href="#cb480-1128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1129"><a href="#cb480-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1130"><a href="#cb480-1130" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-1131"><a href="#cb480-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout</span></span>
<span id="cb480-1132"><a href="#cb480-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1135"><a href="#cb480-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1136"><a href="#cb480-1136" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propNegWB_BKT_bkt</span></span>
<span id="cb480-1137"><a href="#cb480-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1138"><a href="#cb480-1138" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPropNegByRiver</span>(propNegSRsN, <span class="st">"Brook trout"</span>)</span>
<span id="cb480-1139"><a href="#cb480-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1140"><a href="#cb480-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1141"><a href="#cb480-1141" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-1142"><a href="#cb480-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1145"><a href="#cb480-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1146"><a href="#cb480-1146" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propNegWB_BKT_bnt</span></span>
<span id="cb480-1147"><a href="#cb480-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1148"><a href="#cb480-1148" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPropNegByRiver</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(riverGG <span class="sc">!=</span> <span class="st">"Open Small"</span>), <span class="st">"Brown trout"</span>)</span>
<span id="cb480-1149"><a href="#cb480-1149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1150"><a href="#cb480-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1151"><a href="#cb480-1151" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-1152"><a href="#cb480-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1155"><a href="#cb480-1155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1156"><a href="#cb480-1156" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propNegWB_BKT_ats</span></span>
<span id="cb480-1157"><a href="#cb480-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1158"><a href="#cb480-1158" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPropNegByRiver</span>(propNegSRsN, <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb480-1159"><a href="#cb480-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1160"><a href="#cb480-1160" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-1161"><a href="#cb480-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1162"><a href="#cb480-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion of observations with negative growth by species/river/year</span></span>
<span id="cb480-1163"><a href="#cb480-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1164"><a href="#cb480-1164" aria-hidden="true" tabindex="-1"></a>Break down season by year, compare across rivers</span>
<span id="cb480-1165"><a href="#cb480-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1168"><a href="#cb480-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1169"><a href="#cb480-1169" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: neg_posN</span></span>
<span id="cb480-1170"><a href="#cb480-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1171"><a href="#cb480-1171" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>), <span class="fu">aes</span>(year, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1172"><a href="#cb480-1172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1173"><a href="#cb480-1173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb480-1174"><a href="#cb480-1174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1175"><a href="#cb480-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1176"><a href="#cb480-1176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1177"><a href="#cb480-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1178"><a href="#cb480-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1179"><a href="#cb480-1179" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">15</span>, seasonGG <span class="sc">==</span> <span class="st">"Summer"</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>), <span class="fu">aes</span>(year, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1180"><a href="#cb480-1180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1181"><a href="#cb480-1181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb480-1182"><a href="#cb480-1182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1183"><a href="#cb480-1183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1184"><a href="#cb480-1184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>()</span>
<span id="cb480-1185"><a href="#cb480-1185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1186"><a href="#cb480-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1187"><a href="#cb480-1187" aria-hidden="true" tabindex="-1"></a><span class="fu">## Negative growth by individual</span></span>
<span id="cb480-1188"><a href="#cb480-1188" aria-hidden="true" tabindex="-1"></a>Plot growth negative/positive for individual fish that lost mass. Order the individuals on the y-axis by proportion of observations that were negative.</span>
<span id="cb480-1191"><a href="#cb480-1191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1192"><a href="#cb480-1192" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plotNegGrInd</span></span>
<span id="cb480-1193"><a href="#cb480-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1194"><a href="#cb480-1194" aria-hidden="true" tabindex="-1"></a>plotIndNegGrowth <span class="ot">&lt;-</span> <span class="cf">function</span>(sppIn){</span>
<span id="cb480-1195"><a href="#cb480-1195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb480-1196"><a href="#cb480-1196" aria-hidden="true" tabindex="-1"></a>    cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-1197"><a href="#cb480-1197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb480-1198"><a href="#cb480-1198" aria-hidden="true" tabindex="-1"></a>        species <span class="sc">==</span> sppIn, </span>
<span id="cb480-1199"><a href="#cb480-1199" aria-hidden="true" tabindex="-1"></a>        cohort <span class="sc">&gt;=</span> <span class="dv">2000</span>, cohort <span class="sc">&lt;=</span> <span class="dv">2013</span>, </span>
<span id="cb480-1200"><a href="#cb480-1200" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.na</span>(negGrowth), </span>
<span id="cb480-1201"><a href="#cb480-1201" aria-hidden="true" tabindex="-1"></a>        ageInSamples <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb480-1202"><a href="#cb480-1202" aria-hidden="true" tabindex="-1"></a>        propNegGrowthByInd <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb480-1203"><a href="#cb480-1203" aria-hidden="true" tabindex="-1"></a>        ageInSamples <span class="sc">&lt;</span> <span class="dv">12</span></span>
<span id="cb480-1204"><a href="#cb480-1204" aria-hidden="true" tabindex="-1"></a>        ), </span>
<span id="cb480-1205"><a href="#cb480-1205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(ageInSamples, <span class="fu">reorder</span>(tag, propNegGrowthByInd))</span>
<span id="cb480-1206"><a href="#cb480-1206" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb480-1207"><a href="#cb480-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb480-1208"><a href="#cb480-1208" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> negGrowth)<span class="co">#, colour = "grey50", linewidth = 0.2</span></span>
<span id="cb480-1209"><a href="#cb480-1209" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb480-1210"><a href="#cb480-1210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="st">"Individual fish"</span>) <span class="sc">+</span></span>
<span id="cb480-1211"><a href="#cb480-1211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb480-1212"><a href="#cb480-1212" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Season and age"</span>,</span>
<span id="cb480-1213"><a href="#cb480-1213" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>),</span>
<span id="cb480-1214"><a href="#cb480-1214" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"F0"</span>, <span class="st">"W0"</span>, <span class="st">"S1"</span>, <span class="st">"S1"</span>, <span class="st">"F1"</span>, <span class="st">"W1"</span>, <span class="st">"S2"</span>, <span class="st">"S2"</span>,<span class="st">"F2"</span>, <span class="st">"W2"</span>, <span class="st">"S3"</span>, <span class="st">"S3"</span>,<span class="st">"F3"</span>, <span class="st">"W3"</span>, <span class="st">"S4"</span>)) <span class="sc">+</span></span>
<span id="cb480-1215"><a href="#cb480-1215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E66100"</span>, <span class="st">"#5D3A9B"</span>)) <span class="sc">+</span></span>
<span id="cb480-1216"><a href="#cb480-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb480-1217"><a href="#cb480-1217" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb480-1218"><a href="#cb480-1218" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>()</span>
<span id="cb480-1219"><a href="#cb480-1219" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb480-1220"><a href="#cb480-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-1221"><a href="#cb480-1221" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-1222"><a href="#cb480-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1223"><a href="#cb480-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1224"><a href="#cb480-1224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1225"><a href="#cb480-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1226"><a href="#cb480-1226" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-1227"><a href="#cb480-1227" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout</span></span>
<span id="cb480-1228"><a href="#cb480-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1231"><a href="#cb480-1231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1232"><a href="#cb480-1232" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propIndNegWB_bkt</span></span>
<span id="cb480-1233"><a href="#cb480-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1234"><a href="#cb480-1234" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndNegGrowth</span>(<span class="st">"bkt"</span>)</span>
<span id="cb480-1235"><a href="#cb480-1235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1236"><a href="#cb480-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1237"><a href="#cb480-1237" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-1238"><a href="#cb480-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1241"><a href="#cb480-1241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1242"><a href="#cb480-1242" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propIndNegWB_bnt</span></span>
<span id="cb480-1243"><a href="#cb480-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1244"><a href="#cb480-1244" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndNegGrowth</span>(<span class="st">"bnt"</span>)</span>
<span id="cb480-1245"><a href="#cb480-1245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1246"><a href="#cb480-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1247"><a href="#cb480-1247" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-1248"><a href="#cb480-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1251"><a href="#cb480-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1252"><a href="#cb480-1252" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propIndNegWB_ats</span></span>
<span id="cb480-1253"><a href="#cb480-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1254"><a href="#cb480-1254" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndNegGrowth</span>(<span class="st">"ats"</span>)</span>
<span id="cb480-1255"><a href="#cb480-1255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1256"><a href="#cb480-1256" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-1257"><a href="#cb480-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1258"><a href="#cb480-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1259"><a href="#cb480-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1260"><a href="#cb480-1260" aria-hidden="true" tabindex="-1"></a><span class="fu">## Environmental effects on Proportion of observations with negative growth</span></span>
<span id="cb480-1261"><a href="#cb480-1261" aria-hidden="true" tabindex="-1"></a><span class="fu">### Models for proportions  </span></span>
<span id="cb480-1262"><a href="#cb480-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brool trout</span></span>
<span id="cb480-1263"><a href="#cb480-1263" aria-hidden="true" tabindex="-1"></a>Probably delete this section</span>
<span id="cb480-1266"><a href="#cb480-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1267"><a href="#cb480-1267" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propModBKT</span></span>
<span id="cb480-1268"><a href="#cb480-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1269"><a href="#cb480-1269" aria-hidden="true" tabindex="-1"></a>propModBKT1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10 <span class="sc">+</span> nInd <span class="sc">+</span> seasonGG <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1270"><a href="#cb480-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1271"><a href="#cb480-1271" aria-hidden="true" tabindex="-1"></a>propModBKT2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10 <span class="sc">+</span> nInd <span class="sc">+</span> seasonGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1272"><a href="#cb480-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1273"><a href="#cb480-1273" aria-hidden="true" tabindex="-1"></a>propModBKT3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10 <span class="sc">+</span> nInd )<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1274"><a href="#cb480-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1275"><a href="#cb480-1275" aria-hidden="true" tabindex="-1"></a>propModBKT4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10  <span class="sc">+</span> seasonGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1276"><a href="#cb480-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1277"><a href="#cb480-1277" aria-hidden="true" tabindex="-1"></a>propModBKT5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT  <span class="sc">+</span> nInd <span class="sc">+</span> seasonGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1278"><a href="#cb480-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1279"><a href="#cb480-1279" aria-hidden="true" tabindex="-1"></a>propModBKT6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10 <span class="sc">+</span> nInd )<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1280"><a href="#cb480-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1281"><a href="#cb480-1281" aria-hidden="true" tabindex="-1"></a>propModBKT7 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> mF_log10  <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1282"><a href="#cb480-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1283"><a href="#cb480-1283" aria-hidden="true" tabindex="-1"></a>propModBKT8 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT <span class="sc">+</span> seasonGG <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1284"><a href="#cb480-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1285"><a href="#cb480-1285" aria-hidden="true" tabindex="-1"></a>propModBKT9 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (nInd <span class="sc">+</span> seasonGG <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1286"><a href="#cb480-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1287"><a href="#cb480-1287" aria-hidden="true" tabindex="-1"></a>propModBKT10 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mF_log10 <span class="sc">+</span> seasonGG <span class="sc">+</span> riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1288"><a href="#cb480-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1289"><a href="#cb480-1289" aria-hidden="true" tabindex="-1"></a>propModBKT11 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (riverGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1290"><a href="#cb480-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1291"><a href="#cb480-1291" aria-hidden="true" tabindex="-1"></a>propModBKT12<span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (seasonGG)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1292"><a href="#cb480-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1293"><a href="#cb480-1293" aria-hidden="true" tabindex="-1"></a>propModBKT13 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (nInd)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1294"><a href="#cb480-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1295"><a href="#cb480-1295" aria-hidden="true" tabindex="-1"></a>propModBKT14 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mF_log10)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1296"><a href="#cb480-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1297"><a href="#cb480-1297" aria-hidden="true" tabindex="-1"></a>propModBKT15 <span class="ot">&lt;-</span> <span class="fu">lm</span>(propNeg <span class="sc">~</span> (mT)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>))</span>
<span id="cb480-1298"><a href="#cb480-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1299"><a href="#cb480-1299" aria-hidden="true" tabindex="-1"></a>propModAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(propModBKT1, propModBKT2, propModBKT3, propModBKT4, propModBKT5, propModBKT6, propModBKT7, propModBKT8, propModBKT9, propModBKT10, propModBKT11, propModBKT12, propModBKT13, propModBKT14, propModBKT15) <span class="sc">|&gt;</span>  <span class="fu">arrange</span>(AIC)</span>
<span id="cb480-1300"><a href="#cb480-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1301"><a href="#cb480-1301" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rownames</span>(propModAIC)[<span class="dv">1</span>])</span>
<span id="cb480-1302"><a href="#cb480-1302" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="fu">rownames</span>(propModAIC)[<span class="dv">1</span>])</span>
<span id="cb480-1303"><a href="#cb480-1303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1304"><a href="#cb480-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1305"><a href="#cb480-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1306"><a href="#cb480-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1307"><a href="#cb480-1307" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion of observations with negative growth by **flow**</span></span>
<span id="cb480-1308"><a href="#cb480-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1311"><a href="#cb480-1311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1312"><a href="#cb480-1312" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_flow</span></span>
<span id="cb480-1313"><a href="#cb480-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1314"><a href="#cb480-1314" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(mF, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1315"><a href="#cb480-1315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1316"><a href="#cb480-1316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1317"><a href="#cb480-1317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1318"><a href="#cb480-1318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="fu">bquote</span>(<span class="st">"Mean flow "</span> <span class="sc">~</span> (m<span class="sc">^</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"·"</span> <span class="sc">~</span> s<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}))) <span class="sc">+</span> <span class="co">#alt-250 for dot +</span></span>
<span id="cb480-1319"><a href="#cb480-1319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1320"><a href="#cb480-1320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"West Brook"</span>) <span class="sc">+</span></span>
<span id="cb480-1321"><a href="#cb480-1321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1322"><a href="#cb480-1322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1323"><a href="#cb480-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1324"><a href="#cb480-1324" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">!=</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(mF, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1325"><a href="#cb480-1325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1326"><a href="#cb480-1326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1327"><a href="#cb480-1327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1328"><a href="#cb480-1328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="fu">bquote</span>(<span class="st">"Mean flow "</span> <span class="sc">~</span> (m<span class="sc">^</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"·"</span> <span class="sc">~</span> s<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}))) <span class="sc">+</span> <span class="co">#alt-250 for dot</span></span>
<span id="cb480-1329"><a href="#cb480-1329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1330"><a href="#cb480-1330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tributaries"</span>) <span class="sc">+</span></span>
<span id="cb480-1331"><a href="#cb480-1331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1332"><a href="#cb480-1332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1333"><a href="#cb480-1333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1334"><a href="#cb480-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1335"><a href="#cb480-1335" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion of observations with negative growth by **temperature**</span></span>
<span id="cb480-1336"><a href="#cb480-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1339"><a href="#cb480-1339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1340"><a href="#cb480-1340" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_temp</span></span>
<span id="cb480-1341"><a href="#cb480-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1342"><a href="#cb480-1342" aria-hidden="true" tabindex="-1"></a>plotNegGrowth_temp <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s){</span>
<span id="cb480-1343"><a href="#cb480-1343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, seasonGG <span class="sc">==</span> s), <span class="fu">aes</span>(mT, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1344"><a href="#cb480-1344" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1345"><a href="#cb480-1345" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1346"><a href="#cb480-1346" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1347"><a href="#cb480-1347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Mean temperature (C)"</span>) <span class="sc">+</span></span>
<span id="cb480-1348"><a href="#cb480-1348" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1349"><a href="#cb480-1349" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(s) <span class="sc">+</span></span>
<span id="cb480-1350"><a href="#cb480-1350" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1351"><a href="#cb480-1351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1352"><a href="#cb480-1352" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-1353"><a href="#cb480-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1354"><a href="#cb480-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1355"><a href="#cb480-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1356"><a href="#cb480-1356" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-1357"><a href="#cb480-1357" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spring</span></span>
<span id="cb480-1358"><a href="#cb480-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1361"><a href="#cb480-1361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1362"><a href="#cb480-1362" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_tempSPring</span></span>
<span id="cb480-1363"><a href="#cb480-1363" aria-hidden="true" tabindex="-1"></a><span class="fu">plotNegGrowth_temp</span>(propNegSRsN, <span class="st">"Spring"</span>)</span>
<span id="cb480-1364"><a href="#cb480-1364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1365"><a href="#cb480-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1366"><a href="#cb480-1366" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summer</span></span>
<span id="cb480-1367"><a href="#cb480-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1370"><a href="#cb480-1370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1371"><a href="#cb480-1371" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_tempSummer</span></span>
<span id="cb480-1372"><a href="#cb480-1372" aria-hidden="true" tabindex="-1"></a><span class="fu">plotNegGrowth_temp</span>(propNegSRsN, <span class="st">"Summer"</span>)</span>
<span id="cb480-1373"><a href="#cb480-1373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1374"><a href="#cb480-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1375"><a href="#cb480-1375" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Autumn</span></span>
<span id="cb480-1376"><a href="#cb480-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1379"><a href="#cb480-1379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1380"><a href="#cb480-1380" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_tempAutumn</span></span>
<span id="cb480-1381"><a href="#cb480-1381" aria-hidden="true" tabindex="-1"></a><span class="fu">plotNegGrowth_temp</span>(propNegSRsN, <span class="st">"Autumn"</span>)</span>
<span id="cb480-1382"><a href="#cb480-1382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1383"><a href="#cb480-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1384"><a href="#cb480-1384" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Winter</span></span>
<span id="cb480-1385"><a href="#cb480-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1388"><a href="#cb480-1388" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1389"><a href="#cb480-1389" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_tempWinter</span></span>
<span id="cb480-1390"><a href="#cb480-1390" aria-hidden="true" tabindex="-1"></a><span class="fu">plotNegGrowth_temp</span>(propNegSRsN, <span class="st">"Winter"</span>)</span>
<span id="cb480-1391"><a href="#cb480-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1392"><a href="#cb480-1392" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-1393"><a href="#cb480-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1394"><a href="#cb480-1394" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion of observations with negative growth by **3 species fish counts**</span></span>
<span id="cb480-1395"><a href="#cb480-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1398"><a href="#cb480-1398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1399"><a href="#cb480-1399" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_counts3Spp</span></span>
<span id="cb480-1400"><a href="#cb480-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1401"><a href="#cb480-1401" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(nInd, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1402"><a href="#cb480-1402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1403"><a href="#cb480-1403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1404"><a href="#cb480-1404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1405"><a href="#cb480-1405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"3 species count"</span>) <span class="sc">+</span></span>
<span id="cb480-1406"><a href="#cb480-1406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1407"><a href="#cb480-1407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"West Brook"</span>) <span class="sc">+</span></span>
<span id="cb480-1408"><a href="#cb480-1408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1409"><a href="#cb480-1409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1410"><a href="#cb480-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1411"><a href="#cb480-1411" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">!=</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(nInd, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1412"><a href="#cb480-1412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1413"><a href="#cb480-1413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1414"><a href="#cb480-1414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1415"><a href="#cb480-1415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"3 species count"</span>) <span class="sc">+</span></span>
<span id="cb480-1416"><a href="#cb480-1416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1417"><a href="#cb480-1417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tributaries"</span>) <span class="sc">+</span></span>
<span id="cb480-1418"><a href="#cb480-1418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1419"><a href="#cb480-1419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1420"><a href="#cb480-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1421"><a href="#cb480-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1422"><a href="#cb480-1422" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion of observations with negative growth by **conspecific fish counts**</span></span>
<span id="cb480-1423"><a href="#cb480-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1426"><a href="#cb480-1426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1427"><a href="#cb480-1427" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_counts1Spp</span></span>
<span id="cb480-1428"><a href="#cb480-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1429"><a href="#cb480-1429" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(nIndBySpp, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1430"><a href="#cb480-1430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1431"><a href="#cb480-1431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1432"><a href="#cb480-1432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1433"><a href="#cb480-1433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"conspecific count"</span>) <span class="sc">+</span></span>
<span id="cb480-1434"><a href="#cb480-1434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1435"><a href="#cb480-1435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"West Brook"</span>) <span class="sc">+</span></span>
<span id="cb480-1436"><a href="#cb480-1436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-1437"><a href="#cb480-1437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1438"><a href="#cb480-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1439"><a href="#cb480-1439" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">!=</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(nIndBySpp, propNeg, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-1440"><a href="#cb480-1440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-1441"><a href="#cb480-1441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1442"><a href="#cb480-1442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Proportion of observations with negative growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-1443"><a href="#cb480-1443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"conspecific count"</span>) <span class="sc">+</span></span>
<span id="cb480-1444"><a href="#cb480-1444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-1445"><a href="#cb480-1445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Tributaries"</span>) <span class="sc">+</span></span>
<span id="cb480-1446"><a href="#cb480-1446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-1447"><a href="#cb480-1447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-1448"><a href="#cb480-1448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1449"><a href="#cb480-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1450"><a href="#cb480-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1451"><a href="#cb480-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1452"><a href="#cb480-1452" aria-hidden="true" tabindex="-1"></a><span class="fu">## XGBoost model for proportion of fish with negative growth</span></span>
<span id="cb480-1453"><a href="#cb480-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1454"><a href="#cb480-1454" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hyperparameter search grid</span></span>
<span id="cb480-1455"><a href="#cb480-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1458"><a href="#cb480-1458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1459"><a href="#cb480-1459" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runML_HP_propNeg</span></span>
<span id="cb480-1460"><a href="#cb480-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1461"><a href="#cb480-1461" aria-hidden="true" tabindex="-1"></a>runHyperparamSearch <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> propNegSRsN, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"speciesGG"</span>, <span class="st">"riverGG"</span>, <span class="st">"year"</span>, <span class="st">"mT"</span>, <span class="st">"mF_log10"</span>, <span class="st">"nInd"</span>, <span class="st">"propNeg"</span>), <span class="at">nRoundsIn =</span> <span class="dv">100000</span>, <span class="at">early_stopping_roundsIn =</span> <span class="dv">500</span>) {</span>
<span id="cb480-1462"><a href="#cb480-1462" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1463"><a href="#cb480-1463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb480-1464"><a href="#cb480-1464" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1465"><a href="#cb480-1465" aria-hidden="true" tabindex="-1"></a>  dML_propNeg <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb480-1466"><a href="#cb480-1466" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars)) </span>
<span id="cb480-1467"><a href="#cb480-1467" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1468"><a href="#cb480-1468" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variable names</span></span>
<span id="cb480-1469"><a href="#cb480-1469" aria-hidden="true" tabindex="-1"></a>  features_propNeg <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dML_propNeg), <span class="st">"propNeg"</span>)</span>
<span id="cb480-1470"><a href="#cb480-1470" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1471"><a href="#cb480-1471" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the treatment plan from the training data</span></span>
<span id="cb480-1472"><a href="#cb480-1472" aria-hidden="true" tabindex="-1"></a>  treatplan_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">designTreatmentsZ</span>(dML_propNeg, features_propNeg, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1473"><a href="#cb480-1473" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1474"><a href="#cb480-1474" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the "clean" variable names from the scoreFrame</span></span>
<span id="cb480-1475"><a href="#cb480-1475" aria-hidden="true" tabindex="-1"></a>  new_vars_propNeg <span class="ot">&lt;-</span> treatplan_propNeg <span class="sc">%&gt;%</span></span>
<span id="cb480-1476"><a href="#cb480-1476" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>        </span>
<span id="cb480-1477"><a href="#cb480-1477" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb480-1478"><a href="#cb480-1478" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)     </span>
<span id="cb480-1479"><a href="#cb480-1479" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1480"><a href="#cb480-1480" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the training data</span></span>
<span id="cb480-1481"><a href="#cb480-1481" aria-hidden="true" tabindex="-1"></a>  features_train_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_propNeg, dML_propNeg, <span class="at">varRestriction =</span> new_vars_propNeg) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb480-1482"><a href="#cb480-1482" aria-hidden="true" tabindex="-1"></a>  response_train_propNeg <span class="ot">&lt;-</span> dML_propNeg<span class="sc">$</span>propNeg</span>
<span id="cb480-1483"><a href="#cb480-1483" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1484"><a href="#cb480-1484" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create hyperparameter grid</span></span>
<span id="cb480-1485"><a href="#cb480-1485" aria-hidden="true" tabindex="-1"></a>  hyper_grid_propNeg <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb480-1486"><a href="#cb480-1486" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">3</span>),</span>
<span id="cb480-1487"><a href="#cb480-1487" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb480-1488"><a href="#cb480-1488" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_child_weight =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb480-1489"><a href="#cb480-1489" aria-hidden="true" tabindex="-1"></a>    <span class="at">subsample =</span> <span class="fu">c</span>(.<span class="dv">65</span>, .<span class="dv">8</span>, <span class="dv">1</span>),</span>
<span id="cb480-1490"><a href="#cb480-1490" aria-hidden="true" tabindex="-1"></a>    <span class="at">colsample_bytree =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">9</span>, <span class="dv">1</span>),</span>
<span id="cb480-1491"><a href="#cb480-1491" aria-hidden="true" tabindex="-1"></a>    <span class="at">optimal_trees =</span> <span class="dv">0</span>,               <span class="co"># a place to dump results</span></span>
<span id="cb480-1492"><a href="#cb480-1492" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_RMSE =</span> <span class="dv">0</span>                     <span class="co"># a place to dump results</span></span>
<span id="cb480-1493"><a href="#cb480-1493" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-1494"><a href="#cb480-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1495"><a href="#cb480-1495" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reproducibility</span></span>
<span id="cb480-1496"><a href="#cb480-1496" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb480-1497"><a href="#cb480-1497" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   </span></span>
<span id="cb480-1498"><a href="#cb480-1498" aria-hidden="true" tabindex="-1"></a>  <span class="co"># grid search</span></span>
<span id="cb480-1499"><a href="#cb480-1499" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hyper_grid_propNeg)) {</span>
<span id="cb480-1500"><a href="#cb480-1500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(i, <span class="st">" out of "</span>, <span class="fu">nrow</span>(hyper_grid_propNeg)))</span>
<span id="cb480-1501"><a href="#cb480-1501" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create parameter list</span></span>
<span id="cb480-1502"><a href="#cb480-1502" aria-hidden="true" tabindex="-1"></a>    params_propNeg <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb480-1503"><a href="#cb480-1503" aria-hidden="true" tabindex="-1"></a>      <span class="at">eta =</span> hyper_grid_propNeg<span class="sc">$</span>eta[i],</span>
<span id="cb480-1504"><a href="#cb480-1504" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_depth =</span> hyper_grid_propNeg<span class="sc">$</span>max_depth[i],</span>
<span id="cb480-1505"><a href="#cb480-1505" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_child_weight =</span> hyper_grid_propNeg<span class="sc">$</span>min_child_weight[i],</span>
<span id="cb480-1506"><a href="#cb480-1506" aria-hidden="true" tabindex="-1"></a>      <span class="at">subsample =</span> hyper_grid_propNeg<span class="sc">$</span>subsample[i],</span>
<span id="cb480-1507"><a href="#cb480-1507" aria-hidden="true" tabindex="-1"></a>      <span class="at">colsample_bytree =</span> hyper_grid_propNeg<span class="sc">$</span>colsample_bytree[i]</span>
<span id="cb480-1508"><a href="#cb480-1508" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-1509"><a href="#cb480-1509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1510"><a href="#cb480-1510" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1511"><a href="#cb480-1511" aria-hidden="true" tabindex="-1"></a>    <span class="co"># train model</span></span>
<span id="cb480-1512"><a href="#cb480-1512" aria-hidden="true" tabindex="-1"></a>    xgb.tune_propNeg <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb480-1513"><a href="#cb480-1513" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> params_propNeg,</span>
<span id="cb480-1514"><a href="#cb480-1514" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> features_train_propNeg,</span>
<span id="cb480-1515"><a href="#cb480-1515" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> response_train_propNeg,</span>
<span id="cb480-1516"><a href="#cb480-1516" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrounds =</span> <span class="dv">100000</span>,</span>
<span id="cb480-1517"><a href="#cb480-1517" aria-hidden="true" tabindex="-1"></a>      <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb480-1518"><a href="#cb480-1518" aria-hidden="true" tabindex="-1"></a>      <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="co">#"reg:linear",  # for regression models</span></span>
<span id="cb480-1519"><a href="#cb480-1519" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="dv">0</span>,               <span class="co"># silent,</span></span>
<span id="cb480-1520"><a href="#cb480-1520" aria-hidden="true" tabindex="-1"></a>      <span class="at">early_stopping_rounds =</span> early_stopping_roundsIn <span class="co"># stop if no improvement for x consecutive trees</span></span>
<span id="cb480-1521"><a href="#cb480-1521" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-1522"><a href="#cb480-1522" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1523"><a href="#cb480-1523" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add min training error and trees to grid</span></span>
<span id="cb480-1524"><a href="#cb480-1524" aria-hidden="true" tabindex="-1"></a>    hyper_grid_propNeg<span class="sc">$</span>optimal_trees[i] <span class="ot">&lt;-</span> <span class="fu">which.min</span>(xgb.tune_propNeg<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_rmse_mean)</span>
<span id="cb480-1525"><a href="#cb480-1525" aria-hidden="true" tabindex="-1"></a>    hyper_grid_propNeg<span class="sc">$</span>min_RMSE[i] <span class="ot">&lt;-</span> <span class="fu">min</span>(xgb.tune_propNeg<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_rmse_mean)</span>
<span id="cb480-1526"><a href="#cb480-1526" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb480-1527"><a href="#cb480-1527" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1528"><a href="#cb480-1528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(hyper_grid_propNeg <span class="sc">|&gt;</span> <span class="fu">arrange</span>(min_RMSE))</span>
<span id="cb480-1529"><a href="#cb480-1529" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-1530"><a href="#cb480-1530" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb480-1531"><a href="#cb480-1531" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; #     eta max_depth min_child_weight subsample colsample_bytree optimal_trees  min_RMSE</span></span>
<span id="cb480-1532"><a href="#cb480-1532" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 1  0.10         1                7      0.80              0.9            57 0.1833918</span></span>
<span id="cb480-1533"><a href="#cb480-1533" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 2  0.10         3                3      1.00              1.0            52 0.1835447</span></span>
<span id="cb480-1534"><a href="#cb480-1534" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 3  0.05         3                1      0.65              0.9            88 0.1849762</span></span>
<span id="cb480-1535"><a href="#cb480-1535" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 4  0.01         3                7      1.00              0.9           514 0.1853950</span></span>
<span id="cb480-1536"><a href="#cb480-1536" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 5  0.30         5                1      0.80              1.0            17 0.1854102</span></span>
<span id="cb480-1537"><a href="#cb480-1537" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 6  0.01         3                3      0.65              0.8           438 0.1854346</span></span>
<span id="cb480-1538"><a href="#cb480-1538" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 7  0.30         5                1      1.00              0.9            14 0.1856684</span></span>
<span id="cb480-1539"><a href="#cb480-1539" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 8  0.01         1                3      0.65              0.9           560 0.1857717</span></span>
<span id="cb480-1540"><a href="#cb480-1540" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 9  0.30         3                1      1.00              1.0            13 0.1859183</span></span>
<span id="cb480-1541"><a href="#cb480-1541" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 10 0.30         3                3      0.65              0.8            21 0.1860299</span></span>
<span id="cb480-1542"><a href="#cb480-1542" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 11 0.05         7                3      0.80              0.8           123 0.1860336</span></span>
<span id="cb480-1543"><a href="#cb480-1543" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 12 0.01         3                5      0.80              1.0           512 0.1861016</span></span>
<span id="cb480-1544"><a href="#cb480-1544" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 13 0.10         3                7      0.65              1.0            45 0.1861042</span></span>
<span id="cb480-1545"><a href="#cb480-1545" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; # 14 0.10         3                5      1.00              1.0            55 0.1861160</span></span>
<span id="cb480-1546"><a href="#cb480-1546" aria-hidden="true" tabindex="-1"></a><span class="co"># # &gt; # 15 0.10         1                1      1.00              0.9           179 0.1861891</span></span>
<span id="cb480-1547"><a href="#cb480-1547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1548"><a href="#cb480-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1549"><a href="#cb480-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1550"><a href="#cb480-1550" aria-hidden="true" tabindex="-1"></a><span class="fu">### Function to run models</span></span>
<span id="cb480-1551"><a href="#cb480-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1554"><a href="#cb480-1554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1555"><a href="#cb480-1555" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xgBoostPropNegFunction</span></span>
<span id="cb480-1556"><a href="#cb480-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1557"><a href="#cb480-1557" aria-hidden="true" tabindex="-1"></a><span class="co"># http://uc-r.github.io/gbm_regression</span></span>
<span id="cb480-1558"><a href="#cb480-1558" aria-hidden="true" tabindex="-1"></a>runXGB <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> propNegSRsN, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"speciesGG"</span>, <span class="st">"riverGG"</span>, <span class="st">"year"</span>, <span class="st">"mT"</span>, <span class="st">"mF_log10"</span>, <span class="st">"nInd"</span>, <span class="st">"propNeg"</span>), <span class="at">nRoundsIn =</span> <span class="dv">100000</span>, <span class="at">params =</span> params_propNegIn) {</span>
<span id="cb480-1559"><a href="#cb480-1559" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1560"><a href="#cb480-1560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">125</span>)</span>
<span id="cb480-1561"><a href="#cb480-1561" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1562"><a href="#cb480-1562" aria-hidden="true" tabindex="-1"></a>  dML_propNeg <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb480-1563"><a href="#cb480-1563" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars)) </span>
<span id="cb480-1564"><a href="#cb480-1564" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1565"><a href="#cb480-1565" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variable names</span></span>
<span id="cb480-1566"><a href="#cb480-1566" aria-hidden="true" tabindex="-1"></a>  features_propNeg <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dML_propNeg), <span class="st">"propNeg"</span>)</span>
<span id="cb480-1567"><a href="#cb480-1567" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1568"><a href="#cb480-1568" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the treatment plan from the training data</span></span>
<span id="cb480-1569"><a href="#cb480-1569" aria-hidden="true" tabindex="-1"></a>  treatplan_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">designTreatmentsZ</span>(dML_propNeg, features_propNeg, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1570"><a href="#cb480-1570" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1571"><a href="#cb480-1571" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the "clean" variable names from the scoreFrame</span></span>
<span id="cb480-1572"><a href="#cb480-1572" aria-hidden="true" tabindex="-1"></a>  new_vars_propNeg <span class="ot">&lt;-</span> treatplan_propNeg <span class="sc">%&gt;%</span></span>
<span id="cb480-1573"><a href="#cb480-1573" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>        </span>
<span id="cb480-1574"><a href="#cb480-1574" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb480-1575"><a href="#cb480-1575" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)     </span>
<span id="cb480-1576"><a href="#cb480-1576" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1577"><a href="#cb480-1577" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the training data</span></span>
<span id="cb480-1578"><a href="#cb480-1578" aria-hidden="true" tabindex="-1"></a>  features_train_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_propNeg, dML_propNeg, <span class="at">varRestriction =</span> new_vars_propNeg) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb480-1579"><a href="#cb480-1579" aria-hidden="true" tabindex="-1"></a>  response_train_propNeg <span class="ot">&lt;-</span> dML_propNeg<span class="sc">$</span>propNeg</span>
<span id="cb480-1580"><a href="#cb480-1580" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1581"><a href="#cb480-1581" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the test data</span></span>
<span id="cb480-1582"><a href="#cb480-1582" aria-hidden="true" tabindex="-1"></a>  features_test_propNeg <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_propNeg, dML_propNeg, <span class="at">varRestriction =</span> new_vars_propNeg) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb480-1583"><a href="#cb480-1583" aria-hidden="true" tabindex="-1"></a>  response_test_propNeg <span class="ot">&lt;-</span> dML_propNeg<span class="sc">$</span>propNeg</span>
<span id="cb480-1584"><a href="#cb480-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1585"><a href="#cb480-1585" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Run model</span></span>
<span id="cb480-1586"><a href="#cb480-1586" aria-hidden="true" tabindex="-1"></a>  <span class="co"># parameter list - from the top model of the grid search above</span></span>
<span id="cb480-1587"><a href="#cb480-1587" aria-hidden="true" tabindex="-1"></a>  params_propNeg <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb480-1588"><a href="#cb480-1588" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta =</span> params<span class="sc">$</span>eta, <span class="co">#0.01,</span></span>
<span id="cb480-1589"><a href="#cb480-1589" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_depth =</span> params<span class="sc">$</span>max_depth, <span class="co">#1,</span></span>
<span id="cb480-1590"><a href="#cb480-1590" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_child_weight =</span> params<span class="sc">$</span>min_child_weight, <span class="co">#7,</span></span>
<span id="cb480-1591"><a href="#cb480-1591" aria-hidden="true" tabindex="-1"></a>    <span class="at">subsample =</span> params<span class="sc">$</span>subsample, <span class="co">#0.8,</span></span>
<span id="cb480-1592"><a href="#cb480-1592" aria-hidden="true" tabindex="-1"></a>    <span class="at">colsample_bytree =</span> params<span class="sc">$</span>colsample_bytree <span class="co">#0.9</span></span>
<span id="cb480-1593"><a href="#cb480-1593" aria-hidden="true" tabindex="-1"></a>   <span class="co"># optimal_trees = params$optimal_trees</span></span>
<span id="cb480-1594"><a href="#cb480-1594" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-1595"><a href="#cb480-1595" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1596"><a href="#cb480-1596" aria-hidden="true" tabindex="-1"></a>  <span class="co"># train final model</span></span>
<span id="cb480-1597"><a href="#cb480-1597" aria-hidden="true" tabindex="-1"></a>  xgb.fit.final_propNeg <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(</span>
<span id="cb480-1598"><a href="#cb480-1598" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> params_propNeg,</span>
<span id="cb480-1599"><a href="#cb480-1599" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> features_train_propNeg,</span>
<span id="cb480-1600"><a href="#cb480-1600" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> response_train_propNeg,</span>
<span id="cb480-1601"><a href="#cb480-1601" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrounds =</span> nRoundsIn,</span>
<span id="cb480-1602"><a href="#cb480-1602" aria-hidden="true" tabindex="-1"></a>    <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>,</span>
<span id="cb480-1603"><a href="#cb480-1603" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb480-1604"><a href="#cb480-1604" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_rounds =</span> <span class="dv">250</span> <span class="co"># stop if no improvement for 20 consecutive trees</span></span>
<span id="cb480-1605"><a href="#cb480-1605" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-1606"><a href="#cb480-1606" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-1607"><a href="#cb480-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1608"><a href="#cb480-1608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb480-1609"><a href="#cb480-1609" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb480-1610"><a href="#cb480-1610" aria-hidden="true" tabindex="-1"></a>      <span class="at">dat =</span> dML_propNeg,</span>
<span id="cb480-1611"><a href="#cb480-1611" aria-hidden="true" tabindex="-1"></a>      <span class="at">xgb =</span> xgb.fit.final_propNeg,</span>
<span id="cb480-1612"><a href="#cb480-1612" aria-hidden="true" tabindex="-1"></a>      <span class="at">new_vars =</span> new_vars_propNeg,</span>
<span id="cb480-1613"><a href="#cb480-1613" aria-hidden="true" tabindex="-1"></a>      <span class="at">features_train =</span> features_train_propNeg,</span>
<span id="cb480-1614"><a href="#cb480-1614" aria-hidden="true" tabindex="-1"></a>      <span class="at">response_train =</span> response_train_propNeg</span>
<span id="cb480-1615"><a href="#cb480-1615" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-1616"><a href="#cb480-1616" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-1617"><a href="#cb480-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1618"><a href="#cb480-1618" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-1619"><a href="#cb480-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1620"><a href="#cb480-1620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1621"><a href="#cb480-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1622"><a href="#cb480-1622" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brook trout</span></span>
<span id="cb480-1625"><a href="#cb480-1625" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1626"><a href="#cb480-1626" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runXGB_BKT1</span></span>
<span id="cb480-1627"><a href="#cb480-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1628"><a href="#cb480-1628" aria-hidden="true" tabindex="-1"></a><span class="do">#### uncomment to run hyperparameter search grid</span></span>
<span id="cb480-1629"><a href="#cb480-1629" aria-hidden="true" tabindex="-1"></a><span class="co"># hpPropNegBKT &lt;- runHyperparamSearch(</span></span>
<span id="cb480-1630"><a href="#cb480-1630" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt;  filter(speciesGG == "Brook trout", year &gt; 2001),</span></span>
<span id="cb480-1631"><a href="#cb480-1631" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("riverGG", "year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb480-1632"><a href="#cb480-1632" aria-hidden="true" tabindex="-1"></a><span class="co">#   early_stopping_roundsIn = 250</span></span>
<span id="cb480-1633"><a href="#cb480-1633" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb480-1634"><a href="#cb480-1634" aria-hidden="true" tabindex="-1"></a><span class="co"># save(hpPropNegBKT, file = "./data/out/XGBoost/hyperParam/hpPropNegBKT_250.RData")</span></span>
<span id="cb480-1635"><a href="#cb480-1635" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpPropNegBKT_250.RData"</span>)</span>
<span id="cb480-1636"><a href="#cb480-1636" aria-hidden="true" tabindex="-1"></a>hpPropNegBKT[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb480-1637"><a href="#cb480-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1638"><a href="#cb480-1638" aria-hidden="true" tabindex="-1"></a><span class="do">#### uncomment to run XGBoost</span></span>
<span id="cb480-1639"><a href="#cb480-1639" aria-hidden="true" tabindex="-1"></a><span class="co"># propNegBKT &lt;- runXGB(</span></span>
<span id="cb480-1640"><a href="#cb480-1640" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt;  filter(speciesGG == "Brook trout", year &gt; 2001),</span></span>
<span id="cb480-1641"><a href="#cb480-1641" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("riverGG", "year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb480-1642"><a href="#cb480-1642" aria-hidden="true" tabindex="-1"></a><span class="co">#   params = hpPropNegBKT[1,]</span></span>
<span id="cb480-1643"><a href="#cb480-1643" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb480-1644"><a href="#cb480-1644" aria-hidden="true" tabindex="-1"></a><span class="co"># save(propNegBKT, file = "./data/out/XGBoost/modelRuns/XGBpropNegBKT_250.RData")</span></span>
<span id="cb480-1645"><a href="#cb480-1645" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBpropNegBKT_250.RData"</span>)</span>
<span id="cb480-1646"><a href="#cb480-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1647"><a href="#cb480-1647" aria-hidden="true" tabindex="-1"></a>propNegBKT<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span>
<span id="cb480-1648"><a href="#cb480-1648" aria-hidden="true" tabindex="-1"></a>propNegBKT<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span>
<span id="cb480-1649"><a href="#cb480-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1650"><a href="#cb480-1650" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb480-1651"><a href="#cb480-1651" aria-hidden="true" tabindex="-1"></a>viBKT <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> propNegBKT<span class="sc">$</span>xgb)</span>
<span id="cb480-1652"><a href="#cb480-1652" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viBKT, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span>
<span id="cb480-1653"><a href="#cb480-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1654"><a href="#cb480-1654" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb480-1655"><a href="#cb480-1655" aria-hidden="true" tabindex="-1"></a>s_propNegBKT <span class="ot">&lt;-</span> <span class="fu">hstats</span>(propNegBKT<span class="sc">$</span>xgb, <span class="at">v =</span> propNegBKT<span class="sc">$</span>new_vars, <span class="at">X =</span> propNegBKT<span class="sc">$</span>features_train)</span>
<span id="cb480-1656"><a href="#cb480-1656" aria-hidden="true" tabindex="-1"></a>s_propNegBKT</span>
<span id="cb480-1657"><a href="#cb480-1657" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_propNegBKT)</span>
<span id="cb480-1658"><a href="#cb480-1658" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-1659"><a href="#cb480-1659" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb480-1660"><a href="#cb480-1660" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_propNegBKT, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb480-1661"><a href="#cb480-1661" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_propNegBKT, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">normalize =</span> F, <span class="at">squared =</span> F, <span class="at">facet_scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb480-1662"><a href="#cb480-1662" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-1663"><a href="#cb480-1663" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb480-1664"><a href="#cb480-1664" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegBKT, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb480-1665"><a href="#cb480-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1666"><a href="#cb480-1666" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb480-1667"><a href="#cb480-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1668"><a href="#cb480-1668" aria-hidden="true" tabindex="-1"></a>pFlow_propNeg <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1669"><a href="#cb480-1669" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1670"><a href="#cb480-1670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1671"><a href="#cb480-1671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1672"><a href="#cb480-1672" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb480-1673"><a href="#cb480-1673" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb480-1674"><a href="#cb480-1674" aria-hidden="true" tabindex="-1"></a>pTemp_propNeg <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1675"><a href="#cb480-1675" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1676"><a href="#cb480-1676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1677"><a href="#cb480-1677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1678"><a href="#cb480-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1679"><a href="#cb480-1679" aria-hidden="true" tabindex="-1"></a>pNInd_propNeg <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1680"><a href="#cb480-1680" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1681"><a href="#cb480-1681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1682"><a href="#cb480-1682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1683"><a href="#cb480-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1684"><a href="#cb480-1684" aria-hidden="true" tabindex="-1"></a>pYear_propNeg <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1685"><a href="#cb480-1685" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1686"><a href="#cb480-1686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1687"><a href="#cb480-1687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1688"><a href="#cb480-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1689"><a href="#cb480-1689" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pFlow_propNeg, pTemp_propNeg, pNInd_propNeg, pYear_propNeg, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb480-1690"><a href="#cb480-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1691"><a href="#cb480-1691" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-1692"><a href="#cb480-1692" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb480-1693"><a href="#cb480-1693" aria-hidden="true" tabindex="-1"></a>pFlow_propNegDataBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1694"><a href="#cb480-1694" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1695"><a href="#cb480-1695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mF_log10<span class="sc">-</span><span class="fu">mean</span>(mF_log10))<span class="sc">/</span><span class="fu">sd</span>(mF_log10),</span>
<span id="cb480-1696"><a href="#cb480-1696" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb480-1697"><a href="#cb480-1697" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-1698"><a href="#cb480-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1699"><a href="#cb480-1699" aria-hidden="true" tabindex="-1"></a>pMT_propNegDataBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1700"><a href="#cb480-1700" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1701"><a href="#cb480-1701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mT<span class="sc">-</span><span class="fu">mean</span>(mT))<span class="sc">/</span><span class="fu">sd</span>(mT),</span>
<span id="cb480-1702"><a href="#cb480-1702" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb480-1703"><a href="#cb480-1703" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-1704"><a href="#cb480-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1705"><a href="#cb480-1705" aria-hidden="true" tabindex="-1"></a>pNInd_propNegDataBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1706"><a href="#cb480-1706" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1707"><a href="#cb480-1707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb480-1708"><a href="#cb480-1708" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb480-1709"><a href="#cb480-1709" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-1710"><a href="#cb480-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1711"><a href="#cb480-1711" aria-hidden="true" tabindex="-1"></a>pYear_propNegDataBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1712"><a href="#cb480-1712" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1713"><a href="#cb480-1713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb480-1714"><a href="#cb480-1714" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb480-1715"><a href="#cb480-1715" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-1716"><a href="#cb480-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1717"><a href="#cb480-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1718"><a href="#cb480-1718" aria-hidden="true" tabindex="-1"></a>all_propNegDataBKT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pFlow_propNegDataBKT, pMT_propNegDataBKT, pNInd_propNegDataBKT, pYear_propNegDataBKT)</span>
<span id="cb480-1719"><a href="#cb480-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1720"><a href="#cb480-1720" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb480-1721"><a href="#cb480-1721" aria-hidden="true" tabindex="-1"></a>all_propNegDataBKT_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegDataBKT, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb480-1722"><a href="#cb480-1722" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-1723"><a href="#cb480-1723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1724"><a href="#cb480-1724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-1725"><a href="#cb480-1725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb480-1726"><a href="#cb480-1726" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-1727"><a href="#cb480-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1728"><a href="#cb480-1728" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-1729"><a href="#cb480-1729" aria-hidden="true" tabindex="-1"></a><span class="co"># All river on one graph</span></span>
<span id="cb480-1730"><a href="#cb480-1730" aria-hidden="true" tabindex="-1"></a>partialWBBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1731"><a href="#cb480-1731" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1732"><a href="#cb480-1732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"West Brook"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1733"><a href="#cb480-1733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>)</span>
<span id="cb480-1734"><a href="#cb480-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1735"><a href="#cb480-1735" aria-hidden="true" tabindex="-1"></a>partialOLBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1736"><a href="#cb480-1736" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb480-1737"><a href="#cb480-1737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Large"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1738"><a href="#cb480-1738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>)</span>
<span id="cb480-1739"><a href="#cb480-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1740"><a href="#cb480-1740" aria-hidden="true" tabindex="-1"></a>partialOSBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1741"><a href="#cb480-1741" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1742"><a href="#cb480-1742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1743"><a href="#cb480-1743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>)</span>
<span id="cb480-1744"><a href="#cb480-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1745"><a href="#cb480-1745" aria-hidden="true" tabindex="-1"></a>partialISBKT <span class="ot">&lt;-</span> propNegBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1746"><a href="#cb480-1746" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Isolated_Small"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBKT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb480-1747"><a href="#cb480-1747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Isolated Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1748"><a href="#cb480-1748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Isolated_Small"</span>)</span>
<span id="cb480-1749"><a href="#cb480-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1750"><a href="#cb480-1750" aria-hidden="true" tabindex="-1"></a>partialRiversBKT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partialWBBKT, partialOLBKT, partialOSBKT, partialISBKT) <span class="sc">|&gt;</span> </span>
<span id="cb480-1751"><a href="#cb480-1751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-1752"><a href="#cb480-1752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RiverEffect =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span><span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb480-1753"><a href="#cb480-1753" aria-hidden="true" tabindex="-1"></a>         <span class="at">riverOrdered =</span> <span class="fu">factor</span>(riverGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>, <span class="st">"Isolated Small"</span>), </span>
<span id="cb480-1754"><a href="#cb480-1754" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> T))</span>
<span id="cb480-1755"><a href="#cb480-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1756"><a href="#cb480-1756" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(partialRiversBKT, <span class="fu">aes</span>(riverOrdered, yhat, <span class="at">fill =</span> <span class="fu">factor</span>(RiverEffect))) <span class="sc">+</span></span>
<span id="cb480-1757"><a href="#cb480-1757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-1758"><a href="#cb480-1758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>)</span>
<span id="cb480-1759"><a href="#cb480-1759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1760"><a href="#cb480-1760" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb480-1761"><a href="#cb480-1761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1762"><a href="#cb480-1762" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mT"</span>, <span class="at">X =</span> propNegBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mF_log10"</span>)) <span class="sc">+</span></span>
<span id="cb480-1763"><a href="#cb480-1763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mF_log10), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1764"><a href="#cb480-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1765"><a href="#cb480-1765" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mT"</span>)) <span class="sc">+</span></span>
<span id="cb480-1766"><a href="#cb480-1766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mT), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1767"><a href="#cb480-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1768"><a href="#cb480-1768" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb480-1769"><a href="#cb480-1769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1770"><a href="#cb480-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1771"><a href="#cb480-1771" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-1772"><a href="#cb480-1772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1773"><a href="#cb480-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1774"><a href="#cb480-1774" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brown trout</span></span>
<span id="cb480-1777"><a href="#cb480-1777" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1778"><a href="#cb480-1778" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runXGB_BNT</span></span>
<span id="cb480-1779"><a href="#cb480-1779" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-1780"><a href="#cb480-1780" aria-hidden="true" tabindex="-1"></a><span class="co"># hpPropNegBNT &lt;- runHyperparamSearch(</span></span>
<span id="cb480-1781"><a href="#cb480-1781" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt;  filter(speciesGG == "Brown trout", year &gt; 2001),</span></span>
<span id="cb480-1782"><a href="#cb480-1782" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("riverGG", "year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb480-1783"><a href="#cb480-1783" aria-hidden="true" tabindex="-1"></a><span class="co">#   early_stopping_roundsIn = 250</span></span>
<span id="cb480-1784"><a href="#cb480-1784" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb480-1785"><a href="#cb480-1785" aria-hidden="true" tabindex="-1"></a><span class="co"># save(hpPropNegBNT, file = "./data/out/XGBoost/hyperParam/hpPropNegBNT_250.RData")</span></span>
<span id="cb480-1786"><a href="#cb480-1786" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpPropNegBNT_250.RData"</span>)</span>
<span id="cb480-1787"><a href="#cb480-1787" aria-hidden="true" tabindex="-1"></a>hpPropNegBNT[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb480-1788"><a href="#cb480-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1789"><a href="#cb480-1789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1790"><a href="#cb480-1790" aria-hidden="true" tabindex="-1"></a>propNegBNT <span class="ot">&lt;-</span> <span class="fu">runXGB</span>(</span>
<span id="cb480-1791"><a href="#cb480-1791" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> propNegSRsN <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brown trout"</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>, nInd <span class="sc">&gt;</span> <span class="dv">10</span>),</span>
<span id="cb480-1792"><a href="#cb480-1792" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"year"</span>, <span class="st">"mT"</span>, <span class="st">"mF_log10"</span>, <span class="st">"nInd"</span>, <span class="st">"propNeg"</span>),</span>
<span id="cb480-1793"><a href="#cb480-1793" aria-hidden="true" tabindex="-1"></a>  <span class="at">nRoundsIn =</span> <span class="dv">250000</span>,</span>
<span id="cb480-1794"><a href="#cb480-1794" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> hpPropNegBNT[<span class="dv">1</span>,]</span>
<span id="cb480-1795"><a href="#cb480-1795" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-1796"><a href="#cb480-1796" aria-hidden="true" tabindex="-1"></a><span class="co"># save(propNegBNT, file = "./data/out/XGBoost/modelRuns/XGBpropNegBNT_250.RData")</span></span>
<span id="cb480-1797"><a href="#cb480-1797" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBpropNegBNT_250.RData"</span>)</span>
<span id="cb480-1798"><a href="#cb480-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1799"><a href="#cb480-1799" aria-hidden="true" tabindex="-1"></a>propNegBNT<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span>
<span id="cb480-1800"><a href="#cb480-1800" aria-hidden="true" tabindex="-1"></a>propNegBNT<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span>
<span id="cb480-1801"><a href="#cb480-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1802"><a href="#cb480-1802" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb480-1803"><a href="#cb480-1803" aria-hidden="true" tabindex="-1"></a>viBNT <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> propNegBNT<span class="sc">$</span>xgb)</span>
<span id="cb480-1804"><a href="#cb480-1804" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viBNT, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span>
<span id="cb480-1805"><a href="#cb480-1805" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb480-1806"><a href="#cb480-1806" aria-hidden="true" tabindex="-1"></a><span class="co">#s_propNegBNT &lt;- hstats(propNegBNT$xgb, v = propNegBNT$new_vars, X = propNegBNT$features_train)</span></span>
<span id="cb480-1807"><a href="#cb480-1807" aria-hidden="true" tabindex="-1"></a><span class="co"># s_propNegBNT</span></span>
<span id="cb480-1808"><a href="#cb480-1808" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegBNT)</span></span>
<span id="cb480-1809"><a href="#cb480-1809" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-1810"><a href="#cb480-1810" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb480-1811"><a href="#cb480-1811" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_propNegBNT, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb480-1812"><a href="#cb480-1812" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-1813"><a href="#cb480-1813" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb480-1814"><a href="#cb480-1814" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegBNT, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb480-1815"><a href="#cb480-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1816"><a href="#cb480-1816" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb480-1817"><a href="#cb480-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1818"><a href="#cb480-1818" aria-hidden="true" tabindex="-1"></a>pFlow_propNeg <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1819"><a href="#cb480-1819" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1820"><a href="#cb480-1820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1821"><a href="#cb480-1821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1822"><a href="#cb480-1822" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb480-1823"><a href="#cb480-1823" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb480-1824"><a href="#cb480-1824" aria-hidden="true" tabindex="-1"></a>pTemp_propNeg <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1825"><a href="#cb480-1825" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1826"><a href="#cb480-1826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1827"><a href="#cb480-1827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1828"><a href="#cb480-1828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1829"><a href="#cb480-1829" aria-hidden="true" tabindex="-1"></a>pNInd_propNeg <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1830"><a href="#cb480-1830" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1831"><a href="#cb480-1831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1832"><a href="#cb480-1832" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1833"><a href="#cb480-1833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1834"><a href="#cb480-1834" aria-hidden="true" tabindex="-1"></a>pYear_propNeg <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1835"><a href="#cb480-1835" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1836"><a href="#cb480-1836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1837"><a href="#cb480-1837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1838"><a href="#cb480-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1839"><a href="#cb480-1839" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pFlow_propNeg, pTemp_propNeg, pNInd_propNeg, pYear_propNeg, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb480-1840"><a href="#cb480-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1841"><a href="#cb480-1841" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-1842"><a href="#cb480-1842" aria-hidden="true" tabindex="-1"></a><span class="co"># all partials on one graph</span></span>
<span id="cb480-1843"><a href="#cb480-1843" aria-hidden="true" tabindex="-1"></a>pFlow_propNegDataBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1844"><a href="#cb480-1844" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1845"><a href="#cb480-1845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mF_log10<span class="sc">-</span><span class="fu">mean</span>(mF_log10))<span class="sc">/</span><span class="fu">sd</span>(mF_log10),</span>
<span id="cb480-1846"><a href="#cb480-1846" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb480-1847"><a href="#cb480-1847" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb480-1848"><a href="#cb480-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1849"><a href="#cb480-1849" aria-hidden="true" tabindex="-1"></a>pMT_propNegDataBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1850"><a href="#cb480-1850" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1851"><a href="#cb480-1851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mT<span class="sc">-</span><span class="fu">mean</span>(mT))<span class="sc">/</span><span class="fu">sd</span>(mT),</span>
<span id="cb480-1852"><a href="#cb480-1852" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb480-1853"><a href="#cb480-1853" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb480-1854"><a href="#cb480-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1855"><a href="#cb480-1855" aria-hidden="true" tabindex="-1"></a>pNInd_propNegDataBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1856"><a href="#cb480-1856" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1857"><a href="#cb480-1857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb480-1858"><a href="#cb480-1858" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb480-1859"><a href="#cb480-1859" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb480-1860"><a href="#cb480-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1861"><a href="#cb480-1861" aria-hidden="true" tabindex="-1"></a>pYear_propNegDataBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1862"><a href="#cb480-1862" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1863"><a href="#cb480-1863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb480-1864"><a href="#cb480-1864" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb480-1865"><a href="#cb480-1865" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb480-1866"><a href="#cb480-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1867"><a href="#cb480-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1868"><a href="#cb480-1868" aria-hidden="true" tabindex="-1"></a>all_propNegDataBNT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pFlow_propNegDataBNT, pMT_propNegDataBNT, pNInd_propNegDataBNT, pYear_propNegDataBNT)</span>
<span id="cb480-1869"><a href="#cb480-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1870"><a href="#cb480-1870" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb480-1871"><a href="#cb480-1871" aria-hidden="true" tabindex="-1"></a>all_propNegDataBNT_gg <span class="ot">&lt;-</span> </span>
<span id="cb480-1872"><a href="#cb480-1872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(all_propNegDataBNT, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb480-1873"><a href="#cb480-1873" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-1874"><a href="#cb480-1874" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-1875"><a href="#cb480-1875" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-1876"><a href="#cb480-1876" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb480-1877"><a href="#cb480-1877" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-1878"><a href="#cb480-1878" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-1879"><a href="#cb480-1879" aria-hidden="true" tabindex="-1"></a><span class="co"># All river on one graph</span></span>
<span id="cb480-1880"><a href="#cb480-1880" aria-hidden="true" tabindex="-1"></a>partialWBBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1881"><a href="#cb480-1881" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1882"><a href="#cb480-1882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"West Brook"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1883"><a href="#cb480-1883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>)</span>
<span id="cb480-1884"><a href="#cb480-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1885"><a href="#cb480-1885" aria-hidden="true" tabindex="-1"></a>partialOLBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1886"><a href="#cb480-1886" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb480-1887"><a href="#cb480-1887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Large"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1888"><a href="#cb480-1888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>)</span>
<span id="cb480-1889"><a href="#cb480-1889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1890"><a href="#cb480-1890" aria-hidden="true" tabindex="-1"></a>partialOSBNT <span class="ot">&lt;-</span> propNegBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1891"><a href="#cb480-1891" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1892"><a href="#cb480-1892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1893"><a href="#cb480-1893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>)</span>
<span id="cb480-1894"><a href="#cb480-1894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1895"><a href="#cb480-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1896"><a href="#cb480-1896" aria-hidden="true" tabindex="-1"></a>partialRiversBNT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partialWBBNT, partialOLBNT, partialOSBNT) <span class="sc">|&gt;</span> </span>
<span id="cb480-1897"><a href="#cb480-1897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-1898"><a href="#cb480-1898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RiverEffect =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span><span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb480-1899"><a href="#cb480-1899" aria-hidden="true" tabindex="-1"></a>         <span class="at">riverOrdered =</span> <span class="fu">factor</span>(riverGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>), </span>
<span id="cb480-1900"><a href="#cb480-1900" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> T))</span>
<span id="cb480-1901"><a href="#cb480-1901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1902"><a href="#cb480-1902" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(partialRiversBNT, <span class="fu">aes</span>(riverOrdered, yhat, <span class="at">fill =</span> <span class="fu">factor</span>(RiverEffect))) <span class="sc">+</span></span>
<span id="cb480-1903"><a href="#cb480-1903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-1904"><a href="#cb480-1904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>)</span>
<span id="cb480-1905"><a href="#cb480-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1906"><a href="#cb480-1906" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb480-1907"><a href="#cb480-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1908"><a href="#cb480-1908" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mT"</span>, <span class="at">X =</span> propNegBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mF_log10"</span>)) <span class="sc">+</span></span>
<span id="cb480-1909"><a href="#cb480-1909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mF_log10), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1910"><a href="#cb480-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1911"><a href="#cb480-1911" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mT"</span>)) <span class="sc">+</span></span>
<span id="cb480-1912"><a href="#cb480-1912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mT), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1913"><a href="#cb480-1913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1914"><a href="#cb480-1914" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb480-1915"><a href="#cb480-1915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1916"><a href="#cb480-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1917"><a href="#cb480-1917" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-1918"><a href="#cb480-1918" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-1919"><a href="#cb480-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1920"><a href="#cb480-1920" aria-hidden="true" tabindex="-1"></a><span class="fu">### Atlantic salmon</span></span>
<span id="cb480-1923"><a href="#cb480-1923" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-1924"><a href="#cb480-1924" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runXGB_ATS</span></span>
<span id="cb480-1925"><a href="#cb480-1925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1926"><a href="#cb480-1926" aria-hidden="true" tabindex="-1"></a><span class="co"># hpPropNegATS &lt;- runHyperparamSearch(</span></span>
<span id="cb480-1927"><a href="#cb480-1927" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt;  filter(speciesGG == "Atlantic salmon", riverGG == "West Brook", year &lt; 2007),</span></span>
<span id="cb480-1928"><a href="#cb480-1928" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb480-1929"><a href="#cb480-1929" aria-hidden="true" tabindex="-1"></a><span class="co">#   early_stopping_roundsIn = 250</span></span>
<span id="cb480-1930"><a href="#cb480-1930" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb480-1931"><a href="#cb480-1931" aria-hidden="true" tabindex="-1"></a><span class="co"># save(hpPropNegATS, file = "./data/out/XGBoost/hyperParam/hpPropNegATS_250.RData")</span></span>
<span id="cb480-1932"><a href="#cb480-1932" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpPropNegATS_250.RData"</span>)</span>
<span id="cb480-1933"><a href="#cb480-1933" aria-hidden="true" tabindex="-1"></a>hpPropNegATS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb480-1934"><a href="#cb480-1934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1935"><a href="#cb480-1935" aria-hidden="true" tabindex="-1"></a>propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Atlantic salmon"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-1936"><a href="#cb480-1936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, n, <span class="at">color =</span> seasonGG)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverGG)</span>
<span id="cb480-1937"><a href="#cb480-1937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1938"><a href="#cb480-1938" aria-hidden="true" tabindex="-1"></a><span class="co"># propNegATS &lt;- runXGB(</span></span>
<span id="cb480-1939"><a href="#cb480-1939" aria-hidden="true" tabindex="-1"></a><span class="co">#   d = propNegSRsN |&gt; filter(speciesGG == "Atlantic salmon", riverGG == "West Brook", year &lt; 2007),</span></span>
<span id="cb480-1940"><a href="#cb480-1940" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars = c("year", "mT", "mF_log10", "nInd", "propNeg"),</span></span>
<span id="cb480-1941"><a href="#cb480-1941" aria-hidden="true" tabindex="-1"></a><span class="co">#   params = hpPropNegATS[1,]</span></span>
<span id="cb480-1942"><a href="#cb480-1942" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb480-1943"><a href="#cb480-1943" aria-hidden="true" tabindex="-1"></a><span class="co"># save(propNegATS, file = "./data/out/XGBoost/modelRuns/XGBpropNegATS_250.RData")</span></span>
<span id="cb480-1944"><a href="#cb480-1944" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBpropNegATS_250.RData"</span>)</span>
<span id="cb480-1945"><a href="#cb480-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1946"><a href="#cb480-1946" aria-hidden="true" tabindex="-1"></a>propNegATS<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span>
<span id="cb480-1947"><a href="#cb480-1947" aria-hidden="true" tabindex="-1"></a>propNegATS<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span>
<span id="cb480-1948"><a href="#cb480-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1949"><a href="#cb480-1949" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb480-1950"><a href="#cb480-1950" aria-hidden="true" tabindex="-1"></a>viATS <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> propNegATS<span class="sc">$</span>xgb)</span>
<span id="cb480-1951"><a href="#cb480-1951" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viATS, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span>
<span id="cb480-1952"><a href="#cb480-1952" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb480-1953"><a href="#cb480-1953" aria-hidden="true" tabindex="-1"></a><span class="co">#s_propNegATS &lt;- hstats(propNegATS$xgb, v = propNegATS$new_vars, X = propNegATS$features_train)</span></span>
<span id="cb480-1954"><a href="#cb480-1954" aria-hidden="true" tabindex="-1"></a><span class="co"># s_propNegATS</span></span>
<span id="cb480-1955"><a href="#cb480-1955" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegATS)</span></span>
<span id="cb480-1956"><a href="#cb480-1956" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-1957"><a href="#cb480-1957" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb480-1958"><a href="#cb480-1958" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_propNegATS, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb480-1959"><a href="#cb480-1959" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-1960"><a href="#cb480-1960" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb480-1961"><a href="#cb480-1961" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_propNegATS, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb480-1962"><a href="#cb480-1962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1963"><a href="#cb480-1963" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb480-1964"><a href="#cb480-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1965"><a href="#cb480-1965" aria-hidden="true" tabindex="-1"></a>pFlow_propNegATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1966"><a href="#cb480-1966" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1967"><a href="#cb480-1967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1968"><a href="#cb480-1968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1969"><a href="#cb480-1969" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb480-1970"><a href="#cb480-1970" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb480-1971"><a href="#cb480-1971" aria-hidden="true" tabindex="-1"></a>pTemp_propNegATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1972"><a href="#cb480-1972" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1973"><a href="#cb480-1973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1974"><a href="#cb480-1974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1975"><a href="#cb480-1975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1976"><a href="#cb480-1976" aria-hidden="true" tabindex="-1"></a>pNInd_propNegATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1977"><a href="#cb480-1977" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1978"><a href="#cb480-1978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1979"><a href="#cb480-1979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1980"><a href="#cb480-1980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1981"><a href="#cb480-1981" aria-hidden="true" tabindex="-1"></a>pYear_propNegATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1982"><a href="#cb480-1982" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-1983"><a href="#cb480-1983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-1984"><a href="#cb480-1984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-1985"><a href="#cb480-1985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1986"><a href="#cb480-1986" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pFlow_propNegATS, pTemp_propNegATS, pNInd_propNegATS, pYear_propNegATS, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb480-1987"><a href="#cb480-1987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1988"><a href="#cb480-1988" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-1989"><a href="#cb480-1989" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb480-1990"><a href="#cb480-1990" aria-hidden="true" tabindex="-1"></a>pFlow_propNegDataATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1991"><a href="#cb480-1991" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mF_log10"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1992"><a href="#cb480-1992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mF_log10<span class="sc">-</span><span class="fu">mean</span>(mF_log10))<span class="sc">/</span><span class="fu">sd</span>(mF_log10),</span>
<span id="cb480-1993"><a href="#cb480-1993" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb480-1994"><a href="#cb480-1994" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb480-1995"><a href="#cb480-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-1996"><a href="#cb480-1996" aria-hidden="true" tabindex="-1"></a>pMT_propNegDataATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-1997"><a href="#cb480-1997" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"mT"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-1998"><a href="#cb480-1998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (mT<span class="sc">-</span><span class="fu">mean</span>(mT))<span class="sc">/</span><span class="fu">sd</span>(mT),</span>
<span id="cb480-1999"><a href="#cb480-1999" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb480-2000"><a href="#cb480-2000" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb480-2001"><a href="#cb480-2001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2002"><a href="#cb480-2002" aria-hidden="true" tabindex="-1"></a>pNInd_propNegDataATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-2003"><a href="#cb480-2003" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-2004"><a href="#cb480-2004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb480-2005"><a href="#cb480-2005" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb480-2006"><a href="#cb480-2006" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb480-2007"><a href="#cb480-2007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2008"><a href="#cb480-2008" aria-hidden="true" tabindex="-1"></a>pYear_propNegDataATS <span class="ot">&lt;-</span> propNegATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-2009"><a href="#cb480-2009" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> propNegATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-2010"><a href="#cb480-2010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb480-2011"><a href="#cb480-2011" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb480-2012"><a href="#cb480-2012" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb480-2013"><a href="#cb480-2013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2014"><a href="#cb480-2014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2015"><a href="#cb480-2015" aria-hidden="true" tabindex="-1"></a>all_propNegDataATS <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pFlow_propNegDataATS, pMT_propNegDataATS, pNInd_propNegDataATS, pYear_propNegDataATS)</span>
<span id="cb480-2016"><a href="#cb480-2016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2017"><a href="#cb480-2017" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb480-2018"><a href="#cb480-2018" aria-hidden="true" tabindex="-1"></a>all_propNegDataATS_gg <span class="ot">&lt;-</span> </span>
<span id="cb480-2019"><a href="#cb480-2019" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_propNegDataATS, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb480-2020"><a href="#cb480-2020" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-2021"><a href="#cb480-2021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-2022"><a href="#cb480-2022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-2023"><a href="#cb480-2023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb480-2024"><a href="#cb480-2024" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-2025"><a href="#cb480-2025" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb480-2026"><a href="#cb480-2026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2027"><a href="#cb480-2027" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mT"</span>, <span class="at">X =</span> propNegATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mF_log10"</span>)) <span class="sc">+</span></span>
<span id="cb480-2028"><a href="#cb480-2028" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mF_log10), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-2029"><a href="#cb480-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2030"><a href="#cb480-2030" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"mT"</span>)) <span class="sc">+</span></span>
<span id="cb480-2031"><a href="#cb480-2031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> mT), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-2032"><a href="#cb480-2032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2033"><a href="#cb480-2033" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(propNegATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"mF_log10"</span>, <span class="at">X =</span> propNegATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb480-2034"><a href="#cb480-2034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-2035"><a href="#cb480-2035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2036"><a href="#cb480-2036" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-2037"><a href="#cb480-2037" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2038"><a href="#cb480-2038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2039"><a href="#cb480-2039" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3 species together</span></span>
<span id="cb480-2042"><a href="#cb480-2042" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2043"><a href="#cb480-2043" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: threeSppVIP</span></span>
<span id="cb480-2044"><a href="#cb480-2044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2045"><a href="#cb480-2045" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plots</span></span>
<span id="cb480-2046"><a href="#cb480-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2047"><a href="#cb480-2047" aria-hidden="true" tabindex="-1"></a>viAll <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb480-2048"><a href="#cb480-2048" aria-hidden="true" tabindex="-1"></a>  viBKT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>),</span>
<span id="cb480-2049"><a href="#cb480-2049" aria-hidden="true" tabindex="-1"></a>  viBNT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>),</span>
<span id="cb480-2050"><a href="#cb480-2050" aria-hidden="true" tabindex="-1"></a>  viATS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb480-2051"><a href="#cb480-2051" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb480-2052"><a href="#cb480-2052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sppOrdered =</span> <span class="fu">factor</span>(speciesGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Brook Trout"</span>, <span class="st">"Brown Trout"</span>, <span class="st">"Atlantic Salmon"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-2053"><a href="#cb480-2053" aria-hidden="true" tabindex="-1"></a>         <span class="at">feature2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb480-2054"><a href="#cb480-2054" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"mF_log10"</span> <span class="sc">~</span> <span class="st">"Flow"</span>,</span>
<span id="cb480-2055"><a href="#cb480-2055" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"mT"</span> <span class="sc">~</span> <span class="st">"Temperature"</span>,</span>
<span id="cb480-2056"><a href="#cb480-2056" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"nInd"</span> <span class="sc">~</span> <span class="st">"Num Individuals"</span>,</span>
<span id="cb480-2057"><a href="#cb480-2057" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"year"</span> <span class="sc">~</span> <span class="st">"Year"</span>)</span>
<span id="cb480-2058"><a href="#cb480-2058" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-2059"><a href="#cb480-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2060"><a href="#cb480-2060" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(viAll <span class="sc">|&gt;</span> <span class="fu">filter</span>(Feature <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"mF_log10"</span>, <span class="st">"mT"</span>, <span class="st">"nInd"</span>, <span class="st">"year"</span>)), <span class="fu">aes</span>(feature2, Gain, <span class="at">fill =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-2061"><a href="#cb480-2061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb480-2062"><a href="#cb480-2062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-2063"><a href="#cb480-2063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>() <span class="sc">+</span></span>
<span id="cb480-2064"><a href="#cb480-2064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Variable importance for the proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Variable"</span>)</span>
<span id="cb480-2065"><a href="#cb480-2065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2066"><a href="#cb480-2066" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################</span></span>
<span id="cb480-2067"><a href="#cb480-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2068"><a href="#cb480-2068" aria-hidden="true" tabindex="-1"></a>all_propNegData3spp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_propNegDataBKT, all_propNegDataBNT, all_propNegDataATS) <span class="sc">|&gt;</span> </span>
<span id="cb480-2069"><a href="#cb480-2069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sppOrdered =</span> <span class="fu">factor</span>(speciesGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Brook Trout"</span>, <span class="st">"Brown Trout"</span>, <span class="st">"Atlantic Salmon"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb480-2070"><a href="#cb480-2070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2071"><a href="#cb480-2071" aria-hidden="true" tabindex="-1"></a>all_propNegData3sppFlow_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Flow"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-2072"><a href="#cb480-2072" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-2073"><a href="#cb480-2073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-2074"><a href="#cb480-2074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-2075"><a href="#cb480-2075" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-2076"><a href="#cb480-2076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled flow"</span>) <span class="sc">+</span></span>
<span id="cb480-2077"><a href="#cb480-2077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-2078"><a href="#cb480-2078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2079"><a href="#cb480-2079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2080"><a href="#cb480-2080" aria-hidden="true" tabindex="-1"></a>all_propNegData3sppTemp_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Temperature"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-2081"><a href="#cb480-2081" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-2082"><a href="#cb480-2082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-2083"><a href="#cb480-2083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-2084"><a href="#cb480-2084" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-2085"><a href="#cb480-2085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled temperature"</span>) <span class="sc">+</span></span>
<span id="cb480-2086"><a href="#cb480-2086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-2087"><a href="#cb480-2087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2088"><a href="#cb480-2088" aria-hidden="true" tabindex="-1"></a>all_propNegData3sppNInd_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Num inds"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-2089"><a href="#cb480-2089" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-2090"><a href="#cb480-2090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-2091"><a href="#cb480-2091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-2092"><a href="#cb480-2092" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-2093"><a href="#cb480-2093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled Number of individuals"</span>) <span class="sc">+</span></span>
<span id="cb480-2094"><a href="#cb480-2094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-2095"><a href="#cb480-2095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2096"><a href="#cb480-2096" aria-hidden="true" tabindex="-1"></a>all_propNegData3sppYear_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_propNegData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Year"</span>), <span class="fu">aes</span>(year, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-2097"><a href="#cb480-2097" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-2098"><a href="#cb480-2098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-2099"><a href="#cb480-2099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-2100"><a href="#cb480-2100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-2101"><a href="#cb480-2101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb480-2102"><a href="#cb480-2102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-2103"><a href="#cb480-2103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2104"><a href="#cb480-2104" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb480-2105"><a href="#cb480-2105" aria-hidden="true" tabindex="-1"></a>  all_propNegData3sppFlow_gg, </span>
<span id="cb480-2106"><a href="#cb480-2106" aria-hidden="true" tabindex="-1"></a>  all_propNegData3sppTemp_gg,</span>
<span id="cb480-2107"><a href="#cb480-2107" aria-hidden="true" tabindex="-1"></a>  all_propNegData3sppNInd_gg,</span>
<span id="cb480-2108"><a href="#cb480-2108" aria-hidden="true" tabindex="-1"></a>  all_propNegData3sppYear_gg,</span>
<span id="cb480-2109"><a href="#cb480-2109" aria-hidden="true" tabindex="-1"></a>  <span class="at">left =</span> <span class="fu">textGrob</span>(<span class="fu">expression</span>(<span class="fu">bold</span>(<span class="st">"Effect on proportion of negative observations"</span>)), <span class="at">rot =</span> <span class="dv">90</span>, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">16</span>))</span>
<span id="cb480-2110"><a href="#cb480-2110" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-2111"><a href="#cb480-2111" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb480-2112"><a href="#cb480-2112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2113"><a href="#cb480-2113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2114"><a href="#cb480-2114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2115"><a href="#cb480-2115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2116"><a href="#cb480-2116" aria-hidden="true" tabindex="-1"></a><span class="fu">## F/T cycle graphs</span></span>
<span id="cb480-2117"><a href="#cb480-2117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2118"><a href="#cb480-2118" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean flow and temperature</span></span>
<span id="cb480-2119"><a href="#cb480-2119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2122"><a href="#cb480-2122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2123"><a href="#cb480-2123" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_temp_cycle_bySpecies</span></span>
<span id="cb480-2124"><a href="#cb480-2124" aria-hidden="true" tabindex="-1"></a>plot_mT_mF <span class="ot">&lt;-</span> <span class="cf">function</span>(d, s, plotText){</span>
<span id="cb480-2125"><a href="#cb480-2125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">25</span>, speciesGG <span class="sc">==</span> s), <span class="fu">aes</span>(mT, mF_log10, <span class="at">color =</span> <span class="fu">factor</span>(seasonGG))) <span class="sc">+</span></span>
<span id="cb480-2126"><a href="#cb480-2126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> propNeg)) <span class="sc">+</span></span>
<span id="cb480-2127"><a href="#cb480-2127" aria-hidden="true" tabindex="-1"></a>    {<span class="cf">if</span>(plotText) <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> year), <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.075</span>, <span class="at">check_overlap =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">3</span>)} <span class="sc">+</span></span>
<span id="cb480-2128"><a href="#cb480-2128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean temperature (C)"</span>, <span class="at">y =</span> <span class="st">"log10 of mean Flow"</span>) <span class="sc">+</span></span>
<span id="cb480-2129"><a href="#cb480-2129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-2130"><a href="#cb480-2130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-2131"><a href="#cb480-2131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2132"><a href="#cb480-2132" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2133"><a href="#cb480-2133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2134"><a href="#cb480-2134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2135"><a href="#cb480-2135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2136"><a href="#cb480-2136" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-2137"><a href="#cb480-2137" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout</span></span>
<span id="cb480-2138"><a href="#cb480-2138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2141"><a href="#cb480-2141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2142"><a href="#cb480-2142" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_temp_cycle_bySpecies_bkt</span></span>
<span id="cb480-2143"><a href="#cb480-2143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2144"><a href="#cb480-2144" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Brook trout"</span>, <span class="cn">FALSE</span>)</span>
<span id="cb480-2145"><a href="#cb480-2145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2146"><a href="#cb480-2146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2147"><a href="#cb480-2147" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-2148"><a href="#cb480-2148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2151"><a href="#cb480-2151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2152"><a href="#cb480-2152" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_temp_cycle_bySpecies_bnt</span></span>
<span id="cb480-2153"><a href="#cb480-2153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2154"><a href="#cb480-2154" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Brown trout"</span>, <span class="cn">FALSE</span>)</span>
<span id="cb480-2155"><a href="#cb480-2155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2156"><a href="#cb480-2156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2157"><a href="#cb480-2157" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-2158"><a href="#cb480-2158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2161"><a href="#cb480-2161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2162"><a href="#cb480-2162" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_temp_cycle_bySpecies_ats</span></span>
<span id="cb480-2163"><a href="#cb480-2163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2164"><a href="#cb480-2164" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Atlantic salmon"</span>, <span class="cn">FALSE</span>)</span>
<span id="cb480-2165"><a href="#cb480-2165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2166"><a href="#cb480-2166" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-2167"><a href="#cb480-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2168"><a href="#cb480-2168" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean flow and temperature with year labels</span></span>
<span id="cb480-2169"><a href="#cb480-2169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2170"><a href="#cb480-2170" aria-hidden="true" tabindex="-1"></a><span class="fu">#### panel-tabset</span></span>
<span id="cb480-2171"><a href="#cb480-2171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2172"><a href="#cb480-2172" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brook trout</span></span>
<span id="cb480-2173"><a href="#cb480-2173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2176"><a href="#cb480-2176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2177"><a href="#cb480-2177" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_temp_cycle_bySpeciesYear_bkt</span></span>
<span id="cb480-2178"><a href="#cb480-2178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2179"><a href="#cb480-2179" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Brook trout"</span>, <span class="cn">TRUE</span>)</span>
<span id="cb480-2180"><a href="#cb480-2180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2181"><a href="#cb480-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2182"><a href="#cb480-2182" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout</span></span>
<span id="cb480-2183"><a href="#cb480-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2186"><a href="#cb480-2186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2187"><a href="#cb480-2187" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_temp_cycle_bySpeciesYear_bnt</span></span>
<span id="cb480-2188"><a href="#cb480-2188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2189"><a href="#cb480-2189" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Brown trout"</span>, <span class="cn">TRUE</span>)</span>
<span id="cb480-2190"><a href="#cb480-2190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2191"><a href="#cb480-2191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2192"><a href="#cb480-2192" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Atlantic salmon</span></span>
<span id="cb480-2193"><a href="#cb480-2193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2196"><a href="#cb480-2196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2197"><a href="#cb480-2197" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_temp_cycle_bySpeciesYear_ats</span></span>
<span id="cb480-2198"><a href="#cb480-2198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2199"><a href="#cb480-2199" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mT_mF</span>(propNegSRsN, <span class="st">"Atlantic salmon"</span>, <span class="cn">TRUE</span>)</span>
<span id="cb480-2200"><a href="#cb480-2200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2201"><a href="#cb480-2201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2202"><a href="#cb480-2202" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-2203"><a href="#cb480-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2204"><a href="#cb480-2204" aria-hidden="true" tabindex="-1"></a>Mean flow and temperature values for each season and year for the West</span>
<span id="cb480-2205"><a href="#cb480-2205" aria-hidden="true" tabindex="-1"></a>Brook\</span>
<span id="cb480-2206"><a href="#cb480-2206" aria-hidden="true" tabindex="-1"></a>Not very informative</span>
<span id="cb480-2207"><a href="#cb480-2207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2210"><a href="#cb480-2210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2211"><a href="#cb480-2211" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flow_temp_cycle_bySpeciesYear2</span></span>
<span id="cb480-2212"><a href="#cb480-2212" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2213"><a href="#cb480-2213" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propNegSRsN <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">10</span>, riverGG <span class="sc">==</span> <span class="st">'West Brook'</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(riverGG, speciesGG, year, seasonGG), <span class="fu">aes</span>(mT, mF_log10)) <span class="sc">+</span></span>
<span id="cb480-2214"><a href="#cb480-2214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb480-2215"><a href="#cb480-2215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(seasonGG))) <span class="sc">+</span></span>
<span id="cb480-2216"><a href="#cb480-2216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)</span>
<span id="cb480-2217"><a href="#cb480-2217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2218"><a href="#cb480-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2219"><a href="#cb480-2219" aria-hidden="true" tabindex="-1"></a><span class="fu">### Yearly temperature/flow cycles of daily data</span></span>
<span id="cb480-2220"><a href="#cb480-2220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2223"><a href="#cb480-2223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2224"><a href="#cb480-2224" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mergePropNegPlot</span></span>
<span id="cb480-2225"><a href="#cb480-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2226"><a href="#cb480-2226" aria-hidden="true" tabindex="-1"></a>plotMerged <span class="ot">&lt;-</span> <span class="cf">function</span>(d, r, <span class="at">minYear =</span> <span class="dv">2000</span>, <span class="at">maxYear =</span> <span class="dv">2017</span>){</span>
<span id="cb480-2227"><a href="#cb480-2227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(riverGG <span class="sc">==</span> r, year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear)), </span>
<span id="cb480-2228"><a href="#cb480-2228" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(temperature, <span class="fu">log10</span>(flowByRiver), <span class="at">color =</span> seasonGG, <span class="at">group =</span> seasonGG)) <span class="sc">+</span></span>
<span id="cb480-2229"><a href="#cb480-2229" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-2230"><a href="#cb480-2230" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-2231"><a href="#cb480-2231" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_line() +</span></span>
<span id="cb480-2232"><a href="#cb480-2232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (C)"</span>, <span class="at">y =</span> <span class="st">"log10 of Flow"</span>) <span class="sc">+</span></span>
<span id="cb480-2233"><a href="#cb480-2233" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-2234"><a href="#cb480-2234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(r) <span class="sc">+</span></span>
<span id="cb480-2235"><a href="#cb480-2235" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-2236"><a href="#cb480-2236" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>year, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb480-2237"><a href="#cb480-2237" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2238"><a href="#cb480-2238" aria-hidden="true" tabindex="-1"></a><span class="co"># this plots f/t for all three species - good for filling in gaps</span></span>
<span id="cb480-2239"><a href="#cb480-2239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2240"><a href="#cb480-2240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2241"><a href="#cb480-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2242"><a href="#cb480-2242" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-2243"><a href="#cb480-2243" aria-hidden="true" tabindex="-1"></a><span class="fu">#### West Brook</span></span>
<span id="cb480-2244"><a href="#cb480-2244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2247"><a href="#cb480-2247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2248"><a href="#cb480-2248" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mergePropNegPlot_wb</span></span>
<span id="cb480-2249"><a href="#cb480-2249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2250"><a href="#cb480-2250" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMerged</span>(envIn_propNeg, <span class="st">"West Brook"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2251"><a href="#cb480-2251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2252"><a href="#cb480-2252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2253"><a href="#cb480-2253" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Open Large</span></span>
<span id="cb480-2254"><a href="#cb480-2254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2257"><a href="#cb480-2257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2258"><a href="#cb480-2258" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mergePropNegPlot_ol</span></span>
<span id="cb480-2259"><a href="#cb480-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2260"><a href="#cb480-2260" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMerged</span>(envIn_propNeg, <span class="st">"Open Large"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2261"><a href="#cb480-2261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2262"><a href="#cb480-2262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2263"><a href="#cb480-2263" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Open Small</span></span>
<span id="cb480-2264"><a href="#cb480-2264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2267"><a href="#cb480-2267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2268"><a href="#cb480-2268" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mergePropNegPlot_os</span></span>
<span id="cb480-2269"><a href="#cb480-2269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2270"><a href="#cb480-2270" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMerged</span>(envIn_propNeg, <span class="st">"Open Small"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2271"><a href="#cb480-2271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2272"><a href="#cb480-2272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2273"><a href="#cb480-2273" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Isolated small</span></span>
<span id="cb480-2274"><a href="#cb480-2274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2277"><a href="#cb480-2277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2278"><a href="#cb480-2278" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fmergePropNegPlot_is</span></span>
<span id="cb480-2279"><a href="#cb480-2279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2280"><a href="#cb480-2280" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMerged</span>(envIn_propNeg, <span class="st">"Isolated Small"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2281"><a href="#cb480-2281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2282"><a href="#cb480-2282" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-2283"><a href="#cb480-2283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2284"><a href="#cb480-2284" aria-hidden="true" tabindex="-1"></a><span class="fu">### Smooths of temperature/flow cycles of daily data by season</span></span>
<span id="cb480-2285"><a href="#cb480-2285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2288"><a href="#cb480-2288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2289"><a href="#cb480-2289" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plotMergedBySeason</span></span>
<span id="cb480-2290"><a href="#cb480-2290" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb480-2291"><a href="#cb480-2291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2292"><a href="#cb480-2292" aria-hidden="true" tabindex="-1"></a>plotMergedBySeason <span class="ot">&lt;-</span> <span class="cf">function</span>(d, r, <span class="at">minYear =</span> <span class="dv">2000</span>, <span class="at">maxYear =</span> <span class="dv">2017</span>) {</span>
<span id="cb480-2293"><a href="#cb480-2293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(riverGG <span class="sc">==</span> r, year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear), <span class="sc">!</span><span class="fu">is.na</span>(seasonGG)), </span>
<span id="cb480-2294"><a href="#cb480-2294" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(temperature, <span class="fu">log10</span>(flowByRiver), </span>
<span id="cb480-2295"><a href="#cb480-2295" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">factor</span>(year), <span class="at">group =</span> year</span>
<span id="cb480-2296"><a href="#cb480-2296" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb480-2297"><a href="#cb480-2297" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb480-2298"><a href="#cb480-2298" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point() +</span></span>
<span id="cb480-2299"><a href="#cb480-2299" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-2300"><a href="#cb480-2300" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (C)"</span>, <span class="at">y =</span> <span class="st">"log10 of Flow"</span>) <span class="sc">+</span></span>
<span id="cb480-2301"><a href="#cb480-2301" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-2302"><a href="#cb480-2302" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(r) <span class="sc">+</span></span>
<span id="cb480-2303"><a href="#cb480-2303" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>(<span class="at">legendPosition =</span> <span class="st">"right"</span>, <span class="at">legendDirection =</span> <span class="st">"vertical"</span>) <span class="sc">+</span>  </span>
<span id="cb480-2304"><a href="#cb480-2304" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb480-2305"><a href="#cb480-2305" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2306"><a href="#cb480-2306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2307"><a href="#cb480-2307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2308"><a href="#cb480-2308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2309"><a href="#cb480-2309" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-2310"><a href="#cb480-2310" aria-hidden="true" tabindex="-1"></a><span class="fu">#### West Brook</span></span>
<span id="cb480-2311"><a href="#cb480-2311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2314"><a href="#cb480-2314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2315"><a href="#cb480-2315" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plotMergedBySeason_wb</span></span>
<span id="cb480-2316"><a href="#cb480-2316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2317"><a href="#cb480-2317" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeason</span>(envIn_propNeg, <span class="st">"West Brook"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2318"><a href="#cb480-2318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2319"><a href="#cb480-2319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2320"><a href="#cb480-2320" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Open Large</span></span>
<span id="cb480-2321"><a href="#cb480-2321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2324"><a href="#cb480-2324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2325"><a href="#cb480-2325" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plotMergedBySeason_ol</span></span>
<span id="cb480-2326"><a href="#cb480-2326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2327"><a href="#cb480-2327" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeason</span>(envIn_propNeg, <span class="st">"Open Large"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2328"><a href="#cb480-2328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2329"><a href="#cb480-2329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2330"><a href="#cb480-2330" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Open Small</span></span>
<span id="cb480-2331"><a href="#cb480-2331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2334"><a href="#cb480-2334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2335"><a href="#cb480-2335" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plotMergedBySeason_os</span></span>
<span id="cb480-2336"><a href="#cb480-2336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2337"><a href="#cb480-2337" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeason</span>(envIn_propNeg, <span class="st">"Open Small"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2338"><a href="#cb480-2338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2339"><a href="#cb480-2339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2340"><a href="#cb480-2340" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Isolated small</span></span>
<span id="cb480-2341"><a href="#cb480-2341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2344"><a href="#cb480-2344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2345"><a href="#cb480-2345" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plotMergedBySeason_is</span></span>
<span id="cb480-2346"><a href="#cb480-2346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2347"><a href="#cb480-2347" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeason</span>(envIn_propNeg, <span class="st">"Isolated Small"</span>, <span class="dv">2002</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2348"><a href="#cb480-2348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2349"><a href="#cb480-2349" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-2350"><a href="#cb480-2350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2351"><a href="#cb480-2351" aria-hidden="true" tabindex="-1"></a>TO ADD: low flow high density important? Look at interaction btw</span>
<span id="cb480-2352"><a href="#cb480-2352" aria-hidden="true" tabindex="-1"></a>flow:density</span>
<span id="cb480-2353"><a href="#cb480-2353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2354"><a href="#cb480-2354" aria-hidden="true" tabindex="-1"></a><span class="fu">### F/T cycles with labels</span></span>
<span id="cb480-2355"><a href="#cb480-2355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2356"><a href="#cb480-2356" aria-hidden="true" tabindex="-1"></a>Plot F/T cycles by river, season, species with label for propNeg and</span>
<span id="cb480-2357"><a href="#cb480-2357" aria-hidden="true" tabindex="-1"></a>conspecific and all-species abundances</span>
<span id="cb480-2358"><a href="#cb480-2358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2361"><a href="#cb480-2361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2362"><a href="#cb480-2362" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plotMergedBySeasonByEverything</span></span>
<span id="cb480-2363"><a href="#cb480-2363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2364"><a href="#cb480-2364" aria-hidden="true" tabindex="-1"></a>plotMergedBySeasonByEverything <span class="ot">&lt;-</span> <span class="cf">function</span>(d, d2, r, s, spp, <span class="at">minYear =</span> <span class="dv">2000</span>, <span class="at">maxYear =</span> <span class="dv">2017</span>){</span>
<span id="cb480-2365"><a href="#cb480-2365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> </span>
<span id="cb480-2366"><a href="#cb480-2366" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(riverGG <span class="sc">==</span> r,</span>
<span id="cb480-2367"><a href="#cb480-2367" aria-hidden="true" tabindex="-1"></a>                  year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear), </span>
<span id="cb480-2368"><a href="#cb480-2368" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(seasonGG), </span>
<span id="cb480-2369"><a href="#cb480-2369" aria-hidden="true" tabindex="-1"></a>                  seasonGG <span class="sc">==</span> s, </span>
<span id="cb480-2370"><a href="#cb480-2370" aria-hidden="true" tabindex="-1"></a>                  speciesGG <span class="sc">==</span> spp), </span>
<span id="cb480-2371"><a href="#cb480-2371" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(temperature, <span class="fu">log10</span>(flowByRiver))</span>
<span id="cb480-2372"><a href="#cb480-2372" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb480-2373"><a href="#cb480-2373" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>) <span class="sc">+</span></span>
<span id="cb480-2374"><a href="#cb480-2374" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> yday)) <span class="sc">+</span></span>
<span id="cb480-2375"><a href="#cb480-2375" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb480-2376"><a href="#cb480-2376" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> minTemp <span class="sc">+</span> <span class="fl">3.0</span>, </span>
<span id="cb480-2377"><a href="#cb480-2377" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">log10</span>(minFlow) <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb480-2378"><a href="#cb480-2378" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"propNeg="</span>,<span class="fu">round</span>(propNeg, <span class="dv">2</span>)) </span>
<span id="cb480-2379"><a href="#cb480-2379" aria-hidden="true" tabindex="-1"></a>      <span class="co">#size = propNeg</span></span>
<span id="cb480-2380"><a href="#cb480-2380" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb480-2381"><a href="#cb480-2381" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> d2<span class="sc">|&gt;</span> </span>
<span id="cb480-2382"><a href="#cb480-2382" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(riverGG <span class="sc">==</span> r, </span>
<span id="cb480-2383"><a href="#cb480-2383" aria-hidden="true" tabindex="-1"></a>                 year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear),</span>
<span id="cb480-2384"><a href="#cb480-2384" aria-hidden="true" tabindex="-1"></a>                 seasonGG <span class="sc">==</span> s, </span>
<span id="cb480-2385"><a href="#cb480-2385" aria-hidden="true" tabindex="-1"></a>                 speciesGG <span class="sc">==</span> spp)</span>
<span id="cb480-2386"><a href="#cb480-2386" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb480-2387"><a href="#cb480-2387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb480-2388"><a href="#cb480-2388" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> minTemp <span class="sc">+</span> <span class="fl">3.0</span>,</span>
<span id="cb480-2389"><a href="#cb480-2389" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">log10</span>(minFlow) <span class="sc">-</span> <span class="fl">0.3</span>,</span>
<span id="cb480-2390"><a href="#cb480-2390" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">paste</span>(<span class="st">"nIndAllSpp="</span>, nInd), <span class="fu">paste</span>(<span class="st">"nIndBySpp="</span>, nIndBySpp), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb480-2391"><a href="#cb480-2391" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb480-2392"><a href="#cb480-2392" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> d2<span class="sc">|&gt;</span></span>
<span id="cb480-2393"><a href="#cb480-2393" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(riverGG <span class="sc">==</span> r,</span>
<span id="cb480-2394"><a href="#cb480-2394" aria-hidden="true" tabindex="-1"></a>                 year <span class="sc">%in%</span> <span class="fu">c</span>(minYear<span class="sc">:</span>maxYear),</span>
<span id="cb480-2395"><a href="#cb480-2395" aria-hidden="true" tabindex="-1"></a>                 seasonGG <span class="sc">==</span> s,</span>
<span id="cb480-2396"><a href="#cb480-2396" aria-hidden="true" tabindex="-1"></a>                 speciesGG <span class="sc">==</span> spp)</span>
<span id="cb480-2397"><a href="#cb480-2397" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb480-2398"><a href="#cb480-2398" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (c)"</span>, <span class="at">y =</span> <span class="st">"log10 Flow"</span>) <span class="sc">+</span></span>
<span id="cb480-2399"><a href="#cb480-2399" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(r, s, spp, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2400"><a href="#cb480-2400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-2401"><a href="#cb480-2401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year)</span>
<span id="cb480-2402"><a href="#cb480-2402" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2403"><a href="#cb480-2403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2404"><a href="#cb480-2404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2405"><a href="#cb480-2405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2406"><a href="#cb480-2406" aria-hidden="true" tabindex="-1"></a><span class="fu">#### West Brook</span></span>
<span id="cb480-2407"><a href="#cb480-2407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2408"><a href="#cb480-2408" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-2409"><a href="#cb480-2409" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spring</span></span>
<span id="cb480-2410"><a href="#cb480-2410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2413"><a href="#cb480-2413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2414"><a href="#cb480-2414" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: WBPanelSpring</span></span>
<span id="cb480-2415"><a href="#cb480-2415" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2416"><a href="#cb480-2416" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2417"><a href="#cb480-2417" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2418"><a href="#cb480-2418" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Spring"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2419"><a href="#cb480-2419" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Spring"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2420"><a href="#cb480-2420" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Spring"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2421"><a href="#cb480-2421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2422"><a href="#cb480-2422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2423"><a href="#cb480-2423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2424"><a href="#cb480-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2425"><a href="#cb480-2425" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summer</span></span>
<span id="cb480-2426"><a href="#cb480-2426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2429"><a href="#cb480-2429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2430"><a href="#cb480-2430" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: WBPanelSummer</span></span>
<span id="cb480-2431"><a href="#cb480-2431" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2432"><a href="#cb480-2432" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2433"><a href="#cb480-2433" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Summer"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2434"><a href="#cb480-2434" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Summer"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2435"><a href="#cb480-2435" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Summer"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2436"><a href="#cb480-2436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2437"><a href="#cb480-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2438"><a href="#cb480-2438" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Autumn</span></span>
<span id="cb480-2439"><a href="#cb480-2439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2442"><a href="#cb480-2442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2443"><a href="#cb480-2443" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: WBPanelAutumn</span></span>
<span id="cb480-2444"><a href="#cb480-2444" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2445"><a href="#cb480-2445" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2446"><a href="#cb480-2446" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2447"><a href="#cb480-2447" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2448"><a href="#cb480-2448" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2449"><a href="#cb480-2449" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Autumn"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2450"><a href="#cb480-2450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2451"><a href="#cb480-2451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2452"><a href="#cb480-2452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2453"><a href="#cb480-2453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2454"><a href="#cb480-2454" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Winter</span></span>
<span id="cb480-2455"><a href="#cb480-2455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2458"><a href="#cb480-2458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2459"><a href="#cb480-2459" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: WBPanelWinter</span></span>
<span id="cb480-2460"><a href="#cb480-2460" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2461"><a href="#cb480-2461" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2462"><a href="#cb480-2462" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Winter"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2463"><a href="#cb480-2463" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Winter"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2464"><a href="#cb480-2464" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"West Brook"</span>, <span class="st">"Winter"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2465"><a href="#cb480-2465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2466"><a href="#cb480-2466" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-2467"><a href="#cb480-2467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2468"><a href="#cb480-2468" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Open Large</span></span>
<span id="cb480-2469"><a href="#cb480-2469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2470"><a href="#cb480-2470" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-2471"><a href="#cb480-2471" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spring</span></span>
<span id="cb480-2472"><a href="#cb480-2472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2475"><a href="#cb480-2475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2476"><a href="#cb480-2476" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: OLpanelSpring</span></span>
<span id="cb480-2477"><a href="#cb480-2477" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2478"><a href="#cb480-2478" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2479"><a href="#cb480-2479" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2480"><a href="#cb480-2480" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Spring"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2481"><a href="#cb480-2481" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Spring"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2482"><a href="#cb480-2482" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Spring"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2483"><a href="#cb480-2483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2484"><a href="#cb480-2484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2485"><a href="#cb480-2485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2486"><a href="#cb480-2486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2487"><a href="#cb480-2487" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summer</span></span>
<span id="cb480-2488"><a href="#cb480-2488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2491"><a href="#cb480-2491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2492"><a href="#cb480-2492" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: OLPanelSummer</span></span>
<span id="cb480-2493"><a href="#cb480-2493" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2494"><a href="#cb480-2494" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2495"><a href="#cb480-2495" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Summer"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2496"><a href="#cb480-2496" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Summer"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2497"><a href="#cb480-2497" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Summer"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2498"><a href="#cb480-2498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2499"><a href="#cb480-2499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2500"><a href="#cb480-2500" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Autumn</span></span>
<span id="cb480-2501"><a href="#cb480-2501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2504"><a href="#cb480-2504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2505"><a href="#cb480-2505" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: OLPanelAutumn</span></span>
<span id="cb480-2506"><a href="#cb480-2506" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2507"><a href="#cb480-2507" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2508"><a href="#cb480-2508" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2509"><a href="#cb480-2509" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2510"><a href="#cb480-2510" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2511"><a href="#cb480-2511" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Autumn"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2512"><a href="#cb480-2512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2513"><a href="#cb480-2513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2514"><a href="#cb480-2514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2515"><a href="#cb480-2515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2516"><a href="#cb480-2516" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Winter</span></span>
<span id="cb480-2517"><a href="#cb480-2517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2520"><a href="#cb480-2520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2521"><a href="#cb480-2521" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: OLPanelWinter</span></span>
<span id="cb480-2522"><a href="#cb480-2522" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2523"><a href="#cb480-2523" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2524"><a href="#cb480-2524" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Winter"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2525"><a href="#cb480-2525" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Winter"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2526"><a href="#cb480-2526" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Large"</span>, <span class="st">"Winter"</span>, <span class="st">"Atlantic salmon"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2527"><a href="#cb480-2527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2528"><a href="#cb480-2528" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-2529"><a href="#cb480-2529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2530"><a href="#cb480-2530" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Open Small</span></span>
<span id="cb480-2531"><a href="#cb480-2531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2532"><a href="#cb480-2532" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-2533"><a href="#cb480-2533" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spring</span></span>
<span id="cb480-2534"><a href="#cb480-2534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2537"><a href="#cb480-2537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2538"><a href="#cb480-2538" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: OSPanelSpring</span></span>
<span id="cb480-2539"><a href="#cb480-2539" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2540"><a href="#cb480-2540" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2541"><a href="#cb480-2541" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2542"><a href="#cb480-2542" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Spring"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2543"><a href="#cb480-2543" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Spring"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2544"><a href="#cb480-2544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2545"><a href="#cb480-2545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2546"><a href="#cb480-2546" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summer</span></span>
<span id="cb480-2547"><a href="#cb480-2547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2550"><a href="#cb480-2550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2551"><a href="#cb480-2551" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: OSPanelSummer</span></span>
<span id="cb480-2552"><a href="#cb480-2552" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2553"><a href="#cb480-2553" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2554"><a href="#cb480-2554" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Summer"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2555"><a href="#cb480-2555" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Summer"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2556"><a href="#cb480-2556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2557"><a href="#cb480-2557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2558"><a href="#cb480-2558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2559"><a href="#cb480-2559" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Autumn</span></span>
<span id="cb480-2560"><a href="#cb480-2560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2563"><a href="#cb480-2563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2564"><a href="#cb480-2564" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: OSPanelAutumn</span></span>
<span id="cb480-2565"><a href="#cb480-2565" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2566"><a href="#cb480-2566" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2567"><a href="#cb480-2567" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2568"><a href="#cb480-2568" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2569"><a href="#cb480-2569" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2570"><a href="#cb480-2570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2571"><a href="#cb480-2571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2572"><a href="#cb480-2572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2573"><a href="#cb480-2573" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Winter</span></span>
<span id="cb480-2574"><a href="#cb480-2574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2577"><a href="#cb480-2577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2578"><a href="#cb480-2578" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: OSPanelWinter</span></span>
<span id="cb480-2579"><a href="#cb480-2579" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2580"><a href="#cb480-2580" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2581"><a href="#cb480-2581" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Winter"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2582"><a href="#cb480-2582" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Open Small"</span>, <span class="st">"Winter"</span>, <span class="st">"Brown trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2583"><a href="#cb480-2583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2584"><a href="#cb480-2584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2585"><a href="#cb480-2585" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-2586"><a href="#cb480-2586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2587"><a href="#cb480-2587" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Isolated Small</span></span>
<span id="cb480-2588"><a href="#cb480-2588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2589"><a href="#cb480-2589" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb480-2590"><a href="#cb480-2590" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spring</span></span>
<span id="cb480-2591"><a href="#cb480-2591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2594"><a href="#cb480-2594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2595"><a href="#cb480-2595" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ISPanelSpring</span></span>
<span id="cb480-2596"><a href="#cb480-2596" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2597"><a href="#cb480-2597" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2598"><a href="#cb480-2598" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2599"><a href="#cb480-2599" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Isolated Small"</span>, <span class="st">"Spring"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2600"><a href="#cb480-2600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2601"><a href="#cb480-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2602"><a href="#cb480-2602" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summer</span></span>
<span id="cb480-2603"><a href="#cb480-2603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2606"><a href="#cb480-2606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2607"><a href="#cb480-2607" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ISPanelSummer</span></span>
<span id="cb480-2608"><a href="#cb480-2608" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2609"><a href="#cb480-2609" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2610"><a href="#cb480-2610" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Isolated Small"</span>, <span class="st">"Summer"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2611"><a href="#cb480-2611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2612"><a href="#cb480-2612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2613"><a href="#cb480-2613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2614"><a href="#cb480-2614" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Autumn</span></span>
<span id="cb480-2615"><a href="#cb480-2615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2618"><a href="#cb480-2618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2619"><a href="#cb480-2619" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ISPanelAutumn</span></span>
<span id="cb480-2620"><a href="#cb480-2620" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2621"><a href="#cb480-2621" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2622"><a href="#cb480-2622" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-2623"><a href="#cb480-2623" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Isolated Small"</span>, <span class="st">"Autumn"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2624"><a href="#cb480-2624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2625"><a href="#cb480-2625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2626"><a href="#cb480-2626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2627"><a href="#cb480-2627" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Winter</span></span>
<span id="cb480-2628"><a href="#cb480-2628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2631"><a href="#cb480-2631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2632"><a href="#cb480-2632" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ISPanelWinter</span></span>
<span id="cb480-2633"><a href="#cb480-2633" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 13</span></span>
<span id="cb480-2634"><a href="#cb480-2634" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb480-2635"><a href="#cb480-2635" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMergedBySeasonByEverything</span>(envIn_propNeg, propNegLabels, <span class="st">"Isolated Small"</span>, <span class="st">"Winter"</span>, <span class="st">"Brook trout"</span>, <span class="dv">2000</span>, <span class="dv">2017</span>)</span>
<span id="cb480-2636"><a href="#cb480-2636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2637"><a href="#cb480-2637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2638"><a href="#cb480-2638" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb480-2639"><a href="#cb480-2639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2640"><a href="#cb480-2640" aria-hidden="true" tabindex="-1"></a><span class="fu">## Consequences of negative growth</span></span>
<span id="cb480-2641"><a href="#cb480-2641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2642"><a href="#cb480-2642" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth and last observation  </span></span>
<span id="cb480-2643"><a href="#cb480-2643" aria-hidden="true" tabindex="-1"></a><span class="fu">#### All years  </span></span>
<span id="cb480-2644"><a href="#cb480-2644" aria-hidden="true" tabindex="-1"></a>Mean number of last observed sample as response variable</span>
<span id="cb480-2647"><a href="#cb480-2647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2648"><a href="#cb480-2648" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_samplesLeftMean</span></span>
<span id="cb480-2649"><a href="#cb480-2649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2650"><a href="#cb480-2650" aria-hidden="true" tabindex="-1"></a>plot_negGr_beforeLastMean <span class="ot">&lt;-</span> <span class="cf">function</span>(sppIn) {</span>
<span id="cb480-2651"><a href="#cb480-2651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(negGr_beforeLastMean <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> sppIn, seasonGG <span class="sc">!=</span> <span class="st">"Spring"</span>), <span class="fu">aes</span>(negGrowth, meanSamplesBeforeLast, <span class="at">fill =</span> negGrowth)) <span class="sc">+</span></span>
<span id="cb480-2652"><a href="#cb480-2652" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb480-2653"><a href="#cb480-2653" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2654"><a href="#cb480-2654" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)    </span>
<span id="cb480-2655"><a href="#cb480-2655" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2656"><a href="#cb480-2656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2657"><a href="#cb480-2657" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_negGr_beforeLastMean</span>(<span class="st">"Brook trout"</span>)</span>
<span id="cb480-2658"><a href="#cb480-2658" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_negGr_beforeLastMean</span>(<span class="st">"Brown trout"</span>)</span>
<span id="cb480-2659"><a href="#cb480-2659" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_negGr_beforeLastMean</span>(<span class="st">"Atlantic salmon"</span>)</span>
<span id="cb480-2660"><a href="#cb480-2660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2661"><a href="#cb480-2661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(negGr_beforeLastMean <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, seasonGG <span class="sc">!=</span> <span class="st">"Spring"</span>), <span class="fu">aes</span>(meanGR, meanSamplesBeforeLast)) <span class="sc">+</span></span>
<span id="cb480-2662"><a href="#cb480-2662" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> riverGG, <span class="at">shape =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-2663"><a href="#cb480-2663" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">shape =</span> riverGG, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-2664"><a href="#cb480-2664" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_smooth(method = "lm", se = FALSE) +</span></span>
<span id="cb480-2665"><a href="#cb480-2665" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2666"><a href="#cb480-2666" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2667"><a href="#cb480-2667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2668"><a href="#cb480-2668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2669"><a href="#cb480-2669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2670"><a href="#cb480-2670" aria-hidden="true" tabindex="-1"></a><span class="fu">#### By year</span></span>
<span id="cb480-2673"><a href="#cb480-2673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2674"><a href="#cb480-2674" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_samplesLeftMean_year</span></span>
<span id="cb480-2675"><a href="#cb480-2675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2676"><a href="#cb480-2676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(negGr_beforeLastMean_year <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">2</span>, year <span class="sc">&gt;</span> <span class="dv">2001</span>, year <span class="sc">&lt;</span> <span class="dv">2015</span>, speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, seasonGG <span class="sc">!=</span> <span class="st">"Spring"</span>), <span class="fu">aes</span>(meanGR, meanSamplesBeforeLast)) <span class="sc">+</span></span>
<span id="cb480-2677"><a href="#cb480-2677" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> riverGG, <span class="at">shape =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-2678"><a href="#cb480-2678" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">shape =</span> riverGG, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-2679"><a href="#cb480-2679" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_smooth(method = "lm", se = FALSE) +</span></span>
<span id="cb480-2680"><a href="#cb480-2680" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2681"><a href="#cb480-2681" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> year, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2682"><a href="#cb480-2682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2683"><a href="#cb480-2683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2684"><a href="#cb480-2684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2685"><a href="#cb480-2685" aria-hidden="true" tabindex="-1"></a>Split data by samplesBeforeLast = 1 and samplesBeforeLast &gt; 1.  </span>
<span id="cb480-2686"><a href="#cb480-2686" aria-hidden="true" tabindex="-1"></a>The graph shows mean growth for fish that were caught for the last time in the next sample or at some later sample</span>
<span id="cb480-2689"><a href="#cb480-2689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2690"><a href="#cb480-2690" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_samplesLeft01</span></span>
<span id="cb480-2691"><a href="#cb480-2691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2692"><a href="#cb480-2692" aria-hidden="true" tabindex="-1"></a>numSamplesBeforeLastGT1_data <span class="ot">&lt;-</span>  cd1 <span class="sc">|&gt;</span></span>
<span id="cb480-2693"><a href="#cb480-2693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numSamplesBeforeLastGT1 =</span> samplesBeforeLast <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-2694"><a href="#cb480-2694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)) <span class="sc">|&gt;</span> </span>
<span id="cb480-2695"><a href="#cb480-2695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(speciesGG, riverGG, seasonGG, numSamplesBeforeLastGT1) <span class="sc">|&gt;</span> </span>
<span id="cb480-2696"><a href="#cb480-2696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb480-2697"><a href="#cb480-2697" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanGR =</span> <span class="fu">mean</span>(grWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-2698"><a href="#cb480-2698" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdGR =</span> <span class="fu">sd</span>(grWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-2699"><a href="#cb480-2699" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanSamplesBeforeLast =</span> <span class="fu">mean</span>(samplesBeforeLast, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-2700"><a href="#cb480-2700" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdSamplesBeforeLast =</span> <span class="fu">sd</span>(samplesBeforeLast, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-2701"><a href="#cb480-2701" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> meanGR <span class="sc">+</span> sdGR,</span>
<span id="cb480-2702"><a href="#cb480-2702" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb480-2703"><a href="#cb480-2703" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-2704"><a href="#cb480-2704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2705"><a href="#cb480-2705" aria-hidden="true" tabindex="-1"></a> <span class="co">#  ggplot(tmp |&gt; filter(n &gt; 2, speciesGG == "Brook trout"), aes(numSamplesBeforeLastGT1, meanGR)) +</span></span>
<span id="cb480-2706"><a href="#cb480-2706" aria-hidden="true" tabindex="-1"></a> <span class="co">#    geom_errorbar(aes(x = numSamplesBeforeLastGT1, ymin = meanGR, ymax = ymax), width = 0.2) +</span></span>
<span id="cb480-2707"><a href="#cb480-2707" aria-hidden="true" tabindex="-1"></a> <span class="co">#    geom_col() +</span></span>
<span id="cb480-2708"><a href="#cb480-2708" aria-hidden="true" tabindex="-1"></a> <span class="co">#    theme_publication() +    </span></span>
<span id="cb480-2709"><a href="#cb480-2709" aria-hidden="true" tabindex="-1"></a> <span class="co">#    facet_grid(riverGG~seasonGG , scales = "free")</span></span>
<span id="cb480-2710"><a href="#cb480-2710" aria-hidden="true" tabindex="-1"></a> <span class="co">#  </span></span>
<span id="cb480-2711"><a href="#cb480-2711" aria-hidden="true" tabindex="-1"></a> <span class="co"># ggplot(tmp |&gt; filter(n &gt; 2, speciesGG == "Brown trout"), aes(numSamplesBeforeLastGT1, meanGR)) +</span></span>
<span id="cb480-2712"><a href="#cb480-2712" aria-hidden="true" tabindex="-1"></a> <span class="co">#    geom_errorbar(aes(x = numSamplesBeforeLastGT1, ymin = meanGR, ymax = ymax), width = 0.2) +</span></span>
<span id="cb480-2713"><a href="#cb480-2713" aria-hidden="true" tabindex="-1"></a> <span class="co">#    geom_col() +</span></span>
<span id="cb480-2714"><a href="#cb480-2714" aria-hidden="true" tabindex="-1"></a> <span class="co">#    theme_publication() +    </span></span>
<span id="cb480-2715"><a href="#cb480-2715" aria-hidden="true" tabindex="-1"></a> <span class="co">#    facet_grid(riverGG~seasonGG , scales = "free")</span></span>
<span id="cb480-2716"><a href="#cb480-2716" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb480-2717"><a href="#cb480-2717" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(numSamplesBeforeLastGT1_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="sc">!</span><span class="fu">is.na</span>(numSamplesBeforeLastGT1)), <span class="fu">aes</span>(numSamplesBeforeLastGT1, meanGR, <span class="at">fill =</span> speciesGG, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb480-2718"><a href="#cb480-2718" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> numSamplesBeforeLastGT1, <span class="at">ymin =</span> meanGR, <span class="at">ymax =</span> ymax), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb480-2719"><a href="#cb480-2719" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb480-2720"><a href="#cb480-2720" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2721"><a href="#cb480-2721" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>seasonGG , <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2722"><a href="#cb480-2722" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb480-2723"><a href="#cb480-2723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(numSamplesBeforeLastGT1_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="sc">!</span><span class="fu">is.na</span>(numSamplesBeforeLastGT1)), <span class="fu">aes</span>(speciesGG, meanGR, <span class="at">fill =</span> numSamplesBeforeLastGT1, <span class="at">color =</span> numSamplesBeforeLastGT1)) <span class="sc">+</span></span>
<span id="cb480-2724"><a href="#cb480-2724" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> speciesGG, <span class="at">ymin =</span> meanGR, <span class="at">ymax =</span> ymax), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb480-2725"><a href="#cb480-2725" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb480-2726"><a href="#cb480-2726" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-2727"><a href="#cb480-2727" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">360</span> <span class="sc">-</span> <span class="dv">60</span>, <span class="at">vjust =</span> <span class="fl">0.3</span>, <span class="at">hjust =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb480-2728"><a href="#cb480-2728" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>seasonGG , <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2729"><a href="#cb480-2729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2730"><a href="#cb480-2730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2731"><a href="#cb480-2731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2732"><a href="#cb480-2732" aria-hidden="true" tabindex="-1"></a>Relationship between individual growth and length of subsequent</span>
<span id="cb480-2733"><a href="#cb480-2733" aria-hidden="true" tabindex="-1"></a>observations (how many more observations before the last observation)</span>
<span id="cb480-2734"><a href="#cb480-2734" aria-hidden="true" tabindex="-1"></a>for individual fish.  </span>
<span id="cb480-2735"><a href="#cb480-2735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2736"><a href="#cb480-2736" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Broken up by years  </span></span>
<span id="cb480-2739"><a href="#cb480-2739" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2740"><a href="#cb480-2740" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_samplesLeft</span></span>
<span id="cb480-2741"><a href="#cb480-2741" aria-hidden="true" tabindex="-1"></a>plotGrowthSamplesLeft <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb480-2742"><a href="#cb480-2742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>, samplesBeforeLast <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="fu">aes</span>(grWeight, samplesBeforeLast)) <span class="sc">+</span></span>
<span id="cb480-2743"><a href="#cb480-2743" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-2744"><a href="#cb480-2744" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-2745"><a href="#cb480-2745" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-2746"><a href="#cb480-2746" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2747"><a href="#cb480-2747" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2748"><a href="#cb480-2748" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>year)</span>
<span id="cb480-2749"><a href="#cb480-2749" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2750"><a href="#cb480-2750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2751"><a href="#cb480-2751" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"West Brook"</span>)</span>
<span id="cb480-2752"><a href="#cb480-2752" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Large"</span>)</span>
<span id="cb480-2753"><a href="#cb480-2753" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Small"</span>)</span>
<span id="cb480-2754"><a href="#cb480-2754" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Isolated Small"</span>)</span>
<span id="cb480-2755"><a href="#cb480-2755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2756"><a href="#cb480-2756" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeft</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"West Brook"</span>)</span>
<span id="cb480-2757"><a href="#cb480-2757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2758"><a href="#cb480-2758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2759"><a href="#cb480-2759" aria-hidden="true" tabindex="-1"></a><span class="fu">#### All years  </span></span>
<span id="cb480-2762"><a href="#cb480-2762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2763"><a href="#cb480-2763" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_samplesLeftNoYear</span></span>
<span id="cb480-2764"><a href="#cb480-2764" aria-hidden="true" tabindex="-1"></a>plotGrowthSamplesLeftNoYear <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb480-2765"><a href="#cb480-2765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>, samplesBeforeLast <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="fu">aes</span>(grWeight, samplesBeforeLast)) <span class="sc">+</span></span>
<span id="cb480-2766"><a href="#cb480-2766" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-2767"><a href="#cb480-2767" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-2768"><a href="#cb480-2768" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-2769"><a href="#cb480-2769" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2770"><a href="#cb480-2770" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Number of samples before last observation"</span>) <span class="sc">+</span></span>
<span id="cb480-2771"><a href="#cb480-2771" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-2772"><a href="#cb480-2772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG)</span>
<span id="cb480-2773"><a href="#cb480-2773" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2774"><a href="#cb480-2774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2775"><a href="#cb480-2775" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"West Brook"</span>)</span>
<span id="cb480-2776"><a href="#cb480-2776" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Large"</span>)</span>
<span id="cb480-2777"><a href="#cb480-2777" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Small"</span>)</span>
<span id="cb480-2778"><a href="#cb480-2778" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Isolated Small"</span>)</span>
<span id="cb480-2779"><a href="#cb480-2779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2780"><a href="#cb480-2780" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"West Brook"</span>)</span>
<span id="cb480-2781"><a href="#cb480-2781" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthSamplesLeftNoYear</span>(cd1, <span class="st">"Atlantic salmon"</span>, <span class="st">"West Brook"</span>)</span>
<span id="cb480-2782"><a href="#cb480-2782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2783"><a href="#cb480-2783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2784"><a href="#cb480-2784" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Break up by pos/neg growth  </span></span>
<span id="cb480-2787"><a href="#cb480-2787" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2788"><a href="#cb480-2788" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negGrowth_means</span></span>
<span id="cb480-2789"><a href="#cb480-2789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2790"><a href="#cb480-2790" aria-hidden="true" tabindex="-1"></a>plotGR_sampsBL <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb480-2791"><a href="#cb480-2791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>, speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r), <span class="fu">aes</span>(meanGR, samplesBeforeLast, <span class="at">color =</span> negGrowth)) <span class="sc">+</span> </span>
<span id="cb480-2792"><a href="#cb480-2792" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-2793"><a href="#cb480-2793" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-2794"><a href="#cb480-2794" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2795"><a href="#cb480-2795" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Number of samples before last observation"</span>) <span class="sc">+</span></span>
<span id="cb480-2796"><a href="#cb480-2796" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2797"><a href="#cb480-2797" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>seasonGG<span class="sc">+</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2798"><a href="#cb480-2798" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2799"><a href="#cb480-2799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2800"><a href="#cb480-2800" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_sampsBL</span>(negGr_beforeLast, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>))</span>
<span id="cb480-2801"><a href="#cb480-2801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2802"><a href="#cb480-2802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2803"><a href="#cb480-2803" aria-hidden="true" tabindex="-1"></a>plotGR_sampsBL2 <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb480-2804"><a href="#cb480-2804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>, speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r, <span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(meanGR, samplesBeforeLast, <span class="at">color =</span> speciesGG)) <span class="sc">+</span> </span>
<span id="cb480-2805"><a href="#cb480-2805" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb480-2806"><a href="#cb480-2806" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-2807"><a href="#cb480-2807" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-2808"><a href="#cb480-2808" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2809"><a href="#cb480-2809" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Number of samples before last observation"</span>) <span class="sc">+</span></span>
<span id="cb480-2810"><a href="#cb480-2810" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2811"><a href="#cb480-2811" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>negGrowth<span class="sc">+</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2812"><a href="#cb480-2812" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2813"><a href="#cb480-2813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2814"><a href="#cb480-2814" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_sampsBL2</span>(negGr_beforeLast, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>))</span>
<span id="cb480-2815"><a href="#cb480-2815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2816"><a href="#cb480-2816" aria-hidden="true" tabindex="-1"></a>plotGR_sampsBL3 <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r, ng) {</span>
<span id="cb480-2817"><a href="#cb480-2817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>, speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r, negGrowth <span class="sc">%in%</span> ng), <span class="fu">aes</span>(meanGR, samplesBeforeLast, <span class="at">color =</span> speciesGG)) <span class="sc">+</span> </span>
<span id="cb480-2818"><a href="#cb480-2818" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-2819"><a href="#cb480-2819" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-2820"><a href="#cb480-2820" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-2821"><a href="#cb480-2821" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, ng, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2822"><a href="#cb480-2822" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Number of samples before last observation"</span>) <span class="sc">+</span></span>
<span id="cb480-2823"><a href="#cb480-2823" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2824"><a href="#cb480-2824" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(negGrowth<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2825"><a href="#cb480-2825" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2826"><a href="#cb480-2826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2827"><a href="#cb480-2827" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_sampsBL3</span>(negGr_beforeLast, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb480-2828"><a href="#cb480-2828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2829"><a href="#cb480-2829" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_sampsBL3</span>(negGr_beforeLast, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>), <span class="cn">TRUE</span>)</span>
<span id="cb480-2830"><a href="#cb480-2830" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2831"><a href="#cb480-2831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2832"><a href="#cb480-2832" aria-hidden="true" tabindex="-1"></a>TO ADD: mean samplesBeforeLast by negGR </span>
<span id="cb480-2835"><a href="#cb480-2835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2836"><a href="#cb480-2836" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: growthKnkownZPosNeg</span></span>
<span id="cb480-2837"><a href="#cb480-2837" aria-hidden="true" tabindex="-1"></a>plotGrowthKnownZPosNeg <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb480-2838"><a href="#cb480-2838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>, <span class="sc">!</span><span class="fu">is.na</span>(samplesBeforeLast)), <span class="fu">aes</span>(grWeight, <span class="at">color =</span> samplesBeforeLast <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-2839"><a href="#cb480-2839" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb480-2840"><a href="#cb480-2840" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-2841"><a href="#cb480-2841" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(r)) <span class="sc">+</span></span>
<span id="cb480-2842"><a href="#cb480-2842" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>   </span>
<span id="cb480-2843"><a href="#cb480-2843" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb480-2844"><a href="#cb480-2844" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2845"><a href="#cb480-2845" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2846"><a href="#cb480-2846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2847"><a href="#cb480-2847" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZPosNeg</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>, <span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="st">"West Brook"</span>)</span>
<span id="cb480-2848"><a href="#cb480-2848" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZPosNeg</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>, <span class="st">"Brown trout"</span>, <span class="st">"Atlantic salmon"</span>), <span class="st">"Open Large"</span>)</span>
<span id="cb480-2849"><a href="#cb480-2849" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZPosNeg</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>, <span class="st">"Brown trout"</span>), <span class="st">"Open Small"</span>)</span>
<span id="cb480-2850"><a href="#cb480-2850" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZPosNeg</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>), <span class="st">"Isolated Small"</span>)</span>
<span id="cb480-2851"><a href="#cb480-2851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2852"><a href="#cb480-2852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2853"><a href="#cb480-2853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2854"><a href="#cb480-2854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2855"><a href="#cb480-2855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2856"><a href="#cb480-2856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2857"><a href="#cb480-2857" aria-hidden="true" tabindex="-1"></a>TO ADD: knownZ=0 vs knownZ==1, growth in previous interval</span>
<span id="cb480-2860"><a href="#cb480-2860" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2861"><a href="#cb480-2861" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: growthKnkownZ</span></span>
<span id="cb480-2862"><a href="#cb480-2862" aria-hidden="true" tabindex="-1"></a>plotGrowthKnownZ <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb480-2863"><a href="#cb480-2863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>), <span class="fu">aes</span>(grWeight, <span class="at">color =</span> samplesBeforeLast <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-2864"><a href="#cb480-2864" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb480-2865"><a href="#cb480-2865" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-2866"><a href="#cb480-2866" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2867"><a href="#cb480-2867" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2868"><a href="#cb480-2868" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2869"><a href="#cb480-2869" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2870"><a href="#cb480-2870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2871"><a href="#cb480-2871" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"West Brook"</span>)</span>
<span id="cb480-2872"><a href="#cb480-2872" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Large"</span>)</span>
<span id="cb480-2873"><a href="#cb480-2873" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Small"</span>)</span>
<span id="cb480-2874"><a href="#cb480-2874" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Isolated Small"</span>)</span>
<span id="cb480-2875"><a href="#cb480-2875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2876"><a href="#cb480-2876" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"West Brook"</span>)</span>
<span id="cb480-2877"><a href="#cb480-2877" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"Open Large"</span>)</span>
<span id="cb480-2878"><a href="#cb480-2878" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZ</span>(cd1, <span class="st">"Brown trout"</span>, <span class="st">"Open Small"</span>)</span>
<span id="cb480-2879"><a href="#cb480-2879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2880"><a href="#cb480-2880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2881"><a href="#cb480-2881" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2882"><a href="#cb480-2882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2883"><a href="#cb480-2883" aria-hidden="true" tabindex="-1"></a>By year</span>
<span id="cb480-2886"><a href="#cb480-2886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2887"><a href="#cb480-2887" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: growthKnkownZByYear</span></span>
<span id="cb480-2888"><a href="#cb480-2888" aria-hidden="true" tabindex="-1"></a>plotGrowthKnownZByYear <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r){</span>
<span id="cb480-2889"><a href="#cb480-2889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> spp, riverGG <span class="sc">==</span> r, year <span class="sc">&lt;</span> <span class="dv">2011</span>), <span class="fu">aes</span>(grWeight, <span class="at">color =</span> samplesBeforeLast <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb480-2890"><a href="#cb480-2890" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb480-2891"><a href="#cb480-2891" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-2892"><a href="#cb480-2892" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2893"><a href="#cb480-2893" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2894"><a href="#cb480-2894" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(year<span class="sc">~</span>seasonGG)</span>
<span id="cb480-2895"><a href="#cb480-2895" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2896"><a href="#cb480-2896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2897"><a href="#cb480-2897" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZByYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"West Brook"</span>)</span>
<span id="cb480-2898"><a href="#cb480-2898" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZByYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Large"</span>)</span>
<span id="cb480-2899"><a href="#cb480-2899" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZByYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Open Small"</span>)</span>
<span id="cb480-2900"><a href="#cb480-2900" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGrowthKnownZByYear</span>(cd1, <span class="st">"Brook trout"</span>, <span class="st">"Isolated Small"</span>)</span>
<span id="cb480-2901"><a href="#cb480-2901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2902"><a href="#cb480-2902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2903"><a href="#cb480-2903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2904"><a href="#cb480-2904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2905"><a href="#cb480-2905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2906"><a href="#cb480-2906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2907"><a href="#cb480-2907" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth and movement distance</span></span>
<span id="cb480-2908"><a href="#cb480-2908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2909"><a href="#cb480-2909" aria-hidden="true" tabindex="-1"></a>TO add: break avg move into negGR/not negGR</span>
<span id="cb480-2912"><a href="#cb480-2912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2913"><a href="#cb480-2913" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: growthMovementNegPos</span></span>
<span id="cb480-2914"><a href="#cb480-2914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2915"><a href="#cb480-2915" aria-hidden="true" tabindex="-1"></a>plotGR_moveDistNegPos <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb480-2916"><a href="#cb480-2916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r, <span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(distMoved, <span class="at">color =</span> negGrowth)) <span class="sc">+</span> </span>
<span id="cb480-2917"><a href="#cb480-2917" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb480-2918"><a href="#cb480-2918" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-2919"><a href="#cb480-2919" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2920"><a href="#cb480-2920" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Movement distance"</span>) <span class="sc">+</span></span>
<span id="cb480-2921"><a href="#cb480-2921" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>  </span>
<span id="cb480-2922"><a href="#cb480-2922" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb480-2923"><a href="#cb480-2923" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2924"><a href="#cb480-2924" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2925"><a href="#cb480-2925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2926"><a href="#cb480-2926" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_moveDistNegPos</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>,<span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>))</span>
<span id="cb480-2927"><a href="#cb480-2927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2928"><a href="#cb480-2928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2929"><a href="#cb480-2929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2930"><a href="#cb480-2930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2933"><a href="#cb480-2933" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2934"><a href="#cb480-2934" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: growthMovement</span></span>
<span id="cb480-2935"><a href="#cb480-2935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2936"><a href="#cb480-2936" aria-hidden="true" tabindex="-1"></a>plotGR_moveDist <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb480-2937"><a href="#cb480-2937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r), <span class="fu">aes</span>(grWeight, distMoved, <span class="at">color =</span> speciesGG)) <span class="sc">+</span> </span>
<span id="cb480-2938"><a href="#cb480-2938" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb480-2939"><a href="#cb480-2939" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-2940"><a href="#cb480-2940" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-2941"><a href="#cb480-2941" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2942"><a href="#cb480-2942" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Movement distance"</span>) <span class="sc">+</span></span>
<span id="cb480-2943"><a href="#cb480-2943" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2944"><a href="#cb480-2944" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(speciesGG<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2945"><a href="#cb480-2945" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2946"><a href="#cb480-2946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2947"><a href="#cb480-2947" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_moveDist</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>,<span class="st">"Brown trout"</span>,<span class="st">"Atlantic salmon"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>))</span>
<span id="cb480-2948"><a href="#cb480-2948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2949"><a href="#cb480-2949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2950"><a href="#cb480-2950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2953"><a href="#cb480-2953" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2954"><a href="#cb480-2954" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: growthMovement2</span></span>
<span id="cb480-2955"><a href="#cb480-2955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2956"><a href="#cb480-2956" aria-hidden="true" tabindex="-1"></a>plotGR_moveDist2 <span class="ot">&lt;-</span> <span class="cf">function</span>(d, spp, r) {</span>
<span id="cb480-2957"><a href="#cb480-2957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">%in%</span> spp, riverGG <span class="sc">%in%</span> r), <span class="fu">aes</span>(grWeight, distMoved, <span class="at">color =</span> speciesGG)) <span class="sc">+</span> </span>
<span id="cb480-2958"><a href="#cb480-2958" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb480-2959"><a href="#cb480-2959" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb480-2960"><a href="#cb480-2960" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-2961"><a href="#cb480-2961" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(spp, r, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">+</span></span>
<span id="cb480-2962"><a href="#cb480-2962" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Individual growth in mass"</span>, <span class="at">y =</span> <span class="st">"Movement distance"</span>) <span class="sc">+</span></span>
<span id="cb480-2963"><a href="#cb480-2963" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-2964"><a href="#cb480-2964" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(riverGG<span class="sc">~</span>seasonGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-2965"><a href="#cb480-2965" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-2966"><a href="#cb480-2966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2967"><a href="#cb480-2967" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_moveDist2</span>(cd1, <span class="fu">c</span>(<span class="st">"Brook trout"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>, <span class="st">"Isolated Small"</span>))</span>
<span id="cb480-2968"><a href="#cb480-2968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2969"><a href="#cb480-2969" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGR_moveDist2</span>(cd1, <span class="fu">c</span>(<span class="st">"Brown trout"</span>), <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>))</span>
<span id="cb480-2970"><a href="#cb480-2970" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-2971"><a href="#cb480-2971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2972"><a href="#cb480-2972" aria-hidden="true" tabindex="-1"></a><span class="fu">## Machine Learning models - individual data</span></span>
<span id="cb480-2973"><a href="#cb480-2973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2974"><a href="#cb480-2974" aria-hidden="true" tabindex="-1"></a>Using xgBoost to explore patterns in:\</span>
<span id="cb480-2975"><a href="#cb480-2975" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Binary, lose mass:gain mass\</span>
<span id="cb480-2976"><a href="#cb480-2976" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Regression, growth in mass</span>
<span id="cb480-2977"><a href="#cb480-2977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2978"><a href="#cb480-2978" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary model with negative growth, yes:no</span></span>
<span id="cb480-2979"><a href="#cb480-2979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2980"><a href="#cb480-2980" aria-hidden="true" tabindex="-1"></a>Not yet in targets....</span>
<span id="cb480-2981"><a href="#cb480-2981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2982"><a href="#cb480-2982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2983"><a href="#cb480-2983" aria-hidden="true" tabindex="-1"></a><span class="fu">### Function to run hyperparameters</span></span>
<span id="cb480-2984"><a href="#cb480-2984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2987"><a href="#cb480-2987" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-2988"><a href="#cb480-2988" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runML_HP_negGrowth</span></span>
<span id="cb480-2989"><a href="#cb480-2989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-2990"><a href="#cb480-2990" aria-hidden="true" tabindex="-1"></a>runHyperparamSearchIndData <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> cd1, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"cohort"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"negGrowth"</span>), <span class="at">nRoundsIn =</span> <span class="dv">150000</span>, <span class="at">early_stopping_roundsIn =</span> <span class="dv">50</span>) {</span>
<span id="cb480-2991"><a href="#cb480-2991" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-2992"><a href="#cb480-2992" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set.seed(123)</span></span>
<span id="cb480-2993"><a href="#cb480-2993" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-2994"><a href="#cb480-2994" aria-hidden="true" tabindex="-1"></a>  dML_negGrowth <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb480-2995"><a href="#cb480-2995" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> year <span class="sc">-</span> cohort) <span class="sc">|&gt;</span> </span>
<span id="cb480-2996"><a href="#cb480-2996" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars)) </span>
<span id="cb480-2997"><a href="#cb480-2997" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-2998"><a href="#cb480-2998" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variable names</span></span>
<span id="cb480-2999"><a href="#cb480-2999" aria-hidden="true" tabindex="-1"></a>  features_negGrowth <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dML_negGrowth), <span class="st">"negGrowth"</span>)</span>
<span id="cb480-3000"><a href="#cb480-3000" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3001"><a href="#cb480-3001" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the treatment plan from the training data</span></span>
<span id="cb480-3002"><a href="#cb480-3002" aria-hidden="true" tabindex="-1"></a>  treatplan_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">designTreatmentsZ</span>(dML_negGrowth, features_negGrowth, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3003"><a href="#cb480-3003" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3004"><a href="#cb480-3004" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the "clean" variable names from the scoreFrame</span></span>
<span id="cb480-3005"><a href="#cb480-3005" aria-hidden="true" tabindex="-1"></a>  new_vars_negGrowth <span class="ot">&lt;-</span> treatplan_negGrowth <span class="sc">%&gt;%</span></span>
<span id="cb480-3006"><a href="#cb480-3006" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>        </span>
<span id="cb480-3007"><a href="#cb480-3007" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb480-3008"><a href="#cb480-3008" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)     </span>
<span id="cb480-3009"><a href="#cb480-3009" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3010"><a href="#cb480-3010" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the training data</span></span>
<span id="cb480-3011"><a href="#cb480-3011" aria-hidden="true" tabindex="-1"></a>  features_train_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_negGrowth, dML_negGrowth, <span class="at">varRestriction =</span> new_vars_negGrowth) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb480-3012"><a href="#cb480-3012" aria-hidden="true" tabindex="-1"></a>  response_train_negGrowth <span class="ot">&lt;-</span> dML_negGrowth<span class="sc">$</span>negGrowth</span>
<span id="cb480-3013"><a href="#cb480-3013" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3014"><a href="#cb480-3014" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create hyperparameter grid</span></span>
<span id="cb480-3015"><a href="#cb480-3015" aria-hidden="true" tabindex="-1"></a>  hyper_grid_negGrowth <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb480-3016"><a href="#cb480-3016" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">3</span>),</span>
<span id="cb480-3017"><a href="#cb480-3017" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb480-3018"><a href="#cb480-3018" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_child_weight =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb480-3019"><a href="#cb480-3019" aria-hidden="true" tabindex="-1"></a>    <span class="at">subsample =</span> <span class="fu">c</span>(.<span class="dv">65</span>, .<span class="dv">8</span>, <span class="dv">1</span>),</span>
<span id="cb480-3020"><a href="#cb480-3020" aria-hidden="true" tabindex="-1"></a>    <span class="at">colsample_bytree =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">9</span>, <span class="dv">1</span>),</span>
<span id="cb480-3021"><a href="#cb480-3021" aria-hidden="true" tabindex="-1"></a>    <span class="at">optimal_trees =</span> <span class="dv">0</span>,               <span class="co"># a place to dump results</span></span>
<span id="cb480-3022"><a href="#cb480-3022" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_logloss =</span> <span class="dv">0</span>                     <span class="co"># a place to dump results</span></span>
<span id="cb480-3023"><a href="#cb480-3023" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3024"><a href="#cb480-3024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3025"><a href="#cb480-3025" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reproducibility</span></span>
<span id="cb480-3026"><a href="#cb480-3026" aria-hidden="true" tabindex="-1"></a>    <span class="co">#set.seed(123)</span></span>
<span id="cb480-3027"><a href="#cb480-3027" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   </span></span>
<span id="cb480-3028"><a href="#cb480-3028" aria-hidden="true" tabindex="-1"></a>  <span class="co"># grid search</span></span>
<span id="cb480-3029"><a href="#cb480-3029" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hyper_grid_negGrowth)) {</span>
<span id="cb480-3030"><a href="#cb480-3030" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(i, <span class="st">" out of "</span>, <span class="fu">nrow</span>(hyper_grid_negGrowth)))</span>
<span id="cb480-3031"><a href="#cb480-3031" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create parameter list</span></span>
<span id="cb480-3032"><a href="#cb480-3032" aria-hidden="true" tabindex="-1"></a>    params_negGrowth <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb480-3033"><a href="#cb480-3033" aria-hidden="true" tabindex="-1"></a>      <span class="at">eta =</span> hyper_grid_negGrowth<span class="sc">$</span>eta[i],</span>
<span id="cb480-3034"><a href="#cb480-3034" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_depth =</span> hyper_grid_negGrowth<span class="sc">$</span>max_depth[i],</span>
<span id="cb480-3035"><a href="#cb480-3035" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_child_weight =</span> hyper_grid_negGrowth<span class="sc">$</span>min_child_weight[i],</span>
<span id="cb480-3036"><a href="#cb480-3036" aria-hidden="true" tabindex="-1"></a>      <span class="at">subsample =</span> hyper_grid_negGrowth<span class="sc">$</span>subsample[i],</span>
<span id="cb480-3037"><a href="#cb480-3037" aria-hidden="true" tabindex="-1"></a>      <span class="at">colsample_bytree =</span> hyper_grid_negGrowth<span class="sc">$</span>colsample_bytree[i]</span>
<span id="cb480-3038"><a href="#cb480-3038" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-3039"><a href="#cb480-3039" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3040"><a href="#cb480-3040" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3041"><a href="#cb480-3041" aria-hidden="true" tabindex="-1"></a>    <span class="co"># train model</span></span>
<span id="cb480-3042"><a href="#cb480-3042" aria-hidden="true" tabindex="-1"></a>    xgb.tune_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb480-3043"><a href="#cb480-3043" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> params_negGrowth,</span>
<span id="cb480-3044"><a href="#cb480-3044" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> features_train_negGrowth,</span>
<span id="cb480-3045"><a href="#cb480-3045" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> response_train_negGrowth,</span>
<span id="cb480-3046"><a href="#cb480-3046" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrounds =</span> nRoundsIn,</span>
<span id="cb480-3047"><a href="#cb480-3047" aria-hidden="true" tabindex="-1"></a>      <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb480-3048"><a href="#cb480-3048" aria-hidden="true" tabindex="-1"></a>      <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="co">#"reg:linear",  # for regression models</span></span>
<span id="cb480-3049"><a href="#cb480-3049" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="dv">0</span>,               <span class="co"># silent,</span></span>
<span id="cb480-3050"><a href="#cb480-3050" aria-hidden="true" tabindex="-1"></a>      <span class="at">early_stopping_rounds =</span> early_stopping_roundsIn <span class="co"># stop if no improvement for x consecutive trees</span></span>
<span id="cb480-3051"><a href="#cb480-3051" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-3052"><a href="#cb480-3052" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3053"><a href="#cb480-3053" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add min training error and trees to grid</span></span>
<span id="cb480-3054"><a href="#cb480-3054" aria-hidden="true" tabindex="-1"></a>    hyper_grid_negGrowth<span class="sc">$</span>optimal_trees[i] <span class="ot">&lt;-</span> <span class="fu">which.min</span>(xgb.tune_negGrowth<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_logloss_mean)</span>
<span id="cb480-3055"><a href="#cb480-3055" aria-hidden="true" tabindex="-1"></a>    hyper_grid_negGrowth<span class="sc">$</span>min_logloss[i] <span class="ot">&lt;-</span> <span class="fu">min</span>(xgb.tune_negGrowth<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_logloss_mean)</span>
<span id="cb480-3056"><a href="#cb480-3056" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb480-3057"><a href="#cb480-3057" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3058"><a href="#cb480-3058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(hyper_grid_negGrowth <span class="sc">|&gt;</span> <span class="fu">arrange</span>(min_logloss))</span>
<span id="cb480-3059"><a href="#cb480-3059" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3060"><a href="#cb480-3060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3061"><a href="#cb480-3061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3062"><a href="#cb480-3062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3063"><a href="#cb480-3063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3064"><a href="#cb480-3064" aria-hidden="true" tabindex="-1"></a><span class="fu">### Function to run models</span></span>
<span id="cb480-3065"><a href="#cb480-3065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3068"><a href="#cb480-3068" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3069"><a href="#cb480-3069" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xgBoostNegGrowthFunction</span></span>
<span id="cb480-3070"><a href="#cb480-3070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3071"><a href="#cb480-3071" aria-hidden="true" tabindex="-1"></a><span class="co"># http://uc-r.github.io/gbm_regression</span></span>
<span id="cb480-3072"><a href="#cb480-3072" aria-hidden="true" tabindex="-1"></a>runXGB_indData <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> cd1, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"negGrowth"</span>), <span class="at">nRoundsIn =</span> <span class="dv">200000</span>, <span class="at">early_stopping_roundsIn =</span> <span class="dv">50</span>, <span class="at">params =</span> params_negGrowthIn) {</span>
<span id="cb480-3073"><a href="#cb480-3073" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3074"><a href="#cb480-3074" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set.seed(125)</span></span>
<span id="cb480-3075"><a href="#cb480-3075" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3076"><a href="#cb480-3076" aria-hidden="true" tabindex="-1"></a>  dML <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb480-3077"><a href="#cb480-3077" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> year <span class="sc">-</span> cohort) <span class="sc">|&gt;</span> </span>
<span id="cb480-3078"><a href="#cb480-3078" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(vars))</span>
<span id="cb480-3079"><a href="#cb480-3079" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb480-3080"><a href="#cb480-3080" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3081"><a href="#cb480-3081" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variable names</span></span>
<span id="cb480-3082"><a href="#cb480-3082" aria-hidden="true" tabindex="-1"></a>  features_negGrowth <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dML), <span class="st">"negGrowth"</span>)</span>
<span id="cb480-3083"><a href="#cb480-3083" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3084"><a href="#cb480-3084" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the treatment plan from the training data</span></span>
<span id="cb480-3085"><a href="#cb480-3085" aria-hidden="true" tabindex="-1"></a>  treatplan_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">designTreatmentsZ</span>(dML, features_negGrowth, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3086"><a href="#cb480-3086" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3087"><a href="#cb480-3087" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the "clean" variable names from the scoreFrame</span></span>
<span id="cb480-3088"><a href="#cb480-3088" aria-hidden="true" tabindex="-1"></a>  new_vars_negGrowth <span class="ot">&lt;-</span> treatplan_negGrowth <span class="sc">%&gt;%</span></span>
<span id="cb480-3089"><a href="#cb480-3089" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(scoreFrame) <span class="sc">%&gt;%</span>        </span>
<span id="cb480-3090"><a href="#cb480-3090" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"clean"</span>, <span class="st">"lev"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb480-3091"><a href="#cb480-3091" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">use_series</span>(varName)     </span>
<span id="cb480-3092"><a href="#cb480-3092" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3093"><a href="#cb480-3093" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the training data</span></span>
<span id="cb480-3094"><a href="#cb480-3094" aria-hidden="true" tabindex="-1"></a>  features_train_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_negGrowth, dML, <span class="at">varRestriction =</span> new_vars_negGrowth) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb480-3095"><a href="#cb480-3095" aria-hidden="true" tabindex="-1"></a>  response_train_negGrowth <span class="ot">&lt;-</span> dML<span class="sc">$</span>negGrowth</span>
<span id="cb480-3096"><a href="#cb480-3096" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3097"><a href="#cb480-3097" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare the test data</span></span>
<span id="cb480-3098"><a href="#cb480-3098" aria-hidden="true" tabindex="-1"></a>  features_test_negGrowth <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_negGrowth, dML, <span class="at">varRestriction =</span> new_vars_negGrowth) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb480-3099"><a href="#cb480-3099" aria-hidden="true" tabindex="-1"></a>  response_test_negGrowth <span class="ot">&lt;-</span> dML<span class="sc">$</span>negGrowth</span>
<span id="cb480-3100"><a href="#cb480-3100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3101"><a href="#cb480-3101" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Run model</span></span>
<span id="cb480-3102"><a href="#cb480-3102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># parameter list - from the top model of the grid search above</span></span>
<span id="cb480-3103"><a href="#cb480-3103" aria-hidden="true" tabindex="-1"></a>  params_negGrowth <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb480-3104"><a href="#cb480-3104" aria-hidden="true" tabindex="-1"></a>    <span class="at">eta =</span> params<span class="sc">$</span>eta, <span class="co">#0.01,</span></span>
<span id="cb480-3105"><a href="#cb480-3105" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_depth =</span> params<span class="sc">$</span>max_depth, <span class="co">#1,</span></span>
<span id="cb480-3106"><a href="#cb480-3106" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_child_weight =</span> params<span class="sc">$</span>min_child_weight, <span class="co">#7,</span></span>
<span id="cb480-3107"><a href="#cb480-3107" aria-hidden="true" tabindex="-1"></a>    <span class="at">subsample =</span> params<span class="sc">$</span>subsample, <span class="co">#0.8,</span></span>
<span id="cb480-3108"><a href="#cb480-3108" aria-hidden="true" tabindex="-1"></a>    <span class="at">colsample_bytree =</span> params<span class="sc">$</span>colsample_bytree <span class="co">#0.9</span></span>
<span id="cb480-3109"><a href="#cb480-3109" aria-hidden="true" tabindex="-1"></a>   <span class="co"># optimal_trees = params$optimal_trees</span></span>
<span id="cb480-3110"><a href="#cb480-3110" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3111"><a href="#cb480-3111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3112"><a href="#cb480-3112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># train final model</span></span>
<span id="cb480-3113"><a href="#cb480-3113" aria-hidden="true" tabindex="-1"></a>  xgb.fit.final_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(</span>
<span id="cb480-3114"><a href="#cb480-3114" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> params_negGrowth,</span>
<span id="cb480-3115"><a href="#cb480-3115" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> features_train_negGrowth,</span>
<span id="cb480-3116"><a href="#cb480-3116" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> response_train_negGrowth,</span>
<span id="cb480-3117"><a href="#cb480-3117" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrounds =</span> nRoundsIn,</span>
<span id="cb480-3118"><a href="#cb480-3118" aria-hidden="true" tabindex="-1"></a>    <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb480-3119"><a href="#cb480-3119" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">1</span>,</span>
<span id="cb480-3120"><a href="#cb480-3120" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_rounds =</span> early_stopping_roundsIn <span class="co"># stop if no improvement for 20 consecutive trees</span></span>
<span id="cb480-3121"><a href="#cb480-3121" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3122"><a href="#cb480-3122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3123"><a href="#cb480-3123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3124"><a href="#cb480-3124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb480-3125"><a href="#cb480-3125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb480-3126"><a href="#cb480-3126" aria-hidden="true" tabindex="-1"></a>      <span class="at">dat =</span> dML,</span>
<span id="cb480-3127"><a href="#cb480-3127" aria-hidden="true" tabindex="-1"></a>      <span class="at">xgb =</span> xgb.fit.final_negGrowth,</span>
<span id="cb480-3128"><a href="#cb480-3128" aria-hidden="true" tabindex="-1"></a>      <span class="at">new_vars =</span> new_vars_negGrowth,</span>
<span id="cb480-3129"><a href="#cb480-3129" aria-hidden="true" tabindex="-1"></a>      <span class="at">features_train =</span> features_train_negGrowth,</span>
<span id="cb480-3130"><a href="#cb480-3130" aria-hidden="true" tabindex="-1"></a>      <span class="at">response_train =</span> response_train_negGrowth</span>
<span id="cb480-3131"><a href="#cb480-3131" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-3132"><a href="#cb480-3132" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3133"><a href="#cb480-3133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3134"><a href="#cb480-3134" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3135"><a href="#cb480-3135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3136"><a href="#cb480-3136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3137"><a href="#cb480-3137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3138"><a href="#cb480-3138" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brook trout</span></span>
<span id="cb480-3139"><a href="#cb480-3139" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Run hyperparameter grid and main model</span></span>
<span id="cb480-3142"><a href="#cb480-3142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3143"><a href="#cb480-3143" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xgbIndBKT</span></span>
<span id="cb480-3144"><a href="#cb480-3144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3145"><a href="#cb480-3145" aria-hidden="true" tabindex="-1"></a>runHP_BKT <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb480-3146"><a href="#cb480-3146" aria-hidden="true" tabindex="-1"></a>runXGB_BKT <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb480-3147"><a href="#cb480-3147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3148"><a href="#cb480-3148" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runHP_BKT) {</span>
<span id="cb480-3149"><a href="#cb480-3149" aria-hidden="true" tabindex="-1"></a>  hpNegGrowthBKT <span class="ot">&lt;-</span> <span class="fu">runHyperparamSearchIndData</span>(</span>
<span id="cb480-3150"><a href="#cb480-3150" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight), year <span class="sc">&gt;</span> <span class="dv">2001</span>) <span class="sc">|&gt;</span></span>
<span id="cb480-3151"><a href="#cb480-3151" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb480-3152"><a href="#cb480-3152" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb480-3153"><a href="#cb480-3153" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb480-3154"><a href="#cb480-3154" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">50000</span>,</span>
<span id="cb480-3155"><a href="#cb480-3155" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">10</span></span>
<span id="cb480-3156"><a href="#cb480-3156" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3157"><a href="#cb480-3157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(hpNegGrowthBKT, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthBKT.RData"</span>)</span>
<span id="cb480-3158"><a href="#cb480-3158" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb480-3159"><a href="#cb480-3159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthBKT.RData"</span>)</span>
<span id="cb480-3160"><a href="#cb480-3160" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3161"><a href="#cb480-3161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3162"><a href="#cb480-3162" aria-hidden="true" tabindex="-1"></a>hpNegGrowthBKT[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb480-3163"><a href="#cb480-3163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3164"><a href="#cb480-3164" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runXGB_BKT) {</span>
<span id="cb480-3165"><a href="#cb480-3165" aria-hidden="true" tabindex="-1"></a>  negGrowthBKT <span class="ot">&lt;-</span> <span class="fu">runXGB_indData</span>(</span>
<span id="cb480-3166"><a href="#cb480-3166" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brook trout"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight), year <span class="sc">&gt;</span> <span class="dv">2001</span>) <span class="sc">|&gt;</span></span>
<span id="cb480-3167"><a href="#cb480-3167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb480-3168"><a href="#cb480-3168" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb480-3169"><a href="#cb480-3169" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb480-3170"><a href="#cb480-3170" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">200000</span>,</span>
<span id="cb480-3171"><a href="#cb480-3171" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">20</span>,</span>
<span id="cb480-3172"><a href="#cb480-3172" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> hpNegGrowthBKT[<span class="dv">1</span>,]</span>
<span id="cb480-3173"><a href="#cb480-3173" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3174"><a href="#cb480-3174" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(negGrowthBKT, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthBKT.RData"</span>)</span>
<span id="cb480-3175"><a href="#cb480-3175" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb480-3176"><a href="#cb480-3176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthBKT.RData"</span>)</span>
<span id="cb480-3177"><a href="#cb480-3177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3178"><a href="#cb480-3178" aria-hidden="true" tabindex="-1"></a>negGrowthBKT<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span>
<span id="cb480-3179"><a href="#cb480-3179" aria-hidden="true" tabindex="-1"></a>negGrowthBKT<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span>
<span id="cb480-3180"><a href="#cb480-3180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3181"><a href="#cb480-3181" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs number trees</span></span>
<span id="cb480-3182"><a href="#cb480-3182" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(negGrowthBKT<span class="sc">$</span>xgb<span class="sc">$</span>evaluation_log) <span class="sc">+</span></span>
<span id="cb480-3183"><a href="#cb480-3183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, train_logloss), <span class="at">color =</span> <span class="st">"red"</span>) </span>
<span id="cb480-3184"><a href="#cb480-3184" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_line(aes(iter, test_logloss), color = "blue")</span></span>
<span id="cb480-3185"><a href="#cb480-3185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3186"><a href="#cb480-3186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3189"><a href="#cb480-3189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3190"><a href="#cb480-3190" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xgbIndBKT_figs</span></span>
<span id="cb480-3191"><a href="#cb480-3191" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-3192"><a href="#cb480-3192" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb480-3193"><a href="#cb480-3193" aria-hidden="true" tabindex="-1"></a>viBKT_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> negGrowthBKT<span class="sc">$</span>xgb)</span>
<span id="cb480-3194"><a href="#cb480-3194" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viBKT_negGrowth, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span>
<span id="cb480-3195"><a href="#cb480-3195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3196"><a href="#cb480-3196" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb480-3197"><a href="#cb480-3197" aria-hidden="true" tabindex="-1"></a>s_negGrowthBKT <span class="ot">&lt;-</span> <span class="fu">hstats</span>(negGrowthBKT<span class="sc">$</span>xgb, <span class="at">v =</span> negGrowthBKT<span class="sc">$</span>new_vars, <span class="at">X =</span> negGrowthBKT<span class="sc">$</span>features_train)</span>
<span id="cb480-3198"><a href="#cb480-3198" aria-hidden="true" tabindex="-1"></a>s_negGrowthBKT</span>
<span id="cb480-3199"><a href="#cb480-3199" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthBKT)</span>
<span id="cb480-3200"><a href="#cb480-3200" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-3201"><a href="#cb480-3201" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb480-3202"><a href="#cb480-3202" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_negGrowthBKT, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb480-3203"><a href="#cb480-3203" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthBKT, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">normalize =</span> F, <span class="at">squared =</span> F, <span class="at">facet_scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb480-3204"><a href="#cb480-3204" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-3205"><a href="#cb480-3205" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb480-3206"><a href="#cb480-3206" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_negGrowthBKT, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb480-3207"><a href="#cb480-3207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3208"><a href="#cb480-3208" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb480-3209"><a href="#cb480-3209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3210"><a href="#cb480-3210" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3211"><a href="#cb480-3211" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">25</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3212"><a href="#cb480-3212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3213"><a href="#cb480-3213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3214"><a href="#cb480-3214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3215"><a href="#cb480-3215" aria-hidden="true" tabindex="-1"></a><span class="co">#n.trees = 1082, grid.resolution = 100,</span></span>
<span id="cb480-3216"><a href="#cb480-3216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3217"><a href="#cb480-3217" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3218"><a href="#cb480-3218" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3219"><a href="#cb480-3219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3220"><a href="#cb480-3220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3221"><a href="#cb480-3221" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb480-3222"><a href="#cb480-3222" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb480-3223"><a href="#cb480-3223" aria-hidden="true" tabindex="-1"></a>pTemp_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3224"><a href="#cb480-3224" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3225"><a href="#cb480-3225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3226"><a href="#cb480-3226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3227"><a href="#cb480-3227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3228"><a href="#cb480-3228" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3229"><a href="#cb480-3229" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3230"><a href="#cb480-3230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3231"><a href="#cb480-3231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3232"><a href="#cb480-3232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3233"><a href="#cb480-3233" aria-hidden="true" tabindex="-1"></a>pYear_negGrowth <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3234"><a href="#cb480-3234" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3235"><a href="#cb480-3235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3236"><a href="#cb480-3236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3237"><a href="#cb480-3237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3238"><a href="#cb480-3238" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pWeight_negGrowth, pFlow_negGrowth, pTemp_negGrowth, pNInd_negGrowth, pYear_negGrowth, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb480-3239"><a href="#cb480-3239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3240"><a href="#cb480-3240" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-3241"><a href="#cb480-3241" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb480-3242"><a href="#cb480-3242" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3243"><a href="#cb480-3243" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3244"><a href="#cb480-3244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (observedWeight<span class="sc">-</span><span class="fu">mean</span>(observedWeight))<span class="sc">/</span><span class="fu">sd</span>(observedWeight),</span>
<span id="cb480-3245"><a href="#cb480-3245" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Mass"</span>,</span>
<span id="cb480-3246"><a href="#cb480-3246" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-3247"><a href="#cb480-3247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3248"><a href="#cb480-3248" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3249"><a href="#cb480-3249" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3250"><a href="#cb480-3250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanFlowByRiver<span class="sc">-</span><span class="fu">mean</span>(meanFlowByRiver))<span class="sc">/</span><span class="fu">sd</span>(meanFlowByRiver),</span>
<span id="cb480-3251"><a href="#cb480-3251" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb480-3252"><a href="#cb480-3252" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-3253"><a href="#cb480-3253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3254"><a href="#cb480-3254" aria-hidden="true" tabindex="-1"></a>pMT_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3255"><a href="#cb480-3255" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3256"><a href="#cb480-3256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanTemperature<span class="sc">-</span><span class="fu">mean</span>(meanTemperature))<span class="sc">/</span><span class="fu">sd</span>(meanTemperature),</span>
<span id="cb480-3257"><a href="#cb480-3257" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb480-3258"><a href="#cb480-3258" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-3259"><a href="#cb480-3259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3260"><a href="#cb480-3260" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3261"><a href="#cb480-3261" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3262"><a href="#cb480-3262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb480-3263"><a href="#cb480-3263" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb480-3264"><a href="#cb480-3264" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-3265"><a href="#cb480-3265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3266"><a href="#cb480-3266" aria-hidden="true" tabindex="-1"></a>pYear_negGrowthDataBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3267"><a href="#cb480-3267" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3268"><a href="#cb480-3268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb480-3269"><a href="#cb480-3269" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb480-3270"><a href="#cb480-3270" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>)</span>
<span id="cb480-3271"><a href="#cb480-3271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3272"><a href="#cb480-3272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3273"><a href="#cb480-3273" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataBKT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pWeight_negGrowthDataBKT, pFlow_negGrowthDataBKT, pMT_negGrowthDataBKT, pNInd_negGrowthDataBKT, pYear_negGrowthDataBKT)</span>
<span id="cb480-3274"><a href="#cb480-3274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3275"><a href="#cb480-3275" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb480-3276"><a href="#cb480-3276" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataBKT_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthDataBKT, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb480-3277"><a href="#cb480-3277" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-3278"><a href="#cb480-3278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-3279"><a href="#cb480-3279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3280"><a href="#cb480-3280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb480-3281"><a href="#cb480-3281" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-3282"><a href="#cb480-3282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3283"><a href="#cb480-3283" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-3284"><a href="#cb480-3284" aria-hidden="true" tabindex="-1"></a><span class="co"># All river on one graph</span></span>
<span id="cb480-3285"><a href="#cb480-3285" aria-hidden="true" tabindex="-1"></a>partialWBBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3286"><a href="#cb480-3286" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3287"><a href="#cb480-3287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"West Brook"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3288"><a href="#cb480-3288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>)</span>
<span id="cb480-3289"><a href="#cb480-3289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3290"><a href="#cb480-3290" aria-hidden="true" tabindex="-1"></a>partialOLBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3291"><a href="#cb480-3291" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb480-3292"><a href="#cb480-3292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Large"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3293"><a href="#cb480-3293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>)</span>
<span id="cb480-3294"><a href="#cb480-3294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3295"><a href="#cb480-3295" aria-hidden="true" tabindex="-1"></a>partialOSBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3296"><a href="#cb480-3296" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3297"><a href="#cb480-3297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3298"><a href="#cb480-3298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>)</span>
<span id="cb480-3299"><a href="#cb480-3299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3300"><a href="#cb480-3300" aria-hidden="true" tabindex="-1"></a>partialISBKT <span class="ot">&lt;-</span> negGrowthBKT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3301"><a href="#cb480-3301" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Isolated_Small"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBKT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb480-3302"><a href="#cb480-3302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Isolated Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3303"><a href="#cb480-3303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Isolated_Small"</span>)</span>
<span id="cb480-3304"><a href="#cb480-3304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3305"><a href="#cb480-3305" aria-hidden="true" tabindex="-1"></a>partialRiversBKT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partialWBBKT, partialOLBKT, partialOSBKT, partialISBKT) <span class="sc">|&gt;</span> </span>
<span id="cb480-3306"><a href="#cb480-3306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-3307"><a href="#cb480-3307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RiverEffect =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span><span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb480-3308"><a href="#cb480-3308" aria-hidden="true" tabindex="-1"></a>         <span class="at">riverOrdered =</span> <span class="fu">factor</span>(riverGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>, <span class="st">"Isolated Small"</span>), </span>
<span id="cb480-3309"><a href="#cb480-3309" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> T))</span>
<span id="cb480-3310"><a href="#cb480-3310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3311"><a href="#cb480-3311" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(partialRiversBKT, <span class="fu">aes</span>(riverOrdered, yhat, <span class="at">fill =</span> <span class="fu">factor</span>(RiverEffect))) <span class="sc">+</span></span>
<span id="cb480-3312"><a href="#cb480-3312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-3313"><a href="#cb480-3313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>)</span>
<span id="cb480-3314"><a href="#cb480-3314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3315"><a href="#cb480-3315" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb480-3316"><a href="#cb480-3316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3317"><a href="#cb480-3317" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanTemperature"</span>, <span class="at">X =</span> negGrowthBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanFlowByRiver"</span>)) <span class="sc">+</span></span>
<span id="cb480-3318"><a href="#cb480-3318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanFlowByRiver), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3319"><a href="#cb480-3319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3320"><a href="#cb480-3320" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanTemperature"</span>)) <span class="sc">+</span></span>
<span id="cb480-3321"><a href="#cb480-3321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanTemperature), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3322"><a href="#cb480-3322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3323"><a href="#cb480-3323" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBKT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthBKT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb480-3324"><a href="#cb480-3324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3325"><a href="#cb480-3325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3326"><a href="#cb480-3326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3327"><a href="#cb480-3327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3328"><a href="#cb480-3328" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brown trout</span></span>
<span id="cb480-3329"><a href="#cb480-3329" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Run hyperparameter grid and main model</span></span>
<span id="cb480-3332"><a href="#cb480-3332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3333"><a href="#cb480-3333" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xgbIndBNT</span></span>
<span id="cb480-3334"><a href="#cb480-3334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3335"><a href="#cb480-3335" aria-hidden="true" tabindex="-1"></a>runHP_BNT <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb480-3336"><a href="#cb480-3336" aria-hidden="true" tabindex="-1"></a>runXGB_BNT <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb480-3337"><a href="#cb480-3337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3338"><a href="#cb480-3338" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runHP_BNT) {</span>
<span id="cb480-3339"><a href="#cb480-3339" aria-hidden="true" tabindex="-1"></a>  hpNegGrowthBNT <span class="ot">&lt;-</span> <span class="fu">runHyperparamSearchIndData</span>(</span>
<span id="cb480-3340"><a href="#cb480-3340" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brown trout"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight), year <span class="sc">&gt;</span> <span class="dv">2001</span>) <span class="sc">|&gt;</span></span>
<span id="cb480-3341"><a href="#cb480-3341" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb480-3342"><a href="#cb480-3342" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb480-3343"><a href="#cb480-3343" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb480-3344"><a href="#cb480-3344" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">50000</span>,</span>
<span id="cb480-3345"><a href="#cb480-3345" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">10</span></span>
<span id="cb480-3346"><a href="#cb480-3346" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3347"><a href="#cb480-3347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(hpNegGrowthBNT, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthBNT.RData"</span>)</span>
<span id="cb480-3348"><a href="#cb480-3348" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb480-3349"><a href="#cb480-3349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthBNT.RData"</span>)</span>
<span id="cb480-3350"><a href="#cb480-3350" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3351"><a href="#cb480-3351" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3352"><a href="#cb480-3352" aria-hidden="true" tabindex="-1"></a>  hpNegGrowthBNT[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb480-3353"><a href="#cb480-3353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3354"><a href="#cb480-3354" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runXGB_BNT) {</span>
<span id="cb480-3355"><a href="#cb480-3355" aria-hidden="true" tabindex="-1"></a>  negGrowthBNT <span class="ot">&lt;-</span> <span class="fu">runXGB_indData</span>(</span>
<span id="cb480-3356"><a href="#cb480-3356" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Brown trout"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight), year <span class="sc">&gt;</span> <span class="dv">2001</span>) <span class="sc">|&gt;</span></span>
<span id="cb480-3357"><a href="#cb480-3357" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb480-3358"><a href="#cb480-3358" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb480-3359"><a href="#cb480-3359" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"riverGG"</span>, <span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb480-3360"><a href="#cb480-3360" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">200000</span>,</span>
<span id="cb480-3361"><a href="#cb480-3361" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">20</span>,</span>
<span id="cb480-3362"><a href="#cb480-3362" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> hpNegGrowthBNT[<span class="dv">1</span>,]</span>
<span id="cb480-3363"><a href="#cb480-3363" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3364"><a href="#cb480-3364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(negGrowthBNT, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthBNT.RData"</span>)</span>
<span id="cb480-3365"><a href="#cb480-3365" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb480-3366"><a href="#cb480-3366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthBNT.RData"</span>)</span>
<span id="cb480-3367"><a href="#cb480-3367" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3368"><a href="#cb480-3368" aria-hidden="true" tabindex="-1"></a>negGrowthBNT<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span>
<span id="cb480-3369"><a href="#cb480-3369" aria-hidden="true" tabindex="-1"></a>negGrowthBNT<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span>
<span id="cb480-3370"><a href="#cb480-3370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3371"><a href="#cb480-3371" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs number trees</span></span>
<span id="cb480-3372"><a href="#cb480-3372" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(negGrowthBNT<span class="sc">$</span>xgb<span class="sc">$</span>evaluation_log) <span class="sc">+</span></span>
<span id="cb480-3373"><a href="#cb480-3373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, train_logloss), <span class="at">color =</span> <span class="st">"red"</span>) </span>
<span id="cb480-3374"><a href="#cb480-3374" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_line(aes(iter, test_logloss), color = "blue")</span></span>
<span id="cb480-3375"><a href="#cb480-3375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3376"><a href="#cb480-3376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3379"><a href="#cb480-3379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3380"><a href="#cb480-3380" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xgbIndBNT_figs</span></span>
<span id="cb480-3381"><a href="#cb480-3381" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb480-3382"><a href="#cb480-3382" aria-hidden="true" tabindex="-1"></a>viBNT_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> negGrowthBNT<span class="sc">$</span>xgb)</span>
<span id="cb480-3383"><a href="#cb480-3383" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viBNT_negGrowth, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span>
<span id="cb480-3384"><a href="#cb480-3384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3385"><a href="#cb480-3385" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb480-3386"><a href="#cb480-3386" aria-hidden="true" tabindex="-1"></a>s_negGrowthBNT <span class="ot">&lt;-</span> <span class="fu">hstats</span>(negGrowthBNT<span class="sc">$</span>xgb, <span class="at">v =</span> negGrowthBNT<span class="sc">$</span>new_vars, <span class="at">X =</span> negGrowthBNT<span class="sc">$</span>features_train)</span>
<span id="cb480-3387"><a href="#cb480-3387" aria-hidden="true" tabindex="-1"></a>s_negGrowthBNT</span>
<span id="cb480-3388"><a href="#cb480-3388" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthBNT)</span>
<span id="cb480-3389"><a href="#cb480-3389" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-3390"><a href="#cb480-3390" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb480-3391"><a href="#cb480-3391" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_negGrowthBNT, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb480-3392"><a href="#cb480-3392" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthBNT, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">normalize =</span> F, <span class="at">squared =</span> F, <span class="at">facet_scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb480-3393"><a href="#cb480-3393" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-3394"><a href="#cb480-3394" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb480-3395"><a href="#cb480-3395" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_negGrowthBNT, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb480-3396"><a href="#cb480-3396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3397"><a href="#cb480-3397" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb480-3398"><a href="#cb480-3398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3399"><a href="#cb480-3399" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3400"><a href="#cb480-3400" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3401"><a href="#cb480-3401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3402"><a href="#cb480-3402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3403"><a href="#cb480-3403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3404"><a href="#cb480-3404" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3405"><a href="#cb480-3405" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3406"><a href="#cb480-3406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3407"><a href="#cb480-3407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3408"><a href="#cb480-3408" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb480-3409"><a href="#cb480-3409" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb480-3410"><a href="#cb480-3410" aria-hidden="true" tabindex="-1"></a>pTemp_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3411"><a href="#cb480-3411" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3412"><a href="#cb480-3412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3413"><a href="#cb480-3413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3414"><a href="#cb480-3414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3415"><a href="#cb480-3415" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3416"><a href="#cb480-3416" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3417"><a href="#cb480-3417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3418"><a href="#cb480-3418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3419"><a href="#cb480-3419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3420"><a href="#cb480-3420" aria-hidden="true" tabindex="-1"></a>pYear_negGrowth <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3421"><a href="#cb480-3421" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3422"><a href="#cb480-3422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3423"><a href="#cb480-3423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3424"><a href="#cb480-3424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3425"><a href="#cb480-3425" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pWeight_negGrowth, pFlow_negGrowth, pTemp_negGrowth, pNInd_negGrowth, pYear_negGrowth, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb480-3426"><a href="#cb480-3426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3427"><a href="#cb480-3427" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-3428"><a href="#cb480-3428" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb480-3429"><a href="#cb480-3429" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowthDataBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3430"><a href="#cb480-3430" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3431"><a href="#cb480-3431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanFlowByRiver<span class="sc">-</span><span class="fu">mean</span>(meanFlowByRiver))<span class="sc">/</span><span class="fu">sd</span>(meanFlowByRiver),</span>
<span id="cb480-3432"><a href="#cb480-3432" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb480-3433"><a href="#cb480-3433" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb480-3434"><a href="#cb480-3434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3435"><a href="#cb480-3435" aria-hidden="true" tabindex="-1"></a>pMT_negGrowthDataBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3436"><a href="#cb480-3436" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3437"><a href="#cb480-3437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanTemperature<span class="sc">-</span><span class="fu">mean</span>(meanTemperature))<span class="sc">/</span><span class="fu">sd</span>(meanTemperature),</span>
<span id="cb480-3438"><a href="#cb480-3438" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb480-3439"><a href="#cb480-3439" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb480-3440"><a href="#cb480-3440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3441"><a href="#cb480-3441" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowthDataBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3442"><a href="#cb480-3442" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3443"><a href="#cb480-3443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb480-3444"><a href="#cb480-3444" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb480-3445"><a href="#cb480-3445" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb480-3446"><a href="#cb480-3446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3447"><a href="#cb480-3447" aria-hidden="true" tabindex="-1"></a>pYear_negGrowthDataBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3448"><a href="#cb480-3448" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3449"><a href="#cb480-3449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb480-3450"><a href="#cb480-3450" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb480-3451"><a href="#cb480-3451" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>)</span>
<span id="cb480-3452"><a href="#cb480-3452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3453"><a href="#cb480-3453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3454"><a href="#cb480-3454" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataBNT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pFlow_negGrowthDataBNT, pMT_negGrowthDataBNT, pNInd_negGrowthDataBNT, pYear_negGrowthDataBNT)</span>
<span id="cb480-3455"><a href="#cb480-3455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3456"><a href="#cb480-3456" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb480-3457"><a href="#cb480-3457" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataBNT_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthDataBNT, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb480-3458"><a href="#cb480-3458" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-3459"><a href="#cb480-3459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-3460"><a href="#cb480-3460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3461"><a href="#cb480-3461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb480-3462"><a href="#cb480-3462" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-3463"><a href="#cb480-3463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3464"><a href="#cb480-3464" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-3465"><a href="#cb480-3465" aria-hidden="true" tabindex="-1"></a><span class="co"># All river on one graph</span></span>
<span id="cb480-3466"><a href="#cb480-3466" aria-hidden="true" tabindex="-1"></a>partialWBBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3467"><a href="#cb480-3467" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3468"><a href="#cb480-3468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"West Brook"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3469"><a href="#cb480-3469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_West_Brook"</span>)</span>
<span id="cb480-3470"><a href="#cb480-3470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3471"><a href="#cb480-3471" aria-hidden="true" tabindex="-1"></a>partialOLBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3472"><a href="#cb480-3472" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train)<span class="sc">|&gt;</span> </span>
<span id="cb480-3473"><a href="#cb480-3473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Large"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3474"><a href="#cb480-3474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Large"</span>)</span>
<span id="cb480-3475"><a href="#cb480-3475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3476"><a href="#cb480-3476" aria-hidden="true" tabindex="-1"></a>partialOSBNT <span class="ot">&lt;-</span> negGrowthBNT<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3477"><a href="#cb480-3477" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthBNT<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3478"><a href="#cb480-3478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">riverGG =</span> <span class="st">"Open Small"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3479"><a href="#cb480-3479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x =</span> <span class="st">"riverGG_lev_x_Open_Small"</span>)</span>
<span id="cb480-3480"><a href="#cb480-3480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3481"><a href="#cb480-3481" aria-hidden="true" tabindex="-1"></a>partialRiversBNT <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partialWBBNT, partialOLBNT, partialOSBNT) <span class="sc">|&gt;</span> </span>
<span id="cb480-3482"><a href="#cb480-3482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-3483"><a href="#cb480-3483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RiverEffect =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span><span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb480-3484"><a href="#cb480-3484" aria-hidden="true" tabindex="-1"></a>         <span class="at">riverOrdered =</span> <span class="fu">factor</span>(riverGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Open Large"</span>, <span class="st">"Open Small"</span>), </span>
<span id="cb480-3485"><a href="#cb480-3485" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> T))</span>
<span id="cb480-3486"><a href="#cb480-3486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3487"><a href="#cb480-3487" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(partialRiversBNT, <span class="fu">aes</span>(riverOrdered, yhat, <span class="at">fill =</span> <span class="fu">factor</span>(RiverEffect))) <span class="sc">+</span></span>
<span id="cb480-3488"><a href="#cb480-3488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-3489"><a href="#cb480-3489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>)</span>
<span id="cb480-3490"><a href="#cb480-3490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3491"><a href="#cb480-3491" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb480-3492"><a href="#cb480-3492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3493"><a href="#cb480-3493" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanTemperature"</span>, <span class="at">X =</span> negGrowthBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanFlowByRiver"</span>)) <span class="sc">+</span></span>
<span id="cb480-3494"><a href="#cb480-3494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanFlowByRiver), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3495"><a href="#cb480-3495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3496"><a href="#cb480-3496" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanTemperature"</span>)) <span class="sc">+</span></span>
<span id="cb480-3497"><a href="#cb480-3497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanTemperature), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3498"><a href="#cb480-3498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3499"><a href="#cb480-3499" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthBNT<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthBNT<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb480-3500"><a href="#cb480-3500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3501"><a href="#cb480-3501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3502"><a href="#cb480-3502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3503"><a href="#cb480-3503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3504"><a href="#cb480-3504" aria-hidden="true" tabindex="-1"></a><span class="fu">### Atlantic salmon</span></span>
<span id="cb480-3505"><a href="#cb480-3505" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Run hyperparameter grid and main model</span></span>
<span id="cb480-3508"><a href="#cb480-3508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3509"><a href="#cb480-3509" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xgbIndATS</span></span>
<span id="cb480-3510"><a href="#cb480-3510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3511"><a href="#cb480-3511" aria-hidden="true" tabindex="-1"></a>runHP_ATS <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb480-3512"><a href="#cb480-3512" aria-hidden="true" tabindex="-1"></a>runXGB_ATS <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb480-3513"><a href="#cb480-3513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3514"><a href="#cb480-3514" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runHP_ATS) {</span>
<span id="cb480-3515"><a href="#cb480-3515" aria-hidden="true" tabindex="-1"></a>  hpNegGrowthATS <span class="ot">&lt;-</span> <span class="fu">runHyperparamSearchIndData</span>(</span>
<span id="cb480-3516"><a href="#cb480-3516" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Atlantic salmon"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight)) <span class="sc">|&gt;</span></span>
<span id="cb480-3517"><a href="#cb480-3517" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb480-3518"><a href="#cb480-3518" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb480-3519"><a href="#cb480-3519" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb480-3520"><a href="#cb480-3520" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">50000</span>,</span>
<span id="cb480-3521"><a href="#cb480-3521" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">10</span></span>
<span id="cb480-3522"><a href="#cb480-3522" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3523"><a href="#cb480-3523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(hpNegGrowthATS, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthATS.RData"</span>)</span>
<span id="cb480-3524"><a href="#cb480-3524" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {  </span>
<span id="cb480-3525"><a href="#cb480-3525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/hyperParam/hpNegGrowthATS.RData"</span>)</span>
<span id="cb480-3526"><a href="#cb480-3526" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb480-3527"><a href="#cb480-3527" aria-hidden="true" tabindex="-1"></a>hpNegGrowthATS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb480-3528"><a href="#cb480-3528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3529"><a href="#cb480-3529" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (runXGB_ATS) {</span>
<span id="cb480-3530"><a href="#cb480-3530" aria-hidden="true" tabindex="-1"></a>  negGrowthATS <span class="ot">&lt;-</span> <span class="fu">runXGB_indData</span>(</span>
<span id="cb480-3531"><a href="#cb480-3531" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> cd1 <span class="sc">|&gt;</span>  <span class="fu">filter</span>(speciesGG <span class="sc">==</span> <span class="st">"Atlantic salmon"</span>, <span class="sc">!</span><span class="fu">is.na</span>(grWeight)) <span class="sc">|&gt;</span></span>
<span id="cb480-3532"><a href="#cb480-3532" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb480-3533"><a href="#cb480-3533" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)),</span>
<span id="cb480-3534"><a href="#cb480-3534" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"observedWeight"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"nInd"</span>, <span class="st">"nIndBySpp"</span>, <span class="st">"negGrowth"</span>),</span>
<span id="cb480-3535"><a href="#cb480-3535" aria-hidden="true" tabindex="-1"></a>    <span class="at">nRoundsIn =</span> <span class="dv">200000</span>,</span>
<span id="cb480-3536"><a href="#cb480-3536" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_stopping_roundsIn =</span> <span class="dv">20</span>,</span>
<span id="cb480-3537"><a href="#cb480-3537" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> hpNegGrowthATS[<span class="dv">1</span>,]</span>
<span id="cb480-3538"><a href="#cb480-3538" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3539"><a href="#cb480-3539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(negGrowthATS, <span class="at">file =</span> <span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthATS.RData"</span>)</span>
<span id="cb480-3540"><a href="#cb480-3540" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb480-3541"><a href="#cb480-3541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"./data/out/XGBoost/modelRuns/XGBnegGrowthATS.RData"</span>)</span>
<span id="cb480-3542"><a href="#cb480-3542" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3543"><a href="#cb480-3543" aria-hidden="true" tabindex="-1"></a>negGrowthATS<span class="sc">$</span>xgb<span class="sc">$</span>best_iteration</span>
<span id="cb480-3544"><a href="#cb480-3544" aria-hidden="true" tabindex="-1"></a>negGrowthATS<span class="sc">$</span>xgb<span class="sc">$</span>best_score</span>
<span id="cb480-3545"><a href="#cb480-3545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3546"><a href="#cb480-3546" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs number trees</span></span>
<span id="cb480-3547"><a href="#cb480-3547" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(negGrowthATS<span class="sc">$</span>xgb<span class="sc">$</span>evaluation_log) <span class="sc">+</span></span>
<span id="cb480-3548"><a href="#cb480-3548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, train_logloss), <span class="at">color =</span> <span class="st">"red"</span>) </span>
<span id="cb480-3549"><a href="#cb480-3549" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_line(aes(iter, test_logloss), color = "blue")</span></span>
<span id="cb480-3550"><a href="#cb480-3550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3551"><a href="#cb480-3551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3554"><a href="#cb480-3554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3555"><a href="#cb480-3555" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xgbIndATS_figs</span></span>
<span id="cb480-3556"><a href="#cb480-3556" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb480-3557"><a href="#cb480-3557" aria-hidden="true" tabindex="-1"></a>viATS_negGrowth <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> negGrowthATS<span class="sc">$</span>xgb)</span>
<span id="cb480-3558"><a href="#cb480-3558" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(viATS_negGrowth, <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>)</span>
<span id="cb480-3559"><a href="#cb480-3559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3560"><a href="#cb480-3560" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb480-3561"><a href="#cb480-3561" aria-hidden="true" tabindex="-1"></a>s_negGrowthATS <span class="ot">&lt;-</span> <span class="fu">hstats</span>(negGrowthATS<span class="sc">$</span>xgb, <span class="at">v =</span> negGrowthATS<span class="sc">$</span>new_vars, <span class="at">X =</span> negGrowthATS<span class="sc">$</span>features_train)</span>
<span id="cb480-3562"><a href="#cb480-3562" aria-hidden="true" tabindex="-1"></a>s_negGrowthATS</span>
<span id="cb480-3563"><a href="#cb480-3563" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthATS)</span>
<span id="cb480-3564"><a href="#cb480-3564" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-3565"><a href="#cb480-3565" aria-hidden="true" tabindex="-1"></a><span class="co"># # top 5 2-way interactions</span></span>
<span id="cb480-3566"><a href="#cb480-3566" aria-hidden="true" tabindex="-1"></a><span class="co"># h2_pairwise(s_negGrowthATS, normalize = FALSE, squared = FALSE, top_m = 8)</span></span>
<span id="cb480-3567"><a href="#cb480-3567" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_negGrowthATS, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">normalize =</span> F, <span class="at">squared =</span> F, <span class="at">facet_scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb480-3568"><a href="#cb480-3568" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-3569"><a href="#cb480-3569" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3-way interactions</span></span>
<span id="cb480-3570"><a href="#cb480-3570" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(s_negGrowthATS, which = 1:3, normalize = F, squared = F, facet_scales = "free_y", ncol = 1)</span></span>
<span id="cb480-3571"><a href="#cb480-3571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3572"><a href="#cb480-3572" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial dep plots ################################################################</span></span>
<span id="cb480-3573"><a href="#cb480-3573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3574"><a href="#cb480-3574" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3575"><a href="#cb480-3575" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3576"><a href="#cb480-3576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3577"><a href="#cb480-3577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3578"><a href="#cb480-3578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3579"><a href="#cb480-3579" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3580"><a href="#cb480-3580" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3581"><a href="#cb480-3581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3582"><a href="#cb480-3582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3583"><a href="#cb480-3583" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_discrete() +</span></span>
<span id="cb480-3584"><a href="#cb480-3584" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle("PDP")</span></span>
<span id="cb480-3585"><a href="#cb480-3585" aria-hidden="true" tabindex="-1"></a>pTemp_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3586"><a href="#cb480-3586" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3587"><a href="#cb480-3587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3588"><a href="#cb480-3588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3589"><a href="#cb480-3589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3590"><a href="#cb480-3590" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3591"><a href="#cb480-3591" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3592"><a href="#cb480-3592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3593"><a href="#cb480-3593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3594"><a href="#cb480-3594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3595"><a href="#cb480-3595" aria-hidden="true" tabindex="-1"></a>pYear_negGrowth <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3596"><a href="#cb480-3596" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">%&gt;%</span></span>
<span id="cb480-3597"><a href="#cb480-3597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">+</span></span>
<span id="cb480-3598"><a href="#cb480-3598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3599"><a href="#cb480-3599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3600"><a href="#cb480-3600" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pWeight_negGrowth, pFlow_negGrowth, pTemp_negGrowth, pNInd_negGrowth, pYear_negGrowth, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb480-3601"><a href="#cb480-3601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3602"><a href="#cb480-3602" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb480-3603"><a href="#cb480-3603" aria-hidden="true" tabindex="-1"></a><span class="co"># all on one graph</span></span>
<span id="cb480-3604"><a href="#cb480-3604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3605"><a href="#cb480-3605" aria-hidden="true" tabindex="-1"></a>pWeight_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3606"><a href="#cb480-3606" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3607"><a href="#cb480-3607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (observedWeight<span class="sc">-</span><span class="fu">mean</span>(observedWeight))<span class="sc">/</span><span class="fu">sd</span>(observedWeight),</span>
<span id="cb480-3608"><a href="#cb480-3608" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Mass"</span>,</span>
<span id="cb480-3609"><a href="#cb480-3609" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb480-3610"><a href="#cb480-3610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3611"><a href="#cb480-3611" aria-hidden="true" tabindex="-1"></a>pFlow_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3612"><a href="#cb480-3612" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3613"><a href="#cb480-3613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanFlowByRiver<span class="sc">-</span><span class="fu">mean</span>(meanFlowByRiver))<span class="sc">/</span><span class="fu">sd</span>(meanFlowByRiver),</span>
<span id="cb480-3614"><a href="#cb480-3614" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Flow"</span>,</span>
<span id="cb480-3615"><a href="#cb480-3615" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb480-3616"><a href="#cb480-3616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3617"><a href="#cb480-3617" aria-hidden="true" tabindex="-1"></a>pMT_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3618"><a href="#cb480-3618" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3619"><a href="#cb480-3619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (meanTemperature<span class="sc">-</span><span class="fu">mean</span>(meanTemperature))<span class="sc">/</span><span class="fu">sd</span>(meanTemperature),</span>
<span id="cb480-3620"><a href="#cb480-3620" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb480-3621"><a href="#cb480-3621" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb480-3622"><a href="#cb480-3622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3623"><a href="#cb480-3623" aria-hidden="true" tabindex="-1"></a>pNInd_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3624"><a href="#cb480-3624" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"nInd"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3625"><a href="#cb480-3625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (nInd<span class="sc">-</span><span class="fu">mean</span>(nInd))<span class="sc">/</span><span class="fu">sd</span>(nInd),</span>
<span id="cb480-3626"><a href="#cb480-3626" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Num inds"</span>,</span>
<span id="cb480-3627"><a href="#cb480-3627" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb480-3628"><a href="#cb480-3628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3629"><a href="#cb480-3629" aria-hidden="true" tabindex="-1"></a>pYear_negGrowthDataATS <span class="ot">&lt;-</span> negGrowthATS<span class="sc">$</span>xgb <span class="sc">%&gt;%</span></span>
<span id="cb480-3630"><a href="#cb480-3630" aria-hidden="true" tabindex="-1"></a>  pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"year"</span>, <span class="at">n.trees =</span> <span class="dv">10</span>, <span class="at">grid.resolution =</span> <span class="dv">50</span>, <span class="at">train =</span> negGrowthATS<span class="sc">$</span>features_train) <span class="sc">|&gt;</span> </span>
<span id="cb480-3631"><a href="#cb480-3631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xScaled =</span> (year<span class="sc">-</span><span class="fu">mean</span>(year))<span class="sc">/</span><span class="fu">sd</span>(year),</span>
<span id="cb480-3632"><a href="#cb480-3632" aria-hidden="true" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"Year"</span>,</span>
<span id="cb480-3633"><a href="#cb480-3633" aria-hidden="true" tabindex="-1"></a>         <span class="at">speciesGG =</span> <span class="st">"Atlantic salmon"</span>)</span>
<span id="cb480-3634"><a href="#cb480-3634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3635"><a href="#cb480-3635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3636"><a href="#cb480-3636" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataATS <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pWeight_negGrowthDataATS, pFlow_negGrowthDataATS, pMT_negGrowthDataATS, pNInd_negGrowthDataATS, pYear_negGrowthDataATS)</span>
<span id="cb480-3637"><a href="#cb480-3637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3638"><a href="#cb480-3638" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb480-3639"><a href="#cb480-3639" aria-hidden="true" tabindex="-1"></a>all_negGrowthDataATS_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthDataATS, <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> var)) <span class="sc">+</span></span>
<span id="cb480-3640"><a href="#cb480-3640" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-3641"><a href="#cb480-3641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-3642"><a href="#cb480-3642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3643"><a href="#cb480-3643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effect on proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Scaled value"</span>)</span>
<span id="cb480-3644"><a href="#cb480-3644" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-3645"><a href="#cb480-3645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3646"><a href="#cb480-3646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3647"><a href="#cb480-3647" aria-hidden="true" tabindex="-1"></a><span class="do">### Interaction plots ##################################################################</span></span>
<span id="cb480-3648"><a href="#cb480-3648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3649"><a href="#cb480-3649" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanTemperature"</span>, <span class="at">X =</span> negGrowthATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanFlowByRiver"</span>)) <span class="sc">+</span></span>
<span id="cb480-3650"><a href="#cb480-3650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanFlowByRiver), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3651"><a href="#cb480-3651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3652"><a href="#cb480-3652" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="st">"meanTemperature"</span>)) <span class="sc">+</span></span>
<span id="cb480-3653"><a href="#cb480-3653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> meanTemperature), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3654"><a href="#cb480-3654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3655"><a href="#cb480-3655" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">partial_dep</span>(negGrowthATS<span class="sc">$</span>xgb, <span class="at">v =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">X =</span> negGrowthATS<span class="sc">$</span>features_train, <span class="at">BY =</span> <span class="fu">c</span>(<span class="st">"nInd"</span>))) <span class="sc">+</span></span>
<span id="cb480-3656"><a href="#cb480-3656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> nInd), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3657"><a href="#cb480-3657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3658"><a href="#cb480-3658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3659"><a href="#cb480-3659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3660"><a href="#cb480-3660" aria-hidden="true" tabindex="-1"></a><span class="fu">### All 3 species</span></span>
<span id="cb480-3663"><a href="#cb480-3663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3664"><a href="#cb480-3664" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: partial3sppIndProbNeg</span></span>
<span id="cb480-3665"><a href="#cb480-3665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3666"><a href="#cb480-3666" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plots</span></span>
<span id="cb480-3667"><a href="#cb480-3667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3668"><a href="#cb480-3668" aria-hidden="true" tabindex="-1"></a>viAll_negGrowth <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb480-3669"><a href="#cb480-3669" aria-hidden="true" tabindex="-1"></a>  viBKT_negGrowth <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Brook Trout"</span>),</span>
<span id="cb480-3670"><a href="#cb480-3670" aria-hidden="true" tabindex="-1"></a>  viBNT_negGrowth <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Brown Trout"</span>),</span>
<span id="cb480-3671"><a href="#cb480-3671" aria-hidden="true" tabindex="-1"></a>  viATS_negGrowth <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Feature, Gain) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speciesGG =</span> <span class="st">"Atlantic Salmon"</span>)</span>
<span id="cb480-3672"><a href="#cb480-3672" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3673"><a href="#cb480-3673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sppOrdered =</span> <span class="fu">factor</span>(speciesGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Brook Trout"</span>, <span class="st">"Brown Trout"</span>, <span class="st">"Atlantic Salmon"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-3674"><a href="#cb480-3674" aria-hidden="true" tabindex="-1"></a>         <span class="at">feature2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb480-3675"><a href="#cb480-3675" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"observedWeight"</span> <span class="sc">~</span> <span class="st">"Fish mass"</span>,</span>
<span id="cb480-3676"><a href="#cb480-3676" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"meanFlowByRiver"</span> <span class="sc">~</span> <span class="st">"Flow"</span>,</span>
<span id="cb480-3677"><a href="#cb480-3677" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"meanTemperature"</span> <span class="sc">~</span> <span class="st">"Temperature"</span>,</span>
<span id="cb480-3678"><a href="#cb480-3678" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"nInd"</span> <span class="sc">~</span> <span class="st">"Num Individuals"</span>,</span>
<span id="cb480-3679"><a href="#cb480-3679" aria-hidden="true" tabindex="-1"></a>           Feature <span class="sc">==</span> <span class="st">"year"</span> <span class="sc">~</span> <span class="st">"Year"</span>)</span>
<span id="cb480-3680"><a href="#cb480-3680" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3681"><a href="#cb480-3681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3682"><a href="#cb480-3682" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(viAll_negGrowth <span class="sc">|&gt;</span> <span class="fu">filter</span>(Feature <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"observedWeight"</span>, <span class="st">"meanFlowByRiver"</span>, <span class="st">"meanTemperature"</span>, <span class="st">"nInd"</span>, <span class="st">"year"</span>)), <span class="fu">aes</span>(feature2, Gain, <span class="at">fill =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-3683"><a href="#cb480-3683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb480-3684"><a href="#cb480-3684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3685"><a href="#cb480-3685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>() <span class="sc">+</span></span>
<span id="cb480-3686"><a href="#cb480-3686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Variable importance for the proportion of negative observations"</span>, <span class="at">x =</span> <span class="st">"Variable"</span>)</span>
<span id="cb480-3687"><a href="#cb480-3687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3688"><a href="#cb480-3688" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################</span></span>
<span id="cb480-3689"><a href="#cb480-3689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3690"><a href="#cb480-3690" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3spp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_negGrowthDataBKT, all_negGrowthDataBNT, all_negGrowthDataATS) <span class="sc">|&gt;</span> </span>
<span id="cb480-3691"><a href="#cb480-3691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sppOrdered =</span> <span class="fu">factor</span>(speciesGG, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Brook Trout"</span>, <span class="st">"Brown Trout"</span>, <span class="st">"Atlantic Salmon"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb480-3692"><a href="#cb480-3692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3693"><a href="#cb480-3693" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppMass_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Mass"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-3694"><a href="#cb480-3694" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-3695"><a href="#cb480-3695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-3696"><a href="#cb480-3696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3697"><a href="#cb480-3697" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-3698"><a href="#cb480-3698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled fish mass"</span>) <span class="sc">+</span></span>
<span id="cb480-3699"><a href="#cb480-3699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-3700"><a href="#cb480-3700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3701"><a href="#cb480-3701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3702"><a href="#cb480-3702" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppFlow_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Flow"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-3703"><a href="#cb480-3703" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-3704"><a href="#cb480-3704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-3705"><a href="#cb480-3705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3706"><a href="#cb480-3706" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-3707"><a href="#cb480-3707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled flow"</span>) <span class="sc">+</span></span>
<span id="cb480-3708"><a href="#cb480-3708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-3709"><a href="#cb480-3709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3710"><a href="#cb480-3710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3711"><a href="#cb480-3711" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppTemp_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Temperature"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-3712"><a href="#cb480-3712" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-3713"><a href="#cb480-3713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-3714"><a href="#cb480-3714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3715"><a href="#cb480-3715" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-3716"><a href="#cb480-3716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled temperature"</span>) <span class="sc">+</span></span>
<span id="cb480-3717"><a href="#cb480-3717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-3718"><a href="#cb480-3718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3719"><a href="#cb480-3719" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppNInd_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Num inds"</span>), <span class="fu">aes</span>(xScaled, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-3720"><a href="#cb480-3720" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-3721"><a href="#cb480-3721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-3722"><a href="#cb480-3722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3723"><a href="#cb480-3723" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-3724"><a href="#cb480-3724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Scaled Number of individuals"</span>) <span class="sc">+</span></span>
<span id="cb480-3725"><a href="#cb480-3725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-3726"><a href="#cb480-3726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3727"><a href="#cb480-3727" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppYear_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_negGrowthData3spp <span class="sc">|&gt;</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">"Year"</span>), <span class="fu">aes</span>(year, yhat, <span class="at">color =</span> sppOrdered, <span class="at">linetype =</span> sppOrdered)) <span class="sc">+</span></span>
<span id="cb480-3728"><a href="#cb480-3728" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb480-3729"><a href="#cb480-3729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb480-3730"><a href="#cb480-3730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb480-3731"><a href="#cb480-3731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>() <span class="sc">+</span></span>
<span id="cb480-3732"><a href="#cb480-3732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb480-3733"><a href="#cb480-3733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  </span>
<span id="cb480-3734"><a href="#cb480-3734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3735"><a href="#cb480-3735" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb480-3736"><a href="#cb480-3736" aria-hidden="true" tabindex="-1"></a>  all_negGrowthData3sppMass_gg,</span>
<span id="cb480-3737"><a href="#cb480-3737" aria-hidden="true" tabindex="-1"></a>  all_negGrowthData3sppFlow_gg, </span>
<span id="cb480-3738"><a href="#cb480-3738" aria-hidden="true" tabindex="-1"></a>  all_negGrowthData3sppTemp_gg,</span>
<span id="cb480-3739"><a href="#cb480-3739" aria-hidden="true" tabindex="-1"></a>  all_negGrowthData3sppNInd_gg,</span>
<span id="cb480-3740"><a href="#cb480-3740" aria-hidden="true" tabindex="-1"></a>  <span class="co">#all_negGrowthData3sppYear_gg,</span></span>
<span id="cb480-3741"><a href="#cb480-3741" aria-hidden="true" tabindex="-1"></a>  <span class="at">left =</span> <span class="fu">textGrob</span>(<span class="fu">expression</span>(<span class="fu">bold</span>(<span class="st">"Effect on proportion of negative observations"</span>)), <span class="at">rot =</span> <span class="dv">90</span>, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">16</span>))</span>
<span id="cb480-3742"><a href="#cb480-3742" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-3743"><a href="#cb480-3743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3744"><a href="#cb480-3744" aria-hidden="true" tabindex="-1"></a>all_negGrowthData3sppYear_gg</span>
<span id="cb480-3745"><a href="#cb480-3745" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb480-3746"><a href="#cb480-3746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3747"><a href="#cb480-3747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3748"><a href="#cb480-3748" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth model, continuous growth</span></span>
<span id="cb480-3749"><a href="#cb480-3749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3750"><a href="#cb480-3750" aria-hidden="true" tabindex="-1"></a>can we add season, river interactions? or do separate analyses?</span>
<span id="cb480-3751"><a href="#cb480-3751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3754"><a href="#cb480-3754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3755"><a href="#cb480-3755" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: readInTargets_W</span></span>
<span id="cb480-3756"><a href="#cb480-3756" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb480-3757"><a href="#cb480-3757" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb480-3758"><a href="#cb480-3758" aria-hidden="true" tabindex="-1"></a>dML_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(dML_W_target)</span>
<span id="cb480-3759"><a href="#cb480-3759" aria-hidden="true" tabindex="-1"></a>treatplan_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(treatplan_W_target)</span>
<span id="cb480-3760"><a href="#cb480-3760" aria-hidden="true" tabindex="-1"></a>features_train_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(features_train_W_target)</span>
<span id="cb480-3761"><a href="#cb480-3761" aria-hidden="true" tabindex="-1"></a>new_vars_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(new_vars_W_target)</span>
<span id="cb480-3762"><a href="#cb480-3762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3763"><a href="#cb480-3763" aria-hidden="true" tabindex="-1"></a><span class="co"># dimensions of one-hot encoded data</span></span>
<span id="cb480-3764"><a href="#cb480-3764" aria-hidden="true" tabindex="-1"></a>features_train_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(features_train_W_target)</span>
<span id="cb480-3765"><a href="#cb480-3765" aria-hidden="true" tabindex="-1"></a>features_test_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(features_test_W_target)</span>
<span id="cb480-3766"><a href="#cb480-3766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3767"><a href="#cb480-3767" aria-hidden="true" tabindex="-1"></a>response_train_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(response_train_W_target)</span>
<span id="cb480-3768"><a href="#cb480-3768" aria-hidden="true" tabindex="-1"></a>response_test_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(response_test_W_target)</span>
<span id="cb480-3769"><a href="#cb480-3769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3770"><a href="#cb480-3770" aria-hidden="true" tabindex="-1"></a><span class="co"># run from targets</span></span>
<span id="cb480-3771"><a href="#cb480-3771" aria-hidden="true" tabindex="-1"></a>hyper_grid_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(hyper_grid_W_target)</span>
<span id="cb480-3772"><a href="#cb480-3772" aria-hidden="true" tabindex="-1"></a>topModel_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(topModel_W_target)</span>
<span id="cb480-3773"><a href="#cb480-3773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3774"><a href="#cb480-3774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3775"><a href="#cb480-3775" aria-hidden="true" tabindex="-1"></a>finalModels_W <span class="ot">&lt;-</span> <span class="fu">tar_read</span>(finalModels_W_target)</span>
<span id="cb480-3776"><a href="#cb480-3776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3777"><a href="#cb480-3777" aria-hidden="true" tabindex="-1"></a>modelToUse <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb480-3778"><a href="#cb480-3778" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3779"><a href="#cb480-3779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3780"><a href="#cb480-3780" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Run first model</span></span>
<span id="cb480-3781"><a href="#cb480-3781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3784"><a href="#cb480-3784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3785"><a href="#cb480-3785" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runML1_W</span></span>
<span id="cb480-3786"><a href="#cb480-3786" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-3787"><a href="#cb480-3787" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducibility</span></span>
<span id="cb480-3788"><a href="#cb480-3788" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb480-3789"><a href="#cb480-3789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3790"><a href="#cb480-3790" aria-hidden="true" tabindex="-1"></a>xgb.fit1_W <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb480-3791"><a href="#cb480-3791" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> features_train_W,</span>
<span id="cb480-3792"><a href="#cb480-3792" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> response_train_W,</span>
<span id="cb480-3793"><a href="#cb480-3793" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">500</span>,</span>
<span id="cb480-3794"><a href="#cb480-3794" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb480-3795"><a href="#cb480-3795" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>,  <span class="co"># for regression models</span></span>
<span id="cb480-3796"><a href="#cb480-3796" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,               <span class="co"># silent,</span></span>
<span id="cb480-3797"><a href="#cb480-3797" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span></span>
<span id="cb480-3798"><a href="#cb480-3798" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-3799"><a href="#cb480-3799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3800"><a href="#cb480-3800" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of trees that minimize error</span></span>
<span id="cb480-3801"><a href="#cb480-3801" aria-hidden="true" tabindex="-1"></a>xgb.fit1_W<span class="sc">$</span>evaluation_log <span class="sc">%&gt;%</span></span>
<span id="cb480-3802"><a href="#cb480-3802" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb480-3803"><a href="#cb480-3803" aria-hidden="true" tabindex="-1"></a>    <span class="at">ntrees.train =</span> <span class="fu">which</span>(train_rmse_mean <span class="sc">==</span> <span class="fu">min</span>(train_rmse_mean))[<span class="dv">1</span>],</span>
<span id="cb480-3804"><a href="#cb480-3804" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmse.train   =</span> <span class="fu">min</span>(train_rmse_mean),</span>
<span id="cb480-3805"><a href="#cb480-3805" aria-hidden="true" tabindex="-1"></a>    <span class="at">ntrees.test  =</span> <span class="fu">which</span>(test_rmse_mean <span class="sc">==</span> <span class="fu">min</span>(test_rmse_mean))[<span class="dv">1</span>],</span>
<span id="cb480-3806"><a href="#cb480-3806" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmse.test   =</span> <span class="fu">min</span>(test_rmse_mean),</span>
<span id="cb480-3807"><a href="#cb480-3807" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-3808"><a href="#cb480-3808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3809"><a href="#cb480-3809" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs number trees</span></span>
<span id="cb480-3810"><a href="#cb480-3810" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xgb.fit1_W<span class="sc">$</span>evaluation_log) <span class="sc">+</span></span>
<span id="cb480-3811"><a href="#cb480-3811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, train_rmse_mean), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb480-3812"><a href="#cb480-3812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(iter, test_rmse_mean), <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb480-3813"><a href="#cb480-3813" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3814"><a href="#cb480-3814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3815"><a href="#cb480-3815" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Hyperparameter search grid</span></span>
<span id="cb480-3816"><a href="#cb480-3816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3819"><a href="#cb480-3819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3820"><a href="#cb480-3820" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runML_HP_W</span></span>
<span id="cb480-3821"><a href="#cb480-3821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3822"><a href="#cb480-3822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3823"><a href="#cb480-3823" aria-hidden="true" tabindex="-1"></a><span class="co"># create hyperparameter grid</span></span>
<span id="cb480-3824"><a href="#cb480-3824" aria-hidden="true" tabindex="-1"></a><span class="co"># original grid - using a smaller one in targets</span></span>
<span id="cb480-3825"><a href="#cb480-3825" aria-hidden="true" tabindex="-1"></a><span class="co"># hyper_grid_W0 &lt;- expand.grid(</span></span>
<span id="cb480-3826"><a href="#cb480-3826" aria-hidden="true" tabindex="-1"></a><span class="co">#   eta = c(.01, .05, .1, .3),</span></span>
<span id="cb480-3827"><a href="#cb480-3827" aria-hidden="true" tabindex="-1"></a><span class="co">#   max_depth = c(1, 3, 5, 7),</span></span>
<span id="cb480-3828"><a href="#cb480-3828" aria-hidden="true" tabindex="-1"></a><span class="co">#   min_child_weight = c(1, 3, 5, 7),</span></span>
<span id="cb480-3829"><a href="#cb480-3829" aria-hidden="true" tabindex="-1"></a><span class="co">#   subsample = c(.65, .8, 1), </span></span>
<span id="cb480-3830"><a href="#cb480-3830" aria-hidden="true" tabindex="-1"></a><span class="co">#   colsample_bytree = c(.8, .9, 1),</span></span>
<span id="cb480-3831"><a href="#cb480-3831" aria-hidden="true" tabindex="-1"></a><span class="co">#   optimal_trees = 0,               # a place to dump results</span></span>
<span id="cb480-3832"><a href="#cb480-3832" aria-hidden="true" tabindex="-1"></a><span class="co">#   min_RMSE = 0                     # a place to dump results</span></span>
<span id="cb480-3833"><a href="#cb480-3833" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb480-3834"><a href="#cb480-3834" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow(hyper_grid_W0)</span></span>
<span id="cb480-3835"><a href="#cb480-3835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3836"><a href="#cb480-3836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3837"><a href="#cb480-3837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3838"><a href="#cb480-3838" aria-hidden="true" tabindex="-1"></a><span class="co"># Original run using hyper_grid_W0 </span></span>
<span id="cb480-3839"><a href="#cb480-3839" aria-hidden="true" tabindex="-1"></a><span class="co"># eta max_depth min_child_weight</span></span>
<span id="cb480-3840"><a href="#cb480-3840" aria-hidden="true" tabindex="-1"></a><span class="co"># subsample colsample_bytree optimal_trees min_RMSE 1 0.01 7 5 0.65 0.8</span></span>
<span id="cb480-3841"><a href="#cb480-3841" aria-hidden="true" tabindex="-1"></a><span class="co"># 1376 0.001847600 2 0.05 7 3 0.80 0.9 292 0.001848465 3 0.01 7 7 0.80 0.9</span></span>
<span id="cb480-3842"><a href="#cb480-3842" aria-hidden="true" tabindex="-1"></a><span class="co"># 1382 0.001849086 4 0.01 5 1 0.80 0.8 2399 0.001849250 5 0.05 7 3 0.80</span></span>
<span id="cb480-3843"><a href="#cb480-3843" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.8 281 0.001849258 6 0.01 5 3 0.65 0.8 2147 0.001849905 7 0.05 5 1 0.65</span></span>
<span id="cb480-3844"><a href="#cb480-3844" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.8 459 0.001849931 8 0.01 5 5 0.80 0.9 2296 0.001850049 9 0.01 7 5 0.65</span></span>
<span id="cb480-3845"><a href="#cb480-3845" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.9 1402 0.001850246 10 0.01 7 7 0.65 0.8 1382 0.001850544 11 0.01 7 3</span></span>
<span id="cb480-3846"><a href="#cb480-3846" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.65 0.8 1384 0.001850704 12 0.05 3 3 0.80 0.8 1509 0.001850763 13 0.01</span></span>
<span id="cb480-3847"><a href="#cb480-3847" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 7 0.80 0.8 1453 0.001850975 14 0.01 7 1 0.80 1.0 1281 0.001851069 15</span></span>
<span id="cb480-3848"><a href="#cb480-3848" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.01 7 1 0.80 0.8 1473 0.001851078</span></span>
<span id="cb480-3849"><a href="#cb480-3849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3850"><a href="#cb480-3850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3851"><a href="#cb480-3851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3852"><a href="#cb480-3852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3853"><a href="#cb480-3853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3854"><a href="#cb480-3854" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Variable importance plot</span></span>
<span id="cb480-3855"><a href="#cb480-3855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3858"><a href="#cb480-3858" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3859"><a href="#cb480-3859" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vipContinuous_W</span></span>
<span id="cb480-3860"><a href="#cb480-3860" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb480-3861"><a href="#cb480-3861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3862"><a href="#cb480-3862" aria-hidden="true" tabindex="-1"></a><span class="co">#importance_matrix_W &lt;- tar_read(importance_matrix_W_target)</span></span>
<span id="cb480-3863"><a href="#cb480-3863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3864"><a href="#cb480-3864" aria-hidden="true" tabindex="-1"></a><span class="co"># variable importance plot</span></span>
<span id="cb480-3865"><a href="#cb480-3865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3866"><a href="#cb480-3866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3867"><a href="#cb480-3867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3868"><a href="#cb480-3868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3869"><a href="#cb480-3869" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Partial dependence plots</span></span>
<span id="cb480-3870"><a href="#cb480-3870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3873"><a href="#cb480-3873" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3874"><a href="#cb480-3874" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pdpContinuous_W</span></span>
<span id="cb480-3875"><a href="#cb480-3875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3876"><a href="#cb480-3876" aria-hidden="true" tabindex="-1"></a>create_xgb_plots <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> finalModels_W, <span class="at">f =</span> features_train_W, <span class="at">modelToUse =</span> modelToUse) {</span>
<span id="cb480-3877"><a href="#cb480-3877" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3878"><a href="#cb480-3878" aria-hidden="true" tabindex="-1"></a>  imp <span class="ot">&lt;-</span> <span class="fu">xgb.ggplot.importance</span>(d<span class="sc">$</span>importanceMatrix[[modelToUse]], <span class="at">top_n =</span> <span class="dv">10</span>, <span class="at">measure =</span> <span class="st">"Gain"</span>) <span class="sc">+</span> </span>
<span id="cb480-3879"><a href="#cb480-3879" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"Model #"</span>, modelToUse))</span>
<span id="cb480-3880"><a href="#cb480-3880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3881"><a href="#cb480-3881" aria-hidden="true" tabindex="-1"></a>  pW_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb480-3882"><a href="#cb480-3882" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"observedWeight"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb480-3883"><a href="#cb480-3883" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f) </span>
<span id="cb480-3884"><a href="#cb480-3884" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3885"><a href="#cb480-3885" aria-hidden="true" tabindex="-1"></a>  pFlow_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb480-3886"><a href="#cb480-3886" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanFlowByRiver"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb480-3887"><a href="#cb480-3887" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f)</span>
<span id="cb480-3888"><a href="#cb480-3888" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3889"><a href="#cb480-3889" aria-hidden="true" tabindex="-1"></a>  pTemp_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb480-3890"><a href="#cb480-3890" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"meanTemperature"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb480-3891"><a href="#cb480-3891" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f)</span>
<span id="cb480-3892"><a href="#cb480-3892" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3893"><a href="#cb480-3893" aria-hidden="true" tabindex="-1"></a>  pAge_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb480-3894"><a href="#cb480-3894" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"age"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb480-3895"><a href="#cb480-3895" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f)</span>
<span id="cb480-3896"><a href="#cb480-3896" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3897"><a href="#cb480-3897" aria-hidden="true" tabindex="-1"></a>  pCohort_W <span class="ot">&lt;-</span> d<span class="sc">$</span>xgb[[modelToUse]] <span class="sc">%&gt;%</span></span>
<span id="cb480-3898"><a href="#cb480-3898" aria-hidden="true" tabindex="-1"></a>    pdp<span class="sc">::</span><span class="fu">partial</span>(<span class="at">pred.var =</span> <span class="st">"cohort"</span>, <span class="at">n.trees =</span> <span class="dv">1082</span>, <span class="at">grid.resolution =</span> <span class="dv">100</span>, <span class="at">train =</span> f) <span class="sc">%&gt;%</span></span>
<span id="cb480-3899"><a href="#cb480-3899" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">rug =</span> <span class="cn">TRUE</span>, <span class="at">train =</span> f)</span>
<span id="cb480-3900"><a href="#cb480-3900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3901"><a href="#cb480-3901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3902"><a href="#cb480-3902" aria-hidden="true" tabindex="-1"></a>  partials <span class="ot">&lt;-</span> gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pW_W, pFlow_W, pTemp_W, pAge_W, pCohort_W, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">top=</span><span class="fu">textGrob</span>(<span class="fu">paste0</span>(<span class="st">"Model #"</span>, modelToUse)))</span>
<span id="cb480-3903"><a href="#cb480-3903" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3904"><a href="#cb480-3904" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">list</span>(imp, partials)) </span>
<span id="cb480-3905"><a href="#cb480-3905" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3906"><a href="#cb480-3906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3907"><a href="#cb480-3907" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">1</span>)</span>
<span id="cb480-3908"><a href="#cb480-3908" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">2</span>)</span>
<span id="cb480-3909"><a href="#cb480-3909" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">3</span>)</span>
<span id="cb480-3910"><a href="#cb480-3910" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">4</span>)</span>
<span id="cb480-3911"><a href="#cb480-3911" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">5</span>)</span>
<span id="cb480-3912"><a href="#cb480-3912" aria-hidden="true" tabindex="-1"></a><span class="fu">create_xgb_plots</span>(finalModels_W, features_train_W, <span class="at">modelToUse =</span> <span class="dv">15</span>)</span>
<span id="cb480-3913"><a href="#cb480-3913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3914"><a href="#cb480-3914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3915"><a href="#cb480-3915" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Lime</span></span>
<span id="cb480-3916"><a href="#cb480-3916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3919"><a href="#cb480-3919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3920"><a href="#cb480-3920" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: limeContinuous_W</span></span>
<span id="cb480-3921"><a href="#cb480-3921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3922"><a href="#cb480-3922" aria-hidden="true" tabindex="-1"></a><span class="co"># get a few observations to perform local interpretation on</span></span>
<span id="cb480-3923"><a href="#cb480-3923" aria-hidden="true" tabindex="-1"></a>local_obs_W <span class="ot">&lt;-</span> dML_W[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ]</span>
<span id="cb480-3924"><a href="#cb480-3924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3925"><a href="#cb480-3925" aria-hidden="true" tabindex="-1"></a><span class="co"># one-hot encode the local observations to be assessed.</span></span>
<span id="cb480-3926"><a href="#cb480-3926" aria-hidden="true" tabindex="-1"></a>local_obs_onehot_W <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">prepare</span>(treatplan_W, local_obs_W, <span class="at">varRestriction =</span> new_vars_W)</span>
<span id="cb480-3927"><a href="#cb480-3927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3928"><a href="#cb480-3928" aria-hidden="true" tabindex="-1"></a><span class="co"># apply LIME</span></span>
<span id="cb480-3929"><a href="#cb480-3929" aria-hidden="true" tabindex="-1"></a>explainer_W <span class="ot">&lt;-</span> <span class="fu">lime</span>(<span class="fu">data.frame</span>(features_train_W), finalModels_W<span class="sc">$</span>xgb[[modelToUse]], <span class="at">quantile_bins =</span> <span class="cn">FALSE</span>)</span>
<span id="cb480-3930"><a href="#cb480-3930" aria-hidden="true" tabindex="-1"></a>explanation_W <span class="ot">&lt;-</span> lime<span class="sc">::</span><span class="fu">explain</span>(local_obs_onehot_W, explainer_W, <span class="at">n_features =</span> <span class="dv">5</span>, <span class="at">n_labels =</span> <span class="dv">2</span>)</span>
<span id="cb480-3931"><a href="#cb480-3931" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_features</span>(explanation_W)</span>
<span id="cb480-3932"><a href="#cb480-3932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3933"><a href="#cb480-3933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3934"><a href="#cb480-3934" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Predict</span></span>
<span id="cb480-3935"><a href="#cb480-3935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3938"><a href="#cb480-3938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3939"><a href="#cb480-3939" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predict_W</span></span>
<span id="cb480-3940"><a href="#cb480-3940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3941"><a href="#cb480-3941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3942"><a href="#cb480-3942" aria-hidden="true" tabindex="-1"></a>createPredictions <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> finalModels_W, <span class="at">f =</span> features_test_W, <span class="at">r =</span> response_test_W, <span class="at">modelToUse =</span> modelToUse) {</span>
<span id="cb480-3943"><a href="#cb480-3943" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3944"><a href="#cb480-3944" aria-hidden="true" tabindex="-1"></a>  pred_W <span class="ot">&lt;-</span> <span class="fu">predict</span>(d<span class="sc">$</span>xgb[[modelToUse]], f)</span>
<span id="cb480-3945"><a href="#cb480-3945" aria-hidden="true" tabindex="-1"></a>  rmse <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">RMSE</span>(pred_W, r)</span>
<span id="cb480-3946"><a href="#cb480-3946" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">R2</span>(pred_W, r)</span>
<span id="cb480-3947"><a href="#cb480-3947" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3948"><a href="#cb480-3948" aria-hidden="true" tabindex="-1"></a>  obsPred_W <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">obs =</span> r, <span class="at">pred =</span> pred_W, f)</span>
<span id="cb480-3949"><a href="#cb480-3949" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3950"><a href="#cb480-3950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">r2 =</span> r2, <span class="at">rmse =</span> rmse, <span class="at">obsPred_W =</span> obsPred_W))</span>
<span id="cb480-3951"><a href="#cb480-3951" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3952"><a href="#cb480-3952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3953"><a href="#cb480-3953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3954"><a href="#cb480-3954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3957"><a href="#cb480-3957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3958"><a href="#cb480-3958" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: obsPred_W</span></span>
<span id="cb480-3959"><a href="#cb480-3959" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-3960"><a href="#cb480-3960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3961"><a href="#cb480-3961" aria-hidden="true" tabindex="-1"></a>predsOP_W <span class="ot">&lt;-</span> <span class="fu">createPredictions</span>(finalModels_W, features_test_W, response_test_W, modelToUse) </span>
<span id="cb480-3962"><a href="#cb480-3962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3963"><a href="#cb480-3963" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predsOP_W<span class="sc">$</span>obsPred_W, <span class="fu">aes</span>(obs, pred)) <span class="sc">+</span></span>
<span id="cb480-3964"><a href="#cb480-3964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb480-3965"><a href="#cb480-3965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observed growth rate"</span>, <span class="at">y =</span> <span class="st">"Predicted growth rate"</span>) <span class="sc">+</span></span>
<span id="cb480-3966"><a href="#cb480-3966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-3967"><a href="#cb480-3967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"r2 = "</span>, <span class="fu">round</span>(predsOP_W<span class="sc">$</span>r2, <span class="dv">2</span>), <span class="st">" RMSE = "</span>, <span class="fu">round</span>(predsOP_W<span class="sc">$</span>rmse, <span class="dv">5</span>)))</span>
<span id="cb480-3968"><a href="#cb480-3968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3969"><a href="#cb480-3969" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predsOP_W<span class="sc">$</span>obsPred_W, <span class="fu">aes</span>(obs, pred)) <span class="sc">+</span></span>
<span id="cb480-3970"><a href="#cb480-3970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb480-3971"><a href="#cb480-3971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observed growth rate"</span>, <span class="at">y =</span> <span class="st">"Predicted growth rate"</span>) <span class="sc">+</span></span>
<span id="cb480-3972"><a href="#cb480-3972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-3973"><a href="#cb480-3973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort)</span>
<span id="cb480-3974"><a href="#cb480-3974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-3975"><a href="#cb480-3975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3978"><a href="#cb480-3978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-3979"><a href="#cb480-3979" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: UsingGridInputs</span></span>
<span id="cb480-3980"><a href="#cb480-3980" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-3981"><a href="#cb480-3981" aria-hidden="true" tabindex="-1"></a>renameLev <span class="ot">&lt;-</span> <span class="cf">function</span>(d) {</span>
<span id="cb480-3982"><a href="#cb480-3982" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">|&gt;</span>  </span>
<span id="cb480-3983"><a href="#cb480-3983" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">"_lev_x_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb480-3984"><a href="#cb480-3984" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span>.x[<span class="dv">2</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb480-3985"><a href="#cb480-3985" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>()</span>
<span id="cb480-3986"><a href="#cb480-3986" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-3987"><a href="#cb480-3987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3988"><a href="#cb480-3988" aria-hidden="true" tabindex="-1"></a>createPredictionsGrid <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> finalModels_W, <span class="at">pg =</span> gridPred, <span class="at">modelToUse =</span> modelToUse){</span>
<span id="cb480-3989"><a href="#cb480-3989" aria-hidden="true" tabindex="-1"></a>  <span class="co">#, f = features_test_W, r = response_test_W, nSeq = 5, modelToUse = modelToUse) {</span></span>
<span id="cb480-3990"><a href="#cb480-3990" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-3991"><a href="#cb480-3991" aria-hidden="true" tabindex="-1"></a>  predGrid <span class="ot">&lt;-</span> <span class="fu">predict</span>(d<span class="sc">$</span>xgb[[modelToUse]], pg)</span>
<span id="cb480-3992"><a href="#cb480-3992" aria-hidden="true" tabindex="-1"></a>  gridPredOut <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(pg, <span class="at">pred =</span> predGrid) <span class="sc">|&gt;</span> </span>
<span id="cb480-3993"><a href="#cb480-3993" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(</span>
<span id="cb480-3994"><a href="#cb480-3994" aria-hidden="true" tabindex="-1"></a>      renameLev,  </span>
<span id="cb480-3995"><a href="#cb480-3995" aria-hidden="true" tabindex="-1"></a>      <span class="fu">contains</span>(<span class="st">"_lev_x_"</span>)</span>
<span id="cb480-3996"><a href="#cb480-3996" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>  </span>
<span id="cb480-3997"><a href="#cb480-3997" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb480-3998"><a href="#cb480-3998" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb480-3999"><a href="#cb480-3999" aria-hidden="true" tabindex="-1"></a>      <span class="at">sumRiver =</span> <span class="fu">sum</span>(Isolated_Small <span class="sc">+</span> Open_Large <span class="sc">+</span> Open_Small <span class="sc">+</span> West_Brook),</span>
<span id="cb480-4000"><a href="#cb480-4000" aria-hidden="true" tabindex="-1"></a>      <span class="at">sumSeason =</span> <span class="fu">sum</span>(Autumn <span class="sc">+</span> Spring <span class="sc">+</span> Summer <span class="sc">+</span> Winter)</span>
<span id="cb480-4001"><a href="#cb480-4001" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>   </span>
<span id="cb480-4002"><a href="#cb480-4002" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb480-4003"><a href="#cb480-4003" aria-hidden="true" tabindex="-1"></a>      sumRiver <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb480-4004"><a href="#cb480-4004" aria-hidden="true" tabindex="-1"></a>      sumSeason <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb480-4005"><a href="#cb480-4005" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>   </span>
<span id="cb480-4006"><a href="#cb480-4006" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb480-4007"><a href="#cb480-4007" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">'Isolated_Small'</span><span class="sc">:</span><span class="st">'Winter'</span>), <span class="sc">~</span>.x <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb480-4008"><a href="#cb480-4008" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-4009"><a href="#cb480-4009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4010"><a href="#cb480-4010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gridPredOut)</span>
<span id="cb480-4011"><a href="#cb480-4011" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-4012"><a href="#cb480-4012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4013"><a href="#cb480-4013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4014"><a href="#cb480-4014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4015"><a href="#cb480-4015" aria-hidden="true" tabindex="-1"></a>nSeq <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb480-4016"><a href="#cb480-4016" aria-hidden="true" tabindex="-1"></a>xGrid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb480-4017"><a href="#cb480-4017" aria-hidden="true" tabindex="-1"></a>    <span class="at">observedWeight =</span> <span class="dv">40</span>, <span class="co">#seq(min(f[,"observedWeight"]), max(f[,"observedWeight"]), length.out = nSeq),</span></span>
<span id="cb480-4018"><a href="#cb480-4018" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort =</span> <span class="dv">2010</span>, <span class="co">#seq(min(f[,"cohort"]), max(f[,"cohort"]), length.out = nSeq),</span></span>
<span id="cb480-4019"><a href="#cb480-4019" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="dv">1</span>, <span class="co">#seq(min(f[,"age"]), max(f[,"age"]), length.out = nSeq),</span></span>
<span id="cb480-4020"><a href="#cb480-4020" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanTemperature =</span> <span class="fu">seq</span>(<span class="fu">min</span>(features_test_W[,<span class="st">"meanTemperature"</span>]), <span class="fu">max</span>(features_test_W[,<span class="st">"meanTemperature"</span>]), <span class="at">length.out =</span> nSeq <span class="sc">*</span> <span class="dv">3</span>),</span>
<span id="cb480-4021"><a href="#cb480-4021" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiver =</span> <span class="fu">seq</span>(<span class="fu">min</span>(features_test_W[,<span class="st">"meanFlowByRiver"</span>]), <span class="fu">max</span>(features_test_W[,<span class="st">"meanFlowByRiver"</span>]), <span class="at">length.out =</span> nSeq <span class="sc">*</span> <span class="dv">3</span>),</span>
<span id="cb480-4022"><a href="#cb480-4022" aria-hidden="true" tabindex="-1"></a>    <span class="at">riverGG_lev_x_Isolated_Small =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb480-4023"><a href="#cb480-4023" aria-hidden="true" tabindex="-1"></a>    <span class="at">riverGG_lev_x_Open_Large =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb480-4024"><a href="#cb480-4024" aria-hidden="true" tabindex="-1"></a>    <span class="at">riverGG_lev_x_Open_Small =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb480-4025"><a href="#cb480-4025" aria-hidden="true" tabindex="-1"></a>    <span class="at">riverGG_lev_x_West_Brook =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb480-4026"><a href="#cb480-4026" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonGG_lev_x_Autumn =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb480-4027"><a href="#cb480-4027" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonGG_lev_x_Spring =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb480-4028"><a href="#cb480-4028" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonGG_lev_x_Summer =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb480-4029"><a href="#cb480-4029" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonGG_lev_x_Winter =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb480-4030"><a href="#cb480-4030" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb480-4031"><a href="#cb480-4031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb480-4032"><a href="#cb480-4032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4033"><a href="#cb480-4033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4034"><a href="#cb480-4034" aria-hidden="true" tabindex="-1"></a>preds_W <span class="ot">&lt;-</span> <span class="fu">createPredictionsGrid</span>(</span>
<span id="cb480-4035"><a href="#cb480-4035" aria-hidden="true" tabindex="-1"></a>  finalModels_W, </span>
<span id="cb480-4036"><a href="#cb480-4036" aria-hidden="true" tabindex="-1"></a>  xGrid,</span>
<span id="cb480-4037"><a href="#cb480-4037" aria-hidden="true" tabindex="-1"></a>  modelToUse</span>
<span id="cb480-4038"><a href="#cb480-4038" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb480-4039"><a href="#cb480-4039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4040"><a href="#cb480-4040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4041"><a href="#cb480-4041" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(preds_W <span class="sc">|&gt;</span> </span>
<span id="cb480-4042"><a href="#cb480-4042" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(</span>
<span id="cb480-4043"><a href="#cb480-4043" aria-hidden="true" tabindex="-1"></a>           <span class="co">#Isolated_Small, Open_Large, Open_Small, West_Brook, </span></span>
<span id="cb480-4044"><a href="#cb480-4044" aria-hidden="true" tabindex="-1"></a>           <span class="co">#Autumn, Spring, Summer, Winter</span></span>
<span id="cb480-4045"><a href="#cb480-4045" aria-hidden="true" tabindex="-1"></a>           ), </span>
<span id="cb480-4046"><a href="#cb480-4046" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(meanFlowByRiver, pred, <span class="at">color =</span> meanTemperature, <span class="at">group =</span> meanTemperature)) <span class="sc">+</span></span>
<span id="cb480-4047"><a href="#cb480-4047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb480-4048"><a href="#cb480-4048" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">y =</span> <span class="st">"Predicted growth rate"</span>) <span class="sc">+</span></span>
<span id="cb480-4049"><a href="#cb480-4049" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4050"><a href="#cb480-4050" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-4051"><a href="#cb480-4051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Isolated_Small<span class="sc">+</span>Open_Large<span class="sc">+</span>Open_Small<span class="sc">+</span>West_Brook <span class="sc">~</span> Spring<span class="sc">+</span>Summer<span class="sc">+</span>Autumn<span class="sc">+</span>Winter)</span>
<span id="cb480-4052"><a href="#cb480-4052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4053"><a href="#cb480-4053" aria-hidden="true" tabindex="-1"></a><span class="co"># use seasonal zScores for environmetnal data</span></span>
<span id="cb480-4054"><a href="#cb480-4054" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4055"><a href="#cb480-4055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4056"><a href="#cb480-4056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4057"><a href="#cb480-4057" aria-hidden="true" tabindex="-1"></a><span class="fu">#### When and where do fish have predicted negative growth?</span></span>
<span id="cb480-4060"><a href="#cb480-4060" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4061"><a href="#cb480-4061" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: negPredGrowth_W</span></span>
<span id="cb480-4062"><a href="#cb480-4062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4063"><a href="#cb480-4063" aria-hidden="true" tabindex="-1"></a>predNeg <span class="ot">&lt;-</span> preds_W <span class="sc">|&gt;</span> <span class="fu">filter</span>(pred <span class="sc">&lt;</span> <span class="fl">0.000</span>)</span>
<span id="cb480-4064"><a href="#cb480-4064" aria-hidden="true" tabindex="-1"></a>predNeg <span class="sc">|&gt;</span> </span>
<span id="cb480-4065"><a href="#cb480-4065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Isolated_Small, Open_Large, Open_Small, West_Brook, Autumn, Spring, Summer, Winter) <span class="sc">|&gt;</span> </span>
<span id="cb480-4066"><a href="#cb480-4066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb480-4067"><a href="#cb480-4067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4068"><a href="#cb480-4068" aria-hidden="true" tabindex="-1"></a>predNeg <span class="sc">|&gt;</span> </span>
<span id="cb480-4069"><a href="#cb480-4069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Autumn, Spring, Summer, Winter) <span class="sc">|&gt;</span> </span>
<span id="cb480-4070"><a href="#cb480-4070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb480-4071"><a href="#cb480-4071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4072"><a href="#cb480-4072" aria-hidden="true" tabindex="-1"></a>predNeg <span class="sc">|&gt;</span> </span>
<span id="cb480-4073"><a href="#cb480-4073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Isolated_Small, Open_Large, Open_Small, West_Brook) <span class="sc">|&gt;</span> </span>
<span id="cb480-4074"><a href="#cb480-4074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb480-4075"><a href="#cb480-4075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4076"><a href="#cb480-4076" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4077"><a href="#cb480-4077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4078"><a href="#cb480-4078" aria-hidden="true" tabindex="-1"></a><span class="fu">## GAM for individual growth</span></span>
<span id="cb480-4081"><a href="#cb480-4081" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4082"><a href="#cb480-4082" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gamGrowthRaw</span></span>
<span id="cb480-4083"><a href="#cb480-4083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4084"><a href="#cb480-4084" aria-hidden="true" tabindex="-1"></a><span class="co">#riverGG, seasonGG, observedWeight, cohort, age, meanTemperature, meanFlowByRiver, negGrowth</span></span>
<span id="cb480-4085"><a href="#cb480-4085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4086"><a href="#cb480-4086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4087"><a href="#cb480-4087" aria-hidden="true" tabindex="-1"></a>kValue <span class="ot">&lt;-</span> <span class="dv">4</span> </span>
<span id="cb480-4088"><a href="#cb480-4088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4089"><a href="#cb480-4089" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">!=</span> <span class="st">"Atlantic salmon"</span>), <span class="fu">aes</span>(flowByRiverS, grWeight, <span class="at">group =</span> speciesGG, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb480-4090"><a href="#cb480-4090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb480-4091"><a href="#cb480-4091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, </span>
<span id="cb480-4092"><a href="#cb480-4092" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>, <span class="at">k =</span> kValue), </span>
<span id="cb480-4093"><a href="#cb480-4093" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4094"><a href="#cb480-4094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4095"><a href="#cb480-4095" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG)</span>
<span id="cb480-4096"><a href="#cb480-4096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4097"><a href="#cb480-4097" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">!=</span> <span class="st">"Atlantic salmon"</span>), <span class="fu">aes</span>(flowByRiverSR, grWeight, <span class="at">group =</span> speciesGG, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb480-4098"><a href="#cb480-4098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-4099"><a href="#cb480-4099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-4100"><a href="#cb480-4100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, </span>
<span id="cb480-4101"><a href="#cb480-4101" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>, <span class="at">k =</span> kValue), </span>
<span id="cb480-4102"><a href="#cb480-4102" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4103"><a href="#cb480-4103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-4104"><a href="#cb480-4104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4105"><a href="#cb480-4105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-4106"><a href="#cb480-4106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4107"><a href="#cb480-4107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4108"><a href="#cb480-4108" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">!=</span> <span class="st">"Atlantic salmon"</span>), <span class="fu">aes</span>(tempSR, grWeight, <span class="at">group =</span> speciesGG, <span class="at">color =</span> speciesGG)) <span class="sc">+</span></span>
<span id="cb480-4109"><a href="#cb480-4109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-4110"><a href="#cb480-4110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-4111"><a href="#cb480-4111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, </span>
<span id="cb480-4112"><a href="#cb480-4112" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">fx =</span> <span class="cn">TRUE</span>, <span class="at">k =</span> kValue), </span>
<span id="cb480-4113"><a href="#cb480-4113" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4114"><a href="#cb480-4114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-4115"><a href="#cb480-4115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4116"><a href="#cb480-4116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb480-4117"><a href="#cb480-4117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4118"><a href="#cb480-4118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4119"><a href="#cb480-4119" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linear models for growth  </span></span>
<span id="cb480-4120"><a href="#cb480-4120" aria-hidden="true" tabindex="-1"></a>Initial test of model structure for GAMs</span>
<span id="cb480-4123"><a href="#cb480-4123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4124"><a href="#cb480-4124" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: linearModelGrowth</span></span>
<span id="cb480-4125"><a href="#cb480-4125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4126"><a href="#cb480-4126" aria-hidden="true" tabindex="-1"></a>runLinearModels <span class="ot">&lt;-</span> <span class="cf">function</span>(d, speciesIn) {</span>
<span id="cb480-4127"><a href="#cb480-4127" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">=</span></span>
<span id="cb480-4128"><a href="#cb480-4128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">model =</span> </span>
<span id="cb480-4129"><a href="#cb480-4129" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb480-4130"><a href="#cb480-4130" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG * tempSR * flowByRiverSR * observedWeight + cohortF * ageF)'</span>,</span>
<span id="cb480-4131"><a href="#cb480-4131" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG * tempSR * flowByRiverSR * observedWeight + cohortF)'</span>,</span>
<span id="cb480-4132"><a href="#cb480-4132" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG * tempSR * flowByRiverSR + cohortF * ageF)'</span>,</span>
<span id="cb480-4133"><a href="#cb480-4133" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG * tempSR * flowByRiverSR + cohortF)'</span>,</span>
<span id="cb480-4134"><a href="#cb480-4134" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG + tempSR * flowByRiverSR + cohortF * ageF)'</span>,</span>
<span id="cb480-4135"><a href="#cb480-4135" aria-hidden="true" tabindex="-1"></a>          <span class="st">'grWeight ~ (riverGG * seasonGG + tempSR + flowByRiverSR + cohortF * ageF)'</span></span>
<span id="cb480-4136"><a href="#cb480-4136" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb480-4137"><a href="#cb480-4137" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb480-4138"><a href="#cb480-4138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb480-4139"><a href="#cb480-4139" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit =</span> <span class="fu">map</span>(model, <span class="sc">~</span><span class="fu">lm</span>(.x, <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn))),</span>
<span id="cb480-4140"><a href="#cb480-4140" aria-hidden="true" tabindex="-1"></a>      <span class="at">glanced =</span> <span class="fu">map</span>(fit, broom<span class="sc">::</span>glance),</span>
<span id="cb480-4141"><a href="#cb480-4141" aria-hidden="true" tabindex="-1"></a>      <span class="at">tidied =</span> <span class="fu">map</span>(fit, broom<span class="sc">::</span>tidy)</span>
<span id="cb480-4142"><a href="#cb480-4142" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-4143"><a href="#cb480-4143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(models)</span>
<span id="cb480-4144"><a href="#cb480-4144" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-4145"><a href="#cb480-4145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4146"><a href="#cb480-4146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4147"><a href="#cb480-4147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4148"><a href="#cb480-4148" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout  </span></span>
<span id="cb480-4149"><a href="#cb480-4149" aria-hidden="true" tabindex="-1"></a>Most complex model has lowest AIC</span>
<span id="cb480-4152"><a href="#cb480-4152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4153"><a href="#cb480-4153" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: linBKT</span></span>
<span id="cb480-4154"><a href="#cb480-4154" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-4155"><a href="#cb480-4155" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"Brook trout"</span></span>
<span id="cb480-4156"><a href="#cb480-4156" aria-hidden="true" tabindex="-1"></a>modLinearBKT <span class="ot">&lt;-</span> <span class="fu">runLinearModels</span>(dGAM, speciesIn)</span>
<span id="cb480-4157"><a href="#cb480-4157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4158"><a href="#cb480-4158" aria-hidden="true" tabindex="-1"></a>modLinearBKT <span class="sc">|&gt;</span> </span>
<span id="cb480-4159"><a href="#cb480-4159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(glanced) <span class="sc">|&gt;</span></span>
<span id="cb480-4160"><a href="#cb480-4160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb480-4161"><a href="#cb480-4161" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, df.residual, fit, tidied)</span>
<span id="cb480-4162"><a href="#cb480-4162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4163"><a href="#cb480-4163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4164"><a href="#cb480-4164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4165"><a href="#cb480-4165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4166"><a href="#cb480-4166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4167"><a href="#cb480-4167" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brown trout  </span></span>
<span id="cb480-4168"><a href="#cb480-4168" aria-hidden="true" tabindex="-1"></a>Most complex model has lowest AIC</span>
<span id="cb480-4171"><a href="#cb480-4171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4172"><a href="#cb480-4172" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: linBNT</span></span>
<span id="cb480-4173"><a href="#cb480-4173" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-4174"><a href="#cb480-4174" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"Brown trout"</span></span>
<span id="cb480-4175"><a href="#cb480-4175" aria-hidden="true" tabindex="-1"></a>modLinearBNT <span class="ot">&lt;-</span> <span class="fu">runLinearModels</span>(dGAM, speciesIn)</span>
<span id="cb480-4176"><a href="#cb480-4176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4177"><a href="#cb480-4177" aria-hidden="true" tabindex="-1"></a>modLinearBNT <span class="sc">|&gt;</span> </span>
<span id="cb480-4178"><a href="#cb480-4178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(glanced) <span class="sc">|&gt;</span></span>
<span id="cb480-4179"><a href="#cb480-4179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb480-4180"><a href="#cb480-4180" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, df.residual, fit, tidied)</span>
<span id="cb480-4181"><a href="#cb480-4181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4182"><a href="#cb480-4182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4183"><a href="#cb480-4183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4184"><a href="#cb480-4184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4185"><a href="#cb480-4185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4186"><a href="#cb480-4186" aria-hidden="true" tabindex="-1"></a>These linear models suggest that we need significant complexity in GAM models  </span>
<span id="cb480-4187"><a href="#cb480-4187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4188"><a href="#cb480-4188" aria-hidden="true" tabindex="-1"></a><span class="fu">### GAM models for growth  </span></span>
<span id="cb480-4189"><a href="#cb480-4189" aria-hidden="true" tabindex="-1"></a>This modeling approach map() (which I would like to use), throws an error using bam(). Use gamX model approach below.</span>
<span id="cb480-4192"><a href="#cb480-4192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4193"><a href="#cb480-4193" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gamModelsGrowth</span></span>
<span id="cb480-4194"><a href="#cb480-4194" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-4195"><a href="#cb480-4195" aria-hidden="true" tabindex="-1"></a>runGAMModels <span class="ot">&lt;-</span> <span class="cf">function</span>(d, speciesIn, kIn) {</span>
<span id="cb480-4196"><a href="#cb480-4196" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">=</span></span>
<span id="cb480-4197"><a href="#cb480-4197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">model =</span> </span>
<span id="cb480-4198"><a href="#cb480-4198" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb480-4199"><a href="#cb480-4199" aria-hidden="true" tabindex="-1"></a>            <span class="st">'grWeight ~ riverGG * seasonGG * observedWeight + cohortF * ageF +             </span></span>
<span id="cb480-4200"><a href="#cb480-4200" aria-hidden="true" tabindex="-1"></a><span class="st">               s(flowByRiverSR, bs = "cr", k = kIn, by = riverGG) +</span></span>
<span id="cb480-4201"><a href="#cb480-4201" aria-hidden="true" tabindex="-1"></a><span class="st">               s(flowByRiverSR, bs = "cr", k = kIn, by = seasonGG) +</span></span>
<span id="cb480-4202"><a href="#cb480-4202" aria-hidden="true" tabindex="-1"></a><span class="st">               s(tempSR, bs = "cr", k = kIn, by = riverGG) +</span></span>
<span id="cb480-4203"><a href="#cb480-4203" aria-hidden="true" tabindex="-1"></a><span class="st">               s(tempSR, bs = "cr", k = kIn, by = seasonGG)'</span>,</span>
<span id="cb480-4204"><a href="#cb480-4204" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb480-4205"><a href="#cb480-4205" aria-hidden="true" tabindex="-1"></a>            <span class="st">'grWeight ~ riverGG * seasonGG * observedWeight * tempSR * flowByRiverSR + cohortF * ageF +             </span></span>
<span id="cb480-4206"><a href="#cb480-4206" aria-hidden="true" tabindex="-1"></a><span class="st">               s(flowByRiverSR, bs = "cr", k = kIn, by = riverGG) +</span></span>
<span id="cb480-4207"><a href="#cb480-4207" aria-hidden="true" tabindex="-1"></a><span class="st">               s(flowByRiverSR, bs = "cr", k = kIn, by = seasonGG) +</span></span>
<span id="cb480-4208"><a href="#cb480-4208" aria-hidden="true" tabindex="-1"></a><span class="st">               s(tempSR, bs = "cr", k = kIn, by = riverGG) +</span></span>
<span id="cb480-4209"><a href="#cb480-4209" aria-hidden="true" tabindex="-1"></a><span class="st">               s(tempSR, bs = "cr", k = kIn, by = seasonGG)'</span></span>
<span id="cb480-4210"><a href="#cb480-4210" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb480-4211"><a href="#cb480-4211" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb480-4212"><a href="#cb480-4212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb480-4213"><a href="#cb480-4213" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit =</span> <span class="fu">map</span>(model, <span class="sc">~</span> <span class="fu">bam</span>(.x, <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>)))</span>
<span id="cb480-4214"><a href="#cb480-4214" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    glanced = map(fit, broom::glance),</span></span>
<span id="cb480-4215"><a href="#cb480-4215" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    tidied = map(fit, broom::tidy)</span></span>
<span id="cb480-4216"><a href="#cb480-4216" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-4217"><a href="#cb480-4217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(models)</span>
<span id="cb480-4218"><a href="#cb480-4218" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-4219"><a href="#cb480-4219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4220"><a href="#cb480-4220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4221"><a href="#cb480-4221" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-4222"><a href="#cb480-4222" aria-hidden="true" tabindex="-1"></a><span class="co"># speciesIn &lt;- "Brook trout"</span></span>
<span id="cb480-4223"><a href="#cb480-4223" aria-hidden="true" tabindex="-1"></a><span class="co"># modLinearBKT &lt;- runGAMModels(dGAM, speciesIn, kValue)</span></span>
<span id="cb480-4224"><a href="#cb480-4224" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb480-4225"><a href="#cb480-4225" aria-hidden="true" tabindex="-1"></a><span class="co"># modLinearBKT |&gt; </span></span>
<span id="cb480-4226"><a href="#cb480-4226" aria-hidden="true" tabindex="-1"></a><span class="co">#     unnest(glanced) |&gt;</span></span>
<span id="cb480-4227"><a href="#cb480-4227" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(AIC) |&gt;</span></span>
<span id="cb480-4228"><a href="#cb480-4228" aria-hidden="true" tabindex="-1"></a><span class="co">#     dplyr::select(model, AIC, df.residual, fit, tidied)</span></span>
<span id="cb480-4229"><a href="#cb480-4229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4230"><a href="#cb480-4230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4231"><a href="#cb480-4231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4232"><a href="#cb480-4232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4233"><a href="#cb480-4233" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout - flow by river</span></span>
<span id="cb480-4236"><a href="#cb480-4236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4237"><a href="#cb480-4237" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gamModsBKTFBR</span></span>
<span id="cb480-4238"><a href="#cb480-4238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4239"><a href="#cb480-4239" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"Brook trout"</span></span>
<span id="cb480-4240"><a href="#cb480-4240" aria-hidden="true" tabindex="-1"></a>kIn <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb480-4241"><a href="#cb480-4241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4242"><a href="#cb480-4242" aria-hidden="true" tabindex="-1"></a>gam0 <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG <span class="sc">+</span> observedWeight <span class="sc">+</span> tempSR <span class="sc">+</span> flowSR)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> cohortF <span class="sc">*</span> ageF <span class="sc">+</span>             </span>
<span id="cb480-4243"><a href="#cb480-4243" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4244"><a href="#cb480-4244" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb480-4245"><a href="#cb480-4245" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4246"><a href="#cb480-4246" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb480-4247"><a href="#cb480-4247" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb480-4248"><a href="#cb480-4248" aria-hidden="true" tabindex="-1"></a><span class="do">######</span></span>
<span id="cb480-4249"><a href="#cb480-4249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4250"><a href="#cb480-4250" aria-hidden="true" tabindex="-1"></a>gam0ByRiver <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG <span class="sc">+</span> observedWeight <span class="sc">+</span> tempSR <span class="sc">+</span> flowByRiverSR)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> cohortF <span class="sc">*</span> ageF <span class="sc">+</span>             </span>
<span id="cb480-4251"><a href="#cb480-4251" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4252"><a href="#cb480-4252" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb480-4253"><a href="#cb480-4253" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4254"><a href="#cb480-4254" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb480-4255"><a href="#cb480-4255" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb480-4256"><a href="#cb480-4256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4257"><a href="#cb480-4257" aria-hidden="true" tabindex="-1"></a>gam1ByRiver <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG <span class="sc">+</span> observedWeight <span class="sc">+</span> tempSR <span class="sc">+</span> flowByRiverSR)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> cohortF <span class="sc">+</span>             </span>
<span id="cb480-4258"><a href="#cb480-4258" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4259"><a href="#cb480-4259" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb480-4260"><a href="#cb480-4260" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4261"><a href="#cb480-4261" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb480-4262"><a href="#cb480-4262" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb480-4263"><a href="#cb480-4263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4264"><a href="#cb480-4264" aria-hidden="true" tabindex="-1"></a><span class="co"># age matters, what about taking out length?</span></span>
<span id="cb480-4265"><a href="#cb480-4265" aria-hidden="true" tabindex="-1"></a>gam2ByRiver <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG  <span class="sc">+</span> tempSR <span class="sc">+</span> flowByRiverSR)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> cohortF <span class="sc">*</span> ageF <span class="sc">+</span>             </span>
<span id="cb480-4266"><a href="#cb480-4266" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4267"><a href="#cb480-4267" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb480-4268"><a href="#cb480-4268" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4269"><a href="#cb480-4269" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb480-4270"><a href="#cb480-4270" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb480-4271"><a href="#cb480-4271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4272"><a href="#cb480-4272" aria-hidden="true" tabindex="-1"></a><span class="co">#nope, need to keep length</span></span>
<span id="cb480-4273"><a href="#cb480-4273" aria-hidden="true" tabindex="-1"></a><span class="co">#How about without the interactions?</span></span>
<span id="cb480-4274"><a href="#cb480-4274" aria-hidden="true" tabindex="-1"></a>gam3ByRiver <span class="ot">&lt;-</span> <span class="fu">bam</span>(grWeight <span class="sc">~</span> (riverGG <span class="sc">+</span> seasonGG <span class="sc">+</span> observedWeight <span class="sc">+</span> tempSR <span class="sc">+</span> flowByRiverSR) <span class="sc">+</span> cohortF <span class="sc">*</span> ageF <span class="sc">+</span>             </span>
<span id="cb480-4275"><a href="#cb480-4275" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4276"><a href="#cb480-4276" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(flowByRiverSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG) <span class="sc">+</span></span>
<span id="cb480-4277"><a href="#cb480-4277" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> riverGG) <span class="sc">+</span></span>
<span id="cb480-4278"><a href="#cb480-4278" aria-hidden="true" tabindex="-1"></a>               <span class="fu">s</span>(tempSR, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> kIn, <span class="at">by =</span> seasonGG),</span>
<span id="cb480-4279"><a href="#cb480-4279" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> dGAM <span class="sc">|&gt;</span> <span class="fu">filter</span>(speciesGG <span class="sc">==</span> speciesIn, cohort <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>), <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb480-4280"><a href="#cb480-4280" aria-hidden="true" tabindex="-1"></a><span class="co">#nope, need the interactions</span></span>
<span id="cb480-4281"><a href="#cb480-4281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4282"><a href="#cb480-4282" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(gam0ByRiver, gam1ByRiver, gam2ByRiver, gam3ByRiver) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(AIC)</span>
<span id="cb480-4283"><a href="#cb480-4283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4284"><a href="#cb480-4284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4285"><a href="#cb480-4285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4286"><a href="#cb480-4286" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Brook trout - compare flow and flow by river gams</span></span>
<span id="cb480-4289"><a href="#cb480-4289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4290"><a href="#cb480-4290" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gamModsCompare</span></span>
<span id="cb480-4291"><a href="#cb480-4291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4292"><a href="#cb480-4292" aria-hidden="true" tabindex="-1"></a>predictBKTgam <span class="ot">&lt;-</span> <span class="cf">function</span>(dIn, modInFlowByRiver){</span>
<span id="cb480-4293"><a href="#cb480-4293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4294"><a href="#cb480-4294" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predMat0 &lt;- </span></span>
<span id="cb480-4295"><a href="#cb480-4295" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   expand.grid(</span></span>
<span id="cb480-4296"><a href="#cb480-4296" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     flowSR = seq(-1.5,1.5,0.25), </span></span>
<span id="cb480-4297"><a href="#cb480-4297" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     tempSR = seq(-1.5,1.5,0.25), </span></span>
<span id="cb480-4298"><a href="#cb480-4298" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     riverGG = unique(dIn$riverGG), </span></span>
<span id="cb480-4299"><a href="#cb480-4299" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     seasonGG= unique(dIn$seasonGG),</span></span>
<span id="cb480-4300"><a href="#cb480-4300" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     observedWeight = seq(2, max(dIn$observedWeight, na.rm = TRUE)/2, 20),</span></span>
<span id="cb480-4301"><a href="#cb480-4301" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     cohortF = 2000:2013,#uunique(dIn$cohortF),</span></span>
<span id="cb480-4302"><a href="#cb480-4302" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     ageF = 0:4,#unique(dIn$ageF),</span></span>
<span id="cb480-4303"><a href="#cb480-4303" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     byRiver = FALSE</span></span>
<span id="cb480-4304"><a href="#cb480-4304" aria-hidden="true" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb480-4305"><a href="#cb480-4305" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predMat &lt;- </span></span>
<span id="cb480-4306"><a href="#cb480-4306" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   add_column(</span></span>
<span id="cb480-4307"><a href="#cb480-4307" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     pred = predict.bam(modInFlow, predMat0),</span></span>
<span id="cb480-4308"><a href="#cb480-4308" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     predMat0</span></span>
<span id="cb480-4309"><a href="#cb480-4309" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ) |&gt; </span></span>
<span id="cb480-4310"><a href="#cb480-4310" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   rename(flow = flowSR, temp = tempSR)</span></span>
<span id="cb480-4311"><a href="#cb480-4311" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-4312"><a href="#cb480-4312" aria-hidden="true" tabindex="-1"></a>  predMatByRiver0 <span class="ot">&lt;-</span> </span>
<span id="cb480-4313"><a href="#cb480-4313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand.grid</span>(</span>
<span id="cb480-4314"><a href="#cb480-4314" aria-hidden="true" tabindex="-1"></a>      <span class="at">flowByRiverSR =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb480-4315"><a href="#cb480-4315" aria-hidden="true" tabindex="-1"></a>      <span class="at">tempSR =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb480-4316"><a href="#cb480-4316" aria-hidden="true" tabindex="-1"></a>      <span class="at">riverGG =</span> <span class="fu">unique</span>(dIn<span class="sc">$</span>riverGG), </span>
<span id="cb480-4317"><a href="#cb480-4317" aria-hidden="true" tabindex="-1"></a>      <span class="at">seasonGG=</span> <span class="fu">unique</span>(dIn<span class="sc">$</span>seasonGG),</span>
<span id="cb480-4318"><a href="#cb480-4318" aria-hidden="true" tabindex="-1"></a>      <span class="at">observedWeight =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">max</span>(dIn<span class="sc">$</span>observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">2</span>, <span class="dv">20</span>),</span>
<span id="cb480-4319"><a href="#cb480-4319" aria-hidden="true" tabindex="-1"></a>      <span class="at">cohortF =</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2013</span>,<span class="co">#unique(dIn$cohortF),</span></span>
<span id="cb480-4320"><a href="#cb480-4320" aria-hidden="true" tabindex="-1"></a>      <span class="at">ageF =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,<span class="co">#unique(dIn$ageF),</span></span>
<span id="cb480-4321"><a href="#cb480-4321" aria-hidden="true" tabindex="-1"></a>      <span class="at">byRiver =</span> <span class="cn">TRUE</span></span>
<span id="cb480-4322"><a href="#cb480-4322" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb480-4323"><a href="#cb480-4323" aria-hidden="true" tabindex="-1"></a>  predMatByRiver <span class="ot">&lt;-</span> </span>
<span id="cb480-4324"><a href="#cb480-4324" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(</span>
<span id="cb480-4325"><a href="#cb480-4325" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred =</span> <span class="fu">predict.bam</span>(modInFlowByRiver, predMatByRiver0),</span>
<span id="cb480-4326"><a href="#cb480-4326" aria-hidden="true" tabindex="-1"></a>      predMatByRiver0</span>
<span id="cb480-4327"><a href="#cb480-4327" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb480-4328"><a href="#cb480-4328" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">flow =</span> flowByRiverSR, <span class="at">temp =</span> tempSR)</span>
<span id="cb480-4329"><a href="#cb480-4329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4330"><a href="#cb480-4330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(predMatByRiver)</span>
<span id="cb480-4331"><a href="#cb480-4331" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-4332"><a href="#cb480-4332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4333"><a href="#cb480-4333" aria-hidden="true" tabindex="-1"></a>gamBKTPredictions <span class="ot">&lt;-</span> <span class="fu">predictBKTgam</span>(dGAM, gam0ByRiver)</span>
<span id="cb480-4334"><a href="#cb480-4334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4335"><a href="#cb480-4335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4336"><a href="#cb480-4336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4337"><a href="#cb480-4337" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Graph predictions</span></span>
<span id="cb480-4340"><a href="#cb480-4340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4341"><a href="#cb480-4341" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: graphGAMPredictions</span></span>
<span id="cb480-4342"><a href="#cb480-4342" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(gamBKTPredictions<span class="sc">$</span>observedWeight)</span>
<span id="cb480-4343"><a href="#cb480-4343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4344"><a href="#cb480-4344" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb480-4345"><a href="#cb480-4345" aria-hidden="true" tabindex="-1"></a>  gamBKTPredictions <span class="sc">|&gt;</span> </span>
<span id="cb480-4346"><a href="#cb480-4346" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb480-4347"><a href="#cb480-4347" aria-hidden="true" tabindex="-1"></a>      observedWeight <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">22</span>), </span>
<span id="cb480-4348"><a href="#cb480-4348" aria-hidden="true" tabindex="-1"></a>      cohortF <span class="sc">==</span> <span class="dv">2012</span>, </span>
<span id="cb480-4349"><a href="#cb480-4349" aria-hidden="true" tabindex="-1"></a>      ageF <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb480-4350"><a href="#cb480-4350" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb480-4351"><a href="#cb480-4351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(temp, pred, <span class="at">color =</span> (flow), <span class="at">group =</span> (flow))) <span class="sc">+</span></span>
<span id="cb480-4352"><a href="#cb480-4352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb480-4353"><a href="#cb480-4353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Stream temperature"</span>, <span class="at">y =</span> <span class="st">"Predicted growth rate"</span>) <span class="sc">+</span></span>
<span id="cb480-4354"><a href="#cb480-4354" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_smooth(se = FALSE) +</span></span>
<span id="cb480-4355"><a href="#cb480-4355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb480-4356"><a href="#cb480-4356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4357"><a href="#cb480-4357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>riverGG<span class="sc">+</span>byRiver, <span class="at">scales =</span> <span class="st">'free'</span>)</span>
<span id="cb480-4358"><a href="#cb480-4358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4359"><a href="#cb480-4359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4360"><a href="#cb480-4360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4361"><a href="#cb480-4361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4362"><a href="#cb480-4362" aria-hidden="true" tabindex="-1"></a><span class="fu">## Logistic models for environmental effects on negGrowth</span></span>
<span id="cb480-4363"><a href="#cb480-4363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4364"><a href="#cb480-4364" aria-hidden="true" tabindex="-1"></a><span class="fu">### Standardize flow and temperature</span></span>
<span id="cb480-4365"><a href="#cb480-4365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4368"><a href="#cb480-4368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4369"><a href="#cb480-4369" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flowTempZ</span></span>
<span id="cb480-4370"><a href="#cb480-4370" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-4371"><a href="#cb480-4371" aria-hidden="true" tabindex="-1"></a><span class="co"># getZ &lt;- function(d){</span></span>
<span id="cb480-4372"><a href="#cb480-4372" aria-hidden="true" tabindex="-1"></a><span class="co">#   list(</span></span>
<span id="cb480-4373"><a href="#cb480-4373" aria-hidden="true" tabindex="-1"></a><span class="co">#     mean = mean(d, na.rm = TRUE),</span></span>
<span id="cb480-4374"><a href="#cb480-4374" aria-hidden="true" tabindex="-1"></a><span class="co">#     sd = sd(d, na.rm = TRUE)</span></span>
<span id="cb480-4375"><a href="#cb480-4375" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb480-4376"><a href="#cb480-4376" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb480-4377"><a href="#cb480-4377" aria-hidden="true" tabindex="-1"></a><span class="co"># fZ &lt;- getZ(cd1$meanFlowByRiver)</span></span>
<span id="cb480-4378"><a href="#cb480-4378" aria-hidden="true" tabindex="-1"></a><span class="co"># fT &lt;- getZ(cd1$meanTemperature)</span></span>
<span id="cb480-4379"><a href="#cb480-4379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4380"><a href="#cb480-4380" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-4381"><a href="#cb480-4381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb480-4382"><a href="#cb480-4382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)) <span class="sc">|&gt;</span> </span>
<span id="cb480-4383"><a href="#cb480-4383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, speciesGG) <span class="sc">|&gt;</span> </span>
<span id="cb480-4384"><a href="#cb480-4384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb480-4385"><a href="#cb480-4385" aria-hidden="true" tabindex="-1"></a>    <span class="at">fQMean =</span> <span class="fu">mean</span>(meanFlowByRiver, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4386"><a href="#cb480-4386" aria-hidden="true" tabindex="-1"></a>    <span class="at">fQSd =</span> <span class="fu">sd</span>(meanFlowByRiver, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4387"><a href="#cb480-4387" aria-hidden="true" tabindex="-1"></a>    <span class="at">fTMean =</span> <span class="fu">mean</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4388"><a href="#cb480-4388" aria-hidden="true" tabindex="-1"></a>    <span class="at">fTSd =</span> <span class="fu">sd</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4389"><a href="#cb480-4389" aria-hidden="true" tabindex="-1"></a>    <span class="at">fMMean =</span> <span class="fu">mean</span>(observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4390"><a href="#cb480-4390" aria-hidden="true" tabindex="-1"></a>    <span class="at">fMSd =</span> <span class="fu">sd</span>(observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4391"><a href="#cb480-4391" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnIndMean =</span> <span class="fu">mean</span>(nInd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4392"><a href="#cb480-4392" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnIndSd =</span> <span class="fu">sd</span>(nInd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4393"><a href="#cb480-4393" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnIndBySpeciesMean =</span> <span class="fu">mean</span>(nIndBySpp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4394"><a href="#cb480-4394" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnIndBySpeciesSd =</span> <span class="fu">sd</span>(nIndBySpp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-4395"><a href="#cb480-4395" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-4396"><a href="#cb480-4396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4397"><a href="#cb480-4397" aria-hidden="true" tabindex="-1"></a>zBySeason <span class="ot">&lt;-</span> cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-4398"><a href="#cb480-4398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(riverGG, speciesGG, seasonGG) <span class="sc">|&gt;</span> </span>
<span id="cb480-4399"><a href="#cb480-4399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">fQbySeasonMean =</span> <span class="fu">mean</span>(meanFlowByRiver, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4400"><a href="#cb480-4400" aria-hidden="true" tabindex="-1"></a>            <span class="at">fQbySeasonSd =</span> <span class="fu">sd</span>(meanFlowByRiver, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4401"><a href="#cb480-4401" aria-hidden="true" tabindex="-1"></a>            <span class="at">fTbySeasonMean =</span> <span class="fu">mean</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb480-4402"><a href="#cb480-4402" aria-hidden="true" tabindex="-1"></a>            <span class="at">fTbySeasonSd =</span> <span class="fu">sd</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-4403"><a href="#cb480-4403" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb480-4404"><a href="#cb480-4404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4405"><a href="#cb480-4405" aria-hidden="true" tabindex="-1"></a>cd1_z <span class="ot">&lt;-</span> cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-4406"><a href="#cb480-4406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCounts_target)) <span class="sc">|&gt;</span></span>
<span id="cb480-4407"><a href="#cb480-4407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">tar_read</span>(indCountsBySpp_target)) <span class="sc">|&gt;</span> </span>
<span id="cb480-4408"><a href="#cb480-4408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(z) <span class="sc">|&gt;</span> </span>
<span id="cb480-4409"><a href="#cb480-4409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(zBySeason) <span class="sc">|&gt;</span> </span>
<span id="cb480-4410"><a href="#cb480-4410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb480-4411"><a href="#cb480-4411" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiverZ =</span> (meanFlowByRiver <span class="sc">-</span> fQMean)<span class="sc">/</span>fQSd,</span>
<span id="cb480-4412"><a href="#cb480-4412" aria-hidden="true" tabindex="-1"></a>    <span class="at">nIndZ =</span> (nInd <span class="sc">-</span> fnIndMean)<span class="sc">/</span>fnIndSd,</span>
<span id="cb480-4413"><a href="#cb480-4413" aria-hidden="true" tabindex="-1"></a>    <span class="at">nIndBySpeciesZ =</span> (nIndBySpp <span class="sc">-</span> fnIndBySpeciesMean)<span class="sc">/</span>fnIndBySpeciesSd,</span>
<span id="cb480-4414"><a href="#cb480-4414" aria-hidden="true" tabindex="-1"></a>    <span class="at">observedWeightZ =</span> (observedWeight <span class="sc">-</span> fMMean)<span class="sc">/</span>fMSd,</span>
<span id="cb480-4415"><a href="#cb480-4415" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb480-4416"><a href="#cb480-4416" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiverZ =</span> (meanFlowByRiver <span class="sc">-</span> fQMean)<span class="sc">/</span>fQSd,</span>
<span id="cb480-4417"><a href="#cb480-4417" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanTempZ =</span> (meanTemperature <span class="sc">-</span> fTMean)<span class="sc">/</span>fTSd,</span>
<span id="cb480-4418"><a href="#cb480-4418" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb480-4419"><a href="#cb480-4419" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiverZbySeason =</span> (meanFlowByRiver <span class="sc">-</span> fQbySeasonMean)<span class="sc">/</span>fQbySeasonSd,</span>
<span id="cb480-4420"><a href="#cb480-4420" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanTempZbySeason =</span> (meanTemperature <span class="sc">-</span> fTbySeasonMean)<span class="sc">/</span>fTbySeasonSd,</span>
<span id="cb480-4421"><a href="#cb480-4421" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-4422"><a href="#cb480-4422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4423"><a href="#cb480-4423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4424"><a href="#cb480-4424" aria-hidden="true" tabindex="-1"></a><span class="fu">### Raw data with logistic fit for flow effect</span></span>
<span id="cb480-4425"><a href="#cb480-4425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4428"><a href="#cb480-4428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4429"><a href="#cb480-4429" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: logisticFlow</span></span>
<span id="cb480-4430"><a href="#cb480-4430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4431"><a href="#cb480-4431" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(meanFlowByRiverZ, negGrowth <span class="sc">*</span> <span class="dv">1</span>, <span class="at">color =</span> river)) <span class="sc">+</span></span>
<span id="cb480-4432"><a href="#cb480-4432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-4433"><a href="#cb480-4433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb480-4434"><a href="#cb480-4434" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>),</span>
<span id="cb480-4435"><a href="#cb480-4435" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4436"><a href="#cb480-4436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mean flow"</span>) <span class="sc">+</span></span>
<span id="cb480-4437"><a href="#cb480-4437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4438"><a href="#cb480-4438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-4439"><a href="#cb480-4439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4440"><a href="#cb480-4440" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth)), <span class="fu">aes</span>(meanFlowByRiverZ, negGrowth <span class="sc">*</span> <span class="dv">1</span>, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-4441"><a href="#cb480-4441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-4442"><a href="#cb480-4442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb480-4443"><a href="#cb480-4443" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>),</span>
<span id="cb480-4444"><a href="#cb480-4444" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4445"><a href="#cb480-4445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mean flow"</span>) <span class="sc">+</span></span>
<span id="cb480-4446"><a href="#cb480-4446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4447"><a href="#cb480-4447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> speciesGG <span class="sc">+</span> riverGG)</span>
<span id="cb480-4448"><a href="#cb480-4448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4449"><a href="#cb480-4449" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(cd1_z |&gt; filter(!is.na(negGrowth)), aes(meanFlowByRiverZbySeason, negGrowth * 1, color = riverGG)) +</span></span>
<span id="cb480-4450"><a href="#cb480-4450" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(alpha = 0.1) +</span></span>
<span id="cb480-4451"><a href="#cb480-4451" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_smooth(method = "glm", </span></span>
<span id="cb480-4452"><a href="#cb480-4452" aria-hidden="true" tabindex="-1"></a><span class="co">#               method.args = list(family = "binomial"),</span></span>
<span id="cb480-4453"><a href="#cb480-4453" aria-hidden="true" tabindex="-1"></a><span class="co">#               se = FALSE) +</span></span>
<span id="cb480-4454"><a href="#cb480-4454" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(y = "Probability of negative growth in mass", x = "Mean flow (scaled by season)") +</span></span>
<span id="cb480-4455"><a href="#cb480-4455" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_publication() +    </span></span>
<span id="cb480-4456"><a href="#cb480-4456" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(seasonGG ~ speciesGG + riverGG)</span></span>
<span id="cb480-4457"><a href="#cb480-4457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4458"><a href="#cb480-4458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4459"><a href="#cb480-4459" aria-hidden="true" tabindex="-1"></a><span class="fu">### Raw data with logistic fit for temperature effect</span></span>
<span id="cb480-4460"><a href="#cb480-4460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4463"><a href="#cb480-4463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4464"><a href="#cb480-4464" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: logisticTemp</span></span>
<span id="cb480-4465"><a href="#cb480-4465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4466"><a href="#cb480-4466" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), meanTempZbySeason <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">4</span>), <span class="fu">aes</span>(meanTempZbySeason, negGrowth <span class="sc">*</span> <span class="dv">1</span>, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-4467"><a href="#cb480-4467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-4468"><a href="#cb480-4468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb480-4469"><a href="#cb480-4469" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>),</span>
<span id="cb480-4470"><a href="#cb480-4470" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4471"><a href="#cb480-4471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mean temperature (scaled by season)"</span>) <span class="sc">+</span></span>
<span id="cb480-4472"><a href="#cb480-4472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4473"><a href="#cb480-4473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> speciesGG)</span>
<span id="cb480-4474"><a href="#cb480-4474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4475"><a href="#cb480-4475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4476"><a href="#cb480-4476" aria-hidden="true" tabindex="-1"></a><span class="fu">### Raw data with logistic fit for observedWeight effect</span></span>
<span id="cb480-4477"><a href="#cb480-4477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4480"><a href="#cb480-4480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4481"><a href="#cb480-4481" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: logisticWeight</span></span>
<span id="cb480-4482"><a href="#cb480-4482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4483"><a href="#cb480-4483" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(negGrowth), meanTempZbySeason <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">4</span>), <span class="fu">aes</span>(observedWeightZ, negGrowth <span class="sc">*</span> <span class="dv">1</span>, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-4484"><a href="#cb480-4484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb480-4485"><a href="#cb480-4485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb480-4486"><a href="#cb480-4486" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>),</span>
<span id="cb480-4487"><a href="#cb480-4487" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4488"><a href="#cb480-4488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mass (mg, scaled by species and river)"</span>) <span class="sc">+</span></span>
<span id="cb480-4489"><a href="#cb480-4489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4490"><a href="#cb480-4490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> speciesGG)</span>
<span id="cb480-4491"><a href="#cb480-4491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4492"><a href="#cb480-4492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4493"><a href="#cb480-4493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4494"><a href="#cb480-4494" aria-hidden="true" tabindex="-1"></a><span class="fu">## Logistic model for flow and temperature, one species at a time</span></span>
<span id="cb480-4495"><a href="#cb480-4495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4496"><a href="#cb480-4496" aria-hidden="true" tabindex="-1"></a>Species occupy different rivers, so an all-species model will have</span>
<span id="cb480-4497"><a href="#cb480-4497" aria-hidden="true" tabindex="-1"></a>unequal river representation across species and don't need to predict</span>
<span id="cb480-4498"><a href="#cb480-4498" aria-hidden="true" tabindex="-1"></a>where species are not.</span>
<span id="cb480-4499"><a href="#cb480-4499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4500"><a href="#cb480-4500" aria-hidden="true" tabindex="-1"></a>Need to think through whether these models make sense...</span>
<span id="cb480-4501"><a href="#cb480-4501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4504"><a href="#cb480-4504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4505"><a href="#cb480-4505" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runLogisticModels</span></span>
<span id="cb480-4506"><a href="#cb480-4506" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb480-4507"><a href="#cb480-4507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4508"><a href="#cb480-4508" aria-hidden="true" tabindex="-1"></a>runSppModels <span class="ot">&lt;-</span> <span class="cf">function</span>(d, speciesIn) {</span>
<span id="cb480-4509"><a href="#cb480-4509" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">=</span></span>
<span id="cb480-4510"><a href="#cb480-4510" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">model =</span> </span>
<span id="cb480-4511"><a href="#cb480-4511" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb480-4512"><a href="#cb480-4512" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason'</span>,</span>
<span id="cb480-4513"><a href="#cb480-4513" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanTempZbySeason'</span>,</span>
<span id="cb480-4514"><a href="#cb480-4514" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ river'</span>,</span>
<span id="cb480-4515"><a href="#cb480-4515" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ factor(season)'</span>,</span>
<span id="cb480-4516"><a href="#cb480-4516" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ observedWeightZ'</span>,</span>
<span id="cb480-4517"><a href="#cb480-4517" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ nIndBySpeciesZ'</span>,</span>
<span id="cb480-4518"><a href="#cb480-4518" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ nIndZ'</span>,</span>
<span id="cb480-4519"><a href="#cb480-4519" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb480-4520"><a href="#cb480-4520" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river'</span>,</span>
<span id="cb480-4521"><a href="#cb480-4521" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason + river'</span>,</span>
<span id="cb480-4522"><a href="#cb480-4522" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason + meanTempZbySeason + river'</span>, </span>
<span id="cb480-4523"><a href="#cb480-4523" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb480-4524"><a href="#cb480-4524" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason'</span>, </span>
<span id="cb480-4525"><a href="#cb480-4525" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb480-4526"><a href="#cb480-4526" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * factor(season)'</span>,</span>
<span id="cb480-4527"><a href="#cb480-4527" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb480-4528"><a href="#cb480-4528" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason + meanTempZbySeason * river * factor(season)'</span>, </span>
<span id="cb480-4529"><a href="#cb480-4529" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb480-4530"><a href="#cb480-4530" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * factor(season) * observedWeightZ'</span>,</span>
<span id="cb480-4531"><a href="#cb480-4531" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ)^2'</span>,</span>
<span id="cb480-4532"><a href="#cb480-4532" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ + nIndBySpeciesZ)^2'</span>,</span>
<span id="cb480-4533"><a href="#cb480-4533" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ + nIndZ)^2'</span>,</span>
<span id="cb480-4534"><a href="#cb480-4534" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ + nIndZ + nIndBySpeciesZ)^2'</span>,</span>
<span id="cb480-4535"><a href="#cb480-4535" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + river + factor(season) + observedWeightZ + nIndZ)^3'</span>,</span>
<span id="cb480-4536"><a href="#cb480-4536" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb480-4537"><a href="#cb480-4537" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * factor(season) * observedWeightZ * nIndBySpeciesZ'</span>,</span>
<span id="cb480-4538"><a href="#cb480-4538" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * factor(season) * observedWeightZ + nIndBySpeciesZ'</span>,</span>
<span id="cb480-4539"><a href="#cb480-4539" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * observedWeightZ + nIndBySpeciesZ + factor(season)'</span>,</span>
<span id="cb480-4540"><a href="#cb480-4540" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * observedWeightZ + nIndBySpeciesZ * factor(season)'</span>,</span>
<span id="cb480-4541"><a href="#cb480-4541" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * river * observedWeightZ * nIndBySpeciesZ + factor(season)'</span>,</span>
<span id="cb480-4542"><a href="#cb480-4542" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb480-4543"><a href="#cb480-4543" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ meanFlowByRiverZbySeason * meanTempZbySeason * nIndBySpeciesZ + river + observedWeightZ + factor(season)'</span>,</span>
<span id="cb480-4544"><a href="#cb480-4544" aria-hidden="true" tabindex="-1"></a>          <span class="st">'negGrowth ~ (meanFlowByRiverZbySeason + meanTempZbySeason + nIndBySpeciesZ)^2 + river + observedWeightZ + factor(season)'</span></span>
<span id="cb480-4545"><a href="#cb480-4545" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb480-4546"><a href="#cb480-4546" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb480-4547"><a href="#cb480-4547" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb480-4548"><a href="#cb480-4548" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb480-4549"><a href="#cb480-4549" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit =</span> <span class="fu">map</span>(model, <span class="sc">~</span><span class="fu">glm</span>(.x, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn))),</span>
<span id="cb480-4550"><a href="#cb480-4550" aria-hidden="true" tabindex="-1"></a>      <span class="at">glanced =</span> <span class="fu">map</span>(fit, broom<span class="sc">::</span>glance),</span>
<span id="cb480-4551"><a href="#cb480-4551" aria-hidden="true" tabindex="-1"></a>      <span class="at">tidied =</span> <span class="fu">map</span>(fit, broom<span class="sc">::</span>tidy)</span>
<span id="cb480-4552"><a href="#cb480-4552" aria-hidden="true" tabindex="-1"></a>      <span class="co"># anova = map(fit, anova),</span></span>
<span id="cb480-4553"><a href="#cb480-4553" aria-hidden="true" tabindex="-1"></a>      <span class="co"># summary = map(fit, summary),</span></span>
<span id="cb480-4554"><a href="#cb480-4554" aria-hidden="true" tabindex="-1"></a>      <span class="co"># confint = map(fit, confint)</span></span>
<span id="cb480-4555"><a href="#cb480-4555" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-4556"><a href="#cb480-4556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(models)</span>
<span id="cb480-4557"><a href="#cb480-4557" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-4558"><a href="#cb480-4558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4559"><a href="#cb480-4559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4560"><a href="#cb480-4560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4561"><a href="#cb480-4561" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predict p(neg growth in mass)</span></span>
<span id="cb480-4562"><a href="#cb480-4562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4565"><a href="#cb480-4565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4566"><a href="#cb480-4566" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictLogistic</span></span>
<span id="cb480-4567"><a href="#cb480-4567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4568"><a href="#cb480-4568" aria-hidden="true" tabindex="-1"></a>predictSpp <span class="ot">&lt;-</span> <span class="cf">function</span>(dIn, modIn, speciesIn){</span>
<span id="cb480-4569"><a href="#cb480-4569" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> dIn <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn)</span>
<span id="cb480-4570"><a href="#cb480-4570" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-4571"><a href="#cb480-4571" aria-hidden="true" tabindex="-1"></a>  byAIC <span class="ot">=</span> modIn <span class="sc">|&gt;</span> </span>
<span id="cb480-4572"><a href="#cb480-4572" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(glanced) <span class="sc">|&gt;</span> </span>
<span id="cb480-4573"><a href="#cb480-4573" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb480-4574"><a href="#cb480-4574" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, df.residual, deviance, fit, tidied) </span>
<span id="cb480-4575"><a href="#cb480-4575" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-4576"><a href="#cb480-4576" aria-hidden="true" tabindex="-1"></a>  predDSpp <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb480-4577"><a href="#cb480-4577" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanFlowByRiverZbySeason =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb480-4578"><a href="#cb480-4578" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanTempZbySeason =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb480-4579"><a href="#cb480-4579" aria-hidden="true" tabindex="-1"></a>    <span class="at">river =</span> <span class="fu">unique</span>(d<span class="sc">$</span>river), </span>
<span id="cb480-4580"><a href="#cb480-4580" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">unique</span>(d<span class="sc">$</span>season),</span>
<span id="cb480-4581"><a href="#cb480-4581" aria-hidden="true" tabindex="-1"></a>    <span class="at">observedWeightZ =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>),</span>
<span id="cb480-4582"><a href="#cb480-4582" aria-hidden="true" tabindex="-1"></a>    <span class="at">nIndBySpeciesZ =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>),</span>
<span id="cb480-4583"><a href="#cb480-4583" aria-hidden="true" tabindex="-1"></a>    <span class="at">nIndZ =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>)</span>
<span id="cb480-4584"><a href="#cb480-4584" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-4585"><a href="#cb480-4585" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-4586"><a href="#cb480-4586" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-4587"><a href="#cb480-4587" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">add_column</span>(predDSpp, </span>
<span id="cb480-4588"><a href="#cb480-4588" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pred =</span> <span class="fu">predict.glm</span>(byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]], predDSpp, <span class="at">type =</span> <span class="st">"response"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-4589"><a href="#cb480-4589" aria-hidden="true" tabindex="-1"></a>             <span class="fu">mutate</span>(<span class="at">groupT =</span> <span class="fu">paste</span>(river, season, meanTempZbySeason, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb480-4590"><a href="#cb480-4590" aria-hidden="true" tabindex="-1"></a>                    <span class="at">groupF =</span> <span class="fu">paste</span>(river, season, meanFlowByRiverZbySeason, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb480-4591"><a href="#cb480-4591" aria-hidden="true" tabindex="-1"></a>                    <span class="at">groupTM =</span> <span class="fu">paste</span>(river, season, meanTempZbySeason, observedWeightZ, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb480-4592"><a href="#cb480-4592" aria-hidden="true" tabindex="-1"></a>                    <span class="at">groupFN =</span> <span class="fu">paste</span>(river, season, meanFlowByRiverZbySeason, nIndZ, <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-4593"><a href="#cb480-4593" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addGG_noSpecies</span>()</span>
<span id="cb480-4594"><a href="#cb480-4594" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb480-4595"><a href="#cb480-4595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb480-4596"><a href="#cb480-4596" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb480-4597"><a href="#cb480-4597" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred =</span> pred,</span>
<span id="cb480-4598"><a href="#cb480-4598" aria-hidden="true" tabindex="-1"></a>      <span class="at">byAIC =</span> byAIC</span>
<span id="cb480-4599"><a href="#cb480-4599" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb480-4600"><a href="#cb480-4600" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-4601"><a href="#cb480-4601" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb480-4602"><a href="#cb480-4602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4603"><a href="#cb480-4603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4604"><a href="#cb480-4604" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4605"><a href="#cb480-4605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4606"><a href="#cb480-4606" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brook trout</span></span>
<span id="cb480-4607"><a href="#cb480-4607" aria-hidden="true" tabindex="-1"></a>In the figures with the shading, the shading is the range of effects from number of individuals, with the darker line on one edge of the shaded area representing high numbers of individuals. </span>
<span id="cb480-4610"><a href="#cb480-4610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4611"><a href="#cb480-4611" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: modBKT</span></span>
<span id="cb480-4612"><a href="#cb480-4612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4613"><a href="#cb480-4613" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"bkt"</span></span>
<span id="cb480-4614"><a href="#cb480-4614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4615"><a href="#cb480-4615" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb480-4616"><a href="#cb480-4616" aria-hidden="true" tabindex="-1"></a>  cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn) <span class="sc">|&gt;</span> </span>
<span id="cb480-4617"><a href="#cb480-4617" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(meanFlowByRiverZbySeason, meanTempZbySeason, observedWeightZ, nIndBySpeciesZ, nIndZ, river, season)</span>
<span id="cb480-4618"><a href="#cb480-4618" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-4619"><a href="#cb480-4619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4620"><a href="#cb480-4620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4621"><a href="#cb480-4621" aria-hidden="true" tabindex="-1"></a>modBKT <span class="ot">&lt;-</span> <span class="fu">runSppModels</span>(cd1_z, speciesIn)</span>
<span id="cb480-4622"><a href="#cb480-4622" aria-hidden="true" tabindex="-1"></a>predBKT <span class="ot">&lt;-</span> <span class="fu">predictSpp</span>(cd1_z, modBKT, speciesIn)</span>
<span id="cb480-4623"><a href="#cb480-4623" aria-hidden="true" tabindex="-1"></a>predBKT<span class="sc">$</span>byAIC <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, deviance) </span>
<span id="cb480-4624"><a href="#cb480-4624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4625"><a href="#cb480-4625" aria-hidden="true" tabindex="-1"></a><span class="co">#https://rcompanion.org/rcompanion/e_06.html</span></span>
<span id="cb480-4626"><a href="#cb480-4626" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(predBKT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]]) <span class="sc">|&gt;</span> </span>
<span id="cb480-4627"><a href="#cb480-4627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb480-4628"><a href="#cb480-4628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb480-4629"><a href="#cb480-4629" aria-hidden="true" tabindex="-1"></a>    <span class="at">lo =</span> <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb480-4630"><a href="#cb480-4630" aria-hidden="true" tabindex="-1"></a>    <span class="at">hi =</span>  <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb480-4631"><a href="#cb480-4631" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlap0 =</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb480-4632"><a href="#cb480-4632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4633"><a href="#cb480-4633" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(predBKT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span>
<span id="cb480-4634"><a href="#cb480-4634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4635"><a href="#cb480-4635" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(predBKT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]], <span class="at">type=</span><span class="st">"II"</span>, <span class="at">test=</span><span class="st">"Wald"</span>)</span>
<span id="cb480-4636"><a href="#cb480-4636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4637"><a href="#cb480-4637" aria-hidden="true" tabindex="-1"></a><span class="fu">efronRSquared</span>(predBKT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span>
<span id="cb480-4638"><a href="#cb480-4638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4639"><a href="#cb480-4639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4640"><a href="#cb480-4640" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb480-4641"><a href="#cb480-4641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb480-4642"><a href="#cb480-4642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb480-4643"><a href="#cb480-4643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4644"><a href="#cb480-4644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG <span class="sc">+</span> meanTempZbySeason)</span>
<span id="cb480-4645"><a href="#cb480-4645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4646"><a href="#cb480-4646" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">==</span> <span class="dv">0</span>, meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb480-4647"><a href="#cb480-4647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb480-4648"><a href="#cb480-4648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb480-4649"><a href="#cb480-4649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4650"><a href="#cb480-4650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4651"><a href="#cb480-4651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4652"><a href="#cb480-4652" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, pred, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4653"><a href="#cb480-4653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason))) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4654"><a href="#cb480-4654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>) <span class="sc">+</span></span>
<span id="cb480-4655"><a href="#cb480-4655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4656"><a href="#cb480-4656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4657"><a href="#cb480-4657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4658"><a href="#cb480-4658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4659"><a href="#cb480-4659" aria-hidden="true" tabindex="-1"></a>predBKTWider <span class="ot">&lt;-</span> predBKT<span class="sc">$</span>pred <span class="sc">|&gt;</span> </span>
<span id="cb480-4660"><a href="#cb480-4660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nIndZ <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-4661"><a href="#cb480-4661" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>groupFN) <span class="sc">|&gt;</span> </span>
<span id="cb480-4662"><a href="#cb480-4662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> pred, <span class="at">names_from =</span> nIndZ, <span class="at">names_prefix =</span> <span class="st">"nIndZ"</span>)</span>
<span id="cb480-4663"><a href="#cb480-4663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4664"><a href="#cb480-4664" aria-hidden="true" tabindex="-1"></a>tempColors <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"grey"</span>, <span class="st">"red"</span>)</span>
<span id="cb480-4665"><a href="#cb480-4665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4666"><a href="#cb480-4666" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="sc">-</span><span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4667"><a href="#cb480-4667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4668"><a href="#cb480-4668" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4669"><a href="#cb480-4669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4670"><a href="#cb480-4670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4671"><a href="#cb480-4671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4672"><a href="#cb480-4672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4673"><a href="#cb480-4673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Small fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4674"><a href="#cb480-4674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4675"><a href="#cb480-4675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4676"><a href="#cb480-4676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4677"><a href="#cb480-4677" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4678"><a href="#cb480-4678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4679"><a href="#cb480-4679" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4680"><a href="#cb480-4680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4681"><a href="#cb480-4681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4682"><a href="#cb480-4682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4683"><a href="#cb480-4683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4684"><a href="#cb480-4684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Medium fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4685"><a href="#cb480-4685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4686"><a href="#cb480-4686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4687"><a href="#cb480-4687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4688"><a href="#cb480-4688" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBKTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4689"><a href="#cb480-4689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4690"><a href="#cb480-4690" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4691"><a href="#cb480-4691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4692"><a href="#cb480-4692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4693"><a href="#cb480-4693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4694"><a href="#cb480-4694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4695"><a href="#cb480-4695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Large fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4696"><a href="#cb480-4696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4697"><a href="#cb480-4697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4698"><a href="#cb480-4698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4699"><a href="#cb480-4699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4700"><a href="#cb480-4700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4701"><a href="#cb480-4701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4702"><a href="#cb480-4702" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brown trout</span></span>
<span id="cb480-4703"><a href="#cb480-4703" aria-hidden="true" tabindex="-1"></a>to do: exclude OS in all models</span>
<span id="cb480-4706"><a href="#cb480-4706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4707"><a href="#cb480-4707" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: modBnt</span></span>
<span id="cb480-4708"><a href="#cb480-4708" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-4709"><a href="#cb480-4709" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"bnt"</span></span>
<span id="cb480-4710"><a href="#cb480-4710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4711"><a href="#cb480-4711" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb480-4712"><a href="#cb480-4712" aria-hidden="true" tabindex="-1"></a>  cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn) <span class="sc">|&gt;</span> </span>
<span id="cb480-4713"><a href="#cb480-4713" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(meanFlowByRiverZbySeason, meanTempZbySeason, observedWeightZ, nIndBySpeciesZ, nIndZ, river, season)</span>
<span id="cb480-4714"><a href="#cb480-4714" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-4715"><a href="#cb480-4715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4716"><a href="#cb480-4716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4717"><a href="#cb480-4717" aria-hidden="true" tabindex="-1"></a>modBNT <span class="ot">&lt;-</span> <span class="fu">runSppModels</span>(cd1_z, speciesIn)</span>
<span id="cb480-4718"><a href="#cb480-4718" aria-hidden="true" tabindex="-1"></a>predBNT <span class="ot">&lt;-</span> <span class="fu">predictSpp</span>(cd1_z, modBNT, speciesIn)</span>
<span id="cb480-4719"><a href="#cb480-4719" aria-hidden="true" tabindex="-1"></a>predBNT<span class="sc">$</span>byAIC <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, deviance)</span>
<span id="cb480-4720"><a href="#cb480-4720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4721"><a href="#cb480-4721" aria-hidden="true" tabindex="-1"></a><span class="co">#https://rcompanion.org/rcompanion/e_06.html</span></span>
<span id="cb480-4722"><a href="#cb480-4722" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(predBNT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]]) <span class="sc">|&gt;</span> </span>
<span id="cb480-4723"><a href="#cb480-4723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb480-4724"><a href="#cb480-4724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb480-4725"><a href="#cb480-4725" aria-hidden="true" tabindex="-1"></a>    <span class="at">lo =</span> <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb480-4726"><a href="#cb480-4726" aria-hidden="true" tabindex="-1"></a>    <span class="at">hi =</span>  <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb480-4727"><a href="#cb480-4727" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlap0 =</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb480-4728"><a href="#cb480-4728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4729"><a href="#cb480-4729" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(predBNT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span>
<span id="cb480-4730"><a href="#cb480-4730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4731"><a href="#cb480-4731" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(predBNT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]], <span class="at">type=</span><span class="st">"II"</span>, <span class="at">test=</span><span class="st">"Wald"</span>)</span>
<span id="cb480-4732"><a href="#cb480-4732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4733"><a href="#cb480-4733" aria-hidden="true" tabindex="-1"></a><span class="fu">efronRSquared</span>(predBNT<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span>
<span id="cb480-4734"><a href="#cb480-4734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4735"><a href="#cb480-4735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4736"><a href="#cb480-4736" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb480-4737"><a href="#cb480-4737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb480-4738"><a href="#cb480-4738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb480-4739"><a href="#cb480-4739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4740"><a href="#cb480-4740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG <span class="sc">+</span> meanTempZbySeason)</span>
<span id="cb480-4741"><a href="#cb480-4741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4742"><a href="#cb480-4742" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">==</span> <span class="dv">0</span>, meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb480-4743"><a href="#cb480-4743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb480-4744"><a href="#cb480-4744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb480-4745"><a href="#cb480-4745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4746"><a href="#cb480-4746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4747"><a href="#cb480-4747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4748"><a href="#cb480-4748" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNT<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, pred, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4749"><a href="#cb480-4749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason))) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4750"><a href="#cb480-4750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>) <span class="sc">+</span></span>
<span id="cb480-4751"><a href="#cb480-4751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4752"><a href="#cb480-4752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4753"><a href="#cb480-4753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4754"><a href="#cb480-4754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4755"><a href="#cb480-4755" aria-hidden="true" tabindex="-1"></a>predBNTWider <span class="ot">&lt;-</span> predBNT<span class="sc">$</span>pred <span class="sc">|&gt;</span> </span>
<span id="cb480-4756"><a href="#cb480-4756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nIndZ <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-4757"><a href="#cb480-4757" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>groupFN) <span class="sc">|&gt;</span> </span>
<span id="cb480-4758"><a href="#cb480-4758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> pred, <span class="at">names_from =</span> nIndZ, <span class="at">names_prefix =</span> <span class="st">"nIndZ"</span>)</span>
<span id="cb480-4759"><a href="#cb480-4759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4760"><a href="#cb480-4760" aria-hidden="true" tabindex="-1"></a>tempColors <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"grey"</span>, <span class="st">"red"</span>)</span>
<span id="cb480-4761"><a href="#cb480-4761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4762"><a href="#cb480-4762" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="sc">-</span><span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4763"><a href="#cb480-4763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4764"><a href="#cb480-4764" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4765"><a href="#cb480-4765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4766"><a href="#cb480-4766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4767"><a href="#cb480-4767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4768"><a href="#cb480-4768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4769"><a href="#cb480-4769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Small fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4770"><a href="#cb480-4770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4771"><a href="#cb480-4771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4772"><a href="#cb480-4772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4773"><a href="#cb480-4773" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4774"><a href="#cb480-4774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4775"><a href="#cb480-4775" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4776"><a href="#cb480-4776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4777"><a href="#cb480-4777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4778"><a href="#cb480-4778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4779"><a href="#cb480-4779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4780"><a href="#cb480-4780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Medium fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4781"><a href="#cb480-4781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4782"><a href="#cb480-4782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4783"><a href="#cb480-4783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4784"><a href="#cb480-4784" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predBNTWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4785"><a href="#cb480-4785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4786"><a href="#cb480-4786" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4787"><a href="#cb480-4787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4788"><a href="#cb480-4788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4789"><a href="#cb480-4789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4790"><a href="#cb480-4790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4791"><a href="#cb480-4791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Large fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4792"><a href="#cb480-4792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4793"><a href="#cb480-4793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4794"><a href="#cb480-4794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4795"><a href="#cb480-4795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4796"><a href="#cb480-4796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4797"><a href="#cb480-4797" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4798"><a href="#cb480-4798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4799"><a href="#cb480-4799" aria-hidden="true" tabindex="-1"></a><span class="fu">### Atlantic salmon</span></span>
<span id="cb480-4800"><a href="#cb480-4800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4803"><a href="#cb480-4803" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4804"><a href="#cb480-4804" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: modAts</span></span>
<span id="cb480-4805"><a href="#cb480-4805" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-4806"><a href="#cb480-4806" aria-hidden="true" tabindex="-1"></a>speciesIn <span class="ot">&lt;-</span> <span class="st">"ats"</span></span>
<span id="cb480-4807"><a href="#cb480-4807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4808"><a href="#cb480-4808" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb480-4809"><a href="#cb480-4809" aria-hidden="true" tabindex="-1"></a>  cd1_z <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> speciesIn) <span class="sc">|&gt;</span> </span>
<span id="cb480-4810"><a href="#cb480-4810" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(meanFlowByRiverZbySeason, meanTempZbySeason, observedWeightZ, nIndBySpeciesZ, nIndZ, river, season)</span>
<span id="cb480-4811"><a href="#cb480-4811" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb480-4812"><a href="#cb480-4812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4813"><a href="#cb480-4813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4814"><a href="#cb480-4814" aria-hidden="true" tabindex="-1"></a>modATS <span class="ot">&lt;-</span> <span class="fu">runSppModels</span>(cd1_z, speciesIn)</span>
<span id="cb480-4815"><a href="#cb480-4815" aria-hidden="true" tabindex="-1"></a>predATS <span class="ot">&lt;-</span> <span class="fu">predictSpp</span>(cd1_z, modATS, speciesIn)</span>
<span id="cb480-4816"><a href="#cb480-4816" aria-hidden="true" tabindex="-1"></a>predATS<span class="sc">$</span>byAIC <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(model, AIC, deviance) </span>
<span id="cb480-4817"><a href="#cb480-4817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4818"><a href="#cb480-4818" aria-hidden="true" tabindex="-1"></a><span class="co">#https://rcompanion.org/rcompanion/e_06.html</span></span>
<span id="cb480-4819"><a href="#cb480-4819" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(predATS<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]]) <span class="sc">|&gt;</span> </span>
<span id="cb480-4820"><a href="#cb480-4820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb480-4821"><a href="#cb480-4821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb480-4822"><a href="#cb480-4822" aria-hidden="true" tabindex="-1"></a>    <span class="at">lo =</span> <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb480-4823"><a href="#cb480-4823" aria-hidden="true" tabindex="-1"></a>    <span class="at">hi =</span>  <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb480-4824"><a href="#cb480-4824" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlap0 =</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb480-4825"><a href="#cb480-4825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4826"><a href="#cb480-4826" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(predATS<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span>
<span id="cb480-4827"><a href="#cb480-4827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4828"><a href="#cb480-4828" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(predATS<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]], <span class="at">type=</span><span class="st">"II"</span>, <span class="at">test=</span><span class="st">"Wald"</span>)</span>
<span id="cb480-4829"><a href="#cb480-4829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4830"><a href="#cb480-4830" aria-hidden="true" tabindex="-1"></a><span class="fu">efronRSquared</span>(predATS<span class="sc">$</span>byAIC[<span class="dv">1</span>,]<span class="sc">$</span>fit[[<span class="dv">1</span>]])</span>
<span id="cb480-4831"><a href="#cb480-4831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4832"><a href="#cb480-4832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4833"><a href="#cb480-4833" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATS<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb480-4834"><a href="#cb480-4834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb480-4835"><a href="#cb480-4835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb480-4836"><a href="#cb480-4836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4837"><a href="#cb480-4837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG <span class="sc">+</span> meanTempZbySeason)</span>
<span id="cb480-4838"><a href="#cb480-4838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4839"><a href="#cb480-4839" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATS<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">==</span> <span class="dv">0</span>, meanFlowByRiverZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), nIndZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(observedWeightZ, pred, <span class="at">group =</span> groupF)) <span class="sc">+</span></span>
<span id="cb480-4840"><a href="#cb480-4840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanFlowByRiverZbySeason))) <span class="sc">+</span></span>
<span id="cb480-4841"><a href="#cb480-4841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Body mass (mg)"</span>) <span class="sc">+</span></span>
<span id="cb480-4842"><a href="#cb480-4842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4843"><a href="#cb480-4843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4844"><a href="#cb480-4844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4845"><a href="#cb480-4845" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATS<span class="sc">$</span>pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, pred, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4846"><a href="#cb480-4846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason))) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4847"><a href="#cb480-4847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>) <span class="sc">+</span></span>
<span id="cb480-4848"><a href="#cb480-4848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4849"><a href="#cb480-4849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4850"><a href="#cb480-4850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4851"><a href="#cb480-4851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4852"><a href="#cb480-4852" aria-hidden="true" tabindex="-1"></a>predATSWider <span class="ot">&lt;-</span> predATS<span class="sc">$</span>pred <span class="sc">|&gt;</span> </span>
<span id="cb480-4853"><a href="#cb480-4853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nIndZ <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-4854"><a href="#cb480-4854" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>groupFN) <span class="sc">|&gt;</span> </span>
<span id="cb480-4855"><a href="#cb480-4855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> pred, <span class="at">names_from =</span> nIndZ, <span class="at">names_prefix =</span> <span class="st">"nIndZ"</span>)</span>
<span id="cb480-4856"><a href="#cb480-4856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4857"><a href="#cb480-4857" aria-hidden="true" tabindex="-1"></a>tempColors <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"grey"</span>, <span class="st">"red"</span>)</span>
<span id="cb480-4858"><a href="#cb480-4858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4859"><a href="#cb480-4859" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATSWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="sc">-</span><span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>, season <span class="sc">&gt;</span> <span class="dv">1</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4860"><a href="#cb480-4860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4861"><a href="#cb480-4861" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4862"><a href="#cb480-4862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4863"><a href="#cb480-4863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4864"><a href="#cb480-4864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4865"><a href="#cb480-4865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4866"><a href="#cb480-4866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Small fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4867"><a href="#cb480-4867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4868"><a href="#cb480-4868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4869"><a href="#cb480-4869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4870"><a href="#cb480-4870" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATSWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="dv">0</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>,  season <span class="sc">&gt;</span> <span class="dv">1</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4871"><a href="#cb480-4871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4872"><a href="#cb480-4872" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4873"><a href="#cb480-4873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4874"><a href="#cb480-4874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4875"><a href="#cb480-4875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4876"><a href="#cb480-4876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4877"><a href="#cb480-4877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Medium fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4878"><a href="#cb480-4878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4879"><a href="#cb480-4879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4880"><a href="#cb480-4880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4881"><a href="#cb480-4881" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predATSWider <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTempZbySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeightZ <span class="sc">==</span> <span class="fl">1.5</span>, nIndBySpeciesZ <span class="sc">==</span> <span class="dv">0</span>,  season <span class="sc">&gt;</span> <span class="dv">1</span>, riverGG <span class="sc">==</span> <span class="st">"West Brook"</span>), <span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ0, <span class="at">group =</span> groupTM)) <span class="sc">+</span></span>
<span id="cb480-4882"><a href="#cb480-4882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co">#, linetype = factor(observedWeightZ))) +</span></span>
<span id="cb480-4883"><a href="#cb480-4883" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(meanFlowByRiverZbySeason, `nIndZ-1.5`, color = factor(meanTempZbySeason)), alpha = 0.5, linetype = 2, linewidth = 0.75) +</span></span>
<span id="cb480-4884"><a href="#cb480-4884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, nIndZ1<span class="fl">.5</span>, <span class="at">color =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.33</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb480-4885"><a href="#cb480-4885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(meanFlowByRiverZbySeason, <span class="at">ymin =</span> <span class="st">`</span><span class="at">nIndZ-1.5</span><span class="st">`</span>, <span class="at">max =</span> nIndZ1<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">factor</span>(meanTempZbySeason)), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb480-4886"><a href="#cb480-4886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4887"><a href="#cb480-4887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tempColors) <span class="sc">+</span></span>
<span id="cb480-4888"><a href="#cb480-4888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Stream flow"</span>, <span class="at">title =</span> <span class="st">"Large fish"</span>) <span class="sc">+</span></span>
<span id="cb480-4889"><a href="#cb480-4889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4890"><a href="#cb480-4890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG <span class="sc">~</span> riverGG)</span>
<span id="cb480-4891"><a href="#cb480-4891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4892"><a href="#cb480-4892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4893"><a href="#cb480-4893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4894"><a href="#cb480-4894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4895"><a href="#cb480-4895" aria-hidden="true" tabindex="-1"></a><span class="fu">## Two growth models</span></span>
<span id="cb480-4896"><a href="#cb480-4896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4897"><a href="#cb480-4897" aria-hidden="true" tabindex="-1"></a><span class="fu">### Size-adjusted growth model</span></span>
<span id="cb480-4898"><a href="#cb480-4898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4899"><a href="#cb480-4899" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Get l-w relationships for size-adjusted growth model</span></span>
<span id="cb480-4900"><a href="#cb480-4900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4901"><a href="#cb480-4901" aria-hidden="true" tabindex="-1"></a>Here, we will explore size-independent growth in mass, see</span>
<span id="cb480-4902"><a href="#cb480-4902" aria-hidden="true" tabindex="-1"></a><span class="in">`Sigourney, D. B., B H Letcher, M. Obedzinski, and R. A. Cunjak. “Size-Independent Growth in Fishes: Patterns, Models and Metrics.” Journal of Fish Biology 72, no. 10 (2008): 2435–55. https://doi.org/10.1111/j.1095-8649.2008.01830.x.`</span></span>
<span id="cb480-4903"><a href="#cb480-4903" aria-hidden="true" tabindex="-1"></a>Size-independent growth (<span class="in">`grWeightS`</span>) is calculated in</span>
<span id="cb480-4904"><a href="#cb480-4904" aria-hidden="true" tabindex="-1"></a>getDataElectro_targets.R file using addSizeIndGrowthWeight().\</span>
<span id="cb480-4905"><a href="#cb480-4905" aria-hidden="true" tabindex="-1"></a><span class="in">`grWeightS`</span> uses the slope of <span class="in">`log(observedWeight)`</span> \~ <span class="in">`log(grWeight)`</span></span>
<span id="cb480-4906"><a href="#cb480-4906" aria-hidden="true" tabindex="-1"></a>for each river and season and species to adjust growth.\</span>
<span id="cb480-4907"><a href="#cb480-4907" aria-hidden="true" tabindex="-1"></a>A simple linear models shows we need to get separate slopes for each</span>
<span id="cb480-4908"><a href="#cb480-4908" aria-hidden="true" tabindex="-1"></a>river and season and species.</span>
<span id="cb480-4909"><a href="#cb480-4909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4912"><a href="#cb480-4912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4913"><a href="#cb480-4913" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grW_models</span></span>
<span id="cb480-4914"><a href="#cb480-4914" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb480-4915"><a href="#cb480-4915" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">log</span>(observedWeight), <span class="fu">log</span>(grWeight), <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-4916"><a href="#cb480-4916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.05</span>)  <span class="sc">+</span></span>
<span id="cb480-4917"><a href="#cb480-4917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4918"><a href="#cb480-4918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Log of mass (mg)"</span>, <span class="at">x =</span> <span class="st">"Log of growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-4919"><a href="#cb480-4919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-4920"><a href="#cb480-4920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4921"><a href="#cb480-4921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-4922"><a href="#cb480-4922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4923"><a href="#cb480-4923" aria-hidden="true" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight), <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb480-4924"><a href="#cb480-4924" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight) <span class="sc">*</span> river, <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb480-4925"><a href="#cb480-4925" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight) <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season), <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb480-4926"><a href="#cb480-4926" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight) <span class="sc">*</span> <span class="fu">factor</span>(season), <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb480-4927"><a href="#cb480-4927" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(grWeight) <span class="sc">~</span> <span class="fu">log</span>(observedWeight) <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> species, <span class="at">data =</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(grWeight <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb480-4928"><a href="#cb480-4928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4929"><a href="#cb480-4929" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(mod0,mod1,mod2,mod3,mod4) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(AIC)</span>
<span id="cb480-4930"><a href="#cb480-4930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4931"><a href="#cb480-4931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4932"><a href="#cb480-4932" aria-hidden="true" tabindex="-1"></a><span class="fu">### Compare size-adjusted and instantaneous growth</span></span>
<span id="cb480-4933"><a href="#cb480-4933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4934"><a href="#cb480-4934" aria-hidden="true" tabindex="-1"></a>Differences don't seem big enough to warrant the extra complexity from</span>
<span id="cb480-4935"><a href="#cb480-4935" aria-hidden="true" tabindex="-1"></a>the s-adjusted growth metric</span>
<span id="cb480-4936"><a href="#cb480-4936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4939"><a href="#cb480-4939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4940"><a href="#cb480-4940" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grWeight_v_grWeightS</span></span>
<span id="cb480-4941"><a href="#cb480-4941" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grWeight, grWeightS, <span class="at">color =</span> riverGG)) <span class="sc">+</span></span>
<span id="cb480-4942"><a href="#cb480-4942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.05</span>)  <span class="sc">+</span></span>
<span id="cb480-4943"><a href="#cb480-4943" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4944"><a href="#cb480-4944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb480-4945"><a href="#cb480-4945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Gowth in mass"</span>, <span class="at">x =</span> <span class="st">"Size-adjusted growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-4946"><a href="#cb480-4946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-4947"><a href="#cb480-4947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4948"><a href="#cb480-4948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-4949"><a href="#cb480-4949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4950"><a href="#cb480-4950" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1 <span class="sc">|&gt;</span> </span>
<span id="cb480-4951"><a href="#cb480-4951" aria-hidden="true" tabindex="-1"></a>         dplyr<span class="sc">::</span><span class="fu">select</span>(observedWeight, grWeight, grWeightS, seasonGG, speciesGG) <span class="sc">|&gt;</span> </span>
<span id="cb480-4952"><a href="#cb480-4952" aria-hidden="true" tabindex="-1"></a>         <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(grWeight, grWeightS)),</span>
<span id="cb480-4953"><a href="#cb480-4953" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb480-4954"><a href="#cb480-4954" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">log</span>(observedWeight), value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb480-4955"><a href="#cb480-4955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.05</span> )  <span class="sc">+</span></span>
<span id="cb480-4956"><a href="#cb480-4956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb480-4957"><a href="#cb480-4957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Log of mass (mg)"</span>, <span class="at">x =</span> <span class="st">"Growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-4958"><a href="#cb480-4958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-4959"><a href="#cb480-4959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4960"><a href="#cb480-4960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-4961"><a href="#cb480-4961" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4962"><a href="#cb480-4962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4963"><a href="#cb480-4963" aria-hidden="true" tabindex="-1"></a><span class="fu">## Compare growth in length and mass</span></span>
<span id="cb480-4964"><a href="#cb480-4964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4965"><a href="#cb480-4965" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth rate in length vs size-independent growth rate in mass</span></span>
<span id="cb480-4966"><a href="#cb480-4966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4969"><a href="#cb480-4969" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4970"><a href="#cb480-4970" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grLen_v_grWeightS</span></span>
<span id="cb480-4971"><a href="#cb480-4971" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cd1, <span class="fu">aes</span>(grLength, grWeightS)) <span class="sc">+</span></span>
<span id="cb480-4972"><a href="#cb480-4972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> observedWeight), <span class="at">alpha =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb480-4973"><a href="#cb480-4973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb480-4974"><a href="#cb480-4974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth in length"</span>, <span class="at">y =</span> <span class="st">"Size-adjusted growth in mass"</span>) <span class="sc">+</span></span>
<span id="cb480-4975"><a href="#cb480-4975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>() <span class="sc">+</span></span>
<span id="cb480-4976"><a href="#cb480-4976" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-4977"><a href="#cb480-4977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(seasonGG<span class="sc">~</span>speciesGG)</span>
<span id="cb480-4978"><a href="#cb480-4978" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-4979"><a href="#cb480-4979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4980"><a href="#cb480-4980" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Deprecated** logistic models below</span></span>
<span id="cb480-4981"><a href="#cb480-4981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4982"><a href="#cb480-4982" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic model for flow and temperature, all species</span></span>
<span id="cb480-4983"><a href="#cb480-4983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4984"><a href="#cb480-4984" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model selection</span></span>
<span id="cb480-4985"><a href="#cb480-4985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4988"><a href="#cb480-4988" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-4989"><a href="#cb480-4989" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: logistic models all species</span></span>
<span id="cb480-4990"><a href="#cb480-4990" aria-hidden="true" tabindex="-1"></a>modSpecies <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bkt"</span>, <span class="st">"ats"</span>, <span class="st">"bnt"</span>)</span>
<span id="cb480-4991"><a href="#cb480-4991" aria-hidden="true" tabindex="-1"></a>cd1Mod <span class="ot">&lt;-</span> cd1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(species <span class="sc">==</span> modSpecies)</span>
<span id="cb480-4992"><a href="#cb480-4992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4993"><a href="#cb480-4993" aria-hidden="true" tabindex="-1"></a>modFT0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-4994"><a href="#cb480-4994" aria-hidden="true" tabindex="-1"></a>modFT1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-4995"><a href="#cb480-4995" aria-hidden="true" tabindex="-1"></a>modFT2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">+</span> river <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-4996"><a href="#cb480-4996" aria-hidden="true" tabindex="-1"></a>modFT3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">+</span> meanTemperatureScaledBySeason <span class="sc">+</span> river <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-4997"><a href="#cb480-4997" aria-hidden="true" tabindex="-1"></a>modFT4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">+</span> river , <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-4998"><a href="#cb480-4998" aria-hidden="true" tabindex="-1"></a>modFT5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">+</span> river , <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-4999"><a href="#cb480-4999" aria-hidden="true" tabindex="-1"></a>modFT6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">+</span> species , <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-5000"><a href="#cb480-5000" aria-hidden="true" tabindex="-1"></a>modFT7 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-5001"><a href="#cb480-5001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5002"><a href="#cb480-5002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5003"><a href="#cb480-5003" aria-hidden="true" tabindex="-1"></a>modFT8 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-5004"><a href="#cb480-5004" aria-hidden="true" tabindex="-1"></a>modFT9 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-5005"><a href="#cb480-5005" aria-hidden="true" tabindex="-1"></a>modFT10 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">+</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-5006"><a href="#cb480-5006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5007"><a href="#cb480-5007" aria-hidden="true" tabindex="-1"></a>modFT11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> observedWeight <span class="sc">+</span> species, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-5008"><a href="#cb480-5008" aria-hidden="true" tabindex="-1"></a>modFT12 <span class="ot">&lt;-</span> <span class="fu">glm</span>(negGrowth <span class="sc">~</span> meanFlowByRiverScaledBySeason <span class="sc">*</span> meanTemperatureScaledBySeason <span class="sc">*</span> river <span class="sc">*</span> <span class="fu">factor</span>(season) <span class="sc">*</span> species <span class="sc">*</span> observedWeight, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> cd1Mod)</span>
<span id="cb480-5009"><a href="#cb480-5009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5010"><a href="#cb480-5010" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(modFT0, modFT1,modFT2, modFT3,modFT4,modFT5, modFT6,modFT7,modFT8,modFT9,modFT10, modFT11, modFT12) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(AIC)</span>
<span id="cb480-5011"><a href="#cb480-5011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-5012"><a href="#cb480-5012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5013"><a href="#cb480-5013" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model results for additive model (not very good)</span></span>
<span id="cb480-5014"><a href="#cb480-5014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5017"><a href="#cb480-5017" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-5018"><a href="#cb480-5018" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: badAdditiveModel</span></span>
<span id="cb480-5019"><a href="#cb480-5019" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.statology.org/logistic-regression-in-r/</span></span>
<span id="cb480-5020"><a href="#cb480-5020" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(modFT3)</span></span>
<span id="cb480-5021"><a href="#cb480-5021" aria-hidden="true" tabindex="-1"></a><span class="co">#anova(modFT3)</span></span>
<span id="cb480-5022"><a href="#cb480-5022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5023"><a href="#cb480-5023" aria-hidden="true" tabindex="-1"></a>pscl<span class="sc">::</span><span class="fu">pR2</span>(modFT3)[<span class="st">"McFadden"</span>]</span>
<span id="cb480-5024"><a href="#cb480-5024" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">varImp</span>(modFT3) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Overall))</span>
<span id="cb480-5025"><a href="#cb480-5025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5026"><a href="#cb480-5026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5027"><a href="#cb480-5027" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-5028"><a href="#cb480-5028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5029"><a href="#cb480-5029" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model results for full interactive model (best model)</span></span>
<span id="cb480-5030"><a href="#cb480-5030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5033"><a href="#cb480-5033" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-5034"><a href="#cb480-5034" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fullModel</span></span>
<span id="cb480-5035"><a href="#cb480-5035" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.statology.org/logistic-regression-in-r/</span></span>
<span id="cb480-5036"><a href="#cb480-5036" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(modFT11)</span></span>
<span id="cb480-5037"><a href="#cb480-5037" aria-hidden="true" tabindex="-1"></a><span class="co">#anova(modFT11)</span></span>
<span id="cb480-5038"><a href="#cb480-5038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5039"><a href="#cb480-5039" aria-hidden="true" tabindex="-1"></a><span class="co"># full interaction</span></span>
<span id="cb480-5040"><a href="#cb480-5040" aria-hidden="true" tabindex="-1"></a>pscl<span class="sc">::</span><span class="fu">pR2</span>(modFT11)[<span class="st">"McFadden"</span>]</span>
<span id="cb480-5041"><a href="#cb480-5041" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">varImp</span>(modFT11) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Overall))</span>
<span id="cb480-5042"><a href="#cb480-5042" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-5043"><a href="#cb480-5043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5044"><a href="#cb480-5044" aria-hidden="true" tabindex="-1"></a><span class="fu">### Precict p(neg growth in mass)</span></span>
<span id="cb480-5045"><a href="#cb480-5045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5048"><a href="#cb480-5048" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-5049"><a href="#cb480-5049" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictFull</span></span>
<span id="cb480-5050"><a href="#cb480-5050" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb480-5051"><a href="#cb480-5051" aria-hidden="true" tabindex="-1"></a>predD <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb480-5052"><a href="#cb480-5052" aria-hidden="true" tabindex="-1"></a>  <span class="at">meanFlowByRiverScaledBySeason =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb480-5053"><a href="#cb480-5053" aria-hidden="true" tabindex="-1"></a>  <span class="at">meanTemperatureScaledBySeason =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), </span>
<span id="cb480-5054"><a href="#cb480-5054" aria-hidden="true" tabindex="-1"></a>  <span class="at">river =</span> <span class="fu">unique</span>(cd1<span class="sc">$</span>river), </span>
<span id="cb480-5055"><a href="#cb480-5055" aria-hidden="true" tabindex="-1"></a>  <span class="at">species =</span> <span class="fu">unique</span>(cd1<span class="sc">$</span>species), </span>
<span id="cb480-5056"><a href="#cb480-5056" aria-hidden="true" tabindex="-1"></a>  <span class="at">season =</span> <span class="fu">unique</span>(cd1<span class="sc">$</span>season),</span>
<span id="cb480-5057"><a href="#cb480-5057" aria-hidden="true" tabindex="-1"></a>  <span class="at">observedWeight =</span> <span class="fu">seq</span>(<span class="fu">min</span>(cd1<span class="sc">$</span>observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">max</span>(cd1<span class="sc">$</span>observedWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">40</span>)</span>
<span id="cb480-5058"><a href="#cb480-5058" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb480-5059"><a href="#cb480-5059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5060"><a href="#cb480-5060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5061"><a href="#cb480-5061" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">add_column</span>(predD, </span>
<span id="cb480-5062"><a href="#cb480-5062" aria-hidden="true" tabindex="-1"></a>                   <span class="at">pred =</span> <span class="fu">predict.glm</span>(modFT11, predD, <span class="at">type =</span> <span class="st">"response"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb480-5063"><a href="#cb480-5063" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">groupT =</span> <span class="fu">paste</span>(river, species, season, meanTemperatureScaledBySeason, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb480-5064"><a href="#cb480-5064" aria-hidden="true" tabindex="-1"></a>               <span class="at">groupF =</span> <span class="fu">paste</span>(river, species, season, meanFlowByRiverScaledBySeason, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb480-5065"><a href="#cb480-5065" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb480-5066"><a href="#cb480-5066" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb480-5067"><a href="#cb480-5067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5068"><a href="#cb480-5068" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot predictions</span></span>
<span id="cb480-5069"><a href="#cb480-5069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5072"><a href="#cb480-5072" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb480-5073"><a href="#cb480-5073" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plotPred</span></span>
<span id="cb480-5074"><a href="#cb480-5074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5075"><a href="#cb480-5075" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred <span class="sc">|&gt;</span> <span class="fu">filter</span>(meanTemperatureScaledBySeason <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>), observedWeight <span class="sc">==</span> <span class="fl">161.3</span>), <span class="fu">aes</span>(meanFlowByRiverScaledBySeason, pred, <span class="at">group=</span> groupT)) <span class="sc">+</span></span>
<span id="cb480-5076"><a href="#cb480-5076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(meanTemperatureScaledBySeason))) <span class="sc">+</span></span>
<span id="cb480-5077"><a href="#cb480-5077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Probability of negative growth in mass"</span>, <span class="at">x =</span> <span class="st">"Mean flow"</span>) <span class="sc">+</span></span>
<span id="cb480-5078"><a href="#cb480-5078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span>    </span>
<span id="cb480-5079"><a href="#cb480-5079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(season<span class="sc">~</span>species<span class="sc">+</span>river)</span>
<span id="cb480-5080"><a href="#cb480-5080" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>
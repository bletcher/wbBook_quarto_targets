---
title: "All data"
format:
  html:
    toc: false
    echo: false
    keep-hidden: false
    code-tools: true
---

Note: need to do a full book render to get OJS functionality.

## Merge All data

```{r dataAllOptions, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

```{r librariesdataAll, echo = FALSE}
#library(devtools)
#options(download.file.method = "wininet") or turn off VPN
#devtools::install_github('Conte-Ecology/westBrookData/getWBData')
library(tidyverse)
library(lubridate)
library(validate)
library(targets)


# devtools::install_github('bletcher/getPrepareWBData')
# use this if command above doesn't work: options(download.file.method = "wininet")
#library(getPrepareWBData)
```

### Read merged data target

```{r dataAll}

all <- tar_read(cdWB_all)
  
str(all)
```

```{r}
tags <- all %>%
  group_by(tag) %>%
  summarize(n = n()) %>%
  arrange(desc(n)) %>%
  filter(!is.na(tag))

  tags10 <- tags %>%
    filter(n >450, n < 500)
    

ojs_define(tagsOJS = tags$tag)
```

```{ojs}

allTop10 <- all %>%
  filter(tag %in% tags10$tag) %>%
  select(tag, detectionDate, river, section, observedLength)
  
  
ojs_define(allOJS = transpose(allTop10))
```


```{ojs}
//| panel: input

viewof selectTag = Inputs.select(
  tagsOJS,
  {
    value: "1bf20ebcae",
    label: "Tags:",
    multiple: true
  }
)

```

```{ojs}
tagsToPlot = allOJS.filter((d) => selectTag.includes(d.tag))

tagsOverTime = Plot.plot({
  marks: [
    Plot.dot(tagsToPlot, { x: "detectionDate", y: "section", stroke: "tag" }),
    Plot.line(tagsToPlot, { x: "detectionDate", y: "section", stroke: "tag" })
  ]
})
```


